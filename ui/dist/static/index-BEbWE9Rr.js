var qr=Object.defineProperty;var Gr=(r,e,s)=>e in r?qr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[e]=s;var B=(r,e,s)=>Gr(r,typeof e!="symbol"?e+"":e,s);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function s(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(i){if(i.ep)return;i.ep=!0;const n=s(i);fetch(i.href,n)}})();var _e,M,jt,ie,ht,zt,Ft,It,Qe,Be,Je,Ht,be={},Bt=[],Zr=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,we=Array.isArray;function ee(r,e){for(var s in e)r[s]=e[s];return r}function Xe(r){r&&r.parentNode&&r.parentNode.removeChild(r)}function re(r,e,s){var a,i,n,o={};for(n in e)n=="key"?a=e[n]:n=="ref"?i=e[n]:o[n]=e[n];if(arguments.length>2&&(o.children=arguments.length>3?_e.call(arguments,2):s),typeof r=="function"&&r.defaultProps!=null)for(n in r.defaultProps)o[n]===void 0&&(o[n]=r.defaultProps[n]);return ve(r,o,a,i,null)}function ve(r,e,s,a,i){var n={type:r,props:e,key:s,ref:a,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:i??++jt,__i:-1,__u:0};return i==null&&M.vnode!=null&&M.vnode(n),n}function Jt(){return{current:null}}function X(r){return r.children}function K(r,e){this.props=r,this.context=e}function ue(r,e){if(e==null)return r.__?ue(r.__,r.__i+1):null;for(var s;e<r.__k.length;e++)if((s=r.__k[e])!=null&&s.__e!=null)return s.__e;return typeof r.type=="function"?ue(r):null}function Vt(r){var e,s;if((r=r.__)!=null&&r.__c!=null){for(r.__e=r.__c.base=null,e=0;e<r.__k.length;e++)if((s=r.__k[e])!=null&&s.__e!=null){r.__e=r.__c.base=s.__e;break}return Vt(r)}}function Ve(r){(!r.__d&&(r.__d=!0)&&ie.push(r)&&!Ee.__r++||ht!=M.debounceRendering)&&((ht=M.debounceRendering)||zt)(Ee)}function Ee(){for(var r,e,s,a,i,n,o,d=1;ie.length;)ie.length>d&&ie.sort(Ft),r=ie.shift(),d=ie.length,r.__d&&(s=void 0,a=void 0,i=(a=(e=r).__v).__e,n=[],o=[],e.__P&&((s=ee({},a)).__v=a.__v+1,M.vnode&&M.vnode(s),Ye(e.__P,s,a,e.__n,e.__P.namespaceURI,32&a.__u?[i]:null,n,i??ue(a),!!(32&a.__u),o),s.__v=a.__v,s.__.__k[s.__i]=s,Zt(n,s,o),a.__e=a.__=null,s.__e!=i&&Vt(s)));Ee.__r=0}function qt(r,e,s,a,i,n,o,d,h,u,f){var c,m,l,b,_,k,g,p=a&&a.__k||Bt,L=e.length;for(h=Qr(s,e,p,h,L),c=0;c<L;c++)(l=s.__k[c])!=null&&(m=l.__i==-1?be:p[l.__i]||be,l.__i=c,k=Ye(r,l,m,i,n,o,d,h,u,f),b=l.__e,l.ref&&m.ref!=l.ref&&(m.ref&&Ke(m.ref,null,l),f.push(l.ref,l.__c||b,l)),_==null&&b!=null&&(_=b),(g=!!(4&l.__u))||m.__k===l.__k?h=Gt(l,h,r,g):typeof l.type=="function"&&k!==void 0?h=k:b&&(h=b.nextSibling),l.__u&=-7);return s.__e=_,h}function Qr(r,e,s,a,i){var n,o,d,h,u,f=s.length,c=f,m=0;for(r.__k=new Array(i),n=0;n<i;n++)(o=e[n])!=null&&typeof o!="boolean"&&typeof o!="function"?(h=n+m,(o=r.__k[n]=typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?ve(null,o,null,null,null):we(o)?ve(X,{children:o},null,null,null):o.constructor==null&&o.__b>0?ve(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o).__=r,o.__b=r.__b+1,d=null,(u=o.__i=Xr(o,s,h,c))!=-1&&(c--,(d=s[u])&&(d.__u|=2)),d==null||d.__v==null?(u==-1&&(i>f?m--:i<f&&m++),typeof o.type!="function"&&(o.__u|=4)):u!=h&&(u==h-1?m--:u==h+1?m++:(u>h?m--:m++,o.__u|=4))):r.__k[n]=null;if(c)for(n=0;n<f;n++)(d=s[n])!=null&&!(2&d.__u)&&(d.__e==a&&(a=ue(d)),Xt(d,d));return a}function Gt(r,e,s,a){var i,n;if(typeof r.type=="function"){for(i=r.__k,n=0;i&&n<i.length;n++)i[n]&&(i[n].__=r,e=Gt(i[n],e,s,a));return e}r.__e!=e&&(a&&(e&&r.type&&!e.parentNode&&(e=ue(r)),s.insertBefore(r.__e,e||null)),e=r.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function se(r,e){return e=e||[],r==null||typeof r=="boolean"||(we(r)?r.some(function(s){se(s,e)}):e.push(r)),e}function Xr(r,e,s,a){var i,n,o,d=r.key,h=r.type,u=e[s],f=u!=null&&(2&u.__u)==0;if(u===null&&r.key==null||f&&d==u.key&&h==u.type)return s;if(a>(f?1:0)){for(i=s-1,n=s+1;i>=0||n<e.length;)if((u=e[o=i>=0?i--:n++])!=null&&!(2&u.__u)&&d==u.key&&h==u.type)return o}return-1}function mt(r,e,s){e[0]=="-"?r.setProperty(e,s??""):r[e]=s==null?"":typeof s!="number"||Zr.test(e)?s:s+"px"}function Se(r,e,s,a,i){var n,o;e:if(e=="style")if(typeof s=="string")r.style.cssText=s;else{if(typeof a=="string"&&(r.style.cssText=a=""),a)for(e in a)s&&e in s||mt(r.style,e,"");if(s)for(e in s)a&&s[e]==a[e]||mt(r.style,e,s[e])}else if(e[0]=="o"&&e[1]=="n")n=e!=(e=e.replace(It,"$1")),o=e.toLowerCase(),e=o in r||e=="onFocusOut"||e=="onFocusIn"?o.slice(2):e.slice(2),r.l||(r.l={}),r.l[e+n]=s,s?a?s.u=a.u:(s.u=Qe,r.addEventListener(e,n?Je:Be,n)):r.removeEventListener(e,n?Je:Be,n);else{if(i=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in r)try{r[e]=s??"";break e}catch{}typeof s=="function"||(s==null||s===!1&&e[4]!="-"?r.removeAttribute(e):r.setAttribute(e,e=="popover"&&s==1?"":s))}}function ft(r){return function(e){if(this.l){var s=this.l[e.type+r];if(e.t==null)e.t=Qe++;else if(e.t<s.u)return;return s(M.event?M.event(e):e)}}}function Ye(r,e,s,a,i,n,o,d,h,u){var f,c,m,l,b,_,k,g,p,L,C,P,S,R,E,D,z,j=e.type;if(e.constructor!=null)return null;128&s.__u&&(h=!!(32&s.__u),n=[d=e.__e=s.__e]),(f=M.__b)&&f(e);e:if(typeof j=="function")try{if(g=e.props,p="prototype"in j&&j.prototype.render,L=(f=j.contextType)&&a[f.__c],C=f?L?L.props.value:f.__:a,s.__c?k=(c=e.__c=s.__c).__=c.__E:(p?e.__c=c=new j(g,C):(e.__c=c=new K(g,C),c.constructor=j,c.render=Kr),L&&L.sub(c),c.props=g,c.state||(c.state={}),c.context=C,c.__n=a,m=c.__d=!0,c.__h=[],c._sb=[]),p&&c.__s==null&&(c.__s=c.state),p&&j.getDerivedStateFromProps!=null&&(c.__s==c.state&&(c.__s=ee({},c.__s)),ee(c.__s,j.getDerivedStateFromProps(g,c.__s))),l=c.props,b=c.state,c.__v=e,m)p&&j.getDerivedStateFromProps==null&&c.componentWillMount!=null&&c.componentWillMount(),p&&c.componentDidMount!=null&&c.__h.push(c.componentDidMount);else{if(p&&j.getDerivedStateFromProps==null&&g!==l&&c.componentWillReceiveProps!=null&&c.componentWillReceiveProps(g,C),!c.__e&&c.shouldComponentUpdate!=null&&c.shouldComponentUpdate(g,c.__s,C)===!1||e.__v==s.__v){for(e.__v!=s.__v&&(c.props=g,c.state=c.__s,c.__d=!1),e.__e=s.__e,e.__k=s.__k,e.__k.some(function(v){v&&(v.__=e)}),P=0;P<c._sb.length;P++)c.__h.push(c._sb[P]);c._sb=[],c.__h.length&&o.push(c);break e}c.componentWillUpdate!=null&&c.componentWillUpdate(g,c.__s,C),p&&c.componentDidUpdate!=null&&c.__h.push(function(){c.componentDidUpdate(l,b,_)})}if(c.context=C,c.props=g,c.__P=r,c.__e=!1,S=M.__r,R=0,p){for(c.state=c.__s,c.__d=!1,S&&S(e),f=c.render(c.props,c.state,c.context),E=0;E<c._sb.length;E++)c.__h.push(c._sb[E]);c._sb=[]}else do c.__d=!1,S&&S(e),f=c.render(c.props,c.state,c.context),c.state=c.__s;while(c.__d&&++R<25);c.state=c.__s,c.getChildContext!=null&&(a=ee(ee({},a),c.getChildContext())),p&&!m&&c.getSnapshotBeforeUpdate!=null&&(_=c.getSnapshotBeforeUpdate(l,b)),D=f,f!=null&&f.type===X&&f.key==null&&(D=Qt(f.props.children)),d=qt(r,we(D)?D:[D],e,s,a,i,n,o,d,h,u),c.base=e.__e,e.__u&=-161,c.__h.length&&o.push(c),k&&(c.__E=c.__=null)}catch(v){if(e.__v=null,h||n!=null)if(v.then){for(e.__u|=h?160:128;d&&d.nodeType==8&&d.nextSibling;)d=d.nextSibling;n[n.indexOf(d)]=null,e.__e=d}else{for(z=n.length;z--;)Xe(n[z]);qe(e)}else e.__e=s.__e,e.__k=s.__k,v.then||qe(e);M.__e(v,e,s)}else n==null&&e.__v==s.__v?(e.__k=s.__k,e.__e=s.__e):d=e.__e=Yr(s.__e,e,s,a,i,n,o,h,u);return(f=M.diffed)&&f(e),128&e.__u?void 0:d}function qe(r){r&&r.__c&&(r.__c.__e=!0),r&&r.__k&&r.__k.forEach(qe)}function Zt(r,e,s){for(var a=0;a<s.length;a++)Ke(s[a],s[++a],s[++a]);M.__c&&M.__c(e,r),r.some(function(i){try{r=i.__h,i.__h=[],r.some(function(n){n.call(i)})}catch(n){M.__e(n,i.__v)}})}function Qt(r){return typeof r!="object"||r==null||r.__b&&r.__b>0?r:we(r)?r.map(Qt):ee({},r)}function Yr(r,e,s,a,i,n,o,d,h){var u,f,c,m,l,b,_,k=s.props,g=e.props,p=e.type;if(p=="svg"?i="http://www.w3.org/2000/svg":p=="math"?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),n!=null){for(u=0;u<n.length;u++)if((l=n[u])&&"setAttribute"in l==!!p&&(p?l.localName==p:l.nodeType==3)){r=l,n[u]=null;break}}if(r==null){if(p==null)return document.createTextNode(g);r=document.createElementNS(i,p,g.is&&g),d&&(M.__m&&M.__m(e,n),d=!1),n=null}if(p==null)k===g||d&&r.data==g||(r.data=g);else{if(n=n&&_e.call(r.childNodes),k=s.props||be,!d&&n!=null)for(k={},u=0;u<r.attributes.length;u++)k[(l=r.attributes[u]).name]=l.value;for(u in k)if(l=k[u],u!="children"){if(u=="dangerouslySetInnerHTML")c=l;else if(!(u in g)){if(u=="value"&&"defaultValue"in g||u=="checked"&&"defaultChecked"in g)continue;Se(r,u,null,l,i)}}for(u in g)l=g[u],u=="children"?m=l:u=="dangerouslySetInnerHTML"?f=l:u=="value"?b=l:u=="checked"?_=l:d&&typeof l!="function"||k[u]===l||Se(r,u,l,k[u],i);if(f)d||c&&(f.__html==c.__html||f.__html==r.innerHTML)||(r.innerHTML=f.__html),e.__k=[];else if(c&&(r.innerHTML=""),qt(e.type=="template"?r.content:r,we(m)?m:[m],e,s,a,p=="foreignObject"?"http://www.w3.org/1999/xhtml":i,n,o,n?n[0]:s.__k&&ue(s,0),d,h),n!=null)for(u=n.length;u--;)Xe(n[u]);d||(u="value",p=="progress"&&b==null?r.removeAttribute("value"):b!=null&&(b!==r[u]||p=="progress"&&!b||p=="option"&&b!=k[u])&&Se(r,u,b,k[u],i),u="checked",_!=null&&_!=r[u]&&Se(r,u,_,k[u],i))}return r}function Ke(r,e,s){try{if(typeof r=="function"){var a=typeof r.__u=="function";a&&r.__u(),a&&e==null||(r.__u=r(e))}else r.current=e}catch(i){M.__e(i,s)}}function Xt(r,e,s){var a,i;if(M.unmount&&M.unmount(r),(a=r.ref)&&(a.current&&a.current!=r.__e||Ke(a,null,e)),(a=r.__c)!=null){if(a.componentWillUnmount)try{a.componentWillUnmount()}catch(n){M.__e(n,e)}a.base=a.__P=null}if(a=r.__k)for(i=0;i<a.length;i++)a[i]&&Xt(a[i],e,s||typeof r.type!="function");s||Xe(r.__e),r.__c=r.__=r.__e=void 0}function Kr(r,e,s){return this.constructor(r,s)}function he(r,e,s){var a,i,n,o;e==document&&(e=document.documentElement),M.__&&M.__(r,e),i=(a=typeof s=="function")?null:s&&s.__k||e.__k,n=[],o=[],Ye(e,r=(!a&&s||e).__k=re(X,null,[r]),i||be,be,e.namespaceURI,!a&&s?[s]:i?null:e.firstChild?_e.call(e.childNodes):null,n,!a&&s?s:i?i.__e:e.firstChild,a,o),Zt(n,r,o)}function Yt(r,e){he(r,e,Yt)}function es(r,e,s){var a,i,n,o,d=ee({},r.props);for(n in r.type&&r.type.defaultProps&&(o=r.type.defaultProps),e)n=="key"?a=e[n]:n=="ref"?i=e[n]:d[n]=e[n]===void 0&&o!=null?o[n]:e[n];return arguments.length>2&&(d.children=arguments.length>3?_e.call(arguments,2):s),ve(r.type,d,a||r.key,i||r.ref,null)}function Kt(r){function e(s){var a,i;return this.getChildContext||(a=new Set,(i={})[e.__c]=this,this.getChildContext=function(){return i},this.componentWillUnmount=function(){a=null},this.shouldComponentUpdate=function(n){this.props.value!=n.value&&a.forEach(function(o){o.__e=!0,Ve(o)})},this.sub=function(n){a.add(n);var o=n.componentWillUnmount;n.componentWillUnmount=function(){a&&a.delete(n),o&&o.call(n)}}),s.children}return e.__c="__cC"+Ht++,e.__=r,e.Provider=e.__l=(e.Consumer=function(s,a){return s.children(a)}).contextType=e,e}_e=Bt.slice,M={__e:function(r,e,s,a){for(var i,n,o;e=e.__;)if((i=e.__c)&&!i.__)try{if((n=i.constructor)&&n.getDerivedStateFromError!=null&&(i.setState(n.getDerivedStateFromError(r)),o=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(r,a||{}),o=i.__d),o)return i.__E=i}catch(d){r=d}throw r}},jt=0,K.prototype.setState=function(r,e){var s;s=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=ee({},this.state),typeof r=="function"&&(r=r(ee({},s),this.props)),r&&ee(s,r),r!=null&&this.__v&&(e&&this._sb.push(e),Ve(this))},K.prototype.forceUpdate=function(r){this.__v&&(this.__e=!0,r&&this.__h.push(r),Ve(this))},K.prototype.render=X,ie=[],zt=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Ft=function(r,e){return r.__v.__b-e.__v.__b},Ee.__r=0,It=/(PointerCapture)$|Capture$/i,Qe=0,Be=ft(!1),Je=ft(!0),Ht=0;var ts=0;function t(r,e,s,a,i,n){e||(e={});var o,d,h=e;if("ref"in h)for(d in h={},e)d=="ref"?o=e[d]:h[d]=e[d];var u={type:r,props:h,key:s,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--ts,__i:-1,__u:0,__source:i,__self:n};if(typeof r=="function"&&(o=r.defaultProps))for(d in o)h[d]===void 0&&(h[d]=o[d]);return M.vnode&&M.vnode(u),u}var ae,I,je,pt,me=0,er=[],V=M,gt=V.__b,vt=V.__r,yt=V.diffed,bt=V.__c,xt=V.unmount,_t=V.__;function ce(r,e){V.__h&&V.__h(I,r,me||e),me=0;var s=I.__H||(I.__H={__:[],__h:[]});return r>=s.__.length&&s.__.push({}),s.__[r]}function x(r){return me=1,Pe(tr,r)}function Pe(r,e,s){var a=ce(ae++,2);if(a.t=r,!a.__c&&(a.__=[s?s(e):tr(void 0,e),function(d){var h=a.__N?a.__N[0]:a.__[0],u=a.t(h,d);h!==u&&(a.__N=[u,a.__[1]],a.__c.setState({}))}],a.__c=I,!I.__f)){var i=function(d,h,u){if(!a.__c.__H)return!0;var f=a.__c.__H.__.filter(function(m){return!!m.__c});if(f.every(function(m){return!m.__N}))return!n||n.call(this,d,h,u);var c=a.__c.props!==d;return f.forEach(function(m){if(m.__N){var l=m.__[0];m.__=m.__N,m.__N=void 0,l!==m.__[0]&&(c=!0)}}),n&&n.call(this,d,h,u)||c};I.__f=!0;var n=I.shouldComponentUpdate,o=I.componentWillUpdate;I.componentWillUpdate=function(d,h,u){if(this.__e){var f=n;n=void 0,i(d,h,u),n=f}o&&o.call(this,d,h,u)},I.shouldComponentUpdate=i}return a.__N||a.__}function F(r,e){var s=ce(ae++,3);!V.__s&&nt(s.__H,e)&&(s.__=r,s.u=e,I.__H.__h.push(s))}function pe(r,e){var s=ce(ae++,4);!V.__s&&nt(s.__H,e)&&(s.__=r,s.u=e,I.__h.push(s))}function Ue(r){return me=5,ne(function(){return{current:r}},[])}function et(r,e,s){me=6,pe(function(){if(typeof r=="function"){var a=r(e());return function(){r(null),a&&typeof a=="function"&&a()}}if(r)return r.current=e(),function(){return r.current=null}},s==null?s:s.concat(r))}function ne(r,e){var s=ce(ae++,7);return nt(s.__H,e)&&(s.__=r(),s.__H=e,s.__h=r),s.__}function tt(r,e){return me=8,ne(function(){return r},e)}function rt(r){var e=I.context[r.__c],s=ce(ae++,9);return s.c=r,e?(s.__==null&&(s.__=!0,e.sub(I)),e.props.value):r.__}function st(r,e){V.useDebugValue&&V.useDebugValue(e?e(r):r)}function rs(r){var e=ce(ae++,10),s=x();return e.__=r,I.componentDidCatch||(I.componentDidCatch=function(a,i){e.__&&e.__(a,i),s[1](a)}),[s[0],function(){s[1](void 0)}]}function at(){var r=ce(ae++,11);if(!r.__){for(var e=I.__v;e!==null&&!e.__m&&e.__!==null;)e=e.__;var s=e.__m||(e.__m=[0,0]);r.__="P"+s[0]+"-"+s[1]++}return r.__}function ss(){for(var r;r=er.shift();)if(r.__P&&r.__H)try{r.__H.__h.forEach(Te),r.__H.__h.forEach(Ge),r.__H.__h=[]}catch(e){r.__H.__h=[],V.__e(e,r.__v)}}V.__b=function(r){I=null,gt&&gt(r)},V.__=function(r,e){r&&e.__k&&e.__k.__m&&(r.__m=e.__k.__m),_t&&_t(r,e)},V.__r=function(r){vt&&vt(r),ae=0;var e=(I=r.__c).__H;e&&(je===I?(e.__h=[],I.__h=[],e.__.forEach(function(s){s.__N&&(s.__=s.__N),s.u=s.__N=void 0})):(e.__h.forEach(Te),e.__h.forEach(Ge),e.__h=[],ae=0)),je=I},V.diffed=function(r){yt&&yt(r);var e=r.__c;e&&e.__H&&(e.__H.__h.length&&(er.push(e)!==1&&pt===V.requestAnimationFrame||((pt=V.requestAnimationFrame)||as)(ss)),e.__H.__.forEach(function(s){s.u&&(s.__H=s.u),s.u=void 0})),je=I=null},V.__c=function(r,e){e.some(function(s){try{s.__h.forEach(Te),s.__h=s.__h.filter(function(a){return!a.__||Ge(a)})}catch(a){e.some(function(i){i.__h&&(i.__h=[])}),e=[],V.__e(a,s.__v)}}),bt&&bt(r,e)},V.unmount=function(r){xt&&xt(r);var e,s=r.__c;s&&s.__H&&(s.__H.__.forEach(function(a){try{Te(a)}catch(i){e=i}}),s.__H=void 0,e&&V.__e(e,s.__v))};var wt=typeof requestAnimationFrame=="function";function as(r){var e,s=function(){clearTimeout(a),wt&&cancelAnimationFrame(e),setTimeout(r)},a=setTimeout(s,35);wt&&(e=requestAnimationFrame(s))}function Te(r){var e=I,s=r.__c;typeof s=="function"&&(r.__c=void 0,s()),I=e}function Ge(r){var e=I;r.__c=r.__(),I=e}function nt(r,e){return!r||r.length!==e.length||e.some(function(s,a){return s!==r[a]})}function tr(r,e){return typeof e=="function"?e(r):e}class ns{constructor(){B(this,"state",{isAuthenticated:!1,user:null,accessToken:null,refreshToken:null});B(this,"listeners",new Set);B(this,"refreshTimer",null);B(this,"authStatus",null);B(this,"provider",null);this.loadFromStorage(),this.setupRefreshTimer()}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}async getAuthStatus(){if(this.authStatus)return this.authStatus;try{if(this.provider){const e=await this.provider.getAuthStatus();return this.authStatus=e,e}return this.state.isAuthenticated?{usersExist:!0}:{usersExist:!0}}catch(e){return console.warn("Failed to get auth status from provider:",e),{usersExist:!0}}}setAuthStatus(e){this.authStatus=e}setProvider(e){this.provider=e}notifyListeners(){this.listeners.forEach(e=>e(this.state))}updateState(e){this.state={...this.state,...e},this.saveToStorage(),this.notifyListeners()}loadFromStorage(){try{const e=localStorage.getItem("outway_auth");if(e){const s=JSON.parse(e);this.state={isAuthenticated:s.isAuthenticated||!1,user:s.user||null,accessToken:s.accessToken||null,refreshToken:s.refreshToken||null},this.state.accessToken&&this.isTokenExpired(this.state.accessToken)?(console.log("Access token expired, attempting refresh..."),this.state.refreshToken?this.refreshToken().catch(()=>{console.log("Refresh failed, logging out..."),this.logout()}):this.logout()):this.state.isAuthenticated&&this.setupRefreshTimer()}}catch(e){console.error("Failed to load auth state from storage:",e),this.clearAuth()}}isTokenExpired(e){try{const s=this.parseJWT(e);if(!s||!s.exp)return!0;const a=Math.floor(Date.now()/1e3);return s.exp<=a}catch(s){return console.error("Failed to parse token for expiry check:",s),!0}}saveToStorage(){try{localStorage.setItem("outway_auth",JSON.stringify(this.state))}catch(e){console.error("Failed to save auth state to storage:",e)}}clearStorage(){try{localStorage.removeItem("outway_auth")}catch(e){console.error("Failed to clear auth state from storage:",e)}}async login(e){const s=await fetch("/api/v1/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){const i=await s.json();throw new Error(i.error||"Login failed")}const a=await s.json();return this.updateState({isAuthenticated:!0,user:a.user,accessToken:a.access_token,refreshToken:a.refresh_token}),this.setupRefreshTimer(),a}async createFirstUser(e){const s=await fetch("/api/v1/auth/first-user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){const i=await s.json();throw new Error(i.error||"Failed to create first user")}const a=await s.json();return this.updateState({isAuthenticated:!0,user:a.user,accessToken:a.access_token,refreshToken:a.refresh_token}),this.setupRefreshTimer(),a}async refreshToken(){if(!this.state.refreshToken)throw new Error("No refresh token available");if(this.isTokenExpired(this.state.refreshToken))throw console.log("Refresh token expired, logging out..."),this.logout(),new Error("Refresh token expired");const e=await fetch("/api/v1/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:this.state.refreshToken})});if(!e.ok)throw console.log("Token refresh failed with status:",e.status),this.logout(),new Error("Token refresh failed");const s=await e.json();return this.updateState({accessToken:s.access_token,refreshToken:s.refresh_token}),this.setupRefreshTimer(),s}logout(){this.clearAuth()}clearAuth(){this.updateState({isAuthenticated:!1,user:null,accessToken:null,refreshToken:null}),this.clearStorage(),this.clearRefreshTimer()}getAccessToken(){return this.state.accessToken}getRefreshToken(){return this.state.refreshToken}isAuthenticated(){return this.state.isAuthenticated}getUser(){return this.state.user}setupRefreshTimer(){if(this.clearRefreshTimer(),!(!this.state.refreshToken||!this.state.accessToken))try{const e=this.parseJWT(this.state.accessToken);if(!e||!e.exp)return;const s=Math.floor(Date.now()/1e3),i=(e.exp-s)*1e3,n=Math.max(i-6e4,1e3);console.log(`Token expires in ${Math.floor(i/1e3)}s, will refresh in ${Math.floor(n/1e3)}s`),this.refreshTimer=setTimeout(async()=>{try{console.log("Auto-refreshing token..."),await this.refreshToken()}catch(o){console.error("Auto-refresh failed:",o),this.logout()}},n)}catch(e){console.error("Failed to parse JWT token for refresh timer:",e),this.refreshTimer=setTimeout(async()=>{try{await this.refreshToken()}catch(s){console.error("Auto-refresh failed:",s),this.logout()}},4*60*1e3)}}parseJWT(e){try{const s=e.split(".");if(s.length!==3)return null;const a=s[1];if(!a)return null;const i=atob(a.replace(/-/g,"+").replace(/_/g,"/"));return JSON.parse(i)}catch(s){return console.error("Failed to parse JWT:",s),null}}clearRefreshTimer(){this.refreshTimer&&(clearTimeout(this.refreshTimer),this.refreshTimer=null)}async fetchUsers(){return(await this.authenticatedFetch("/api/v1/users")).json()}async createUser(e){return(await this.authenticatedFetch("/api/v1/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json()}async getUserByEmail(e){return(await this.authenticatedFetch(`/api/v1/users/${e}`)).json()}async updateUser(e,s){return(await this.authenticatedFetch(`/api/v1/users/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json()}async deleteUser(e){await this.authenticatedFetch(`/api/v1/users/${e}`,{method:"DELETE"})}async changePassword(e,s){await this.authenticatedFetch(`/api/v1/users/${e}/change-password`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:s})})}async fetchRoles(){return(await this.authenticatedFetch("/api/v1/users/roles")).json()}async fetchRolePermissions(e){return(await this.authenticatedFetch(`/api/v1/users/roles/${e}/permissions`)).json()}async authenticatedFetch(e,s={}){if(!this.state.accessToken)throw new Error("Not authenticated");const a={...s.headers,Authorization:`Bearer ${this.state.accessToken}`},i=await fetch(e,{...s,headers:a});if(i.status===401)try{await this.refreshToken();const n={...s.headers,Authorization:`Bearer ${this.state.accessToken}`};return fetch(e,{...s,headers:n})}catch{throw this.logout(),new Error("Authentication failed")}if(!i.ok){const n=await i.json().catch(()=>({error:"Request failed"}));throw new Error(n.error||"Request failed")}return i}}const A=new ns;class is{constructor(e){B(this,"ws",null);B(this,"reconnectTimeout",null);B(this,"reconnectAttempts",0);B(this,"maxReconnectAttempts",10);B(this,"baseDelay",500);B(this,"maxDelay",1e4);B(this,"callbacks",new Map);B(this,"lastSnapshot",{});this.url=e}async connect(){return new Promise((e,s)=>{try{const a=this.url.replace(/^http/,"ws"),i=A.getAccessToken();if(!i){s(new Error("No access token available"));return}const n=`${a}?token=${encodeURIComponent(i)}`;this.ws=new WebSocket(n),this.ws.onopen=()=>{console.log("WebSocket connected"),this.reconnectAttempts=0,this.clearReconnectTimeout(),e()},this.ws.onmessage=o=>{try{const d=JSON.parse(o.data);this.handleMessage(d)}catch(d){console.warn("Invalid WebSocket message:",d)}},this.ws.onclose=()=>{console.log("WebSocket disconnected"),this.scheduleReconnect()},this.ws.onerror=o=>{console.error("WebSocket error:",o),s(o)},this.ws.addEventListener("ping",()=>{var o;((o=this.ws)==null?void 0:o.readyState)===WebSocket.OPEN&&this.ws.send("pong")})}catch(a){s(a)}})}close(){this.clearReconnectTimeout(),this.ws&&(this.ws.close(),this.ws=null)}handleMessage(e){let s=e.data;if(e.type==="upstreams"&&Array.isArray(s)){const i=this.lastSnapshot.upstreams||[];s=s.map((n,o)=>{var m;const d=(n.name||n.Name||"").toString(),h=n.weight??n.Weight,u=(n.type||n.Type||"").toString().toLowerCase(),f=(n.address||n.Address||"").toString();let c=f;if(/^(https?|udp|tcp|tls|dot|quic|doq):\/\//i.test(f)||(u&&u!=="doh"?c=`${u}://${f}`:c=`udp://${f}`),!c||c==="udp://"){const l=i.find(b=>b.name===d);c=(l==null?void 0:l.address)||((m=i[o])==null?void 0:m.address)||c}return{name:d,address:c,weight:h}})}if(e.type==="history"){const i=Array.isArray(s)?s:s&&Array.isArray(s.events)?s.events:[];s=i;try{console.debug("[WS] history",Array.isArray(i)?i.length:0)}catch{}}if(e.type==="stats"&&s)if(typeof s=="object"&&s!==null){s={dns_queries_total:s.dns_queries_total||0,dns_marks_total:s.dns_marks_total||0,marks_dropped_total:s.marks_dropped_total||0,dns_upstream_rtt_avg_seconds:s.dns_upstream_rtt_avg_seconds||0,dns_request_avg_seconds:s.dns_request_avg_seconds||0,service_ready:s.service_ready||0,effective_rps:s.effective_rps||0,origin_rps:s.origin_rps||0,cache_hit_rate:s.cache_hit_rate||0,...s};try{console.debug("[WS] stats received:",s)}catch{}}else try{console.warn("[WS] Invalid stats payload:",s)}catch{}if(e.type==="overview"&&s)try{window.__ov=s}catch{}if(e.type==="cache_updated"){const i=this.callbacks.get("cache");i&&i.forEach(n=>{var o,d,h,u;try{n({items:((o=this.lastSnapshot.cache)==null?void 0:o.items)||[],total:((d=this.lastSnapshot.cache)==null?void 0:d.total)||0,offset:((h=this.lastSnapshot.cache)==null?void 0:h.offset)||0,limit:((u=this.lastSnapshot.cache)==null?void 0:u.limit)||0})}catch{}})}this.lastSnapshot[e.type]=s;const a=this.callbacks.get(e.type);a&&a.forEach(i=>{try{i(s)}catch(n){console.error("Callback error:",n)}})}scheduleReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.error("Max reconnection attempts reached");return}this.clearReconnectTimeout();const e=Math.min(this.baseDelay*Math.pow(1.8,this.reconnectAttempts),this.maxDelay),s=e*.25,a=e+(Math.random()-.5)*s;this.reconnectTimeout=window.setTimeout(()=>{this.reconnectAttempts++,console.log(`Attempting to reconnect (${this.reconnectAttempts}/${this.maxReconnectAttempts})`),this.connect().catch(console.error)},a)}clearReconnectTimeout(){this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null)}onRuleGroups(e){return this.subscribe("rule_groups",e)}onUpstreams(e){return this.subscribe("upstreams",e)}onStats(e){return this.subscribe("stats",e)}onHistory(e){return this.subscribe("history",e)}onHosts(e){return this.subscribe("hosts",e)}onOverview(e){return this.subscribe("overview",e)}onCache(e){return this.subscribe("cache",e)}onCacheUpdated(e){return this.subscribe("cache_updated",e)}onUpdateAvailable(e){return this.subscribe("update_available",e)}subscribe(e,s){if(this.callbacks.has(e)||this.callbacks.set(e,new Set),this.callbacks.get(e).add(s),this.lastSnapshot[e])try{s(this.lastSnapshot[e])}catch(a){console.error("Snapshot callback error:",a)}return()=>{const a=this.callbacks.get(e);a&&(a.delete(s),a.size===0&&this.callbacks.delete(e))}}async fetchRuleGroups(){throw new Error("Use REST provider for fetch operations")}async createRuleGroup(e){throw new Error("Use REST provider for mutation operations")}async updateRuleGroup(e,s){throw new Error("Use REST provider for mutation operations")}async deleteRuleGroup(e){throw new Error("Use REST provider for mutation operations")}async fetchUpstreams(){throw new Error("Use REST provider for fetch operations")}async saveUpstreams(e){throw new Error("Use REST provider for mutation operations")}async fetchStats(){throw new Error("Use REST provider for fetch operations")}async fetchHistory(){throw new Error("Use REST provider for fetch operations")}async fetchServerInfo(){throw new Error("Use REST provider for fetch operations")}async fetchConfig(){throw new Error("Use REST provider for fetch operations")}async updateConfig(e){throw new Error("Use REST provider for mutation operations")}async fetchHosts(){throw new Error("Use REST provider for fetch operations")}async saveHosts(e){throw new Error("Use REST provider for mutation operations")}async testResolve(e,s){throw new Error("Use REST provider for fetch operations")}on(e,s){this.callbacks.has(e)||this.callbacks.set(e,new Set),this.callbacks.get(e).add(s)}off(e,s){const a=this.callbacks.get(e);a&&a.delete(s)}async request(e,s,a){throw new Error("Use REST provider for HTTP requests")}async fetchLocalZones(){throw new Error("Use REST provider for Local DNS operations")}async fetchLocalLeases(){throw new Error("Use REST provider for Local DNS operations")}async testLocalResolve(e){throw new Error("Use REST provider for Local DNS operations")}async getAuthStatus(){throw new Error("Use REST provider for authentication")}async login(e){throw new Error("Use REST provider for authentication")}async refreshToken(e){throw new Error("Use REST provider for authentication")}async createFirstUser(e){throw new Error("Use REST provider for authentication")}async fetchUsers(){throw new Error("Use REST provider for user management")}async createUser(e){throw new Error("Use REST provider for user management")}async getUser(e){throw new Error("Use REST provider for user management")}async updateUser(e,s){throw new Error("Use REST provider for user management")}async deleteUser(e){throw new Error("Use REST provider for user management")}async changePassword(e,s){throw new Error("Use REST provider for user management")}async fetchRoles(){throw new Error("Use REST provider for role management")}async fetchRolePermissions(e){throw new Error("Use REST provider for role management")}}class os{constructor(e=""){B(this,"pollingTimers",new Map);B(this,"callbacks",new Map);B(this,"pollingConfig",{stats:3e4,history:6e4,rule_groups:3e5,upstreams:3e5,hosts:3e5,cache:3e4,local_zones:3e4,local_leases:3e4});this.baseUrl=e}async connect(){this.startPolling("stats",()=>this.fetchStats()),this.startPolling("history",()=>this.fetchHistory()),this.startPolling("rule_groups",()=>this.fetchRuleGroups()),this.startPolling("upstreams",()=>this.fetchUpstreams()),this.startPolling("hosts",()=>this.fetchHosts()),this.startPolling("cache",()=>this.fetchCache())}close(){this.pollingTimers.forEach(e=>clearInterval(e)),this.pollingTimers.clear(),this.callbacks.clear()}async fetchJSON(e,s={}){const a=A.getAccessToken(),i={"Content-Type":"application/json",...s.headers};a&&!e.startsWith("/api/v1/auth/")&&(i.Authorization=`Bearer ${a}`);const n=await fetch(`${this.baseUrl}${e}`,{headers:i,...s});if(!n.ok){if(n.status===401&&a)try{await A.refreshToken();const d=A.getAccessToken();if(d){i.Authorization=`Bearer ${d}`;const h=await fetch(`${this.baseUrl}${e}`,{headers:i,...s});if(h.ok){const u=h.headers.get("content-type");return u!=null&&u.includes("application/json")?h.json():h.text()}}}catch(d){console.error("Token refresh failed:",d),A.logout()}throw new Error(`HTTP ${n.status}: ${await n.text()}`)}const o=n.headers.get("content-type");return o!=null&&o.includes("application/json")?n.json():n.text()}startPolling(e,s){const a=this.pollingConfig[e];s().then(n=>{this.notifyCallbacks(e,n)}).catch(console.error);const i=window.setInterval(()=>{s().then(n=>{this.notifyCallbacks(e,n)}).catch(console.error)},a);this.pollingTimers.set(e,i)}notifyCallbacks(e,s){const a=this.callbacks.get(e);a&&a.forEach(i=>{try{i(s)}catch(n){console.error("Polling callback error:",n)}})}onRuleGroups(e){return this.subscribe("rule_groups",e)}onUpstreams(e){return this.subscribe("upstreams",e)}onStats(e){return this.subscribe("stats",e)}onHistory(e){return this.subscribe("history",e)}onHosts(e){return this.subscribe("hosts",e)}onCache(e){return this.subscribe("cache",e)}onUpdateAvailable(e){return()=>{}}subscribe(e,s){return this.callbacks.has(e)||this.callbacks.set(e,new Set),this.callbacks.get(e).add(s),()=>{const a=this.callbacks.get(e);a&&(a.delete(s),a.size===0&&this.callbacks.delete(e))}}async fetchRuleGroups(){return(await this.fetchJSON("/api/v1/rule-groups")).rule_groups}async createRuleGroup(e){await this.fetchJSON("/api/v1/rule-groups",{method:"POST",body:JSON.stringify(e)})}async updateRuleGroup(e,s){await this.fetchJSON(`/api/v1/rule-groups/${encodeURIComponent(e)}`,{method:"PUT",body:JSON.stringify(s)})}async deleteRuleGroup(e){await this.fetchJSON(`/api/v1/rule-groups/${encodeURIComponent(e)}`,{method:"DELETE"})}async fetchUpstreams(){return(await this.fetchJSON("/api/v1/upstreams")).upstreams.map(s=>{var h,u;const a=s.name||s.Name||"",i=s.weight??s.Weight,n=(h=s.type)==null?void 0:h.toString().toLowerCase(),o=((u=s.address)==null?void 0:u.toString())||"";let d=o;return/^(https?|udp|tcp|tls|dot|quic|doq):\/\//i.test(o)?d=o:n&&n!=="doh"&&(d=`${n}://${o.replace(/^(udp|tcp|tls|dot|quic|doq):\/\//i,"")}`),{name:a,address:d,weight:i}})}async saveUpstreams(e){const s=e.map(a=>{const i=String(a.address||"").trim();let n=(a.name||"").trim();const o=typeof a.weight=="number"?a.weight:void 0;try{const u=new URL(i),f=u.protocol.replace(":","").toLowerCase();let c=i;return f!=="https"&&(c=`${f==="tls"?"dot":f==="quic"?"doq":f}://${u.host}`),n||(n=u.hostname),{name:n,address:c,...o!==void 0?{weight:o}:{}}}catch{}const d=i.replace(/^(udp|tcp|tls|dot|quic|doq):\/\//i,"");n||(n=d.split(":")[0]||d);const h=`udp://${d}`;return{name:n,address:h,...o!==void 0?{weight:o}:{}}});await this.fetchJSON("/api/v1/upstreams",{method:"POST",body:JSON.stringify({upstreams:s})})}async fetchStats(){return this.fetchJSON("/api/v1/stats")}async fetchHistory(){return(await this.fetchJSON("/api/v1/history")).events}async fetchHosts(){return(await this.fetchJSON("/api/v1/hosts")).hosts}async saveHosts(e){await this.fetchJSON("/api/v1/hosts",{method:"PUT",body:JSON.stringify({hosts:e})})}async fetchServerInfo(){return this.fetchJSON("/api/v1/info")}async testResolve(e,s){const a=new URLSearchParams({name:e,type:s});return this.fetchJSON(`/api/v1/resolve?${a.toString()}`)}async cacheFlush(){return this.fetchJSON("/api/v1/cache/flush",{method:"POST"})}async cacheDelete(e){return this.fetchJSON("/api/v1/cache/delete",{method:"POST",body:JSON.stringify(e)})}onOverview(e){return this.subscribe("overview",e)}async fetchOverview(){return this.fetchJSON("/api/v1/overview")}async fetchCache(e){const s=new URLSearchParams;e!=null&&e.offset&&s.set("offset",String(e.offset)),e!=null&&e.limit&&s.set("limit",String(e.limit)),e!=null&&e.q&&s.set("q",e.q);const a=s.toString();return this.fetchJSON(`/api/v1/cache${a?`?${a}`:""}`)}async fetchCacheKey(e){const s=new URLSearchParams({key:e});return this.fetchJSON(`/api/v1/cache/key?${s.toString()}`)}on(e,s){this.callbacks.has(e)||this.callbacks.set(e,new Set),this.callbacks.get(e).add(s)}off(e,s){const a=this.callbacks.get(e);a&&a.delete(s)}async request(e,s,a){const i=`${this.baseUrl}${s}`,n={method:e,headers:{"Content-Type":"application/json"}};return a&&(n.body=JSON.stringify(a)),fetch(i,n)}async fetchLocalZones(){return(await this.fetchJSON("/api/v1/local/zones")).zones||[]}async fetchLocalLeases(){return(await this.fetchJSON("/api/v1/local/leases")).leases||[]}async testLocalResolve(e){const s=new URLSearchParams({name:e});return this.fetchJSON(`/api/v1/local/resolve?${s.toString()}`)}async fetchWOLDevices(){return this.fetchJSON("/api/v1/wol/devices")}async fetchWOLInterfaces(){return this.fetchJSON("/api/v1/wol/interfaces")}async fetchWOLConfig(){return this.fetchJSON("/api/v1/wol/config")}async updateWOLConfig(e){await this.fetchJSON("/api/v1/wol/config",{method:"PUT",body:JSON.stringify(e)})}async scanWOLDevices(){return this.fetchJSON("/api/v1/wol/devices/scan")}async addWOLDevice(e){return this.fetchJSON("/api/v1/wol/devices/add",{method:"POST",body:JSON.stringify(e)})}async updateWOLDevice(e,s){await this.fetchJSON(`/api/v1/wol/devices/update?id=${e}`,{method:"POST",body:JSON.stringify(s)})}async deleteWOLDevice(e){await this.fetchJSON(`/api/v1/wol/devices/delete?id=${e}`,{method:"POST"})}async fetchDevices(){return this.fetchJSON("/api/v1/devices")}async fetchDevice(e){return this.fetchJSON(`/api/v1/devices/${e}`)}async addDevice(e){return this.fetchJSON("/api/v1/devices",{method:"POST",body:JSON.stringify(e)})}async updateDevice(e,s){await this.fetchJSON(`/api/v1/devices/${e}`,{method:"PUT",body:JSON.stringify(s)})}async deleteDevice(e){await this.fetchJSON(`/api/v1/devices/${e}`,{method:"DELETE"})}async fetchDevicesByType(e){return this.fetchJSON(`/api/v1/devices/type/${e}`)}async fetchOnlineDevices(){return this.fetchJSON("/api/v1/devices/online")}async fetchWakeableDevices(){return this.fetchJSON("/api/v1/devices/wakeable")}async fetchResolvableDevices(){return this.fetchJSON("/api/v1/devices/resolvable")}async scanDevices(){return this.fetchJSON("/api/v1/devices/scan")}async fetchDeviceStats(){return this.fetchJSON("/api/v1/devices/stats")}async wakeDevice(e){return this.fetchJSON(`/api/v1/devices/${e.id}/wake`,{method:"POST",body:JSON.stringify(e)})}async wakeAllDevices(){return this.fetchJSON("/api/v1/devices/wake-all",{method:"POST"})}async resolveDevice(e){return this.fetchJSON(`/api/v1/devices/${e}/resolve`)}async getAuthStatus(){return this.fetchJSON("/api/v1/auth/status")}async login(e){return this.fetchJSON("/api/v1/auth/login",{method:"POST",body:JSON.stringify(e)})}async refreshToken(e){return this.fetchJSON("/api/v1/auth/refresh",{method:"POST",body:JSON.stringify({refresh_token:e})})}async createFirstUser(e){return this.fetchJSON("/api/v1/auth/first-user",{method:"POST",body:JSON.stringify(e)})}async fetchUsers(){return this.fetchJSON("/api/v1/users")}async createUser(e){return this.fetchJSON("/api/v1/users",{method:"POST",body:JSON.stringify(e)})}async getUser(e){return this.fetchJSON(`/api/v1/users/${e}`)}async updateUser(e,s){return this.fetchJSON(`/api/v1/users/${e}`,{method:"PUT",body:JSON.stringify(s)})}async deleteUser(e){await this.fetchJSON(`/api/v1/users/${e}`,{method:"DELETE"})}async changePassword(e,s){await this.fetchJSON(`/api/v1/users/${e}/change-password`,{method:"POST",body:JSON.stringify({password:s})})}async fetchRoles(){return this.fetchJSON("/api/v1/users/roles")}async fetchRolePermissions(e){return this.fetchJSON(`/api/v1/users/roles/${e}/permissions`)}}class ls{constructor(e="/ws",s=""){B(this,"wsProvider");B(this,"restProvider");B(this,"isWSConnected",!1);B(this,"listeners",new Map);B(this,"wsUnsubs",new Map);B(this,"restUnsubs",new Map);B(this,"statusListeners",new Set);this.wsProvider=new is(e),this.restProvider=new os(s)}async connect(){try{await this.wsProvider.connect(),this.isWSConnected=!0,console.log("Using WebSocket provider")}catch(e){console.warn("WebSocket connection failed, falling back to REST:",e),this.isWSConnected=!1}try{await this.restProvider.connect(),console.log("REST provider ready")}catch(e){throw console.error("REST provider failed:",e),e}this.resubscribeAll(),this.monitorWSConnection(),this.emitStatus()}close(){this.wsProvider.close(),this.restProvider.close(),this.wsUnsubs.forEach(e=>e()),this.restUnsubs.forEach(e=>e()),this.wsUnsubs.clear(),this.restUnsubs.clear(),this.listeners.clear(),this.statusListeners.clear()}monitorWSConnection(){const e=setInterval(()=>{var i;const s=this.isWSConnected;if(!(((i=this.wsProvider.ws)==null?void 0:i.readyState)===WebSocket.OPEN)){setTimeout(()=>{var d;const n=((d=this.wsProvider.ws)==null?void 0:d.readyState)!==WebSocket.OPEN,o=this.isWSConnected;this.isWSConnected=!n,o!==this.isWSConnected&&(this.resubscribeAll(),console.log(this.isWSConnected?"WebSocket active":"Using REST fallback"),this.emitStatus())},1500);return}this.isWSConnected=!0,s!==!0&&(this.resubscribeAll(),console.log(this.isWSConnected?"WebSocket active":"Using REST fallback"),this.emitStatus())},1e4);this.wsUnsubs.set("_monitor",()=>clearInterval(e))}addListener(e,s){return this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(s),this.resubscribe(e),()=>{const a=this.listeners.get(e);a&&(a.delete(s),a.size===0&&this.listeners.delete(e));const i=this.wsUnsubs.get(e);i&&i();const n=this.restUnsubs.get(e);n&&n(),this.wsUnsubs.delete(e),this.restUnsubs.delete(e)}}resubscribe(e){const s=this.wsUnsubs.get(e);s&&s();const a=this.restUnsubs.get(e);a&&a(),this.wsUnsubs.delete(e),this.restUnsubs.delete(e);const i=this.listeners.get(e);if(!i||i.size===0)return;const n=o=>i.forEach(d=>{try{d(o)}catch{}});if(this.isWSConnected)switch(e){case"rule_groups":this.wsUnsubs.set(e,this.wsProvider.onRuleGroups(n));break;case"upstreams":this.wsUnsubs.set(e,this.wsProvider.onUpstreams(n));break;case"stats":this.wsUnsubs.set(e,this.wsProvider.onStats(n));break;case"history":this.wsUnsubs.set(e,this.wsProvider.onHistory(n));break;case"hosts":this.wsUnsubs.set(e,this.wsProvider.onHosts(n));break;case"overview":this.wsUnsubs.set(e,this.wsProvider.onOverview(n));break;case"update_available":this.wsUnsubs.set(e,this.wsProvider.onUpdateAvailable(n));break;case"cache":this.wsUnsubs.set(e,this.wsProvider.onCache(n));break}else switch(e){case"rule_groups":this.restUnsubs.set(e,this.restProvider.onRuleGroups(n)),this.restProvider.fetchRuleGroups().then(n).catch(console.error);break;case"upstreams":this.restUnsubs.set(e,this.restProvider.onUpstreams(n)),this.restProvider.fetchUpstreams().then(n).catch(console.error);break;case"stats":this.restUnsubs.set(e,this.restProvider.onStats(n)),this.restProvider.fetchStats().then(o=>{console.debug("[FailoverProvider] Stats loaded via REST:",o),n(o)}).catch(o=>{console.error("[FailoverProvider] Failed to load stats via REST:",o)});break;case"history":this.restUnsubs.set(e,this.restProvider.onHistory(n)),this.restProvider.fetchHistory().then(n).catch(console.error);break;case"hosts":this.restUnsubs.set(e,this.restProvider.onHosts(n)),this.restProvider.fetchHosts().then(n).catch(console.error);break;case"overview":this.restUnsubs.set(e,this.restProvider.onOverview(n)),this.restProvider.fetchOverview().then(n).catch(console.error);break;case"update_available":this.restUnsubs.set(e,this.restProvider.onUpdateAvailable(n));break;case"cache":this.restUnsubs.set(e,this.restProvider.onCache(n));break}}resubscribeAll(){Array.from(this.listeners.keys()).forEach(e=>this.resubscribe(e))}emitStatus(){const e={channel:this.isWSConnected?"ws":"rest",connected:!0};this.statusListeners.forEach(s=>{try{s(e)}catch{}})}onStatus(e){return this.statusListeners.add(e),e({channel:this.isWSConnected?"ws":"rest",connected:!0}),()=>{this.statusListeners.delete(e)}}async reconnect(){try{await this.wsProvider.connect(),this.isWSConnected=!0,this.resubscribeAll(),this.emitStatus()}catch{}}onRuleGroups(e){return this.addListener("rule_groups",e)}onUpstreams(e){return this.addListener("upstreams",e)}onStats(e){return this.addListener("stats",e)}onHistory(e){return this.addListener("history",e)}onHosts(e){return this.addListener("hosts",e)}onOverview(e){return this.addListener("overview",e)}onUpdateAvailable(e){return this.addListener("update_available",e)}onCache(e){return this.addListener("cache",e)}onCacheUpdated(e){return this.addListener("cache_updated",e)}async fetchCache(e){return this.restProvider.fetchCache(e)}async fetchRuleGroups(){try{return await this.restProvider.fetchRuleGroups()}catch(e){throw console.error("Failed to fetch rule groups:",e),e}}async createRuleGroup(e){try{await this.restProvider.createRuleGroup(e)}catch(s){throw console.error("Failed to create rule group:",s),s}}async updateRuleGroup(e,s){try{await this.restProvider.updateRuleGroup(e,s)}catch(a){throw console.error("Failed to update rule group:",a),a}}async deleteRuleGroup(e){try{await this.restProvider.deleteRuleGroup(e)}catch(s){throw console.error("Failed to delete rule group:",s),s}}async fetchUpstreams(){var e;try{return this.isWSConnected&&this.wsProvider&&((e=this.wsProvider.lastSnapshot)!=null&&e.upstreams)?this.wsProvider.lastSnapshot.upstreams:await this.restProvider.fetchUpstreams()}catch(s){throw console.error("Failed to fetch upstreams:",s),s}}async saveUpstreams(e){try{await this.restProvider.saveUpstreams(e)}catch(s){throw console.error("Failed to save upstreams:",s),s}}async fetchStats(){try{return await this.restProvider.fetchStats()}catch(e){throw console.error("Failed to fetch stats:",e),e}}async fetchHistory(){try{return await this.restProvider.fetchHistory()}catch(e){throw console.error("Failed to fetch history:",e),e}}async fetchHosts(){try{return await this.restProvider.fetchHosts()}catch(e){throw console.error("Failed to fetch hosts:",e),e}}async saveHosts(e){try{await this.restProvider.saveHosts(e)}catch(s){throw console.error("Failed to save hosts:",s),s}}async fetchServerInfo(){try{return await this.restProvider.fetchServerInfo()}catch(e){throw console.error("Failed to fetch server info:",e),e}}async fetchOverview(){try{return await this.restProvider.fetchOverview()}catch(e){throw console.error("Failed to fetch overview:",e),e}}async testResolve(e,s){try{return await this.restProvider.testResolve(e,s)}catch(a){throw console.error("Failed to run resolve test:",a),a}}async cacheFlush(){return this.restProvider.cacheFlush()}async cacheDelete(e){return this.restProvider.cacheDelete(e)}on(e,s){this.isWSConnected?this.wsProvider.on(e,s):this.restProvider.on(e,s)}off(e,s){this.isWSConnected?this.wsProvider.off(e,s):this.restProvider.off(e,s)}async request(e,s,a){return this.isWSConnected?this.wsProvider.request(e,s,a):this.restProvider.request(e,s,a)}async fetchLocalZones(){return this.restProvider.fetchLocalZones()}async fetchLocalLeases(){return this.restProvider.fetchLocalLeases()}async testLocalResolve(e){return this.restProvider.testLocalResolve(e)}async fetchWOLDevices(){return this.restProvider.fetchWOLDevices()}async fetchWOLInterfaces(){return this.restProvider.fetchWOLInterfaces()}async fetchWOLConfig(){return this.restProvider.fetchWOLConfig()}async updateWOLConfig(e){return this.restProvider.updateWOLConfig(e)}async scanWOLDevices(){return this.restProvider.scanWOLDevices()}async addWOLDevice(e){return this.restProvider.addWOLDevice(e)}async updateWOLDevice(e,s){return this.restProvider.updateWOLDevice(e,s)}async deleteWOLDevice(e){return this.restProvider.deleteWOLDevice(e)}async fetchDevices(){return this.restProvider.fetchDevices()}async fetchDevice(e){return this.restProvider.fetchDevice(e)}async addDevice(e){return this.restProvider.addDevice(e)}async updateDevice(e,s){return this.restProvider.updateDevice(e,s)}async deleteDevice(e){return this.restProvider.deleteDevice(e)}async fetchDevicesByType(e){return this.restProvider.fetchDevicesByType(e)}async fetchOnlineDevices(){return this.restProvider.fetchOnlineDevices()}async fetchWakeableDevices(){return this.restProvider.fetchWakeableDevices()}async fetchResolvableDevices(){return this.restProvider.fetchResolvableDevices()}async scanDevices(){return this.restProvider.scanDevices()}async fetchDeviceStats(){return this.restProvider.fetchDeviceStats()}async wakeDevice(e){return this.restProvider.wakeDevice(e)}async wakeAllDevices(){return this.restProvider.wakeAllDevices()}async resolveDevice(e){return this.restProvider.resolveDevice(e)}async getAuthStatus(){return this.restProvider.getAuthStatus()}async login(e){return this.restProvider.login(e)}async refreshToken(e){return this.restProvider.refreshToken(e)}async createFirstUser(e){return this.restProvider.createFirstUser(e)}async fetchUsers(){return this.restProvider.fetchUsers()}async createUser(e){return this.restProvider.createUser(e)}async getUser(e){return this.restProvider.getUser(e)}async updateUser(e,s){return this.restProvider.updateUser(e,s)}async deleteUser(e){return this.restProvider.deleteUser(e)}async changePassword(e,s){return this.restProvider.changePassword(e,s)}async fetchRoles(){return this.restProvider.fetchRoles()}async fetchRolePermissions(e){return this.restProvider.fetchRolePermissions(e)}}function H({children:r,className:e="",title:s,subtitle:a,...i}){const n=`card bg-white/80 dark:bg-gray-800/70 backdrop-blur-sm rounded-xl p-6 border border-gray-200/50 dark:border-gray-700/50 shadow-lg hover:shadow-xl transition-all duration-300 ${e}`.trim();return t("div",{className:n,...i,children:[(s||a)&&t("div",{className:"card-header pb-4 mb-6 border-b border-gray-200 dark:border-gray-700",children:[s&&t("h3",{className:"card-title text-xl font-semibold text-gray-900 dark:text-gray-100 leading-tight",children:s}),a&&t("p",{className:"card-subtitle text-sm text-gray-600 dark:text-gray-400 mt-2 leading-relaxed",children:a})]}),t("div",{className:"card-content text-gray-700 dark:text-gray-300 leading-relaxed",children:r})]})}function Ce({title:r,value:e,change:s,icon:a,color:i="blue",className:n=""}){const o={blue:"text-blue-600 dark:text-blue-400",green:"text-green-600 dark:text-green-400",red:"text-red-600 dark:text-red-400",yellow:"text-yellow-600 dark:text-yellow-400",purple:"text-purple-600 dark:text-purple-400",indigo:"text-indigo-600 dark:text-indigo-400"},d=`stats-card bg-white rounded-md p-6 shadow-sm dark:bg-black dark:shadow-none ${n}`.trim();return t("div",{className:d,children:t("div",{className:"flex items-center justify-between",children:[t("div",{children:[t("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:r}),t("p",{className:"text-2xl font-bold text-black dark:text-white mt-1",children:e}),s&&t("p",{className:`text-xs font-medium mt-2 ${s.type==="increase"?"text-green-600":"text-red-600"}`,children:[s.type==="increase"?"↗":"↘"," ",Math.abs(s.value),"%"]})]}),a&&t("div",{className:`flex-shrink-0 w-6 h-6 flex items-center justify-center rounded-full ${o[i]}`,children:a})]})})}function $({variant:r="primary",size:e="md",children:s,disabled:a=!1,loading:i=!1,fullWidth:n=!1,className:o="",...d}){const h="btn inline-flex items-center justify-center font-medium rounded-md disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 ease-out",u={primary:"btn-primary bg-blue-600 text-white hover:bg-blue-700 shadow-lg hover:shadow-xl shadow-blue-600/25 hover:shadow-blue-600/40 dark:bg-blue-600 dark:text-white dark:hover:bg-blue-700",secondary:"btn-secondary bg-gray-100 text-gray-900 hover:bg-gray-200 shadow-md hover:shadow-lg dark:bg-gray-700 dark:text-gray-100 dark:hover:bg-gray-600",outline:"btn-outline bg-white/80 dark:bg-gray-800/80 text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700 backdrop-blur-sm",danger:"btn-danger bg-red-600 text-white hover:bg-red-700 shadow-lg hover:shadow-xl shadow-red-600/25 hover:shadow-red-600/40 dark:bg-red-600 dark:text-white dark:hover:bg-red-700"},f={sm:"btn-sm px-3 py-2 text-sm rounded-lg",md:"btn-md px-4 py-2.5 text-sm rounded-lg",lg:"btn-lg px-6 py-3 text-base rounded-lg"},c=n?"w-full":"",m=i?"btn-loading":"",l=`${h} ${u[r]} ${f[e]} ${c} ${m} ${o}`.trim();return t("button",{className:l,disabled:a||i,...d,children:[i&&t("svg",{className:"btn-spinner animate-spin -ml-1 mr-2 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[t("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),t("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),s]})}function kt({title:r,data:e,type:s="line",height:a=300,loading:i=!1,error:n,className:o="",xLabel:d,yLabel:h}){const u=Ue(null);F(()=>{if(!u.current||!e)return;const l=u.current,b=l.getContext("2d");if(!b)return;const _=56,k=l.width-_*2,g=l.height-_*2;b.clearRect(0,0,l.width,l.height),s==="line"?f(b,e,_,k,g,d,h):s==="bar"?c(b,e,_,k,g,d,h):s==="doughnut"&&m(b,e,l.width/2,l.height/2,Math.min(l.width,l.height)/3)},[e,s]);const f=(l,b,_,k,g,p,L)=>{var j;const C=b.datasets[0];if(!C)return;const P=Math.max(...C.data),S=Math.min(...C.data),R=P-S||1;l.strokeStyle="#e5e7eb",l.lineWidth=1;for(let v=0;v<=5;v++){const y=_+g/5*v;l.beginPath(),l.moveTo(_,y),l.lineTo(_+k,y),l.stroke()}l.fillStyle="#6b7280",l.font="12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial",l.textAlign="right";for(let v=0;v<=5;v++){const y=_+g/5*v,w=P-R/5*v,W=Number.isFinite(w)?w>=100?w.toFixed(0):w.toFixed(1):"0";l.fillText(W,_-8,y+4)}L&&(l.save(),l.translate(16,_+g/2),l.rotate(-Math.PI/2),l.textAlign="center",l.fillText(L,0,0),l.restore()),l.textAlign="center";const E=C.data.length,D=Math.min(6,Math.max(2,E)),z=Math.max(1,Math.floor((E-1)/(D-1)));for(let v=0;v<E;v+=z){const y=_+k/(E-1)*v,w=((j=b.labels)==null?void 0:j[v])||"";w&&l.fillText(w,y,_+g+18)}p&&l.fillText(p,_+k/2,_+g+34),l.strokeStyle="#3b82f6",l.lineWidth=2,l.beginPath(),C.data.forEach((v,y)=>{const w=_+k/(C.data.length-1)*y,W=_+g-(v-S)/R*g;y===0?l.moveTo(w,W):l.lineTo(w,W)}),l.stroke(),l.fillStyle="#3b82f6",C.data.forEach((v,y)=>{const w=_+k/(C.data.length-1)*y,W=_+g-(v-S)/R*g;l.beginPath(),l.arc(w,W,4,0,2*Math.PI),l.fill()})},c=(l,b,_,k,g,p,L)=>{var j;const C=b.datasets[0];if(!C)return;const P=Math.max(...C.data),S=k/C.data.length*.8,R=k/C.data.length*.2;l.fillStyle="#3b82f6",C.data.forEach((v,y)=>{const w=v/P*g,W=_+y*(S+R)+R/2,J=_+g-w;l.fillRect(W,J,S,w)}),l.fillStyle="#6b7280",l.font="12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial",l.textAlign="right";for(let v=0;v<=5;v++){const y=_+g/5*v,w=P-P/5*v,W=Number.isFinite(w)?w>=100?w.toFixed(0):w.toFixed(1):"0";l.fillText(W,_-8,y+4)}L&&(l.save(),l.translate(16,_+g/2),l.rotate(-Math.PI/2),l.textAlign="center",l.fillText(L,0,0),l.restore()),l.textAlign="center";const E=C.data.length,D=Math.min(6,Math.max(2,E)),z=Math.max(1,Math.floor((E-1)/(D-1)));for(let v=0;v<E;v+=z){const y=_+v*(S+R)+R/2+S/2,w=((j=b.labels)==null?void 0:j[v])||"";w&&l.fillText(w,y,_+g+18)}p&&l.fillText(p,_+k/2,_+g+34)},m=(l,b,_,k,g)=>{const p=b.datasets[0];if(!p)return;const L=p.data.reduce((S,R)=>S+R,0),C=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6"];let P=0;p.data.forEach((S,R)=>{const E=S/L*2*Math.PI;l.beginPath(),l.arc(_,k,g,P,P+E),l.arc(_,k,g*.6,P+E,P,!0),l.closePath(),l.fillStyle=C[R%C.length],l.fill(),P+=E})};return i?t("div",{className:`flex items-center justify-center ${o}`,style:{height:a},children:t("div",{className:"text-center",children:[t("div",{className:"w-8 h-8 border-2 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),t("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Loading chart..."})]})}):n?t("div",{className:`flex items-center justify-center ${o}`,style:{height:a},children:t("div",{className:"text-center",children:[t("svg",{className:"w-12 h-12 mx-auto mb-4 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 16.5c-.77.833.192 2.5 1.732 2.5z"})}),t("p",{className:"text-sm text-red-600 dark:text-red-400",children:n})]})}):t("div",{className:`chart-container ${o}`,children:[r&&t("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:r}),t("div",{className:"relative",children:t("canvas",{ref:u,width:800,height:a,className:"w-full h-auto"})})]})}const cs={},Nt=r=>{let e;const s=new Set,a=(f,c)=>{const m=typeof f=="function"?f(e):f;if(!Object.is(m,e)){const l=e;e=c??(typeof m!="object"||m===null)?m:Object.assign({},e,m),s.forEach(b=>b(e,l))}},i=()=>e,h={setState:a,getState:i,getInitialState:()=>u,subscribe:f=>(s.add(f),()=>s.delete(f)),destroy:()=>{(cs?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),s.clear()}},u=e=r(a,i,h);return h},ds=r=>r?Nt(r):Nt;function rr(r,e){for(var s in e)r[s]=e[s];return r}function Ze(r,e){for(var s in r)if(s!=="__source"&&!(s in e))return!0;for(var a in e)if(a!=="__source"&&r[a]!==e[a])return!0;return!1}function it(r,e){var s=e(),a=x({t:{__:s,u:e}}),i=a[0].t,n=a[1];return pe(function(){i.__=s,i.u=e,ze(i)&&n({t:i})},[r,s,e]),F(function(){return ze(i)&&n({t:i}),r(function(){ze(i)&&n({t:i})})},[r]),s}function ze(r){var e,s,a=r.u,i=r.__;try{var n=a();return!((e=i)===(s=n)&&(e!==0||1/e==1/s)||e!=e&&s!=s)}catch{return!0}}function ot(r){r()}function lt(r){return r}function ct(){return[!1,ot]}var dt=pe;function Re(r,e){this.props=r,this.context=e}function sr(r,e){function s(i){var n=this.props.ref,o=n==i.ref;return!o&&n&&(n.call?n(null):n.current=null),e?!e(this.props,i)||!o:Ze(this.props,i)}function a(i){return this.shouldComponentUpdate=s,re(r,i)}return a.displayName="Memo("+(r.displayName||r.name)+")",a.prototype.isReactComponent=!0,a.__f=!0,a.type=r,a}(Re.prototype=new K).isPureReactComponent=!0,Re.prototype.shouldComponentUpdate=function(r,e){return Ze(this.props,r)||Ze(this.state,e)};var St=M.__b;M.__b=function(r){r.type&&r.type.__f&&r.ref&&(r.props.ref=r.ref,r.ref=null),St&&St(r)};var us=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function ar(r){function e(s){var a=rr({},s);return delete a.ref,r(a,s.ref||null)}return e.$$typeof=us,e.render=r,e.prototype.isReactComponent=e.__f=!0,e.displayName="ForwardRef("+(r.displayName||r.name)+")",e}var Ct=function(r,e){return r==null?null:se(se(r).map(e))},nr={map:Ct,forEach:Ct,count:function(r){return r?se(r).length:0},only:function(r){var e=se(r);if(e.length!==1)throw"Children.only";return e[0]},toArray:se},hs=M.__e;M.__e=function(r,e,s,a){if(r.then){for(var i,n=e;n=n.__;)if((i=n.__c)&&i.__c)return e.__e==null&&(e.__e=s.__e,e.__k=s.__k),i.__c(r,e)}hs(r,e,s,a)};var Lt=M.unmount;function ir(r,e,s){return r&&(r.__c&&r.__c.__H&&(r.__c.__H.__.forEach(function(a){typeof a.__c=="function"&&a.__c()}),r.__c.__H=null),(r=rr({},r)).__c!=null&&(r.__c.__P===s&&(r.__c.__P=e),r.__c.__e=!0,r.__c=null),r.__k=r.__k&&r.__k.map(function(a){return ir(a,e,s)})),r}function or(r,e,s){return r&&s&&(r.__v=null,r.__k=r.__k&&r.__k.map(function(a){return or(a,e,s)}),r.__c&&r.__c.__P===e&&(r.__e&&s.appendChild(r.__e),r.__c.__e=!0,r.__c.__P=s)),r}function ye(){this.__u=0,this.o=null,this.__b=null}function lr(r){var e=r.__.__c;return e&&e.__a&&e.__a(r)}function cr(r){var e,s,a;function i(n){if(e||(e=r()).then(function(o){s=o.default||o},function(o){a=o}),a)throw a;if(!s)throw e;return re(s,n)}return i.displayName="Lazy",i.__f=!0,i}function de(){this.i=null,this.l=null}M.unmount=function(r){var e=r.__c;e&&e.__R&&e.__R(),e&&32&r.__u&&(r.type=null),Lt&&Lt(r)},(ye.prototype=new K).__c=function(r,e){var s=e.__c,a=this;a.o==null&&(a.o=[]),a.o.push(s);var i=lr(a.__v),n=!1,o=function(){n||(n=!0,s.__R=null,i?i(d):d())};s.__R=o;var d=function(){if(!--a.__u){if(a.state.__a){var h=a.state.__a;a.__v.__k[0]=or(h,h.__c.__P,h.__c.__O)}var u;for(a.setState({__a:a.__b=null});u=a.o.pop();)u.forceUpdate()}};a.__u++||32&e.__u||a.setState({__a:a.__b=a.__v.__k[0]}),r.then(o,o)},ye.prototype.componentWillUnmount=function(){this.o=[]},ye.prototype.render=function(r,e){if(this.__b){if(this.__v.__k){var s=document.createElement("div"),a=this.__v.__k[0].__c;this.__v.__k[0]=ir(this.__b,s,a.__O=a.__P)}this.__b=null}var i=e.__a&&re(X,null,r.fallback);return i&&(i.__u&=-33),[re(X,null,e.__a?null:r.children),i]};var Tt=function(r,e,s){if(++s[1]===s[0]&&r.l.delete(e),r.props.revealOrder&&(r.props.revealOrder[0]!=="t"||!r.l.size))for(s=r.i;s;){for(;s.length>3;)s.pop()();if(s[1]<s[0])break;r.i=s=s[2]}};function ms(r){return this.getChildContext=function(){return r.context},r.children}function fs(r){var e=this,s=r.h;if(e.componentWillUnmount=function(){he(null,e.v),e.v=null,e.h=null},e.h&&e.h!==s&&e.componentWillUnmount(),!e.v){for(var a=e.__v;a!==null&&!a.__m&&a.__!==null;)a=a.__;e.h=s,e.v={nodeType:1,parentNode:s,childNodes:[],__k:{__m:a.__m},contains:function(){return!0},insertBefore:function(i,n){this.childNodes.push(i),e.h.insertBefore(i,n)},removeChild:function(i){this.childNodes.splice(this.childNodes.indexOf(i)>>>1,1),e.h.removeChild(i)}}}he(re(ms,{context:e.context},r.__v),e.v)}function dr(r,e){var s=re(fs,{__v:r,h:e});return s.containerInfo=e,s}(de.prototype=new K).__a=function(r){var e=this,s=lr(e.__v),a=e.l.get(r);return a[0]++,function(i){var n=function(){e.props.revealOrder?(a.push(i),Tt(e,r,a)):i()};s?s(n):n()}},de.prototype.render=function(r){this.i=null,this.l=new Map;var e=se(r.children);r.revealOrder&&r.revealOrder[0]==="b"&&e.reverse();for(var s=e.length;s--;)this.l.set(e[s],this.i=[1,0,this.i]);return r.children},de.prototype.componentDidUpdate=de.prototype.componentDidMount=function(){var r=this;this.l.forEach(function(e,s){Tt(r,s,e)})};var ur=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,ps=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,gs=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,vs=/[A-Z0-9]/g,ys=typeof document<"u",bs=function(r){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(r)};function hr(r,e,s){return e.__k==null&&(e.textContent=""),he(r,e),typeof s=="function"&&s(),r?r.__c:null}function mr(r,e,s){return Yt(r,e),typeof s=="function"&&s(),r?r.__c:null}K.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(r){Object.defineProperty(K.prototype,r,{configurable:!0,get:function(){return this["UNSAFE_"+r]},set:function(e){Object.defineProperty(this,r,{configurable:!0,writable:!0,value:e})}})});var Et=M.event;function xs(){}function _s(){return this.cancelBubble}function ws(){return this.defaultPrevented}M.event=function(r){return Et&&(r=Et(r)),r.persist=xs,r.isPropagationStopped=_s,r.isDefaultPrevented=ws,r.nativeEvent=r};var ut,ks={enumerable:!1,configurable:!0,get:function(){return this.class}},Rt=M.vnode;M.vnode=function(r){typeof r.type=="string"&&function(e){var s=e.props,a=e.type,i={},n=a.indexOf("-")===-1;for(var o in s){var d=s[o];if(!(o==="value"&&"defaultValue"in s&&d==null||ys&&o==="children"&&a==="noscript"||o==="class"||o==="className")){var h=o.toLowerCase();o==="defaultValue"&&"value"in s&&s.value==null?o="value":o==="download"&&d===!0?d="":h==="translate"&&d==="no"?d=!1:h[0]==="o"&&h[1]==="n"?h==="ondoubleclick"?o="ondblclick":h!=="onchange"||a!=="input"&&a!=="textarea"||bs(s.type)?h==="onfocus"?o="onfocusin":h==="onblur"?o="onfocusout":gs.test(o)&&(o=h):h=o="oninput":n&&ps.test(o)?o=o.replace(vs,"-$&").toLowerCase():d===null&&(d=void 0),h==="oninput"&&i[o=h]&&(o="oninputCapture"),i[o]=d}}a=="select"&&i.multiple&&Array.isArray(i.value)&&(i.value=se(s.children).forEach(function(u){u.props.selected=i.value.indexOf(u.props.value)!=-1})),a=="select"&&i.defaultValue!=null&&(i.value=se(s.children).forEach(function(u){u.props.selected=i.multiple?i.defaultValue.indexOf(u.props.value)!=-1:i.defaultValue==u.props.value})),s.class&&!s.className?(i.class=s.class,Object.defineProperty(i,"className",ks)):(s.className&&!s.class||s.class&&s.className)&&(i.class=i.className=s.className),e.props=i}(r),r.$$typeof=ur,Rt&&Rt(r)};var Pt=M.__r;M.__r=function(r){Pt&&Pt(r),ut=r.__c};var Ut=M.diffed;M.diffed=function(r){Ut&&Ut(r);var e=r.props,s=r.__e;s!=null&&r.type==="textarea"&&"value"in e&&e.value!==s.value&&(s.value=e.value==null?"":e.value),ut=null};var fr={ReactCurrentDispatcher:{current:{readContext:function(r){return ut.__n[r.__c].props.value},useCallback:tt,useContext:rt,useDebugValue:st,useDeferredValue:lt,useEffect:F,useId:at,useImperativeHandle:et,useInsertionEffect:dt,useLayoutEffect:pe,useMemo:ne,useReducer:Pe,useRef:Ue,useState:x,useSyncExternalStore:it,useTransition:ct}}},Ns="18.3.1";function pr(r){return re.bind(null,r)}function ke(r){return!!r&&r.$$typeof===ur}function gr(r){return ke(r)&&r.type===X}function vr(r){return!!r&&!!r.displayName&&(typeof r.displayName=="string"||r.displayName instanceof String)&&r.displayName.startsWith("Memo(")}function yr(r){return ke(r)?es.apply(null,arguments):r}function br(r){return!!r.__k&&(he(null,r),!0)}function xr(r){return r&&(r.base||r.nodeType===1&&r)||null}var _r=function(r,e){return r(e)},wr=function(r,e){return r(e)},kr=X,Nr=ke,Sr={useState:x,useId:at,useReducer:Pe,useEffect:F,useLayoutEffect:pe,useInsertionEffect:dt,useTransition:ct,useDeferredValue:lt,useSyncExternalStore:it,startTransition:ot,useRef:Ue,useImperativeHandle:et,useMemo:ne,useCallback:tt,useContext:rt,useDebugValue:st,version:"18.3.1",Children:nr,render:hr,hydrate:mr,unmountComponentAtNode:br,createPortal:dr,createElement:re,createContext:Kt,createFactory:pr,cloneElement:yr,createRef:Jt,Fragment:X,isValidElement:ke,isElement:Nr,isFragment:gr,isMemo:vr,findDOMNode:xr,Component:K,PureComponent:Re,memo:sr,forwardRef:ar,flushSync:wr,unstable_batchedUpdates:_r,StrictMode:kr,Suspense:ye,SuspenseList:de,lazy:cr,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:fr};const Ss=Object.freeze(Object.defineProperty({__proto__:null,Children:nr,Component:K,Fragment:X,PureComponent:Re,StrictMode:kr,Suspense:ye,SuspenseList:de,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:fr,cloneElement:yr,createContext:Kt,createElement:re,createFactory:pr,createPortal:dr,createRef:Jt,default:Sr,findDOMNode:xr,flushSync:wr,forwardRef:ar,hydrate:mr,isElement:Nr,isFragment:gr,isMemo:vr,isValidElement:ke,lazy:cr,memo:sr,render:hr,startTransition:ot,unmountComponentAtNode:br,unstable_batchedUpdates:_r,useCallback:tt,useContext:rt,useDebugValue:st,useDeferredValue:lt,useEffect:F,useErrorBoundary:rs,useId:at,useImperativeHandle:et,useInsertionEffect:dt,useLayoutEffect:pe,useMemo:ne,useReducer:Pe,useRef:Ue,useState:x,useSyncExternalStore:it,useTransition:ct,version:Ns},Symbol.toStringTag,{value:"Module"}));function Cs(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Ls(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var s=function a(){return this instanceof a?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};s.prototype=e.prototype}else s={};return Object.defineProperty(s,"__esModule",{value:!0}),Object.keys(r).forEach(function(a){var i=Object.getOwnPropertyDescriptor(r,a);Object.defineProperty(s,a,i.get?i:{enumerable:!0,get:function(){return r[a]}})}),s}var Cr={exports:{}},Lr={};const Tr=Ls(Ss);var Er={exports:{}},Rr={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fe=Tr;function Ts(r,e){return r===e&&(r!==0||1/r===1/e)||r!==r&&e!==e}var Es=typeof Object.is=="function"?Object.is:Ts,Rs=fe.useState,Ps=fe.useEffect,Us=fe.useLayoutEffect,$s=fe.useDebugValue;function As(r,e){var s=e(),a=Rs({inst:{value:s,getSnapshot:e}}),i=a[0].inst,n=a[1];return Us(function(){i.value=s,i.getSnapshot=e,Fe(i)&&n({inst:i})},[r,s,e]),Ps(function(){return Fe(i)&&n({inst:i}),r(function(){Fe(i)&&n({inst:i})})},[r]),$s(s),s}function Fe(r){var e=r.getSnapshot;r=r.value;try{var s=e();return!Es(r,s)}catch{return!0}}function Os(r,e){return e()}var Ms=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Os:As;Rr.useSyncExternalStore=fe.useSyncExternalStore!==void 0?fe.useSyncExternalStore:Ms;Er.exports=Rr;var Ds=Er.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $e=Tr,Ws=Ds;function js(r,e){return r===e&&(r!==0||1/r===1/e)||r!==r&&e!==e}var zs=typeof Object.is=="function"?Object.is:js,Fs=Ws.useSyncExternalStore,Is=$e.useRef,Hs=$e.useEffect,Bs=$e.useMemo,Js=$e.useDebugValue;Lr.useSyncExternalStoreWithSelector=function(r,e,s,a,i){var n=Is(null);if(n.current===null){var o={hasValue:!1,value:null};n.current=o}else o=n.current;n=Bs(function(){function h(l){if(!u){if(u=!0,f=l,l=a(l),i!==void 0&&o.hasValue){var b=o.value;if(i(b,l))return c=b}return c=l}if(b=c,zs(f,l))return b;var _=a(l);return i!==void 0&&i(b,_)?(f=l,b):(f=l,c=_)}var u=!1,f,c,m=s===void 0?null:s;return[function(){return h(e())},m===null?void 0:function(){return h(m())}]},[e,s,a,i]);var d=Fs(r,n[0],n[1]);return Hs(function(){o.hasValue=!0,o.value=d},[d]),Js(d),d};Cr.exports=Lr;var Vs=Cr.exports;const qs=Cs(Vs),Pr={},{useDebugValue:Gs}=Sr,{useSyncExternalStoreWithSelector:Zs}=qs;let $t=!1;const Qs=r=>r;function Xs(r,e=Qs,s){(Pr?"production":void 0)!=="production"&&s&&!$t&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),$t=!0);const a=Zs(r.subscribe,r.getState,r.getServerState||r.getInitialState,e,s);return Gs(a),a}const At=r=>{(Pr?"production":void 0)!=="production"&&typeof r!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const e=typeof r=="function"?ds(r):r,s=(a,i)=>Xs(e,a,i);return Object.assign(s,e),s},Ne=r=>r?At(r):At,Ur=Ne(r=>({ruleGroups:[],loading:!1,error:null,setRuleGroups:e=>r({ruleGroups:e,error:null}),addRuleGroup:e=>r(s=>({ruleGroups:[...s.ruleGroups.filter(a=>a.name!==e.name),e]})),updateRuleGroup:(e,s)=>r(a=>({ruleGroups:a.ruleGroups.map(i=>i.name===e?s:i)})),removeRuleGroup:e=>r(s=>({ruleGroups:s.ruleGroups.filter(a=>a.name!==e)})),setLoading:e=>r({loading:e}),setError:e=>r({error:e})})),$r=Ne(r=>({upstreams:[],loading:!1,error:null,setUpstreams:e=>r({upstreams:e,error:null}),addUpstream:e=>r(s=>({upstreams:[...s.upstreams,e]})),removeUpstream:e=>r(s=>({upstreams:s.upstreams.filter(a=>a.address!==e)})),setLoading:e=>r({loading:e}),setError:e=>r({error:e})})),Ar=Ne(r=>({stats:null,loading:!1,error:null,setStats:e=>r({stats:e,error:null}),setLoading:e=>r({loading:e}),setError:e=>r({error:e})})),Or=Ne(r=>({info:null,loading:!1,error:null,setInfo:e=>r({info:e,error:null}),setLoading:e=>r({loading:e}),setError:e=>r({error:e})})),Mr=Ne(r=>({events:[],loading:!1,error:null,setEvents:e=>r({events:e,error:null}),addEvent:e=>r(s=>({events:[e,...s.events].slice(0,2e3)})),setLoading:e=>r({loading:e}),setError:e=>r({error:e})})),Dr=()=>Ur(r=>r.ruleGroups),Wr=()=>Ur(r=>({setRuleGroups:r.setRuleGroups,addRuleGroup:r.addRuleGroup,updateRuleGroup:r.updateRuleGroup,removeRuleGroup:r.removeRuleGroup,setLoading:r.setLoading,setError:r.setError})),jr=()=>$r(r=>r.upstreams),zr=()=>$r(r=>({setUpstreams:r.setUpstreams,addUpstream:r.addUpstream,removeUpstream:r.removeUpstream,setLoading:r.setLoading,setError:r.setError})),Ys=()=>Ar(r=>r.stats),Ks=()=>Ar(r=>({setStats:r.setStats,setLoading:r.setLoading,setError:r.setError})),ea=()=>Mr(r=>r.events),ta=()=>Mr(r=>({setEvents:r.setEvents,addEvent:r.addEvent,setLoading:r.setLoading,setError:r.setError})),ra=()=>Or(r=>r.info),sa=()=>Or(r=>({setInfo:r.setInfo,setLoading:r.setLoading,setError:r.setError})),Ie=[{label:"1m",seconds:60},{label:"5m",seconds:300},{label:"15m",seconds:900}],aa={1:"A",28:"AAAA",2:"NS",5:"CNAME",6:"SOA",12:"PTR",15:"MX",16:"TXT",33:"SRV"};function na({provider:r}){const e=Ys(),{setStats:s,setError:a}=Ks(),i=Dr(),n=jr(),o=ra(),{setRuleGroups:d,setError:h}=Wr(),{setUpstreams:u,setError:f}=zr(),{setInfo:c,setError:m}=sa(),[l,b]=x(Ie[1]),[_,k]=x([]),[g,p]=x([]),L=w=>{window.location.hash=w,window.scrollTo(0,0)};F(()=>{const w=r.onStats(s),W=r.onRuleGroups(d),J=r.onUpstreams(u),Z=r.onOverview?r.onOverview(U=>{U!=null&&U.stats&&s(U.stats);try{window.__ov=U}catch{}P(U)}):()=>{};return r.fetchStats().then(s).catch(U=>a(U.message)),r.fetchRuleGroups().then(d).catch(U=>h(U.message)),r.fetchUpstreams().then(u).catch(U=>f(U.message)),r.fetchServerInfo().then(c).catch(U=>m(U.message)),r.fetchOverview&&r.fetchOverview().then(U=>{U!=null&&U.stats&&s(U.stats),P(U);try{window.__ov=U}catch{}}).catch(()=>{}),()=>{w(),W(),J(),Z()}},[r,s,d,u,a,h,f,c,m]);const[C,P]=x(null);F(()=>{if(!e)return;const w=30,W=e.effective_rps??(e.dns_queries_total?e.dns_queries_total/60:0);k(Z=>{const U=[...Z,Math.max(0,Number(W||0))];return U.length>w&&U.shift(),U});const J=(e.dns_request_avg_seconds??0)*1e3;p(Z=>{const U=[...Z,Math.max(0,Number(J||0))];return U.length>w&&U.shift(),U})},[e]);const S=(e==null?void 0:e.effective_rps)??(e?e.dns_queries_total/60:0),R=e!=null&&e.dns_request_avg_seconds?e.dns_request_avg_seconds*1e3:0,E=n?n.length:0,D=i?i.reduce((w,W)=>w+W.patterns.length,0):0,z=(()=>{if(!e)return null;const w=e.cache_hit_rate;return w==null||(e.dns_queries_total||0)===0?null:w})(),j=w=>Array.from({length:w},()=>""),v={labels:j(_.length),datasets:[{label:"RPS",data:_,borderColor:"#3b82f6",backgroundColor:"#3b82f6",fill:!1}]},y={labels:j(g.length),datasets:[{label:"Avg RT (ms)",data:g,borderColor:"#10b981",backgroundColor:"#10b981",fill:!1}]};return t("div",{className:"space-y-6",children:[t("div",{className:"flex items-center justify-between",children:[t("div",{children:[t("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Dashboard"}),t("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Monitor your DNS proxy performance and configuration"})]}),t("div",{className:"flex items-center space-x-4",children:t("select",{value:l.ms,onChange:w=>{const W=Ie.find(J=>J.ms===parseInt(w.currentTarget.value));W&&b(W)},className:"px-3 py-2 text-sm border border-gray-300 rounded-md bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:text-gray-100 dark:border-gray-600 dark:focus:border-blue-400 dark:focus:ring-blue-400",children:Ie.map(w=>t("option",{value:w.ms,children:w.label},w.ms))})})]}),t("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[t(Ce,{title:"DNS RPS",value:S.toFixed(1),icon:t("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),color:"blue",loading:!e}),t(Ce,{title:"Response Time",value:`${R.toFixed(0)}ms`,icon:t("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),color:"green",loading:!e}),t(Ce,{title:"Active Upstreams",value:E,icon:t("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),color:"purple",loading:!n}),t(Ce,{title:"Total Rules",value:D,icon:t("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),color:"indigo",loading:!i})]}),t("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t(H,{title:"DNS Queries Over Time",subtitle:`Last ${l.label}`,children:t(kt,{data:v,type:"line",height:256,xLabel:"time",yLabel:"RPS",loading:!e})}),t(H,{title:"Response Time Over Time",subtitle:`Last ${l.label}`,children:t(kt,{data:y,type:"line",height:256,xLabel:"time",yLabel:"ms",loading:!e})})]}),t("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t(H,{title:"Service Status",className:"lg:col-span-2",children:t("div",{className:"space-y-4",children:[t("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[t("div",{className:"flex items-center",children:[t("div",{className:`w-3 h-3 rounded-full mr-3 ${(e==null?void 0:e.service_ready)===1?"bg-green-500":"bg-red-500"}`}),t("div",{children:[t("p",{className:"font-medium text-gray-900 dark:text-white",children:"DNS Proxy"}),t("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:(e==null?void 0:e.service_ready)===1?"Running":"Stopped"})]})]}),t("div",{className:"text-right",children:[t("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Uptime"}),t("p",{className:"font-medium text-gray-900 dark:text-white",children:(C==null?void 0:C.uptime)??(o?o.uptime:"Unknown")})]})]}),t("div",{className:"grid grid-cols-2 gap-4",children:[t("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[t("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Cache hit rate"}),t("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:z==null?"N/A":`${(z*100).toFixed(2)}%`})]}),t("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[t("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Queries (1m)"}),t("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[(C==null?void 0:C.queries_last_min)??"N/A",C!=null&&C.errors_last_min?` (${C==null?void 0:C.errors_last_min} errors)`:""]})]})]})]})}),t(H,{title:"Quick Actions",children:t("div",{className:"space-y-3",children:[t($,{variant:"outline",fullWidth:!0,className:"justify-start hover:scale-[1.01] transition-transform",onClick:()=>L("rules"),children:[t("svg",{className:"w-5 h-5 mr-3 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Add New Rule"]}),t($,{variant:"outline",fullWidth:!0,className:"justify-start hover:scale-[1.01] transition-transform",onClick:()=>L("upstreams"),children:[t("svg",{className:"w-5 h-5 mr-3 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),"Add Upstream"]})]})})]})]})}function q({label:r,error:e,hint:s,required:a=!1,className:i="",id:n,...o}){const d=n||`input-${Math.random().toString(36).substr(2,9)}`,m=`input-field block w-full px-3 py-2 h-[42px] text-sm rounded-md border transition-all duration-200 ease-out focus:outline-none focus:ring-2 disabled:opacity-50 disabled:cursor-not-allowed bg-white text-gray-900 placeholder-gray-500 border-gray-300 hover:border-gray-400 focus:border-blue-500 focus:ring-blue-500 disabled:bg-gray-50 disabled:border-gray-300 dark:bg-gray-800 dark:text-gray-100 dark:placeholder-gray-400 dark:border-gray-600 dark:hover:border-gray-500 dark:focus:border-blue-400 dark:focus:ring-blue-400 dark:disabled:bg-gray-700 dark:disabled:border-gray-600 ${e?"border-red-500 focus:border-red-500 focus:ring-red-500 dark:border-red-400 dark:focus:border-red-400 dark:focus:ring-red-400":""} ${i}`.trim();return t("div",{className:"input-container space-y-1",children:[r&&t("label",{htmlFor:d,className:"input-label block text-sm font-medium text-gray-700 dark:text-gray-300",children:[r,a&&t("span",{className:"text-red-500 ml-1",children:"*"})]}),t("input",{id:d,className:m,...o}),s&&!e&&t("p",{className:"input-hint text-xs text-gray-500 dark:text-gray-400",children:s}),e&&t("p",{className:"input-error text-xs text-red-600 dark:text-red-400",children:e})]})}function ia({provider:r}){const[e,s]=x(""),[a,i]=x("A"),[n,o]=x(""),[d,h]=x(!1),u=c=>{let m=(c||"").trim();if(!m)return m;m.startsWith("@")&&(m=m.slice(1));try{return new URL(m).hostname||m}catch{}try{return new URL(/^https?:\/\//i.test(m)?m:`http://${m}`).hostname||m}catch{}return m=m.replace(/^\w+:\/\//,""),m=m.replace(/\/.*$/,""),m};return t("div",{className:"space-y-6",children:[t("div",{children:[t("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Resolve"}),t("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Run a test DNS resolve via the active pipeline"})]}),t(H,{children:t("form",{onSubmit:async c=>{if(c.preventDefault(),!!e.trim()){h(!0),o("");try{const m=u(e),l=await r.testResolve(m,a),b=[`Upstream: ${l.upstream}`,`RCODE: ${l.rcode}`,`Answers: ${l.answers}`];l.response_time_ms!==void 0&&b.push(`Time: ${l.response_time_ms}ms`),l.ttl!==void 0&&b.push(`TTL: ${l.ttl}s`);const _=b.join(" | "),k=(l.records||[]).join(`
`);o(`${_}
${k}`)}catch(m){o(m.message)}finally{h(!1)}}},className:"space-y-4",children:[t("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[t(q,{label:"Domain",value:e,onInput:c=>s(c.target.value),placeholder:"example.com or https://www.example.com",required:!0}),t("div",{children:[t("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Type"}),t("select",{className:"w-full px-3 py-2 h-[42px] border border-gray-300 rounded-md bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:text-gray-100 dark:border-gray-600 dark:focus:border-blue-400 dark:focus:ring-blue-400",value:a,onChange:c=>i(c.currentTarget.value),children:[t("option",{value:"A",children:"A"}),t("option",{value:"AAAA",children:"AAAA"}),t("option",{value:"CNAME",children:"CNAME"}),t("option",{value:"MX",children:"MX"}),t("option",{value:"NS",children:"NS"}),t("option",{value:"TXT",children:"TXT"}),t("option",{value:"SRV",children:"SRV"}),t("option",{value:"PTR",children:"PTR"})]})]}),t("div",{className:"flex items-end",children:t($,{type:"submit",variant:"primary",fullWidth:!0,loading:d,disabled:d,children:d?"Resolving…":"Resolve"})})]}),n&&t("div",{children:[t("div",{className:"flex items-center justify-between mb-2",children:[t("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Result"}),t("div",{className:"flex gap-2",children:[t($,{type:"button",variant:"outline",size:"sm",onClick:()=>navigator.clipboard.writeText(n),children:"Copy"}),t($,{type:"button",variant:"secondary",size:"sm",onClick:()=>o(""),children:"Clear"})]})]}),t("pre",{className:"mt-1 p-3 rounded-md bg-gray-50 text-gray-800 dark:bg-gray-900 dark:text-gray-200 whitespace-pre-wrap text-sm border border-gray-200 dark:border-gray-700 font-mono leading-6 max-h-96 overflow-auto",children:n})]})]})})]})}function le({children:r,variant:e="default",size:s="md",className:a="",...i}){const n="badge inline-flex items-center rounded-md font-medium",o={default:"bg-gray-100 text-gray-900 dark:bg-gray-800 dark:text-gray-100",primary:"bg-blue-600 text-white dark:bg-blue-600 dark:text-white",secondary:"bg-gray-200 text-gray-900 dark:bg-gray-700 dark:text-gray-100"},d={sm:"px-2 py-0.5 text-xs",md:"px-2.5 py-1 text-sm"},h=`${n} ${o[e]} ${d[s]} ${a}`.trim();return t("span",{className:h,...i,children:r})}const oa=[{id:"overview",label:"Overview",roles:["admin","user"],icon:t("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})})},{id:"rules",label:"Rules",roles:["admin"],icon:t("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})},{id:"upstreams",label:"Upstreams",roles:["admin"],icon:t("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})})},{id:"history",label:"History",roles:["admin","user"],icon:t("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})},{id:"hosts",label:"Hosts",roles:["admin"],icon:t("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"})})},{id:"devices",label:"Devices",roles:["admin","user"],icon:t("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})},{id:"resolve",label:"Resolve",roles:["admin","user"],icon:t("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})},{id:"cache",label:"Cache",roles:["admin","user"],icon:t("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"})})},{id:"users",label:"Users",roles:["admin"],icon:t("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})},{id:"roles",label:"Roles & Permissions",roles:["admin"],icon:t("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})})},{id:"update",label:"Updates",roles:["admin","user"],icon:t("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}];function la({activeTab:r,onTabChange:e,collapsed:s=!1}){var o,d,h,u,f,c;const[a,i]=x(A.state.user);F(()=>A.subscribe(l=>{i(l.user)}),[]);const n=oa.filter(m=>a?m.roles.includes(a.role):!1);return t("aside",{className:`fixed left-0 top-0 z-40 h-screen bg-white/95 dark:bg-gray-800/95 backdrop-blur-sm border-r border-gray-100 dark:border-gray-700 transition-all duration-300 ${s?"w-16":"w-64"} ${s?"-translate-x-full lg:translate-x-0":"translate-x-0"} lg:translate-x-0`,children:[t("div",{className:"flex items-center justify-center h-16 px-4 border-b border-gray-100 dark:border-gray-700",children:[!s&&t("div",{className:"flex items-center space-x-2",children:[t("div",{className:"w-7 h-7 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center shadow-sm",children:t("span",{className:"text-white font-bold text-sm",children:"O"})}),t("span",{className:"text-lg font-semibold text-gray-900 dark:text-white tracking-tight",children:"Outway"})]}),s&&t("div",{className:"w-7 h-7 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center mx-auto shadow-sm",children:t("span",{className:"text-white font-bold text-sm",children:"O"})})]}),t("nav",{className:"flex-1 px-4 py-4 space-y-1 overflow-y-auto",children:n.map(m=>{const l=r===m.id;return t("button",{onClick:()=>e(m.id),className:`w-full flex items-center px-3 py-2.5 text-sm font-medium transition-all duration-200 ${s?l?"bg-blue-600 text-white shadow-lg shadow-blue-600/25 rounded-lg justify-center":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white rounded-lg justify-center":l?"bg-blue-600 text-white shadow-lg shadow-blue-600/25 rounded-xl":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white rounded-xl"}`,children:[t("span",{className:`flex-shrink-0 ${s?"":"mr-3"}`,children:m.icon}),!s&&t("span",{className:"truncate font-medium",children:m.label})]},m.id)})}),t("div",{className:"p-4 border-t border-gray-100 dark:border-gray-700",children:[!s&&t("div",{className:"space-y-3",children:[t("div",{className:"flex items-center space-x-3",children:[t("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center shadow-sm",children:t("span",{className:"text-xs font-semibold text-white",children:((d=(o=A.state.user)==null?void 0:o.email)==null?void 0:d.charAt(0).toUpperCase())||"U"})}),t("div",{className:"flex-1 min-w-0",children:[t("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:((h=A.state.user)==null?void 0:h.email)||"User"}),t("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:((u=A.state.user)==null?void 0:u.role)||"user"})]})]}),t("button",{onClick:()=>A.logout(),className:"w-full flex items-center justify-center px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-md transition-colors",children:[t("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),"Sign Out"]})]}),s&&t("div",{className:"space-y-2",children:[t("div",{className:"flex justify-center",children:t("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center shadow-sm",children:t("span",{className:"text-xs font-semibold text-white",children:((c=(f=A.state.user)==null?void 0:f.email)==null?void 0:c.charAt(0).toUpperCase())||"U"})})}),t("button",{onClick:()=>A.logout(),className:"w-full flex items-center justify-center p-2 text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-md transition-colors",title:"Sign Out",children:t("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})})]})]})]})}const Ot="outway-theme";function Fr(){const[r,e]=x(()=>typeof window>"u"?"auto":localStorage.getItem(Ot)||"auto"),[s,a]=x("light");return F(()=>{const n=()=>{if(r==="auto"){const o=window.matchMedia("(prefers-color-scheme: dark)").matches;a(o?"dark":"light")}else a(r)};if(n(),r==="auto"){const o=window.matchMedia("(prefers-color-scheme: dark)"),d=()=>n();return o.addEventListener("change",d),()=>o.removeEventListener("change",d)}},[r]),F(()=>{const n=document.documentElement;s==="dark"?n.classList.add("dark"):n.classList.remove("dark")},[s]),F(()=>{typeof window<"u"&&localStorage.setItem(Ot,r)},[r]),{theme:r,resolvedTheme:s,setTheme:n=>{e(n)}}}function ca({className:r="",showLabel:e=!1,variant:s="select",...a}){const{theme:i,resolvedTheme:n,setTheme:o}=Fr(),d=m=>{o(m)},h=()=>{const m=["light","dark","auto"],b=(m.indexOf(i)+1)%m.length;o(m[b])},u=()=>{switch(i){case"light":return t("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})});case"dark":return t("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})});case"auto":return t("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}},f=()=>{switch(i){case"light":return"Light theme";case"dark":return"Dark theme";case"auto":return`Auto theme (${n})`}},c=[{value:"light",label:"Light",icon:"☀️"},{value:"dark",label:"Dark",icon:"🌙"},{value:"auto",label:"Auto",icon:"🔄"}];return s==="button"?t("div",{className:`flex items-center gap-2 ${r}`,...a,children:[t("button",{onClick:h,className:"p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-500 dark:text-gray-400 transition-colors duration-200","aria-label":f(),title:f(),children:u()}),e&&t("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:i==="auto"?`Auto (${n})`:i})]}):t("div",{className:`theme-toggle ${r}`,...a,children:t("select",{value:i,onChange:m=>d(m.currentTarget.value),className:"theme-select",children:c.map(m=>t("option",{value:m.value,children:[m.icon," ",m.label]},m.value))})})}function da({onSidebarToggle:r,provider:e,sidebarCollapsed:s}){const[a,i]=x("ws");return F(()=>{if(!e||!e.onStatus)return;const n=e.onStatus(o=>i(o.channel));return()=>{n&&n()}},[e]),t("header",{className:`fixed top-0 z-30 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-b border-gray-100 dark:border-gray-700 transition-all duration-300 ${s?"left-0 right-0 lg:left-16":"left-0 right-0 lg:left-64"}`,children:t("div",{className:"flex items-center justify-between h-16 px-4",children:[t("div",{className:"flex items-center gap-2",children:r&&t("button",{onClick:r,className:"p-1.5 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-300 transition-all duration-200","aria-label":"Toggle sidebar",children:t("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 6h16M4 12h16M4 18h16"})})})}),t("div",{className:"flex items-center gap-2",children:[t("span",{className:`px-2 py-0.5 text-xs rounded-full ${a==="ws"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300":"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-300"}`,title:a==="ws"?"WebSocket live":"REST fallback",children:a.toUpperCase()}),(e==null?void 0:e.reconnect)&&a==="rest"&&t("button",{className:"inline-flex items-center gap-1 text-xs px-2 py-1 rounded-md border border-gray-300 dark:border-gray-600/50 text-gray-700 dark:text-gray-200 bg-transparent hover:bg-gray-50 dark:hover:bg-gray-700/50",title:"Try reconnect WebSocket",onClick:()=>e.reconnect&&e.reconnect(),children:[t("svg",{className:"w-3.5 h-3.5",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:t("path",{fillRule:"evenodd",d:"M4.083 9.75A6.75 6.75 0 0117.5 10a.75.75 0 001.5 0A8.25 8.25 0 103.5 15.398V13a.75.75 0 00-1.5 0v4a.75.75 0 00.75.75H7a.75.75 0 000-1.5H4.84A6.73 6.73 0 014.083 9.75z",clipRule:"evenodd"})}),"Reconnect"]}),t("div",{className:"mx-1",children:t(ca,{variant:"button"})})]})]})})}function Ae({children:r,className:e=""}){return t("div",{className:`overflow-auto border border-gray-200 dark:border-gray-700 rounded-lg ${e}`,children:t("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:r})})}function Oe({children:r}){return t("thead",{className:"bg-gray-50 dark:bg-gray-900",children:r})}function te({children:r}){return t("tr",{children:r})}function Y({children:r,sortable:e=!1,active:s=!1,order:a="asc",onClick:i}){return t("th",{onClick:i,className:`px-4 py-2 text-left text-xs font-medium uppercase tracking-wider ${e?"cursor-pointer select-none":""} text-gray-500 dark:text-gray-400`,children:t("span",{className:"inline-flex items-center gap-1",children:[r,e&&s&&t("svg",{className:"w-3 h-3",viewBox:"0 0 20 20",fill:"currentColor",children:t("path",{d:a==="asc"?"M5 12l5-5 5 5H5z":"M5 8l5 5 5-5H5z"})})]})})}function Me({children:r}){return t("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:r})}function G({children:r,align:e="left",colSpan:s,title:a}){return t("td",{className:`px-4 py-2 text-sm ${e==="right"?"text-right":""}`,colSpan:s,title:a,children:r})}function xe({isOpen:r,title:e,children:s,onClose:a,primaryAction:i,secondaryAction:n,size:o="md",className:d=""}){return F(()=>{const u=f=>{f.key==="Escape"&&r&&a()};return r&&(document.addEventListener("keydown",u),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",u),document.body.style.overflow="unset"}},[r,a]),r?t("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[t("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:a}),t("div",{className:"flex min-h-full items-center justify-center p-4",children:t("div",{className:`relative w-full ${{sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"}[o]} transform overflow-hidden rounded-lg bg-white dark:bg-gray-800 shadow-xl transition-all ${d}`,children:[e&&t("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:t("div",{className:"flex items-center justify-between",children:[t("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:e}),t("button",{onClick:a,className:"p-1 rounded-md text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",children:t("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),t("div",{className:"px-6 py-4",children:s}),(i||n)&&t("div",{className:"px-6 py-4 border-t border-gray-200 dark:border-gray-700",children:t("div",{className:"flex justify-end space-x-3",children:[n&&t($,{variant:n.variant||"outline",onClick:n.onClick,disabled:n.disabled,children:n.label}),i&&t($,{variant:i.variant||"primary",onClick:i.onClick,loading:i.loading,disabled:i.disabled,children:i.label})]})})]})})]}):null}function Ir({message:r,type:e="info",duration:s=5e3,onClose:a,position:i="top-right"}){const[n,o]=x(!1);F(()=>{const f=setTimeout(()=>o(!0),100),c=setTimeout(()=>{o(!1),setTimeout(a,300)},s);return()=>{clearTimeout(f),clearTimeout(c)}},[s,a]);const d={success:{bg:"bg-green-50 dark:bg-green-900",border:"border-green-200 dark:border-green-700",text:"text-green-800 dark:text-green-200",icon:t("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})},error:{bg:"bg-red-50 dark:bg-red-900",border:"border-red-200 dark:border-red-700",text:"text-red-800 dark:text-red-200",icon:t("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 16.5c-.77.833.192 2.5 1.732 2.5z"})})},warning:{bg:"bg-yellow-50 dark:bg-yellow-900",border:"border-yellow-200 dark:border-yellow-700",text:"text-yellow-800 dark:text-yellow-200",icon:t("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 16.5c-.77.833.192 2.5 1.732 2.5z"})})},info:{bg:"bg-blue-50 dark:bg-blue-900",border:"border-blue-200 dark:border-blue-700",text:"text-blue-800 dark:text-blue-200",icon:t("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}},h={"top-right":"top-4 right-4","top-left":"top-4 left-4","bottom-right":"bottom-4 right-4","bottom-left":"bottom-4 left-4"},u=d[e];return t("div",{className:`fixed ${h[i]} z-50 max-w-sm w-full`,children:t("div",{className:`${u.bg} ${u.border} border rounded-lg shadow-lg p-4 transition-all duration-300 ${n?"transform translate-x-0 opacity-100":"transform translate-x-full opacity-0"}`,children:t("div",{className:"flex items-start",children:[t("div",{className:`flex-shrink-0 ${u.text}`,children:u.icon}),t("div",{className:"ml-3 flex-1",children:t("p",{className:`text-sm font-medium ${u.text}`,children:r})}),t("div",{className:"ml-4 flex-shrink-0",children:t("button",{onClick:()=>{o(!1),setTimeout(a,300)},className:`${u.text} hover:opacity-75 transition-opacity`,children:t("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})})]})})})}function ua({toasts:r,onRemove:e}){return t("div",{className:"fixed inset-0 pointer-events-none z-50",children:r.map(s=>t(Ir,{message:s.message,type:s.type,duration:s.duration,onClose:()=>e(s.id)},s.id))})}function oe({size:r="md",color:e="primary",text:s,className:a=""}){const i={sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8"},n={primary:"text-blue-600",secondary:"text-gray-600",white:"text-white"};return t("div",{className:`flex items-center justify-center ${a}`,children:t("div",{className:"flex flex-col items-center space-y-2",children:[t("div",{className:`${i[r]} ${n[e]} animate-spin`,children:t("svg",{className:"w-full h-full",fill:"none",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:[t("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),t("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),s&&t("p",{className:`text-sm ${n[e]} dark:text-gray-400`,children:s})]})})}function ha({icon:r,label:e,variant:s="secondary",size:a="md",className:i=""}){return t(le,{variant:s,className:`flex items-center space-x-1 ${{sm:"text-xs",md:"text-sm",lg:"text-base"}[a]} ${i}`,children:[r,t("span",{children:e})]})}function Mt({initials:r,size:e="md",variant:s="primary",className:a=""}){const i=h=>({sm:"w-6 h-6 text-xs",md:"w-8 h-8 text-sm",lg:"w-12 h-12 text-lg",xl:"w-16 h-16 text-xl"})[h],n=h=>({primary:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300",secondary:"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-300",success:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300",warning:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300",danger:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300"})[h],o=i(e),d=n(s);return t("div",{className:`${o} ${d} rounded-full flex items-center justify-center font-medium ${a}`,children:r})}function ma({title:r,description:e,count:s,icon:a,status:i="active",onClick:n,className:o=""}){const h=(f=>({active:"hover:shadow-lg ring-2 ring-blue-500 bg-blue-50 dark:bg-blue-900/20",inactive:"hover:bg-gray-50 dark:hover:bg-gray-800",warning:"hover:shadow-lg ring-2 ring-yellow-500 bg-yellow-50 dark:bg-yellow-900/20",error:"hover:shadow-lg ring-2 ring-red-500 bg-red-50 dark:bg-red-900/20"})[f])(i);return t(H,{className:`transition-all duration-200 ${!!n?"cursor-pointer":""} ${h} ${o}`,onClick:n,children:t("div",{className:"p-6",children:t("div",{className:"flex items-center justify-between mb-4",children:[t("div",{className:"flex items-center space-x-3",children:[a&&t("div",{className:"p-2 rounded-lg bg-gray-100 dark:bg-gray-800",children:a}),t("div",{children:[t("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:r}),e&&t("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e})]})]}),s!==void 0&&t(le,{variant:"secondary",className:"text-xs",children:s})]})})})}function De({message:r="Loading...",size:e="md",className:s=""}){const i=(n=>({sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"})[n])(e);return t("div",{className:`flex items-center justify-center py-8 ${s}`,children:t("div",{className:"flex flex-col items-center space-y-3",children:[t("div",{className:`animate-spin rounded-full border-b-2 border-blue-600 ${i}`}),t("span",{className:"text-gray-600 dark:text-gray-400 text-sm",children:r})]})})}function Hr({title:r,description:e,icon:s="box",action:a,className:i=""}){const n=o=>({box:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"}),user:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"}),settings:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),search:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"}),shield:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})})[o];return t("div",{className:`text-center py-12 ${i}`,children:t("div",{className:"text-gray-400 dark:text-gray-500",children:[t("svg",{className:"mx-auto h-12 w-12 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n(s)}),t("p",{className:"text-lg font-medium text-gray-900 dark:text-white",children:r}),e&&t("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e}),a&&t("button",{onClick:a.onClick,className:"mt-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:a.label})]})})}function fa({data:r,columns:e,loading:s=!1,emptyMessage:a="No data available",emptyDescription:i="There are no items to display.",className:n=""}){if(s)return t(De,{message:"Loading data..."});if(r.length===0)return t(Hr,{title:a,description:i,icon:"box"});const o=(d,h)=>typeof h=="string"&&h.includes(".")?h.split(".").reduce((u,f)=>u==null?void 0:u[f],d):d[h];return t("div",{className:`overflow-x-auto ${n}`,children:t(Ae,{children:[t(Oe,{children:t(te,{children:e.map(d=>t(Y,{children:d.title},String(d.key)))})}),t(Me,{children:r.map((d,h)=>t(te,{children:e.map(u=>t(G,{children:u.render?u.render(o(d,u.key),d,h):o(d,u.key)},String(u.key)))},h))})]})})}function Dt({label:r,value:e,onChange:s,children:a,className:i="",...n}){return t("div",{children:[r&&t("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:r}),t("select",{value:e,onChange:s,className:`w-full px-3 py-2 h-[42px] border border-gray-300 rounded-md bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:text-gray-100 dark:border-gray-600 dark:focus:border-blue-400 dark:focus:ring-blue-400 ${i}`,...n,children:a})]})}function Le({label:r,type:e="text",value:s,onChange:a,placeholder:i,required:n=!1,error:o,helpText:d,className:h="",disabled:u=!1}){return t("div",{className:`space-y-2 ${h}`,children:[t("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[r,n&&t("span",{className:"text-red-500 ml-1",children:"*"})]}),t(q,{type:e,value:String(s),onInput:f=>a(e==="number"?Number(f.currentTarget.value):f.currentTarget.value),placeholder:i,disabled:u,className:o?"border-red-500 focus:border-red-500 focus:ring-red-500":""}),o&&t("p",{className:"text-sm text-red-600 dark:text-red-400",children:o}),d&&!o&&t("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:d})]})}function He({action:r,onClick:e,disabled:s=!1,loading:a=!1,size:i="md",className:n=""}){const d=(h=>{const u={add:{label:"Add",variant:"primary",icon:t("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})},edit:{label:"Edit",variant:"outline",icon:t("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})},delete:{label:"Delete",variant:"outline",icon:t("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})},save:{label:"Save",variant:"primary",icon:t("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})})},cancel:{label:"Cancel",variant:"outline",icon:t("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})},refresh:{label:"Refresh",variant:"outline",icon:t("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})},wake:{label:"Wake",variant:"primary",icon:t("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})})},view:{label:"View",variant:"outline",icon:t("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})}};return u[h]||u.add})(r);return t($,{variant:d.variant,size:i,onClick:e,disabled:s||a,className:`flex items-center space-x-2 ${n}`,children:[a?t("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}):d.icon,t("span",{children:d.label})]})}function Br({role:r,size:e="md",showIcon:s=!0,className:a=""}){const i=(d,h)=>{const f={sm:"w-4 h-4",md:"w-5 h-5",lg:"w-6 h-6"}[h];return d==="admin"?t("svg",{className:`${f} text-red-600 dark:text-red-400`,fill:"currentColor",viewBox:"0 0 20 20",children:t("path",{fillRule:"evenodd",d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z",clipRule:"evenodd"})}):t("svg",{className:`${f} text-blue-600 dark:text-blue-400`,fill:"currentColor",viewBox:"0 0 20 20",children:t("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"})})},n=d=>d==="admin"?"primary":"secondary",o=d=>d==="admin"?"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300":"";return t(ha,{icon:s?i(r,e):t(X,{}),label:r.charAt(0).toUpperCase()+r.slice(1),variant:n(r),size:e,className:`${o(r)} ${a}`})}function pa({email:r,size:e="md",variant:s="primary",className:a="",fallbackToInitials:i=!0}){const[n,o]=x(!1),[d,h]=x(!0),u=_=>{let k=0;for(let g=0;g<_.length;g++){const p=_.charCodeAt(g);k=(k<<5)-k+p,k=k&k}return Math.abs(k).toString(16)},f=(_,k)=>`https://www.gravatar.com/avatar/${u(_.toLowerCase().trim())}?s=${k}&d=404&r=g`,c=_=>({sm:32,md:40,lg:48,xl:56})[_],m=_=>{const k=_.split("@")[0];return k?k.charAt(0).toUpperCase():"?"},l=c(e),b=f(r,l);return n||!i?t(Mt,{initials:m(r),size:e,variant:s,className:a}):t("div",{className:`relative ${a}`,children:[d&&t(Mt,{initials:m(r),size:e,variant:s,className:"absolute inset-0"}),t("img",{src:b,alt:`Avatar for ${r}`,className:`rounded-full ${ga(e)} object-cover`,onLoad:()=>h(!1),onError:()=>o(!0),style:{display:d?"none":"block"}})]})}function ga(r){return{sm:"w-8 h-8",md:"w-10 h-10",lg:"w-12 h-12",xl:"w-14 h-14"}[r]}function va({email:r,role:e,size:s="md",showRole:a=!1,className:i=""}){const n=o=>o==="admin"?"danger":"primary";return t("div",{className:`flex items-center space-x-2 ${i}`,children:[t(pa,{email:r,size:s,variant:n(e)}),a&&e&&t("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:e})]})}function ya({provider:r}){const e=Dr(),{setRuleGroups:s,setError:a}=Wr(),[i,n]=x(""),[o,d]=x(""),[h,u]=x(""),[f,c]=x([""]),[m,l]=x(!0),[b,_]=x(""),[k,g]=x(!1),[p,L]=x(null),[C,P]=x({});F(()=>{const N=r.onRuleGroups(T=>{s(T)});return r.fetchRuleGroups().then(s).catch(T=>{console.error("Failed to fetch rule groups:",T),a(T.message)}),N},[r,s,a]);const S=e.filter(N=>{var T;return N.name.toLowerCase().includes(b.toLowerCase())||((T=N.description)==null?void 0:T.toLowerCase().includes(b.toLowerCase()))||N.patterns.some(O=>O.toLowerCase().includes(b.toLowerCase()))}),R=()=>{c([...f,""])},E=N=>{c(f.filter((T,O)=>O!==N))},D=(N,T)=>{const O=[...f];O[N]=T,c(O)},z=async N=>{if(N.preventDefault(),!i.trim()||!h.trim()||f.some(T=>!T.trim())){a("Please fill in all required fields");return}g(!0);try{const T={name:i.trim(),description:o.trim()||"",via:h.trim(),patterns:f.filter(O=>O.trim()),pin_ttl:m};await r.createRuleGroup(T),n(""),d(""),u(""),c([""]),l(!0)}catch(T){console.error("Failed to create rule group:",T),a(T instanceof Error?T.message:"Failed to create rule group")}finally{g(!1)}},j=N=>{P(T=>({...T,[N.name]:{...N}}))},v=N=>{P(T=>{const O={...T};return delete O[N],O})},y=(N,T,O)=>{P(Q=>({...Q,[N]:{...Q[N],[T]:O}}))},w=(N,T,O)=>{P(Q=>{const ge=Q[N];if(!ge)return Q;const We=ge.patterns.slice();return We[T]=O,{...Q,[N]:{...ge,patterns:We}}})},W=N=>{P(T=>{const O=T[N];return O?{...T,[N]:{...O,patterns:[...O.patterns,""]}}:T})},J=(N,T)=>{P(O=>{const Q=O[N];if(!Q)return O;const ge=Q.patterns.filter((We,Vr)=>Vr!==T);return{...O,[N]:{...Q,patterns:ge}}})},Z=async N=>{const T=C[N];if(T)try{await r.updateRuleGroup(N,{name:T.name,description:T.description||"",via:T.via,patterns:T.patterns.filter(Q=>Q.trim()),pin_ttl:!!T.pin_ttl}),v(N);const O=await r.fetchRuleGroups();s(O)}catch(O){console.error("Failed to update rule group:",O),a(O instanceof Error?O.message:"Failed to update rule group")}},U=async N=>{try{await r.deleteRuleGroup(N),L(null)}catch(T){console.error("Failed to delete rule group:",T),a(T instanceof Error?T.message:"Failed to delete rule group")}};return t("div",{className:"space-y-6",children:[t("div",{className:"flex items-center justify-between",children:t("div",{children:[t("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Rule Groups"}),t("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Manage DNS routing rules and patterns"})]})}),t(H,{title:"Add New Rule Group",subtitle:"Create a new routing rule group",children:t("form",{onSubmit:z,className:"space-y-6",children:[t("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t(q,{label:"Group Name",value:i,onInput:N=>n(N.target.value),placeholder:"e.g., YouTube",required:!0}),t(q,{label:"Via Interface",value:h,onInput:N=>u(N.target.value),placeholder:"e.g., utun4",required:!0})]}),t(q,{label:"Description",value:o,onInput:N=>d(N.target.value),placeholder:"Optional description"}),t("div",{children:[t("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"DNS Patterns *"}),f.map((N,T)=>t("div",{className:"flex gap-3 mb-3",children:[t("div",{className:"flex-1",children:t(q,{value:N,onInput:O=>D(T,O.target.value),placeholder:"e.g., *.youtube.com",required:!0})}),f.length>1&&t($,{type:"button",variant:"outline",size:"sm",onClick:()=>E(T),children:"Remove"})]},T)),t($,{type:"button",variant:"secondary",size:"sm",onClick:R,children:"Add Pattern"})]}),t("div",{className:"flex items-center gap-3",children:[t("input",{type:"checkbox",id:"pin-ttl",checked:m,onChange:N=>l(N.target.checked),className:"rounded border-gray-300 dark:border-gray-600 text-black dark:text-white focus:ring-black dark:focus:ring-white"}),t("label",{htmlFor:"pin-ttl",className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:t("span",{className:"input-label",children:"Pin TTL (keep IP/route until TTL expires)"})})]}),t("div",{className:"flex gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:t($,{type:"submit",variant:"primary",loading:k,disabled:k,children:k?"Creating...":"Create Rule Group"})})]})}),t("div",{children:t(q,{label:"Search Rule Groups",value:b,onInput:N=>_(N.target.value),placeholder:"Search by name, description, or pattern...",hint:"Filter rule groups by name, description, or DNS patterns"})}),t("div",{className:"grid gap-4",children:S.map(N=>t(H,{title:N.name,subtitle:N.description,children:[t("div",{className:"flex justify-between items-start mb-4",children:[t("div",{className:"flex items-center gap-3",children:[t(le,{variant:"primary",children:N.patterns.length}),t("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:N.patterns.length===1?"pattern":"patterns"})]}),t("div",{className:"flex gap-2",children:[C[N.name]?t(X,{children:[t($,{variant:"secondary",size:"sm",onClick:()=>v(N.name),children:"Cancel"}),t($,{variant:"primary",size:"sm",onClick:()=>Z(N.name),children:"Save"})]}):t($,{variant:"secondary",size:"sm",onClick:()=>j(N),children:"Edit"}),t($,{variant:"outline",size:"sm",onClick:()=>L(N.name),children:"Delete"})]})]}),C[N.name]?t("div",{className:"space-y-4",children:[t("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[t("div",{className:"flex items-center gap-2",children:[t("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Via Interface:"}),t(q,{value:C[N.name].via,onInput:T=>y(N.name,"via",T.target.value)})]}),t("div",{className:"flex items-center gap-2",children:[t("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Pin TTL:"}),t("input",{type:"checkbox",checked:!!C[N.name].pin_ttl,onChange:T=>y(N.name,"pin_ttl",T.target.checked)})]})]}),t("div",{children:[t("span",{className:"font-medium text-sm text-gray-700 dark:text-gray-300",children:"Description:"}),t(q,{value:C[N.name].description||"",onInput:T=>y(N.name,"description",T.target.value),placeholder:"Optional description"})]}),t("div",{className:"mt-2 pt-2 border-t border-gray-200 dark:border-gray-700",children:[t("span",{className:"font-medium text-sm text-gray-700 dark:text-gray-300",children:"DNS Patterns:"}),C[N.name].patterns.map((T,O)=>t("div",{className:"flex gap-2 mt-2",children:[t(q,{value:T,onInput:Q=>w(N.name,O,Q.target.value)}),t($,{variant:"outline",size:"sm",onClick:()=>J(N.name,O),children:"Remove"})]},O)),t($,{className:"mt-2",variant:"secondary",size:"sm",onClick:()=>W(N.name),children:"Add Pattern"})]})]}):t(X,{children:[t("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[t("div",{className:"flex items-center gap-2",children:[t("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Via Interface:"}),t(le,{variant:"secondary",children:N.via})]}),t("div",{className:"flex items-center gap-2",children:[t("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Pin TTL:"}),t(le,{variant:N.pin_ttl?"primary":"secondary",children:N.pin_ttl?"Yes":"No"})]})]}),t("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[t("span",{className:"font-medium text-sm text-gray-700 dark:text-gray-300",children:"DNS Patterns:"}),t("div",{className:"flex flex-wrap gap-2 mt-2",children:N.patterns.map((T,O)=>t("span",{className:"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 px-2 py-1 rounded text-xs font-mono",children:T},O))})]})]})]},N.name))}),S.length===0&&t(H,{className:"text-center py-8",children:t("p",{className:"text-secondary",children:b?"No rule groups match your search.":"No rule groups configured."})}),p&&t("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t(H,{className:"max-w-md w-full mx-4",children:[t("h3",{className:"text-lg font-semibold mb-4",children:"Confirm Delete"}),t("p",{className:"text-secondary mb-6",children:['Are you sure you want to delete the rule group "',p,'"? This action cannot be undone.']}),t("div",{className:"flex gap-3 justify-end",children:[t($,{variant:"secondary",onClick:()=>L(null),children:"Cancel"}),t($,{variant:"danger",onClick:()=>U(p),children:"Delete"})]})]})})]})}function ba(r){return aa[r]||`TYPE${r}`}function xa(r){return r.length>50?r.substring(0,47)+"...":r}function _a(r){return new Date(typeof r=="string"?r:r*1e3).toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})}function wa(r){return r.trim()?[/^udp:[a-zA-Z0-9.-]+:\d+$/,/^tcp:[a-zA-Z0-9.-]+:\d+$/,/^https?:\/\/[a-zA-Z0-9.-]+(\/.*)?$/,/^[a-zA-Z0-9.-]+:\d+$/,/^[a-zA-Z0-9.-]+$/].some(a=>a.test(r))?{valid:!0}:{valid:!1,error:"Invalid upstream format. Use: udp:host:port, tcp:host:port, https://host/path, or host:port"}:{valid:!1,error:"Upstream is required"}}function ka({provider:r}){const e=jr(),{setUpstreams:s,addUpstream:a,removeUpstream:i,setError:n}=zr(),[o,d]=x(""),[h,u]=x(""),[f,c]=x(""),[m,l]=x(!1),[b,_]=x(null),[k,g]=x("asc"),[p,L]=x({});F(()=>r.onUpstreams(y=>{s(y)}),[r,s,n]);const C=[...e||[]].sort((v,y)=>{const w=(v.name||v.address).localeCompare(y.name||y.address);return k==="asc"?w:-w}),P=async v=>{v.preventDefault();const y=wa(o);if(!y.valid){n(y.error);return}l(!0),n(null);try{let w=o.trim();try{const Z=new URL(w),U=Z.protocol.replace(":","").toLowerCase();U!=="https"&&(w=`${U==="tls"?"dot":U==="quic"?"doq":U}://${Z.host}`)}catch{w=`udp://${w.replace(/^(udp|tcp|tls|dot|quic|doq):\/\//i,"")}`}const W={name:(h||new URL(w).hostname).trim(),address:w};f!==""&&(W.weight=Number(f)),a(W);const J=[...e,W];await r.saveUpstreams(J),d(""),u(""),c("")}catch(w){console.error("Failed to save upstream:",w),n(w instanceof Error?w.message:"Failed to save upstream")}finally{l(!1)}},S=async v=>{try{i(v);const y=e.filter(w=>w.address!==v);await r.saveUpstreams(y),_(null)}catch(y){console.error("Failed to delete upstream:",y),n(y instanceof Error?y.message:"Failed to delete upstream")}},R=v=>{const y=e.find(w=>w.address===v);y&&L(w=>({...w,[v]:{...y}}))},E=v=>{L(y=>{const w={...y};return delete w[v],w})},D=async v=>{const y=p[v];if(!y)return;const w=e.find(U=>U.address===v);if(!w)return;const W={name:(y.name??w.name??"").trim(),address:(y.address??w.address).trim()},J=y.weight===void 0?w.weight:Number(y.weight);J!==void 0&&(W.weight=J);const Z=e.map(U=>U.address===v?W:U);try{s(Z),await r.saveUpstreams(Z),E(v)}catch(U){console.error("Failed to save edit:",U),n(U instanceof Error?U.message:"Failed to save")}},z=(v,y,w)=>{L(W=>({...W,[v]:{...W[v],[y]:y==="weight"?w===""?void 0:Number(w):w}}))},j=()=>{g(v=>v==="asc"?"desc":"asc")};return t("div",{className:"space-y-6",children:[t("div",{className:"flex items-center justify-between",children:t("div",{children:[t("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Upstreams"}),t("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Manage DNS upstream servers and their configuration"})]})}),t(H,{title:"Add New Upstream",subtitle:"Add a new DNS upstream server",children:t("form",{onSubmit:P,className:"space-y-6",children:[t("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t(q,{label:"Name",value:h,onInput:v=>u(v.target.value),placeholder:"Human-friendly name"}),t(q,{label:"Address",value:o,onInput:v=>d(v.target.value),placeholder:"udp://8.8.8.8:53 or https://dns.google/dns-query",hint:"Use URL form",required:!0}),t(q,{label:"Weight",type:"number",value:f,onInput:v=>c(v.target.value===""?"":Number(v.target.value)),placeholder:"1"})]}),t("div",{className:"flex gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:t($,{type:"submit",variant:"primary",loading:m,disabled:m,children:m?"Adding...":"Add Upstream"})})]})}),t(H,{title:"Configured Upstreams",subtitle:`${e.length} upstream server${e.length===1?"":"s"} configured`,children:[t("div",{className:"flex justify-between items-center mb-6",children:[t("div",{className:"flex items-center gap-3",children:[t(le,{variant:"primary",children:e.length}),t("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.length===1?"upstream server":"upstream servers"})]}),t($,{variant:"secondary",size:"sm",onClick:j,title:`Sort ${k==="asc"?"Z-A":"A-Z"}`,children:k==="asc"?"A-Z":"Z-A"})]}),C.length===0?t("div",{className:"text-center py-8",children:t("p",{className:"text-gray-600 dark:text-gray-400",children:"No upstream servers configured yet."})}):t("div",{className:"space-y-3",children:C.map(v=>{var y,w,W;return t("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:p[v.address]?t("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3 items-end",children:[t(q,{label:"Name",value:((y=p[v.address])==null?void 0:y.name)??v.name,onInput:J=>z(v.address,"name",J.target.value)}),t(q,{label:"Address",value:((w=p[v.address])==null?void 0:w.address)??v.address,onInput:J=>z(v.address,"address",J.target.value)}),t(q,{label:"Weight",type:"number",value:((W=p[v.address])==null?void 0:W.weight)??v.weight??"",onInput:J=>z(v.address,"weight",J.target.value)}),t("div",{className:"flex gap-2 justify-end",children:[t($,{variant:"outline",size:"sm",onClick:()=>E(v.address),children:"Cancel"}),t($,{variant:"primary",size:"sm",onClick:()=>D(v.address),children:"Save"})]})]}):t("div",{className:"flex items-center justify-between gap-4",children:[t("div",{className:"flex flex-col min-w-0",children:[t("span",{className:"text-sm text-gray-500 dark:text-gray-400 truncate max-w-[420px]",title:v.name||"Unnamed",children:v.name||"Unnamed"}),t("span",{className:"mt-1 px-2 py-1 rounded bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-gray-100 text-xs font-mono truncate max-w-[520px]",title:v.address,children:v.address})]}),t("div",{className:"flex items-center gap-3",children:[t("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["weight: ",v.weight??1]}),t($,{variant:"secondary",size:"sm",onClick:()=>R(v.address),children:"Edit"}),t($,{variant:"outline",size:"sm",onClick:()=>_(v.address),children:"Delete"})]})]})},v.address)})})]}),b&&t("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50",children:t("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 p-6 max-w-md w-full",children:[t("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Delete Upstream"}),t("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:["Are you sure you want to delete upstream ",t("strong",{children:['"',b,'"']}),"? This action cannot be undone."]}),t("div",{className:"flex gap-3 justify-end",children:[t($,{variant:"outline",onClick:()=>_(null),children:"Cancel"}),t($,{variant:"primary",onClick:()=>S(b),children:"Delete"})]})]})})]})}function Na({provider:r}){const e=ea(),{setEvents:s,setError:a}=ta(),[i,n]=x(""),[o,d]=x(200);F(()=>{const f=r.onHistory(c=>{s(c)});return r.fetchHistory().then(s).catch(c=>{console.error("Failed to fetch history:",c),a(c.message)}),f},[r,s,a]);const h=ne(()=>{let f=e;if(i.trim()){const c=i.toLowerCase();f=e.filter(m=>m.name.toLowerCase().includes(c))}return f.slice(0,o)},[e,i,o]),u=()=>e.length<=o?t(X,{}):t("div",{style:{marginTop:"12px",textAlign:"center"},children:[t("span",{className:"muted",children:["Showing ",o," of ",e.length," events."]}),o<1e3&&t("button",{className:"ow-btn ow-btn--secondary ow-btn--sm",style:{marginLeft:"8px"},onClick:()=>d(Math.min(o*2,2e3)),children:"Show More"})]});return t("div",{className:"space-y-6",children:[t("div",{className:"flex items-center justify-between",children:t("div",{children:[t("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Query History"}),t("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"View DNS query history and performance metrics"})]})}),t(H,{title:"Search and Filters",subtitle:"Filter DNS query history",children:t("div",{className:"space-y-4",children:[t(q,{label:"Filter by Domain",value:i,onInput:f=>n(f.target.value),placeholder:"Filter by domain name...",hint:"Enter a domain name to filter the results"}),t("div",{className:"flex items-center justify-between",children:[t("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Showing ",h.length," of ",e.length," events"]}),e.length>o&&t("button",{className:"text-sm text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300",onClick:()=>d(Math.min(o*2,2e3)),children:"Show More"})]})]})}),t(H,{title:"Query History",subtitle:`${h.length} DNS queries`,children:h.length===0?t("div",{className:"text-center py-8",children:t("p",{className:"text-gray-600 dark:text-gray-400",children:e.length===0?"No query history available":"No queries match filter"})}):t("div",{className:"overflow-x-auto",children:[t("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700 table-auto",children:[t("thead",{className:"bg-gray-50 dark:bg-gray-800",children:t("tr",{children:[t("th",{className:"px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Time"}),t("th",{className:"px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Domain"}),t("th",{className:"px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Type"}),t("th",{className:"px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Client IP"}),t("th",{className:"px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Upstream"}),t("th",{className:"px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Duration"}),t("th",{className:"px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Status"})]})}),t("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700",children:h.map((f,c)=>t("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[t("td",{className:"px-4 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:_a(f.time)}),t("td",{className:"px-4 sm:px-6 py-3 sm:py-4 whitespace-normal sm:whitespace-nowrap break-words text-sm font-medium text-gray-900 dark:text-gray-100",children:f.name}),t("td",{className:"px-4 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:ba(f.qtype)}),t("td",{className:"px-4 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400 font-mono",children:f.client_ip||"unknown"}),t("td",{className:"px-4 sm:px-6 py-3 sm:py-4 whitespace-normal sm:whitespace-nowrap break-words text-sm text-gray-500 dark:text-gray-400",title:f.upstream,children:xa(f.upstream)}),t("td",{className:"px-4 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:f.duration}),t("td",{className:"px-4 sm:px-6 py-3 sm:py-4 whitespace-nowrap",children:t("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${f.status==="ok"?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400":"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400"}`,children:f.status==="ok"?"OK":"Error"})})]},`${f.time}-${f.name}-${c}`))})]}),u()]})})]})}function Sa({provider:r}){const[e,s]=x([]),[a,i]=x(!0),[n,o]=x(null);F(()=>{let l=r.onHosts(b=>{s(b),i(!1)});return r.fetchHosts().then(s).catch(b=>o(String(b))).finally(()=>i(!1)),()=>{l()}},[r]);const d=()=>s(l=>[...l,{pattern:"",a:[],aaaa:[],ttl:60}]),h=l=>s(b=>b.filter((_,k)=>k!==l)),u=(l,b)=>s(_=>_.map((k,g)=>g===l?{...k,...b}:k)),f=l=>l?l.split(",").map(b=>b.trim()).filter(Boolean):[];return t("div",{className:"space-y-6",children:[t("div",{className:"flex items-center justify-between",children:[t("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Hosts"}),t("div",{className:"space-x-2",children:[t(He,{action:"add",onClick:d}),t(He,{action:"save",onClick:async()=>{o(null);try{await r.saveHosts(e)}catch(l){o(String(l))}}})]})]}),n&&t("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:t("div",{className:"flex",children:[t("div",{className:"flex-shrink-0",children:t("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:t("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),t("div",{className:"ml-3",children:[t("h3",{className:"text-sm font-medium text-red-800 dark:text-red-200",children:"Error"}),t("div",{className:"mt-2 text-sm text-red-700 dark:text-red-300",children:n})]})]})}),t(H,{title:"Overrides",subtitle:"Static DNS responses with wildcard support",children:a?t(De,{message:"Loading hosts..."}):t(fa,{data:e,columns:[{key:"pattern",title:"Pattern",width:"28%",render:(l,b,_)=>t(Le,{label:"",value:l||"",onChange:k=>u(_,{pattern:k}),placeholder:"e.g. *.example.com",className:"mb-0"})},{key:"a",title:"A Records",width:"28%",render:(l,b,_)=>t(Le,{label:"",value:(l||[]).join(", "),onChange:k=>u(_,{a:f(k)}),placeholder:"127.0.0.1, 10.0.0.1",className:"mb-0"})},{key:"aaaa",title:"AAAA Records",width:"28%",render:(l,b,_)=>t(Le,{label:"",value:(l||[]).join(", "),onChange:k=>u(_,{aaaa:f(k)}),placeholder:"::1, 2001:db8::1",className:"mb-0"})},{key:"ttl",title:"TTL",width:"8%",render:(l,b,_)=>t(Le,{label:"",type:"number",value:l??60,onChange:k=>u(_,{ttl:k}),placeholder:"60",className:"mb-0"})},{key:"actions",title:"Actions",width:"8%",render:(l,b,_)=>t("div",{className:"flex justify-end",children:t(He,{action:"delete",onClick:()=>h(_),size:"sm"})})}],emptyMessage:"No hosts configured",emptyDescription:"Click Add to create your first host override."})})]})}function Ca({provider:r}){const[e,s]=x([]),[a,i]=x(!1),[n,o]=x(null),[d,h]=x(!1),[u,f]=x(null),[c,m]=x("idle");F(()=>{(async()=>{try{if(i(!0),r.fetchDevices){const L=await r.fetchDevices();s(L.devices||[])}}catch(L){o("Failed to load devices"),console.error("Failed to load devices:",L)}finally{i(!1)}})()},[r]);const l=async p=>{f(p),h(!0),m("waking");try{if(!r.wakeDevice)throw new Error("Wake device API not available");const L={id:p.id},C=await r.wakeDevice(L);m(C.success?"success":"error"),C.success&&s(P=>P.map(S=>S.id===p.id?{...S,status:"online",last_seen:new Date().toISOString()}:S))}catch(L){m("error"),console.error("Failed to wake device:",L)}},b=async()=>{i(!0),o(null);try{if(r.scanDevices){const p=await r.scanDevices();s(p.devices||[])}else if(r.fetchDevices){const p=await r.fetchDevices();s(p.devices||[])}}catch(p){o("Failed to scan network"),console.error("Failed to scan network:",p)}finally{i(!1)}},_=p=>{switch(p){case"online":return"primary";case"offline":return"secondary";case"unknown":return"default";default:return"default"}},k=p=>{switch(p){case"online":return"Online";case"offline":return"Offline";case"unknown":return"Unknown";default:return"Unknown"}},g=p=>{const L=new Date(p),P=new Date().getTime()-L.getTime(),S=Math.floor(P/6e4),R=Math.floor(S/60),E=Math.floor(R/24);return S<1?"Just now":S<60?`${S}m ago`:R<24?`${R}h ago`:`${E}d ago`};return t("div",{className:"space-y-6",children:[t("div",{className:"flex items-center justify-between",children:[t("div",{children:[t("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Devices"}),t("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Manage network devices, DNS resolution, and Wake-on-LAN"})]}),t("div",{className:"flex items-center space-x-3",children:t($,{variant:"outline",onClick:b,loading:a,children:[t("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),"Scan Network"]})})]}),n&&t("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:t("div",{className:"flex",children:[t("svg",{className:"w-5 h-5 text-red-400 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),t("div",{children:[t("h3",{className:"text-sm font-medium text-red-800 dark:text-red-200",children:"Error"}),t("p",{className:"text-sm text-red-700 dark:text-red-300 mt-1",children:n})]})]})}),t("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[t(H,{children:t("div",{className:"flex items-center",children:[t("div",{className:"p-3 bg-green-100 dark:bg-green-900/20 rounded-lg",children:t("svg",{className:"w-6 h-6 text-green-600 dark:text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),t("div",{className:"ml-4",children:[t("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Online Devices"}),t("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:e.filter(p=>p.status==="online").length})]})]})}),t(H,{children:t("div",{className:"flex items-center",children:[t("div",{className:"p-3 bg-red-100 dark:bg-red-900/20 rounded-lg",children:t("svg",{className:"w-6 h-6 text-red-600 dark:text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),t("div",{className:"ml-4",children:[t("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Offline Devices"}),t("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:e.filter(p=>p.status==="offline").length})]})]})}),t(H,{children:t("div",{className:"flex items-center",children:[t("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/20 rounded-lg",children:t("svg",{className:"w-6 h-6 text-blue-600 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})})}),t("div",{className:"ml-4",children:[t("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Total Devices"}),t("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:e.length})]})]})})]}),t(H,{title:"Network Devices",subtitle:"Manage and wake up devices on your network",children:t(Ae,{children:[t(Oe,{children:t(te,{children:[t(Y,{children:"Device Name"}),t(Y,{children:"MAC Address"}),t(Y,{children:"IP Address"}),t(Y,{children:"Status"}),t(Y,{children:"Last Seen"}),t(Y,{children:"Vendor"}),t(Y,{children:"Actions"})]})}),t(Me,{children:e.length===0?t(te,{children:t(G,{colSpan:7,children:t("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:a?"Loading...":"No devices found. Try scanning the network or adding a device manually."})})}):e.map(p=>t(te,{children:[t(G,{children:t("span",{className:"font-medium",children:p.name})}),t(G,{children:t("span",{className:"font-mono text-sm",children:p.mac})}),t(G,{children:p.ip}),t(G,{children:t(le,{variant:_(p.status),children:k(p.status)})}),t(G,{children:g(p.last_seen)}),t(G,{children:p.vendor||"Unknown"}),t(G,{children:t("div",{className:"flex space-x-2",children:t($,{size:"sm",variant:"outline",onClick:()=>l(p),disabled:p.status==="online",children:[t("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"Wake"]})})})]},p.id))})]})}),t(xe,{isOpen:d,onClose:()=>{h(!1),m("idle")},title:"Wake Up Device",children:t("div",{className:"space-y-4",children:[t("div",{className:"text-center",children:[t("div",{className:"w-16 h-16 bg-blue-100 dark:bg-blue-900/20 rounded-full flex items-center justify-center mx-auto mb-4",children:t("svg",{className:"w-8 h-8 text-blue-600 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})})}),t("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:(u==null?void 0:u.name)||"Unknown Device"}),t("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:(u==null?void 0:u.mac)||"Unknown MAC"})]}),c==="waking"&&t("div",{className:"text-center",children:[t("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),t("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Sending wake-up packet..."})]}),c==="success"&&t("div",{className:"text-center",children:[t("div",{className:"w-8 h-8 bg-green-100 dark:bg-green-900/20 rounded-full flex items-center justify-center mx-auto mb-2",children:t("svg",{className:"w-5 h-5 text-green-600 dark:text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),t("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Wake-up packet sent successfully!"})]}),c==="error"&&t("div",{className:"text-center",children:[t("div",{className:"w-8 h-8 bg-red-100 dark:bg-red-900/20 rounded-full flex items-center justify-center mx-auto mb-2",children:t("svg",{className:"w-5 h-5 text-red-600 dark:text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),t("p",{className:"text-sm text-red-600 dark:text-red-400",children:"Failed to send wake-up packet"})]}),t("div",{className:"flex justify-end space-x-3 mt-6",children:[t($,{variant:"outline",onClick:()=>{h(!1),m("idle")},children:"Close"}),c==="idle"&&u&&t($,{onClick:()=>l(u),children:"Send Wake Packet"})]})]})})]})}function Jr({role:r,permissions:e=[],showDetails:s=!1,onViewPermissions:a,className:i=""}){return t("div",{className:`space-y-2 ${i}`,children:[t("div",{className:"flex items-center space-x-2",children:[t(Br,{role:r,size:"sm"}),e.length>0&&t("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[e.length," permissions"]})]}),s&&a&&t($,{variant:"outline",size:"sm",onClick:a,className:"w-full",children:["View Permissions (",e.length,")"]})]})}function La({isOpen:r,onClose:e,role:s}){const[a,i]=x([]),[n,o]=x(!1),[d,h]=x("");F(()=>{r&&s&&u()},[r,s]);const u=async()=>{try{o(!0),h("");const c=await A.fetchRolePermissions(s);i(c.permissions)}catch(c){h(c instanceof Error?c.message:"Failed to load permissions")}finally{o(!1)}},f=a.reduce((c,m)=>{const l=m.category||"Other";return c[l]||(c[l]=[]),c[l].push(m),c},{});return t(xe,{isOpen:r,onClose:e,title:`${s.charAt(0).toUpperCase()+s.slice(1)} Permissions`,size:"xl",children:t("div",{className:"space-y-6",children:[t("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-gray-800 dark:to-gray-700 rounded-lg p-6 border border-blue-200 dark:border-gray-600",children:t("div",{className:"flex items-center space-x-4",children:[t(Br,{role:s,size:"lg"}),t("div",{children:[t("h3",{className:"text-xl font-bold text-gray-900 dark:text-white capitalize",children:[s," Role"]}),t("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:s==="admin"?"Full system access with all permissions":"Limited access for regular users"}),t("div",{className:"mt-2",children:t("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300",children:[a.length," permissions"]})})]})]})}),n&&t(De,{message:"Loading permissions..."}),d&&t("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:t("div",{className:"flex items-center",children:[t("div",{className:"flex-shrink-0",children:t("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:t("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),t("div",{className:"ml-3",children:[t("h3",{className:"text-sm font-medium text-red-800 dark:text-red-200",children:"Error loading permissions"}),t("div",{className:"mt-2 text-sm text-red-700 dark:text-red-300",children:d})]})]})}),!n&&!d&&Object.keys(f).length>0&&t("div",{className:"space-y-4",children:Object.entries(f).map(([c,m])=>t("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm hover:shadow-md transition-shadow",children:[t("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-700 px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:t("div",{className:"flex items-center justify-between",children:[t("h4",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:c}),t("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-200 text-gray-800 dark:bg-gray-600 dark:text-gray-200",children:[m.length," permission",m.length!==1?"s":""]})]})}),t("div",{className:"p-6",children:t("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:m.map(l=>t("div",{className:"flex items-start space-x-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[t("div",{className:"flex-shrink-0 mt-1",children:t("div",{className:"w-2 h-2 bg-green-500 rounded-full"})}),t("div",{className:"flex-1 min-w-0",children:[t("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:l.name}),t("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:l.description})]})]},l.name))})})]},c))}),!n&&!d&&a.length===0&&t(Hr,{title:"No permissions found",description:"This role doesn't have any permissions assigned.",icon:"shield"})]})})}function Ta(){const[r,e]=x([]),[s,a]=x([]),[i,n]=x(!0),[o,d]=x(""),[h,u]=x(!1),[f,c]=x(null),[m,l]=x(!1),[b,_]=x(""),k=async()=>{try{n(!0);const S=await A.fetchUsers();e(S.users)}catch(S){d(S instanceof Error?S.message:"Failed to load users")}finally{n(!1)}},g=async()=>{try{const S=await A.fetchRoles();a(S.roles)}catch(S){console.error("Failed to load roles:",S)}};F(()=>{A.state.isAuthenticated&&(k(),g())},[A.state.isAuthenticated]);const p=async S=>{try{await A.createUser(S),u(!1),await k()}catch(R){d(R instanceof Error?R.message:"Failed to create user")}},L=async(S,R)=>{try{await A.updateUser(S,R),c(null),await k()}catch(E){d(E instanceof Error?E.message:"Failed to update user")}},C=async S=>{if(confirm(`Are you sure you want to delete user "${S}"?`))try{await A.deleteUser(S),await k()}catch(R){d(R instanceof Error?R.message:"Failed to delete user")}},P=S=>{_(S),l(!0)};return A.state.isAuthenticated?i?t("div",{className:"flex justify-center items-center h-64",children:t("div",{className:"text-gray-500 dark:text-gray-400",children:"Loading users..."})}):t("div",{className:"space-y-6",children:[t("div",{className:"flex justify-between items-center",children:[t("div",{children:[t("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"User Management"}),t("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Manage system users and their permissions"})]}),t($,{onClick:()=>u(!0),variant:"primary",children:"Add User"})]}),o&&t(H,{className:"border-red-200 bg-red-50 dark:bg-red-900/20 dark:border-red-800",children:t("div",{className:"flex items-center",children:[t("svg",{className:"h-5 w-5 text-red-400 mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:t("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94l-1.72-1.72z",clipRule:"evenodd"})}),t("p",{className:"text-sm font-medium text-red-800 dark:text-red-200",children:o})]})}),h&&t(Wt,{roles:s,onSubmit:p,onCancel:()=>u(!1)}),t(H,{children:t(Ae,{children:[t(Oe,{children:t(te,{children:[t(Y,{children:"User"}),t(Y,{children:"Role & Permissions"}),t(Y,{children:"Actions"})]})}),t(Me,{children:r.map(S=>{var R;return t(te,{children:[t(G,{children:t("div",{className:"flex items-center",children:[t(va,{email:S.email,role:S.role,size:"md",className:"mr-3"}),t("div",{children:[t("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:S.email}),t("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[((R=S.permissions)==null?void 0:R.length)||0," permissions"]})]})]})}),t(G,{children:t(Jr,{role:S.role,permissions:S.permissions||[],showDetails:!0,onViewPermissions:()=>P(S.role)})}),t(G,{children:t("div",{className:"flex space-x-2",children:[t($,{onClick:()=>c(S.email),variant:"outline",size:"sm",children:"Edit"}),t($,{onClick:()=>C(S.email),variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700 border-red-300 hover:border-red-400",children:"Delete"})]})})]},S.email)})})]})}),f&&t(Wt,{user:r.find(S=>S.email===f)||void 0,roles:s,onSubmit:S=>L(f,S),onCancel:()=>c(null)}),t(Ea,{isOpen:m,onClose:()=>l(!1),role:b})]}):t("div",{className:"flex justify-center items-center h-64",children:t("div",{className:"text-gray-500 dark:text-gray-400",children:"Please log in to manage users."})})}function Wt({user:r,roles:e=[],onSubmit:s,onCancel:a}){const[i,n]=x((r==null?void 0:r.email)||""),[o,d]=x(""),[h,u]=x((r==null?void 0:r.role)||"user");F(()=>{r!=null&&r.role&&u(r.role)},[r==null?void 0:r.role]);const[f,c]=x(!1);return t(xe,{isOpen:!0,onClose:a,title:r?"Edit User":"Create User",children:t("form",{onSubmit:async l=>{l.preventDefault(),c(!0);try{await s({email:i,password:o,role:h})}catch(b){console.error("Form submission error:",b)}finally{c(!1)}},className:"space-y-4",children:[t(q,{label:"Email",type:"email",value:i,onInput:l=>n(l.target.value),placeholder:"Enter email",required:!0,disabled:f}),t(q,{label:"Password",type:"password",value:o,onInput:l=>d(l.target.value),placeholder:r?"Leave empty to keep current password":"Enter password",required:!r,disabled:f}),t("div",{children:[t("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Role"}),t("select",{className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm",value:h,onChange:l=>u(l.target.value),disabled:f,children:e.map(l=>t("option",{value:l.name,children:[l.name.charAt(0).toUpperCase()+l.name.slice(1)," - ",l.description]},l.name))}),e.length>0&&t("div",{className:"mt-2",children:t(Jr,{role:h,showDetails:!1,className:"text-xs"})})]}),t("div",{className:"flex justify-end space-x-3 pt-4",children:[t($,{type:"button",onClick:a,variant:"outline",disabled:f,children:"Cancel"}),t($,{type:"submit",variant:"primary",loading:f,disabled:f,children:r?"Update User":"Create User"})]})]})})}function Ea({isOpen:r,onClose:e,role:s}){return t(La,{isOpen:r,onClose:e,role:s})}function Ra(){const[r,e]=x([]),[s,a]=x(null),[i,n]=x(null),[o,d]=x(!0),[h,u]=x(""),f=async()=>{try{d(!0);const m=await A.fetchRoles();e(m.roles)}catch(m){u(m instanceof Error?m.message:"Failed to load roles")}finally{d(!1)}},c=async m=>{try{const l=await A.fetchRolePermissions(m);n(l),a(m)}catch(l){u(l instanceof Error?l.message:"Failed to load role permissions")}};return F(()=>{A.state.isAuthenticated&&f()},[A.state.isAuthenticated]),A.state.isAuthenticated?o?t(De,{message:"Loading roles..."}):t("div",{className:"space-y-6",children:[t("div",{className:"flex justify-between items-center",children:t("div",{children:[t("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Roles & Permissions"}),t("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Overview of system roles and their associated permissions"})]})}),h&&t(H,{className:"border-red-200 bg-red-50 dark:bg-red-900/20 dark:border-red-800",children:t("div",{className:"flex items-center",children:[t("svg",{className:"h-5 w-5 text-red-400 mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:t("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94l-1.72-1.72z",clipRule:"evenodd"})}),t("p",{className:"text-sm font-medium text-red-800 dark:text-red-200",children:h})]})}),t("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map(m=>{const l=b=>b==="admin"?t("svg",{className:"w-6 h-6 text-red-600 dark:text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:t("path",{fillRule:"evenodd",d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z",clipRule:"evenodd"})}):t("svg",{className:"w-6 h-6 text-blue-600 dark:text-blue-400",viewBox:"0 0 20 20",fill:"currentColor",children:t("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"})});return t(ma,{title:m.name.charAt(0).toUpperCase()+m.name.slice(1),description:m.description,count:m.permissions_count,icon:l(m.name),status:s===m.name?"active":"inactive",onClick:()=>c(m.name)},m.name)})}),s&&i&&t(H,{className:"max-w-6xl mx-auto",children:t("div",{className:"p-6",children:[t("div",{className:"flex items-center justify-between mb-6",children:[t("div",{className:"flex items-center space-x-3",children:[t("div",{className:`p-3 rounded-lg ${s==="admin"?"bg-red-100 dark:bg-red-900/30":"bg-blue-100 dark:bg-blue-900/30"}`,children:s==="admin"?t("svg",{className:"w-8 h-8 text-red-600 dark:text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:t("path",{fillRule:"evenodd",d:"M9.504 1.132a1 1 0 01.992 0l1.75 1a1 1 0 11-.992 1.736L10 3.152l-1.254.716a1 1 0 11-.992-1.736l1.75-1zM5.618 4.504a1 1 0 01-.372 1.364L5.016 6l.23.132a1 1 0 11-.992 1.736L3.667 8.5l-.23.132a1 1 0 01-.992-1.736L2.5 6.5l-.23-.132a1 1 0 01.992-1.736L3.5 4.5l.23-.132a1 1 0 011.364.372zm8.764 0a1 1 0 011.364-.372l.23.132.23-.132a1 1 0 011.364.372l.132.23-.132.23a1 1 0 01-1.736.992L16.5 6.5l.132.23a1 1 0 01-1.736.992L14.5 6.5l-.132-.23a1 1 0 01.992-1.736L15.5 4.5l-.132-.23a1 1 0 01-.372-1.364zm-7 4a1 1 0 011.364-.372L7.5 9l.23.132a1 1 0 11-.992 1.736L5.667 11.5l-.23.132a1 1 0 01-.992-1.736L4.5 10.5l-.23-.132a1 1 0 01.992-1.736L5.5 8.5l.23-.132a1 1 0 01.364-.372zm7 0a1 1 0 01.364.372l.23.132.23-.132a1 1 0 01.992 1.736L16.5 10.5l.132.23a1 1 0 01-1.736.992L14.5 10.5l-.132-.23a1 1 0 01.992-1.736L15.5 8.5l.132-.23a1 1 0 01.372-.364zM9.504 13.132a1 1 0 01.992 0l1.75 1a1 1 0 11-.992 1.736L10 15.152l-1.254.716a1 1 0 11-.992-1.736l1.75-1z",clipRule:"evenodd"})}):t("svg",{className:"w-8 h-8 text-blue-600 dark:text-blue-400",viewBox:"0 0 20 20",fill:"currentColor",children:t("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"})})}),t("div",{children:[t("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white capitalize",children:[s," Role"]}),t("p",{className:"text-gray-600 dark:text-gray-400",children:[i.count," permissions across ",Object.keys(i.categories).length," categories"]})]})]}),t($,{variant:"outline",onClick:()=>a(null),children:"Close"})]}),t("div",{className:"space-y-6",children:Object.entries(i.categories).map(([m,l])=>t("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg",children:[t("div",{className:"bg-gray-100 dark:bg-gray-800 px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:[t("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:m}),t("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[l.length," permission",l.length!==1?"s":""]})]}),t("div",{className:"p-4",children:t("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:l.map(b=>t("div",{className:"flex items-start space-x-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[t("div",{className:"flex-shrink-0 mt-1",children:t("div",{className:"w-2 h-2 bg-green-500 rounded-full"})}),t("div",{className:"flex-1 min-w-0",children:[t("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:b.name}),t("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:b.description})]})]},b.name))})})]},m))})]})})]}):t("div",{className:"flex justify-center items-center h-64",children:t("div",{className:"text-gray-500 dark:text-gray-400",children:"Please log in to view roles."})})}const Pa=(r,e)=>{const s=e.split("/"),a=s[0],i=s[1];if(!a||!i)return null;for(const n of r){const o=n.name.toLowerCase();if(o.includes(a.toLowerCase())&&o.includes(i.toLowerCase()))return n}for(const n of r)if(n.name.toLowerCase().includes(a.toLowerCase()))return n;for(const n of r){const o=n.name.toLowerCase();if(o.includes(".tar.gz")||o.includes(".zip")||o.includes(".bin"))return n}return null},Ua=({provider:r})=>{const[e,s]=x(null),[a,i]=x(null),[n,o]=x(!1),[d,h]=x(!1),[u,f]=x(!1),[c,m]=x(!1),[l,b]=x(null),[_,k]=x(null),g=(E,D)=>{b({message:E,type:D}),setTimeout(()=>b(null),5e3)};F(()=>r?r.onUpdateAvailable(D=>{console.log("WebSocket update notification received:",D),s(D),g(`Update available: ${D.latest_version}`,"success")}):void 0,[r]);const p=async()=>{o(!0);try{const D=await(await A.authenticatedFetch("/api/v1/update/check")).json();s(D)}catch(E){g(`Failed to check for updates: ${E}`,"error")}finally{o(!1)}},L=async()=>{var z;if(!((z=e==null?void 0:e.release)!=null&&z.assets))return;const E=(a==null?void 0:a.platform)||"",D=Pa(e.release.assets,E);if(!D){g("No suitable update found for your platform","error");return}h(!0);try{const j=await A.authenticatedFetch("/api/v1/update/download",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({download_url:D.browser_download_url})});if(!j.ok)throw new Error("Failed to download update");const v=await j.json();k(v.path),g("Update downloaded successfully","success")}catch(j){g(`Failed to download update: ${j}`,"error")}finally{h(!1)}},C=async(E=30,D=2e3)=>{m(!0);let z=0;const j=async()=>{try{return(await A.authenticatedFetch("/api/v1/update/status",{method:"HEAD",signal:AbortSignal.timeout(5e3)})).ok}catch{return!1}},v=async()=>{if(z++,z>E){m(!1),g("Server did not come back online after installation. Please check manually.","error");return}if(await j()){m(!1),g("Server is back online! Reloading page...","success"),setTimeout(()=>{window.location.reload()},1e3);return}setTimeout(v,D)};g("Installation complete. Waiting for server to restart...","success"),v()},P=async()=>{if(_){f(!0);try{const E=await A.authenticatedFetch("/api/v1/update/install",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({update_path:_})});if(!E.ok)throw new Error("Failed to install update");const D=await E.json();g(D.message||"Update installed successfully. Server will restart...","success"),k(null),await C()}catch(E){g(`Failed to install update: ${E}`,"error")}finally{f(!1)}}},S=E=>new Date(E).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),R=E=>{const D=E.match(/(?:(\d+)h)?(?:(\d+)m)?(?:(\d+(?:\.\d+)?)s)?/);if(!D)return E;const z=parseInt(D[1]||"0"),j=parseInt(D[2]||"0"),v=parseFloat(D[3]||"0"),y=[];return z>0&&y.push(`${z}h`),j>0&&y.push(`${j}m`),v>0&&y.push(`${Math.floor(v)}s`),y.join(" ")||"0s"};return F(()=>{(async()=>{try{const z=await(await A.authenticatedFetch("/api/v1/update/status")).json();i(z)}catch(D){console.error("Failed to load update status:",D)}})(),p()},[]),t("div",{className:"space-y-6",children:[t("div",{className:"flex items-center justify-between",children:t("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Updates"})}),l&&t(Ir,{message:l.message,type:l.type,onClose:()=>b(null)}),t(H,{children:t("div",{className:"p-6",children:[t("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-6",children:"Current Version"}),a?t("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[t("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[t("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Version"}),t("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:a.current_version})]}),t("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[t("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Build Time"}),t("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:S(a.build_time)})]}),t("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[t("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Uptime"}),t("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:R(a.uptime)})]}),t("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[t("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Platform"}),t("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:a.platform})]})]}):t("div",{className:"flex items-center justify-center py-12",children:t(oe,{})})]})}),t(H,{children:t("div",{className:"p-6",children:[t("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[t("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Check for Updates"}),t($,{onClick:p,disabled:n,className:"flex items-center gap-2 w-full sm:w-auto",children:[n?t(oe,{size:"sm"}):null,"Check for Updates"]})]}),e&&t("div",{className:"space-y-4",children:[e.has_update?t("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-xl p-6",children:[t("div",{className:"flex items-center gap-3 mb-3",children:[t("div",{className:"w-3 h-3 bg-blue-500 rounded-full animate-pulse"}),t("p",{className:"text-blue-800 dark:text-blue-200 font-semibold text-lg",children:"Update Available"})]}),t("p",{className:"text-blue-700 dark:text-blue-300 text-base mb-2",children:["New version ",t("span",{className:"font-bold",children:e.latest_version})," is available"]}),t("p",{className:"text-blue-600 dark:text-blue-400 text-sm",children:["Current version: ",e.current_version]}),e.release&&t("div",{className:"mt-3 space-y-2",children:[t("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:["Released: ",S(e.release.published_at)]}),e.release.body&&t("details",{className:"mt-2",children:[t("summary",{className:"text-sm text-blue-600 dark:text-blue-400 cursor-pointer hover:underline",children:"Release Notes"}),t("div",{className:"mt-2 p-3 bg-white dark:bg-gray-800 rounded border text-sm text-gray-700 dark:text-gray-300 whitespace-pre-wrap",children:e.release.body})]})]})]}):t("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-xl p-6",children:[t("div",{className:"flex items-center gap-3 mb-3",children:[t("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),t("p",{className:"text-green-800 dark:text-green-200 font-semibold text-lg",children:"You are up to date"})]}),t("p",{className:"text-green-700 dark:text-green-300 text-base",children:["Running latest version ",t("span",{className:"font-bold",children:e.current_version})]})]}),e.has_update&&t("div",{className:"flex flex-col sm:flex-row gap-3 mt-6",children:_?t($,{onClick:P,disabled:u||c,className:"flex items-center justify-center gap-2 px-6 py-3 bg-red-600 hover:bg-red-700 text-white font-medium",children:[u?t(oe,{size:"sm"}):null,c?"Waiting for server...":"Install Update"]}):t($,{onClick:L,disabled:d,className:"flex items-center justify-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium",children:[d?t(oe,{size:"sm"}):null,"Download Update"]})})]})]})})]})};function $a(r){let e=(r||"").trim();if(!e)return e;e.startsWith("@")&&(e=e.slice(1));try{return new URL(e).hostname||e}catch{}try{return new URL(/^https?:\/\//i.test(e)?e:`http://${e}`).hostname||e}catch{}return e=e.replace(/^\w+:\/\//,""),e=e.replace(/\/.*$/,""),e}function Aa({provider:r}){const[e,s]=x(""),[a,i]=x(""),[n,o]=x(!1),[d,h]=x([]),[u,f]=x(0),[c,m]=x(0),[l,b]=x(20),[_,k]=x(""),[g,p]=x(""),[L,C]=x("expires"),[P,S]=x("desc"),[R,E]=x({open:!1}),[D,z]=x(!1);F(()=>{try{const y=JSON.parse(localStorage.getItem("cache.ui")||"{}");typeof y.limit=="number"&&b(y.limit),y.sort&&C(y.sort),y.order&&S(y.order)}catch{}},[]),F(()=>{try{localStorage.setItem("cache.ui",JSON.stringify({limit:l,sort:L,order:P}))}catch{}},[l,L,P]),F(()=>{const y=window.setTimeout(()=>p(_),300);return()=>window.clearTimeout(y)},[_]),F(()=>{var J,Z,U;const y=(J=r.onCache)==null?void 0:J.call(r,N=>{!N||!Array.isArray(N.items)||(h(N.items),f(N.total||0))});let w=0;const W=(Z=r.onCacheUpdated)==null?void 0:Z.call(r,()=>{var T;const N=Date.now();N-w<800||(w=N,(T=r.fetchCache)==null||T.call(r,{offset:c,limit:l,q:g,sort:L,order:P}).then(O=>{O&&(h(O.items||[]),f(O.total||0))}).catch(()=>{}))});return(U=r.fetchCache)==null||U.call(r,{offset:c,limit:l,q:g,sort:L,order:P}).then(N=>{N&&(h(N.items||[]),f(N.total||0))}).catch(()=>{}),()=>{y&&y(),W&&W()}},[r,c,l,g,L,P]);const j=ne(()=>Math.max(1,Math.ceil(u/l)),[u,l]),v=ne(()=>Math.floor(c/l)+1,[c,l]);return t("div",{className:"space-y-6",children:[t("div",{children:[t("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Cache"}),t("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Manage local DNS cache"})]}),t(H,{children:t("div",{className:"space-y-4",children:[t("div",{className:"flex flex-wrap items-end gap-3",children:[t("div",{className:"flex-1 min-w-[260px]",children:t(q,{label:"Domain",value:e,onInput:y=>s(y.target.value),placeholder:"example.com"})}),t("div",{className:"w-64",children:t(Dt,{label:"Type (optional)",value:a,onChange:y=>i(y.target.value),children:[t("option",{value:"",children:"All"}),t("option",{value:"1",children:"A"}),t("option",{value:"28",children:"AAAA"}),t("option",{value:"5",children:"CNAME"}),t("option",{value:"15",children:"MX"}),t("option",{value:"2",children:"NS"}),t("option",{value:"16",children:"TXT"}),t("option",{value:"33",children:"SRV"}),t("option",{value:"12",children:"PTR"})]})}),t("div",{className:"ml-auto flex items-end gap-3",children:[t($,{type:"button",variant:"secondary",size:"md",className:"h-[42px]",disabled:n,onClick:async()=>{const y=$a(e);if(y){o(!0);try{await r.cacheDelete({name:y,qtype:a?parseInt(a,10):void 0})}finally{o(!1)}}},children:"Delete domain cache"}),t($,{type:"button",variant:"outline",size:"md",className:"h-[42px]",disabled:n,onClick:()=>z(!0),children:"Flush all"}),t("div",{className:"flex items-center gap-2",children:[t("label",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Per page"}),t(Dt,{value:String(l),onChange:y=>b(parseInt(y.target.value,10)),children:[t("option",{value:"10",children:"10"}),t("option",{value:"20",children:"20"}),t("option",{value:"50",children:"50"})]})]})]})]}),t("div",{children:t(q,{label:"Search",value:_,onInput:y=>k(y.target.value),placeholder:"Filter by domain"})}),t(Ae,{children:[t(Oe,{children:t(te,{children:[[{key:"name",label:"Domain"},{key:"qtype",label:"Type"},{key:"answers",label:"Answers"},{key:"expires",label:"Expires"}].map(y=>t(Y,{sortable:!0,active:L===y.key,order:P,onClick:()=>{L===y.key?S(P==="asc"?"desc":"asc"):(C(y.key),S("asc")),m(0)},children:y.label},y.key)),t(Y,{})]})}),t(Me,{children:[d.map(y=>t(te,{children:[t(G,{children:y.name}),t(G,{children:{1:"A",28:"AAAA",5:"CNAME",15:"MX",2:"NS",16:"TXT",33:"SRV",12:"PTR"}[y.qtype]||y.qtype}),t(G,{children:y.answers}),t(G,{children:[Math.max(0,Math.floor((new Date(y.expires_at).getTime()-Date.now())/1e3)),"s"]}),t(G,{align:"right",children:[t($,{type:"button",size:"sm",variant:"outline",onClick:async()=>{var w,W;o(!0);try{await((w=r.cacheDelete)==null?void 0:w.call(r,{name:y.name,qtype:y.qtype})),await((W=r.fetchCache)==null?void 0:W.call(r,{offset:c,limit:l,q:g,sort:L,order:P}))}finally{o(!1)}},children:"Delete"}),t($,{type:"button",size:"sm",className:"ml-2",variant:"secondary",onClick:async()=>{try{const w=await r.restProvider.fetchCacheKey(y.key);E({open:!0,key:y.key,data:w})}catch{}},children:"View"})]})]},y.key)),d.length===0&&t(te,{children:t(G,{align:"left",colSpan:5,children:[" ",t("span",{className:"px-4 py-6 block text-sm text-gray-500 dark:text-gray-400",children:"No cache entries"})," "]})})]})]}),t("div",{className:"flex items-center justify-between",children:[t("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Total: ",u]}),t("div",{className:"flex items-center gap-2",children:[t($,{type:"button",variant:"outline",size:"sm",disabled:v<=1,onClick:()=>m(Math.max(0,c-l)),children:"Prev"}),t("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:[v," / ",j]}),t($,{type:"button",variant:"outline",size:"sm",disabled:v>=j,onClick:()=>m(c+l),children:"Next"})]})]})]})}),t(xe,{isOpen:R.open,title:`Cache entry: ${R.key}`,onClose:()=>E({open:!1}),children:R.data?t("div",{className:"space-y-2",children:[t("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:["RCODE: ",R.data.rcode]}),t("pre",{className:"p-3 rounded-md bg-gray-50 text-gray-800 dark:bg-gray-900 dark:text-gray-200 whitespace-pre-wrap text-sm border border-gray-200 dark:border-gray-700 max-h-80 overflow-auto",children:(R.data.answers||[]).join(`
`)})]}):t("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Loading…"})}),t(xe,{isOpen:D,title:"Confirm flush",onClose:()=>z(!1),primaryAction:{label:"Flush all",onClick:async()=>{var y,w;o(!0);try{await((y=r.cacheFlush)==null?void 0:y.call(r)),await((w=r.fetchCache)==null?void 0:w.call(r,{offset:0,limit:l,q:g,sort:L,order:P})),m(0)}finally{o(!1),z(!1)}},variant:"primary"},secondaryAction:{label:"Cancel",onClick:()=>z(!1)},children:t("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:"This will clear the entire cache. Continue?"})})]})}function Oa({onLogin:r,isFirstUser:e}){const[s,a]=x(""),[i,n]=x(""),[o,d]=x(!1),[h,u]=x("");return t("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:t("div",{className:"max-w-md w-full space-y-8",children:[t("div",{className:"text-center",children:[t("div",{className:"mx-auto h-12 w-12 bg-blue-600 rounded-xl flex items-center justify-center shadow-lg",children:t("svg",{className:"h-8 w-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),t("h2",{className:"mt-6 text-3xl font-bold text-gray-900 dark:text-white",children:e?"Welcome to Outway":"Welcome back"}),t("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:e?"Create your administrator account to get started":"Sign in to your account to continue"})]}),t(H,{className:"shadow-2xl",children:t("form",{onSubmit:async c=>{c.preventDefault(),d(!0),u("");try{e?await A.createFirstUser({email:s,password:i}):await A.login({email:s,password:i}),r()}catch(m){u(m instanceof Error?m.message:"Login failed")}finally{d(!1)}},className:"space-y-6",children:[t("div",{className:"space-y-4",children:[t(q,{label:"Email",type:"email",value:s,onInput:c=>a(c.target.value),placeholder:"Enter your email",required:!0,disabled:o,...h&&{error:h}}),t(q,{label:"Password",type:"password",value:i,onInput:c=>n(c.target.value),placeholder:"Enter your password",required:!0,disabled:o})]}),h&&t("div",{className:"rounded-md bg-red-50 dark:bg-red-900/20 p-4 border border-red-200 dark:border-red-800",children:t("div",{className:"flex",children:[t("div",{className:"flex-shrink-0",children:t("svg",{className:"h-5 w-5 text-red-400",fill:"currentColor",viewBox:"0 0 20 20",children:t("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),t("div",{className:"ml-3",children:t("h3",{className:"text-sm font-medium text-red-800 dark:text-red-200",children:h})})]})}),t($,{type:"submit",variant:"primary",size:"lg",fullWidth:!0,loading:o,disabled:!s||!i,children:o?"Please wait...":e?"Create Account":"Sign In"})]})}),t("div",{className:"text-center",children:t("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:e?"This will create the first administrator account":"Secure access to your Outway dashboard"})})]})})}function Ma(){const r=()=>{const g=window.location.hash.slice(1);return["overview","rules","upstreams","history","hosts","devices","resolve","cache","users","roles","update"].includes(g)?g:"overview"},[e,s]=x(r()),[a,i]=x(!1),[n,o]=x(null),[d,h]=x([]),[u,f]=x(A.state),[c,m]=x(null),[l,b]=x(!0);Fr(),F(()=>{const g=A.subscribe(f);return()=>{g()}},[]),F(()=>{(async()=>{try{const p=await A.getAuthStatus();m(p),A.setAuthStatus(p)}catch(p){console.error("Failed to check auth status:",p);const L={usersExist:!0};m(L),A.setAuthStatus(L)}finally{b(!1)}})()},[u.isAuthenticated]),F(()=>{var S;if(!u.isAuthenticated){n&&(n.close(),o(null));return}const g=new ls(`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`);let p=null;g.connect().then(()=>{o(g),A.setProvider(g),console.log("Provider connected"),A.getAuthStatus().then(R=>{m(R),A.setAuthStatus(R)}).catch(R=>{console.error("Failed to check auth status after provider connection:",R)})}).catch(R=>{console.error("Failed to connect provider:",R)});const L=()=>{const R=window.location.hash.slice(1);["overview","rules","upstreams","history","hosts","devices","resolve","cache","users","roles","update"].includes(R)&&s(R)};L(),window.addEventListener("hashchange",L);const C=()=>{window.innerWidth<1024&&i(!0)};C(),window.addEventListener("resize",C);const P=(S=g.onStatus)==null?void 0:S.call(g,R=>{if(R.channel==="rest"){p&&clearTimeout(p),p=window.setTimeout(()=>{h(E=>[{id:`${Date.now()}`,message:"WebSocket unavailable — using polling",type:"warning",duration:2500},...E].slice(0,4)),p=null},1200);return}p&&(clearTimeout(p),p=null),h(E=>[{id:`${Date.now()}`,message:"Realtime updates via WebSocket",type:"success",duration:2500},...E].slice(0,4))});return()=>{window.removeEventListener("hashchange",L),window.removeEventListener("resize",C),p&&clearTimeout(p),P&&P(),g.close()}},[u.isAuthenticated]);const _=g=>{window.location.hash.slice(1)!==g?window.location.hash=g:s(g),window.innerWidth<1024&&i(!0),window.scrollTo(0,0)},k=()=>{i(!a)};return u.isAuthenticated?n?t("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-700",children:[t(ua,{toasts:d,onRemove:g=>h(p=>p.filter(L=>L.id!==g))}),t(la,{activeTab:e,onTabChange:_,collapsed:a}),t("div",{className:`transition-all duration-300 ${a?"ml-0 lg:ml-16":"ml-0 lg:ml-64"}`,children:[t(da,{onSidebarToggle:k,sidebarCollapsed:a,provider:n}),t("main",{className:"p-6 pt-24",children:t("div",{className:"max-w-7xl mx-auto",children:[e==="overview"&&t(na,{provider:n}),e==="rules"&&t(ya,{provider:n}),e==="upstreams"&&t(ka,{provider:n}),e==="history"&&t(Na,{provider:n}),e==="hosts"&&t(Sa,{provider:n}),e==="devices"&&t(Ca,{provider:n}),e==="resolve"&&t(ia,{provider:n}),e==="cache"&&t(Aa,{provider:n}),e==="users"&&t(Ta,{}),e==="roles"&&t(Ra,{}),e==="update"&&t(Ua,{provider:n})]})})]}),!a&&t("div",{className:"fixed inset-0 z-30 bg-black/50 lg:hidden",onClick:k})]}):t(oe,{text:"Connecting to server...",className:"min-h-screen"}):l?t(oe,{text:"Checking authentication status...",className:"min-h-screen"}):c?t(Oa,{onLogin:()=>s("overview"),isFirstUser:!c.usersExist}):t(oe,{text:"Loading authentication status...",className:"min-h-screen"})}he(t(Ma,{}),document.getElementById("app"));
