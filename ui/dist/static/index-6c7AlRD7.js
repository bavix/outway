(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=r(o);fetch(o.href,a)}})();var ce,$,ut,ee,Fe,ht,mt,pt,Ae,Te,Ee,ft,le={},gt=[],Kt=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,de=Array.isArray;function Z(t,e){for(var r in e)t[r]=e[r];return t}function Me(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function X(t,e,r){var n,o,a,i={};for(a in e)a=="key"?n=e[a]:a=="ref"?o=e[a]:i[a]=e[a];if(arguments.length>2&&(i.children=arguments.length>3?ce.call(arguments,2):r),typeof t=="function"&&t.defaultProps!=null)for(a in t.defaultProps)i[a]===void 0&&(i[a]=t.defaultProps[a]);return ie(t,i,n,o,null)}function ie(t,e,r,n,o){var a={type:t,props:e,key:r,ref:n,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:o??++ut,__i:-1,__u:0};return o==null&&$.vnode!=null&&$.vnode(a),a}function er(){return{current:null}}function J(t){return t.children}function Q(t,e){this.props=t,this.context=e}function te(t,e){if(e==null)return t.__?te(t.__,t.__i+1):null;for(var r;e<t.__k.length;e++)if((r=t.__k[e])!=null&&r.__e!=null)return r.__e;return typeof t.type=="function"?te(t):null}function _t(t){var e,r;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((r=t.__k[e])!=null&&r.__e!=null){t.__e=t.__c.base=r.__e;break}return _t(t)}}function Ue(t){(!t.__d&&(t.__d=!0)&&ee.push(t)&&!xe.__r++||Fe!=$.debounceRendering)&&((Fe=$.debounceRendering)||ht)(xe)}function xe(){for(var t,e,r,n,o,a,i,d=1;ee.length;)ee.length>d&&ee.sort(mt),t=ee.shift(),d=ee.length,t.__d&&(r=void 0,n=void 0,o=(n=(e=t).__v).__e,a=[],i=[],e.__P&&((r=Z({},n)).__v=n.__v+1,$.vnode&&$.vnode(r),We(e.__P,r,n,e.__n,e.__P.namespaceURI,32&n.__u?[o]:null,a,o??te(n),!!(32&n.__u),i),r.__v=n.__v,r.__.__k[r.__i]=r,bt(a,r,i),n.__e=n.__=null,r.__e!=o&&_t(r)));xe.__r=0}function yt(t,e,r,n,o,a,i,d,m,u,h){var l,p,c,v,g,k,x,N=n&&n.__k||gt,A=e.length;for(m=tr(r,e,N,m,A),l=0;l<A;l++)(c=r.__k[l])!=null&&(p=c.__i==-1?le:N[c.__i]||le,c.__i=l,k=We(t,c,p,o,a,i,d,m,u,h),v=c.__e,c.ref&&p.ref!=c.ref&&(p.ref&&He(p.ref,null,c),h.push(c.ref,c.__c||v,c)),g==null&&v!=null&&(g=v),(x=!!(4&c.__u))||p.__k===c.__k?m=vt(c,m,t,x):typeof c.type=="function"&&k!==void 0?m=k:v&&(m=v.nextSibling),c.__u&=-7);return r.__e=g,m}function tr(t,e,r,n,o){var a,i,d,m,u,h=r.length,l=h,p=0;for(t.__k=new Array(o),a=0;a<o;a++)(i=e[a])!=null&&typeof i!="boolean"&&typeof i!="function"?(m=a+p,(i=t.__k[a]=typeof i=="string"||typeof i=="number"||typeof i=="bigint"||i.constructor==String?ie(null,i,null,null,null):de(i)?ie(J,{children:i},null,null,null):i.constructor==null&&i.__b>0?ie(i.type,i.props,i.key,i.ref?i.ref:null,i.__v):i).__=t,i.__b=t.__b+1,d=null,(u=i.__i=rr(i,r,m,l))!=-1&&(l--,(d=r[u])&&(d.__u|=2)),d==null||d.__v==null?(u==-1&&(o>h?p--:o<h&&p++),typeof i.type!="function"&&(i.__u|=4)):u!=m&&(u==m-1?p--:u==m+1?p++:(u>m?p--:p++,i.__u|=4))):t.__k[a]=null;if(l)for(a=0;a<h;a++)(d=r[a])!=null&&(2&d.__u)==0&&(d.__e==n&&(n=te(d)),wt(d,d));return n}function vt(t,e,r,n){var o,a;if(typeof t.type=="function"){for(o=t.__k,a=0;o&&a<o.length;a++)o[a]&&(o[a].__=t,e=vt(o[a],e,r,n));return e}t.__e!=e&&(n&&(e&&t.type&&!e.parentNode&&(e=te(t)),r.insertBefore(t.__e,e||null)),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function Y(t,e){return e=e||[],t==null||typeof t=="boolean"||(de(t)?t.some(function(r){Y(r,e)}):e.push(t)),e}function rr(t,e,r,n){var o,a,i,d=t.key,m=t.type,u=e[r],h=u!=null&&(2&u.__u)==0;if(u===null&&t.key==null||h&&d==u.key&&m==u.type)return r;if(n>(h?1:0)){for(o=r-1,a=r+1;o>=0||a<e.length;)if((u=e[i=o>=0?o--:a++])!=null&&(2&u.__u)==0&&d==u.key&&m==u.type)return i}return-1}function ze(t,e,r){e[0]=="-"?t.setProperty(e,r??""):t[e]=r==null?"":typeof r!="number"||Kt.test(e)?r:r+"px"}function pe(t,e,r,n,o){var a,i;e:if(e=="style")if(typeof r=="string")t.style.cssText=r;else{if(typeof n=="string"&&(t.style.cssText=n=""),n)for(e in n)r&&e in r||ze(t.style,e,"");if(r)for(e in r)n&&r[e]==n[e]||ze(t.style,e,r[e])}else if(e[0]=="o"&&e[1]=="n")a=e!=(e=e.replace(pt,"$1")),i=e.toLowerCase(),e=i in t||e=="onFocusOut"||e=="onFocusIn"?i.slice(2):e.slice(2),t.l||(t.l={}),t.l[e+a]=r,r?n?r.u=n.u:(r.u=Ae,t.addEventListener(e,a?Ee:Te,a)):t.removeEventListener(e,a?Ee:Te,a);else{if(o=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=r??"";break e}catch{}typeof r=="function"||(r==null||r===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&r==1?"":r))}}function Ge(t){return function(e){if(this.l){var r=this.l[e.type+t];if(e.t==null)e.t=Ae++;else if(e.t<r.u)return;return r($.event?$.event(e):e)}}}function We(t,e,r,n,o,a,i,d,m,u){var h,l,p,c,v,g,k,x,N,A,U,S,C,P,W,F,j,T=e.type;if(e.constructor!=null)return null;128&r.__u&&(m=!!(32&r.__u),a=[d=e.__e=r.__e]),(h=$.__b)&&h(e);e:if(typeof T=="function")try{if(x=e.props,N="prototype"in T&&T.prototype.render,A=(h=T.contextType)&&n[h.__c],U=h?A?A.props.value:h.__:n,r.__c?k=(l=e.__c=r.__c).__=l.__E:(N?e.__c=l=new T(x,U):(e.__c=l=new Q(x,U),l.constructor=T,l.render=nr),A&&A.sub(l),l.props=x,l.state||(l.state={}),l.context=U,l.__n=n,p=l.__d=!0,l.__h=[],l._sb=[]),N&&l.__s==null&&(l.__s=l.state),N&&T.getDerivedStateFromProps!=null&&(l.__s==l.state&&(l.__s=Z({},l.__s)),Z(l.__s,T.getDerivedStateFromProps(x,l.__s))),c=l.props,v=l.state,l.__v=e,p)N&&T.getDerivedStateFromProps==null&&l.componentWillMount!=null&&l.componentWillMount(),N&&l.componentDidMount!=null&&l.__h.push(l.componentDidMount);else{if(N&&T.getDerivedStateFromProps==null&&x!==c&&l.componentWillReceiveProps!=null&&l.componentWillReceiveProps(x,U),!l.__e&&l.shouldComponentUpdate!=null&&l.shouldComponentUpdate(x,l.__s,U)===!1||e.__v==r.__v){for(e.__v!=r.__v&&(l.props=x,l.state=l.__s,l.__d=!1),e.__e=r.__e,e.__k=r.__k,e.__k.some(function(f){f&&(f.__=e)}),S=0;S<l._sb.length;S++)l.__h.push(l._sb[S]);l._sb=[],l.__h.length&&i.push(l);break e}l.componentWillUpdate!=null&&l.componentWillUpdate(x,l.__s,U),N&&l.componentDidUpdate!=null&&l.__h.push(function(){l.componentDidUpdate(c,v,g)})}if(l.context=U,l.props=x,l.__P=t,l.__e=!1,C=$.__r,P=0,N){for(l.state=l.__s,l.__d=!1,C&&C(e),h=l.render(l.props,l.state,l.context),W=0;W<l._sb.length;W++)l.__h.push(l._sb[W]);l._sb=[]}else do l.__d=!1,C&&C(e),h=l.render(l.props,l.state,l.context),l.state=l.__s;while(l.__d&&++P<25);l.state=l.__s,l.getChildContext!=null&&(n=Z(Z({},n),l.getChildContext())),N&&!p&&l.getSnapshotBeforeUpdate!=null&&(g=l.getSnapshotBeforeUpdate(c,v)),F=h,h!=null&&h.type===J&&h.key==null&&(F=xt(h.props.children)),d=yt(t,de(F)?F:[F],e,r,n,o,a,i,d,m,u),l.base=e.__e,e.__u&=-161,l.__h.length&&i.push(l),k&&(l.__E=l.__=null)}catch(f){if(e.__v=null,m||a!=null)if(f.then){for(e.__u|=m?160:128;d&&d.nodeType==8&&d.nextSibling;)d=d.nextSibling;a[a.indexOf(d)]=null,e.__e=d}else{for(j=a.length;j--;)Me(a[j]);Re(e)}else e.__e=r.__e,e.__k=r.__k,f.then||Re(e);$.__e(f,e,r)}else a==null&&e.__v==r.__v?(e.__k=r.__k,e.__e=r.__e):d=e.__e=sr(r.__e,e,r,n,o,a,i,m,u);return(h=$.diffed)&&h(e),128&e.__u?void 0:d}function Re(t){t&&t.__c&&(t.__c.__e=!0),t&&t.__k&&t.__k.forEach(Re)}function bt(t,e,r){for(var n=0;n<r.length;n++)He(r[n],r[++n],r[++n]);$.__c&&$.__c(e,t),t.some(function(o){try{t=o.__h,o.__h=[],t.some(function(a){a.call(o)})}catch(a){$.__e(a,o.__v)}})}function xt(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:de(t)?t.map(xt):Z({},t)}function sr(t,e,r,n,o,a,i,d,m){var u,h,l,p,c,v,g,k=r.props,x=e.props,N=e.type;if(N=="svg"?o="http://www.w3.org/2000/svg":N=="math"?o="http://www.w3.org/1998/Math/MathML":o||(o="http://www.w3.org/1999/xhtml"),a!=null){for(u=0;u<a.length;u++)if((c=a[u])&&"setAttribute"in c==!!N&&(N?c.localName==N:c.nodeType==3)){t=c,a[u]=null;break}}if(t==null){if(N==null)return document.createTextNode(x);t=document.createElementNS(o,N,x.is&&x),d&&($.__m&&$.__m(e,a),d=!1),a=null}if(N==null)k===x||d&&t.data==x||(t.data=x);else{if(a=a&&ce.call(t.childNodes),k=r.props||le,!d&&a!=null)for(k={},u=0;u<t.attributes.length;u++)k[(c=t.attributes[u]).name]=c.value;for(u in k)if(c=k[u],u!="children"){if(u=="dangerouslySetInnerHTML")l=c;else if(!(u in x)){if(u=="value"&&"defaultValue"in x||u=="checked"&&"defaultChecked"in x)continue;pe(t,u,null,c,o)}}for(u in x)c=x[u],u=="children"?p=c:u=="dangerouslySetInnerHTML"?h=c:u=="value"?v=c:u=="checked"?g=c:d&&typeof c!="function"||k[u]===c||pe(t,u,c,k[u],o);if(h)d||l&&(h.__html==l.__html||h.__html==t.innerHTML)||(t.innerHTML=h.__html),e.__k=[];else if(l&&(t.innerHTML=""),yt(e.type=="template"?t.content:t,de(p)?p:[p],e,r,n,N=="foreignObject"?"http://www.w3.org/1999/xhtml":o,a,i,a?a[0]:r.__k&&te(r,0),d,m),a!=null)for(u=a.length;u--;)Me(a[u]);d||(u="value",N=="progress"&&v==null?t.removeAttribute("value"):v!=null&&(v!==t[u]||N=="progress"&&!v||N=="option"&&v!=k[u])&&pe(t,u,v,k[u],o),u="checked",g!=null&&g!=t[u]&&pe(t,u,g,k[u],o))}return t}function He(t,e,r){try{if(typeof t=="function"){var n=typeof t.__u=="function";n&&t.__u(),n&&e==null||(t.__u=t(e))}else t.current=e}catch(o){$.__e(o,r)}}function wt(t,e,r){var n,o;if($.unmount&&$.unmount(t),(n=t.ref)&&(n.current&&n.current!=t.__e||He(n,null,e)),(n=t.__c)!=null){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(a){$.__e(a,e)}n.base=n.__P=null}if(n=t.__k)for(o=0;o<n.length;o++)n[o]&&wt(n[o],e,r||typeof t.type!="function");r||Me(t.__e),t.__c=t.__=t.__e=void 0}function nr(t,e,r){return this.constructor(t,r)}function re(t,e,r){var n,o,a,i;e==document&&(e=document.documentElement),$.__&&$.__(t,e),o=(n=typeof r=="function")?null:r&&r.__k||e.__k,a=[],i=[],We(e,t=(!n&&r||e).__k=X(J,null,[t]),o||le,le,e.namespaceURI,!n&&r?[r]:o?null:e.firstChild?ce.call(e.childNodes):null,a,!n&&r?r:o?o.__e:e.firstChild,n,i),bt(a,t,i)}function kt(t,e){re(t,e,kt)}function ar(t,e,r){var n,o,a,i,d=Z({},t.props);for(a in t.type&&t.type.defaultProps&&(i=t.type.defaultProps),e)a=="key"?n=e[a]:a=="ref"?o=e[a]:d[a]=e[a]===void 0&&i!=null?i[a]:e[a];return arguments.length>2&&(d.children=arguments.length>3?ce.call(arguments,2):r),ie(t.type,d,n||t.key,o||t.ref,null)}function or(t){function e(r){var n,o;return this.getChildContext||(n=new Set,(o={})[e.__c]=this,this.getChildContext=function(){return o},this.componentWillUnmount=function(){n=null},this.shouldComponentUpdate=function(a){this.props.value!=a.value&&n.forEach(function(i){i.__e=!0,Ue(i)})},this.sub=function(a){n.add(a);var i=a.componentWillUnmount;a.componentWillUnmount=function(){n&&n.delete(a),i&&i.call(a)}}),r.children}return e.__c="__cC"+ft++,e.__=t,e.Provider=e.__l=(e.Consumer=function(r,n){return r.children(n)}).contextType=e,e}ce=gt.slice,$={__e:function(t,e,r,n){for(var o,a,i;e=e.__;)if((o=e.__c)&&!o.__)try{if((a=o.constructor)&&a.getDerivedStateFromError!=null&&(o.setState(a.getDerivedStateFromError(t)),i=o.__d),o.componentDidCatch!=null&&(o.componentDidCatch(t,n||{}),i=o.__d),i)return o.__E=o}catch(d){t=d}throw t}},ut=0,Q.prototype.setState=function(t,e){var r;r=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=Z({},this.state),typeof t=="function"&&(t=t(Z({},r),this.props)),t&&Z(r,t),t!=null&&this.__v&&(e&&this._sb.push(e),Ue(this))},Q.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),Ue(this))},Q.prototype.render=J,ee=[],ht=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,mt=function(t,e){return t.__v.__b-e.__v.__b},xe.__r=0,pt=/(PointerCapture)$|Capture$/i,Ae=0,Te=Ge(!1),Ee=Ge(!0),ft=0;var ir=0;function s(t,e,r,n,o,a){e||(e={});var i,d,m=e;if("ref"in m)for(d in m={},e)d=="ref"?i=e[d]:m[d]=e[d];var u={type:t,props:m,key:r,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--ir,__i:-1,__u:0,__source:o,__self:a};if(typeof t=="function"&&(i=t.defaultProps))for(d in i)m[d]===void 0&&(m[d]=i[d]);return $.vnode&&$.vnode(u),u}var K,H,Ne,Ve,se=0,Nt=[],I=$,qe=I.__b,Be=I.__r,Je=I.diffed,Ze=I.__c,Qe=I.unmount,Ye=I.__;function ne(t,e){I.__h&&I.__h(H,t,se||e),se=0;var r=H.__H||(H.__H={__:[],__h:[]});return t>=r.__.length&&r.__.push({}),r.__[t]}function E(t){return se=1,Ie(Rt,t)}function Ie(t,e,r){var n=ne(K++,2);if(n.t=t,!n.__c&&(n.__=[r?r(e):Rt(void 0,e),function(d){var m=n.__N?n.__N[0]:n.__[0],u=n.t(m,d);m!==u&&(n.__N=[u,n.__[1]],n.__c.setState({}))}],n.__c=H,!H.__f)){var o=function(d,m,u){if(!n.__c.__H)return!0;var h=n.__c.__H.__.filter(function(p){return!!p.__c});if(h.every(function(p){return!p.__N}))return!a||a.call(this,d,m,u);var l=n.__c.props!==d;return h.forEach(function(p){if(p.__N){var c=p.__[0];p.__=p.__N,p.__N=void 0,c!==p.__[0]&&(l=!0)}}),a&&a.call(this,d,m,u)||l};H.__f=!0;var a=H.shouldComponentUpdate,i=H.componentWillUpdate;H.componentWillUpdate=function(d,m,u){if(this.__e){var h=a;a=void 0,o(d,m,u),a=h}i&&i.call(this,d,m,u)},H.shouldComponentUpdate=o}return n.__N||n.__}function z(t,e){var r=ne(K++,3);!I.__s&&je(r.__H,e)&&(r.__=t,r.u=e,H.__H.__h.push(r))}function ue(t,e){var r=ne(K++,4);!I.__s&&je(r.__H,e)&&(r.__=t,r.u=e,H.__h.push(r))}function Oe(t){return se=5,he(function(){return{current:t}},[])}function St(t,e,r){se=6,ue(function(){if(typeof t=="function"){var n=t(e());return function(){t(null),n&&typeof n=="function"&&n()}}if(t)return t.current=e(),function(){return t.current=null}},r==null?r:r.concat(t))}function he(t,e){var r=ne(K++,7);return je(r.__H,e)&&(r.__=t(),r.__H=e,r.__h=t),r.__}function Ct(t,e){return se=8,he(function(){return t},e)}function Tt(t){var e=H.context[t.__c],r=ne(K++,9);return r.c=t,e?(r.__==null&&(r.__=!0,e.sub(H)),e.props.value):t.__}function Et(t,e){I.useDebugValue&&I.useDebugValue(e?e(t):t)}function Ut(){var t=ne(K++,11);if(!t.__){for(var e=H.__v;e!==null&&!e.__m&&e.__!==null;)e=e.__;var r=e.__m||(e.__m=[0,0]);t.__="P"+r[0]+"-"+r[1]++}return t.__}function lr(){for(var t;t=Nt.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(ye),t.__H.__h.forEach($e),t.__H.__h=[]}catch(e){t.__H.__h=[],I.__e(e,t.__v)}}I.__b=function(t){H=null,qe&&qe(t)},I.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),Ye&&Ye(t,e)},I.__r=function(t){Be&&Be(t),K=0;var e=(H=t.__c).__H;e&&(Ne===H?(e.__h=[],H.__h=[],e.__.forEach(function(r){r.__N&&(r.__=r.__N),r.u=r.__N=void 0})):(e.__h.forEach(ye),e.__h.forEach($e),e.__h=[],K=0)),Ne=H},I.diffed=function(t){Je&&Je(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(Nt.push(e)!==1&&Ve===I.requestAnimationFrame||((Ve=I.requestAnimationFrame)||cr)(lr)),e.__H.__.forEach(function(r){r.u&&(r.__H=r.u),r.u=void 0})),Ne=H=null},I.__c=function(t,e){e.some(function(r){try{r.__h.forEach(ye),r.__h=r.__h.filter(function(n){return!n.__||$e(n)})}catch(n){e.some(function(o){o.__h&&(o.__h=[])}),e=[],I.__e(n,r.__v)}}),Ze&&Ze(t,e)},I.unmount=function(t){Qe&&Qe(t);var e,r=t.__c;r&&r.__H&&(r.__H.__.forEach(function(n){try{ye(n)}catch(o){e=o}}),r.__H=void 0,e&&I.__e(e,r.__v))};var Xe=typeof requestAnimationFrame=="function";function cr(t){var e,r=function(){clearTimeout(n),Xe&&cancelAnimationFrame(e),setTimeout(t)},n=setTimeout(r,35);Xe&&(e=requestAnimationFrame(r))}function ye(t){var e=H,r=t.__c;typeof r=="function"&&(t.__c=void 0,r()),H=e}function $e(t){var e=H;t.__c=t.__(),H=e}function je(t,e){return!t||t.length!==e.length||e.some(function(r,n){return r!==t[n]})}function Rt(t,e){return typeof e=="function"?e(t):e}class dr{constructor(e){this.url=e}ws=null;reconnectTimeout=null;reconnectAttempts=0;maxReconnectAttempts=10;baseDelay=500;maxDelay=1e4;callbacks=new Map;lastSnapshot={};async connect(){return new Promise((e,r)=>{try{const n=this.url.replace(/^http/,"ws");this.ws=new WebSocket(n),this.ws.onopen=()=>{console.log("WebSocket connected"),this.reconnectAttempts=0,this.clearReconnectTimeout(),e()},this.ws.onmessage=o=>{try{const a=JSON.parse(o.data);this.handleMessage(a)}catch(a){console.warn("Invalid WebSocket message:",a)}},this.ws.onclose=()=>{console.log("WebSocket disconnected"),this.scheduleReconnect()},this.ws.onerror=o=>{console.error("WebSocket error:",o),r(o)},this.ws.addEventListener("ping",()=>{this.ws?.readyState===WebSocket.OPEN&&this.ws.send("pong")})}catch(n){r(n)}})}close(){this.clearReconnectTimeout(),this.ws&&(this.ws.close(),this.ws=null)}handleMessage(e){let r=e.data;if(e.type==="upstreams"&&Array.isArray(r)){const o=this.lastSnapshot.upstreams||[];r=r.map((a,i)=>{const d=(a.name||a.Name||"").toString(),m=a.weight??a.Weight,u=(a.type||a.Type||"").toString().toLowerCase(),h=(a.address||a.Address||"").toString();let l=h;return/^(https?|udp|tcp|tls|dot|quic|doq):\/\//i.test(h)||(u&&u!=="doh"?l=`${u}://${h}`:l=`udp://${h}`),(!l||l==="udp://")&&(l=o.find(c=>c.name===d)?.address||o[i]?.address||l),{name:d,address:l,weight:m}})}if(e.type==="history"){const o=Array.isArray(r)?r:r&&Array.isArray(r.events)?r.events:[];r=o;try{console.debug("[WS] history",Array.isArray(o)?o.length:0)}catch{}}if(e.type==="overview"&&r)try{window.__ov=r}catch{}this.lastSnapshot[e.type]=r;const n=this.callbacks.get(e.type);n&&n.forEach(o=>{try{o(r)}catch(a){console.error("Callback error:",a)}})}scheduleReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.error("Max reconnection attempts reached");return}this.clearReconnectTimeout();const e=Math.min(this.baseDelay*Math.pow(1.8,this.reconnectAttempts),this.maxDelay),r=e*.25,n=e+(Math.random()-.5)*r;this.reconnectTimeout=window.setTimeout(()=>{this.reconnectAttempts++,console.log(`Attempting to reconnect (${this.reconnectAttempts}/${this.maxReconnectAttempts})`),this.connect().catch(console.error)},n)}clearReconnectTimeout(){this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null)}onRuleGroups(e){return this.subscribe("rule_groups",e)}onUpstreams(e){return this.subscribe("upstreams",e)}onStats(e){return this.subscribe("stats",e)}onHistory(e){return this.subscribe("history",e)}onHosts(e){return this.subscribe("hosts",e)}onOverview(e){return this.subscribe("overview",e)}onUpdateAvailable(e){return this.subscribe("update_available",e)}subscribe(e,r){if(this.callbacks.has(e)||this.callbacks.set(e,new Set),this.callbacks.get(e).add(r),this.lastSnapshot[e])try{r(this.lastSnapshot[e])}catch(n){console.error("Snapshot callback error:",n)}return()=>{const n=this.callbacks.get(e);n&&(n.delete(r),n.size===0&&this.callbacks.delete(e))}}async fetchRuleGroups(){throw new Error("Use REST provider for fetch operations")}async createRuleGroup(e){throw new Error("Use REST provider for mutation operations")}async updateRuleGroup(e,r){throw new Error("Use REST provider for mutation operations")}async deleteRuleGroup(e){throw new Error("Use REST provider for mutation operations")}async fetchUpstreams(){throw new Error("Use REST provider for fetch operations")}async saveUpstreams(e){throw new Error("Use REST provider for mutation operations")}async fetchStats(){throw new Error("Use REST provider for fetch operations")}async fetchHistory(){throw new Error("Use REST provider for fetch operations")}async fetchServerInfo(){throw new Error("Use REST provider for fetch operations")}async fetchConfig(){throw new Error("Use REST provider for fetch operations")}async updateConfig(e){throw new Error("Use REST provider for mutation operations")}async fetchHosts(){throw new Error("Use REST provider for fetch operations")}async saveHosts(e){throw new Error("Use REST provider for mutation operations")}async testResolve(e,r){throw new Error("Use REST provider for fetch operations")}}class ur{constructor(e=""){this.baseUrl=e}pollingTimers=new Map;callbacks=new Map;pollingConfig={stats:3e4,history:6e4,rule_groups:3e5,upstreams:3e5,hosts:3e5};async connect(){this.startPolling("stats",()=>this.fetchStats()),this.startPolling("history",()=>this.fetchHistory()),this.startPolling("rule_groups",()=>this.fetchRuleGroups()),this.startPolling("upstreams",()=>this.fetchUpstreams()),this.startPolling("hosts",()=>this.fetchHosts())}close(){this.pollingTimers.forEach(e=>clearInterval(e)),this.pollingTimers.clear(),this.callbacks.clear()}async fetchJSON(e,r={}){const n=await fetch(`${this.baseUrl}${e}`,{headers:{"Content-Type":"application/json",...r.headers},...r});if(!n.ok)throw new Error(`HTTP ${n.status}: ${await n.text()}`);return n.headers.get("content-type")?.includes("application/json")?n.json():n.text()}startPolling(e,r){const n=this.pollingConfig[e];r().then(a=>{this.notifyCallbacks(e,a)}).catch(console.error);const o=window.setInterval(()=>{r().then(a=>{this.notifyCallbacks(e,a)}).catch(console.error)},n);this.pollingTimers.set(e,o)}notifyCallbacks(e,r){const n=this.callbacks.get(e);n&&n.forEach(o=>{try{o(r)}catch(a){console.error("Polling callback error:",a)}})}onRuleGroups(e){return this.subscribe("rule_groups",e)}onUpstreams(e){return this.subscribe("upstreams",e)}onStats(e){return this.subscribe("stats",e)}onHistory(e){return this.subscribe("history",e)}onHosts(e){return this.subscribe("hosts",e)}onUpdateAvailable(e){return()=>{}}subscribe(e,r){return this.callbacks.has(e)||this.callbacks.set(e,new Set),this.callbacks.get(e).add(r),()=>{const n=this.callbacks.get(e);n&&(n.delete(r),n.size===0&&this.callbacks.delete(e))}}async fetchRuleGroups(){return(await this.fetchJSON("/api/v1/rule-groups")).rule_groups}async createRuleGroup(e){await this.fetchJSON("/api/v1/rule-groups",{method:"POST",body:JSON.stringify(e)})}async updateRuleGroup(e,r){await this.fetchJSON(`/api/v1/rule-groups/${encodeURIComponent(e)}`,{method:"PUT",body:JSON.stringify(r)})}async deleteRuleGroup(e){await this.fetchJSON(`/api/v1/rule-groups/${encodeURIComponent(e)}`,{method:"DELETE"})}async fetchUpstreams(){return(await this.fetchJSON("/api/v1/upstreams")).upstreams.map(r=>{const n=r.name||r.Name||"",o=r.weight??r.Weight,a=r.type?.toString().toLowerCase(),i=r.address?.toString()||"";let d=i;return/^(https?|udp|tcp|tls|dot|quic|doq):\/\//i.test(i)?d=i:a&&a!=="doh"&&(d=`${a}://${i.replace(/^(udp|tcp|tls|dot|quic|doq):\/\//i,"")}`),{name:n,address:d,weight:o}})}async saveUpstreams(e){const r=e.map(n=>{const o=String(n.address||"").trim();let a=(n.name||"").trim();const i=typeof n.weight=="number"?n.weight:void 0;try{const u=new URL(o),h=u.protocol.replace(":","").toLowerCase();let l=o;return h!=="https"&&(l=`${h==="tls"?"dot":h==="quic"?"doq":h}://${u.host}`),a||(a=u.hostname),{name:a,address:l,...i!==void 0?{weight:i}:{}}}catch{}const d=o.replace(/^(udp|tcp|tls|dot|quic|doq):\/\//i,"");a||(a=d.split(":")[0]||d);const m=`udp://${d}`;return{name:a,address:m,...i!==void 0?{weight:i}:{}}});await this.fetchJSON("/api/v1/upstreams",{method:"POST",body:JSON.stringify({upstreams:r})})}async fetchStats(){return this.fetchJSON("/api/v1/stats")}async fetchHistory(){return(await this.fetchJSON("/api/v1/history")).events}async fetchHosts(){return(await this.fetchJSON("/api/v1/hosts")).hosts}async saveHosts(e){await this.fetchJSON("/api/v1/hosts",{method:"PUT",body:JSON.stringify({hosts:e})})}async fetchServerInfo(){return this.fetchJSON("/api/v1/info")}async testResolve(e,r){const n=new URLSearchParams({name:e,type:r});return this.fetchJSON(`/api/v1/resolve?${n.toString()}`)}onOverview(e){return this.subscribe("overview",e)}async fetchOverview(){return this.fetchJSON("/api/v1/overview")}}class hr{wsProvider;restProvider;isWSConnected=!1;listeners=new Map;wsUnsubs=new Map;restUnsubs=new Map;statusListeners=new Set;constructor(e="/ws",r=""){this.wsProvider=new dr(e),this.restProvider=new ur(r)}async connect(){try{await this.wsProvider.connect(),this.isWSConnected=!0,console.log("Using WebSocket provider")}catch(e){console.warn("WebSocket connection failed, falling back to REST:",e),this.isWSConnected=!1}try{await this.restProvider.connect(),console.log("REST provider ready")}catch(e){throw console.error("REST provider failed:",e),e}this.resubscribeAll(),this.monitorWSConnection(),this.emitStatus()}close(){this.wsProvider.close(),this.restProvider.close(),this.wsUnsubs.forEach(e=>e()),this.restUnsubs.forEach(e=>e()),this.wsUnsubs.clear(),this.restUnsubs.clear(),this.listeners.clear(),this.statusListeners.clear()}monitorWSConnection(){const e=setInterval(()=>{const r=this.isWSConnected;if(!(this.wsProvider.ws?.readyState===WebSocket.OPEN)){setTimeout(()=>{const o=this.wsProvider.ws?.readyState!==WebSocket.OPEN,a=this.isWSConnected;this.isWSConnected=!o,a!==this.isWSConnected&&(this.resubscribeAll(),console.log(this.isWSConnected?"WebSocket active":"Using REST fallback"),this.emitStatus())},1500);return}this.isWSConnected=!0,r!==!0&&(this.resubscribeAll(),console.log(this.isWSConnected?"WebSocket active":"Using REST fallback"),this.emitStatus())},1e4);this.wsUnsubs.set("_monitor",()=>clearInterval(e))}addListener(e,r){return this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(r),this.resubscribe(e),()=>{const n=this.listeners.get(e);n&&(n.delete(r),n.size===0&&this.listeners.delete(e));const o=this.wsUnsubs.get(e);o&&o();const a=this.restUnsubs.get(e);a&&a(),this.wsUnsubs.delete(e),this.restUnsubs.delete(e)}}resubscribe(e){const r=this.wsUnsubs.get(e);r&&r();const n=this.restUnsubs.get(e);n&&n(),this.wsUnsubs.delete(e),this.restUnsubs.delete(e);const o=this.listeners.get(e);if(!o||o.size===0)return;const a=i=>o.forEach(d=>{try{d(i)}catch{}});if(this.isWSConnected)switch(e){case"rule_groups":this.wsUnsubs.set(e,this.wsProvider.onRuleGroups(a));break;case"upstreams":this.wsUnsubs.set(e,this.wsProvider.onUpstreams(a));break;case"stats":this.wsUnsubs.set(e,this.wsProvider.onStats(a));break;case"history":this.wsUnsubs.set(e,this.wsProvider.onHistory(a));break;case"hosts":this.wsUnsubs.set(e,this.wsProvider.onHosts(a));break;case"overview":this.wsUnsubs.set(e,this.wsProvider.onOverview(a));break;case"update_available":this.wsUnsubs.set(e,this.wsProvider.onUpdateAvailable(a));break}else switch(e){case"rule_groups":this.restUnsubs.set(e,this.restProvider.onRuleGroups(a));break;case"upstreams":this.restUnsubs.set(e,this.restProvider.onUpstreams(a));break;case"stats":this.restUnsubs.set(e,this.restProvider.onStats(a));break;case"history":this.restUnsubs.set(e,this.restProvider.onHistory(a));break;case"hosts":this.restUnsubs.set(e,this.restProvider.onHosts(a));break;case"overview":this.restUnsubs.set(e,this.restProvider.onOverview(a));break;case"update_available":this.restUnsubs.set(e,this.restProvider.onUpdateAvailable(a));break}}resubscribeAll(){Array.from(this.listeners.keys()).forEach(e=>this.resubscribe(e))}emitStatus(){const e={channel:this.isWSConnected?"ws":"rest",connected:!0};this.statusListeners.forEach(r=>{try{r(e)}catch{}})}onStatus(e){return this.statusListeners.add(e),e({channel:this.isWSConnected?"ws":"rest",connected:!0}),()=>{this.statusListeners.delete(e)}}async reconnect(){try{await this.wsProvider.connect(),this.isWSConnected=!0,this.resubscribeAll(),this.emitStatus()}catch{}}onRuleGroups(e){return this.addListener("rule_groups",e)}onUpstreams(e){return this.addListener("upstreams",e)}onStats(e){return this.addListener("stats",e)}onHistory(e){return this.addListener("history",e)}onHosts(e){return this.addListener("hosts",e)}onOverview(e){return this.addListener("overview",e)}onUpdateAvailable(e){return this.addListener("update_available",e)}async fetchRuleGroups(){try{return await this.restProvider.fetchRuleGroups()}catch(e){throw console.error("Failed to fetch rule groups:",e),e}}async createRuleGroup(e){try{await this.restProvider.createRuleGroup(e)}catch(r){throw console.error("Failed to create rule group:",r),r}}async updateRuleGroup(e,r){try{await this.restProvider.updateRuleGroup(e,r)}catch(n){throw console.error("Failed to update rule group:",n),n}}async deleteRuleGroup(e){try{await this.restProvider.deleteRuleGroup(e)}catch(r){throw console.error("Failed to delete rule group:",r),r}}async fetchUpstreams(){try{return this.isWSConnected&&this.wsProvider&&this.wsProvider.lastSnapshot?.upstreams?this.wsProvider.lastSnapshot.upstreams:await this.restProvider.fetchUpstreams()}catch(e){throw console.error("Failed to fetch upstreams:",e),e}}async saveUpstreams(e){try{await this.restProvider.saveUpstreams(e)}catch(r){throw console.error("Failed to save upstreams:",r),r}}async fetchStats(){try{return await this.restProvider.fetchStats()}catch(e){throw console.error("Failed to fetch stats:",e),e}}async fetchHistory(){try{return await this.restProvider.fetchHistory()}catch(e){throw console.error("Failed to fetch history:",e),e}}async fetchHosts(){try{return await this.restProvider.fetchHosts()}catch(e){throw console.error("Failed to fetch hosts:",e),e}}async saveHosts(e){try{await this.restProvider.saveHosts(e)}catch(r){throw console.error("Failed to save hosts:",r),r}}async fetchServerInfo(){try{return await this.restProvider.fetchServerInfo()}catch(e){throw console.error("Failed to fetch server info:",e),e}}async fetchOverview(){try{return await this.restProvider.fetchOverview()}catch(e){throw console.error("Failed to fetch overview:",e),e}}async testResolve(e,r){try{return await this.restProvider.testResolve(e,r)}catch(n){throw console.error("Failed to run resolve test:",n),n}}}function G({children:t,className:e="",title:r,subtitle:n,...o}){const a=`card bg-white/80 dark:bg-gray-800/70 backdrop-blur-sm rounded-xl p-6 border border-gray-200/50 dark:border-gray-700/50 shadow-lg hover:shadow-xl transition-all duration-300 ${e}`.trim();return s("div",{className:a,...o,children:[(r||n)&&s("div",{className:"card-header pb-4 mb-6 border-b border-gray-200 dark:border-gray-700",children:[r&&s("h3",{className:"card-title text-xl font-semibold text-gray-900 dark:text-gray-100 leading-tight",children:r}),n&&s("p",{className:"card-subtitle text-sm text-gray-600 dark:text-gray-400 mt-2 leading-relaxed",children:n})]}),s("div",{className:"card-content text-gray-700 dark:text-gray-300 leading-relaxed",children:t})]})}function fe({title:t,value:e,change:r,icon:n,color:o="blue",className:a=""}){const i={blue:"text-blue-600 dark:text-blue-400",green:"text-green-600 dark:text-green-400",red:"text-red-600 dark:text-red-400",yellow:"text-yellow-600 dark:text-yellow-400",purple:"text-purple-600 dark:text-purple-400",indigo:"text-indigo-600 dark:text-indigo-400"},d=`stats-card bg-white rounded-md p-6 shadow-sm dark:bg-black dark:shadow-none ${a}`.trim();return s("div",{className:d,children:s("div",{className:"flex items-center justify-between",children:[s("div",{children:[s("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t}),s("p",{className:"text-2xl font-bold text-black dark:text-white mt-1",children:e}),r&&s("p",{className:`text-xs font-medium mt-2 ${r.type==="increase"?"text-green-600":"text-red-600"}`,children:[r.type==="increase"?"↗":"↘"," ",Math.abs(r.value),"%"]})]}),n&&s("div",{className:`flex-shrink-0 w-6 h-6 flex items-center justify-center rounded-full ${i[o]}`,children:n})]})})}function M({variant:t="primary",size:e="md",children:r,disabled:n=!1,loading:o=!1,fullWidth:a=!1,className:i="",...d}){const m="btn inline-flex items-center justify-center font-medium rounded-md disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 ease-out",u={primary:"btn-primary bg-blue-600 text-white hover:bg-blue-700 shadow-lg hover:shadow-xl shadow-blue-600/25 hover:shadow-blue-600/40 dark:bg-blue-600 dark:text-white dark:hover:bg-blue-700",secondary:"btn-secondary bg-gray-100 text-gray-900 hover:bg-gray-200 shadow-md hover:shadow-lg dark:bg-gray-700 dark:text-gray-100 dark:hover:bg-gray-600",outline:"btn-outline bg-white/80 dark:bg-gray-800/80 text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700 backdrop-blur-sm",danger:"btn-danger bg-red-600 text-white hover:bg-red-700 shadow-lg hover:shadow-xl shadow-red-600/25 hover:shadow-red-600/40 dark:bg-red-600 dark:text-white dark:hover:bg-red-700"},h={sm:"btn-sm px-3 py-2 text-sm rounded-lg",md:"btn-md px-4 py-2.5 text-sm rounded-lg",lg:"btn-lg px-6 py-3 text-base rounded-lg"},l=a?"w-full":"",p=o?"btn-loading":"",c=`${m} ${u[t]} ${h[e]} ${l} ${p} ${i}`.trim();return s("button",{className:c,disabled:n||o,...d,children:[o&&s("svg",{className:"btn-spinner animate-spin -ml-1 mr-2 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[s("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),r]})}function Ke({title:t,data:e,type:r="line",height:n=300,loading:o=!1,error:a,className:i="",xLabel:d,yLabel:m}){const u=Oe(null);z(()=>{if(!u.current||!e)return;const c=u.current,v=c.getContext("2d");if(!v)return;const g=56,k=c.width-g*2,x=c.height-g*2;v.clearRect(0,0,c.width,c.height),r==="line"?h(v,e,g,k,x,d,m):r==="bar"?l(v,e,g,k,x,d,m):r==="doughnut"&&p(v,e,c.width/2,c.height/2,Math.min(c.width,c.height)/3)},[e,r]);const h=(c,v,g,k,x,N,A)=>{const U=v.datasets[0];if(!U)return;const S=Math.max(...U.data),C=Math.min(...U.data),P=S-C||1;c.strokeStyle="#e5e7eb",c.lineWidth=1;for(let T=0;T<=5;T++){const f=g+x/5*T;c.beginPath(),c.moveTo(g,f),c.lineTo(g+k,f),c.stroke()}c.fillStyle="#6b7280",c.font="12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial",c.textAlign="right";for(let T=0;T<=5;T++){const f=g+x/5*T,b=S-P/5*T,y=Number.isFinite(b)?b>=100?b.toFixed(0):b.toFixed(1):"0";c.fillText(y,g-8,f+4)}A&&(c.save(),c.translate(16,g+x/2),c.rotate(-Math.PI/2),c.textAlign="center",c.fillText(A,0,0),c.restore()),c.textAlign="center";const W=U.data.length,F=Math.min(6,Math.max(2,W)),j=Math.max(1,Math.floor((W-1)/(F-1)));for(let T=0;T<W;T+=j){const f=g+k/(W-1)*T,b=v.labels?.[T]||"";b&&c.fillText(b,f,g+x+18)}N&&c.fillText(N,g+k/2,g+x+34),c.strokeStyle="#3b82f6",c.lineWidth=2,c.beginPath(),U.data.forEach((T,f)=>{const b=g+k/(U.data.length-1)*f,y=g+x-(T-C)/P*x;f===0?c.moveTo(b,y):c.lineTo(b,y)}),c.stroke(),c.fillStyle="#3b82f6",U.data.forEach((T,f)=>{const b=g+k/(U.data.length-1)*f,y=g+x-(T-C)/P*x;c.beginPath(),c.arc(b,y,4,0,2*Math.PI),c.fill()})},l=(c,v,g,k,x,N,A)=>{const U=v.datasets[0];if(!U)return;const S=Math.max(...U.data),C=k/U.data.length*.8,P=k/U.data.length*.2;c.fillStyle="#3b82f6",U.data.forEach((T,f)=>{const b=T/S*x,y=g+f*(C+P)+P/2,O=g+x-b;c.fillRect(y,O,C,b)}),c.fillStyle="#6b7280",c.font="12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial",c.textAlign="right";for(let T=0;T<=5;T++){const f=g+x/5*T,b=S-S/5*T,y=Number.isFinite(b)?b>=100?b.toFixed(0):b.toFixed(1):"0";c.fillText(y,g-8,f+4)}A&&(c.save(),c.translate(16,g+x/2),c.rotate(-Math.PI/2),c.textAlign="center",c.fillText(A,0,0),c.restore()),c.textAlign="center";const W=U.data.length,F=Math.min(6,Math.max(2,W)),j=Math.max(1,Math.floor((W-1)/(F-1)));for(let T=0;T<W;T+=j){const f=g+T*(C+P)+P/2+C/2,b=v.labels?.[T]||"";b&&c.fillText(b,f,g+x+18)}N&&c.fillText(N,g+k/2,g+x+34)},p=(c,v,g,k,x)=>{const N=v.datasets[0];if(!N)return;const A=N.data.reduce((C,P)=>C+P,0),U=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6"];let S=0;N.data.forEach((C,P)=>{const W=C/A*2*Math.PI;c.beginPath(),c.arc(g,k,x,S,S+W),c.arc(g,k,x*.6,S+W,S,!0),c.closePath(),c.fillStyle=U[P%U.length],c.fill(),S+=W})};return o?s("div",{className:`flex items-center justify-center ${i}`,style:{height:n},children:s("div",{className:"text-center",children:[s("div",{className:"w-8 h-8 border-2 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),s("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Loading chart..."})]})}):a?s("div",{className:`flex items-center justify-center ${i}`,style:{height:n},children:s("div",{className:"text-center",children:[s("svg",{className:"w-12 h-12 mx-auto mb-4 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 16.5c-.77.833.192 2.5 1.732 2.5z"})}),s("p",{className:"text-sm text-red-600 dark:text-red-400",children:a})]})}):s("div",{className:`chart-container ${i}`,children:[t&&s("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:t}),s("div",{className:"relative",children:s("canvas",{ref:u,width:800,height:n,className:"w-full h-auto"})})]})}const et=t=>{let e;const r=new Set,n=(u,h)=>{const l=typeof u=="function"?u(e):u;if(!Object.is(l,e)){const p=e;e=h??(typeof l!="object"||l===null)?l:Object.assign({},e,l),r.forEach(c=>c(e,p))}},o=()=>e,d={setState:n,getState:o,getInitialState:()=>m,subscribe:u=>(r.add(u),()=>r.delete(u))},m=e=t(n,o,d);return d},mr=(t=>t?et(t):et);function $t(t,e){for(var r in e)t[r]=e[r];return t}function Le(t,e){for(var r in t)if(r!=="__source"&&!(r in e))return!0;for(var n in e)if(n!=="__source"&&t[n]!==e[n])return!0;return!1}function Lt(t,e){var r=e(),n=E({t:{__:r,u:e}}),o=n[0].t,a=n[1];return ue(function(){o.__=r,o.u=e,Se(o)&&a({t:o})},[t,r,e]),z(function(){return Se(o)&&a({t:o}),t(function(){Se(o)&&a({t:o})})},[t]),r}function Se(t){var e,r,n=t.u,o=t.__;try{var a=n();return!((e=o)===(r=a)&&(e!==0||1/e==1/r)||e!=e&&r!=r)}catch{return!0}}function Pt(t){t()}function At(t){return t}function Mt(){return[!1,Pt]}var Wt=ue;function Pe(t,e){this.props=t,this.context=e}function pr(t,e){function r(o){var a=this.props.ref,i=a==o.ref;return!i&&a&&(a.call?a(null):a.current=null),e?!e(this.props,o)||!i:Le(this.props,o)}function n(o){return this.shouldComponentUpdate=r,X(t,o)}return n.displayName="Memo("+(t.displayName||t.name)+")",n.prototype.isReactComponent=!0,n.__f=!0,n.type=t,n}(Pe.prototype=new Q).isPureReactComponent=!0,Pe.prototype.shouldComponentUpdate=function(t,e){return Le(this.props,t)||Le(this.state,e)};var tt=$.__b;$.__b=function(t){t.type&&t.type.__f&&t.ref&&(t.props.ref=t.ref,t.ref=null),tt&&tt(t)};var fr=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function gr(t){function e(r){var n=$t({},r);return delete n.ref,t(n,r.ref||null)}return e.$$typeof=fr,e.render=t,e.prototype.isReactComponent=e.__f=!0,e.displayName="ForwardRef("+(t.displayName||t.name)+")",e}var rt=function(t,e){return t==null?null:Y(Y(t).map(e))},_r={map:rt,forEach:rt,count:function(t){return t?Y(t).length:0},only:function(t){var e=Y(t);if(e.length!==1)throw"Children.only";return e[0]},toArray:Y},yr=$.__e;$.__e=function(t,e,r,n){if(t.then){for(var o,a=e;a=a.__;)if((o=a.__c)&&o.__c)return e.__e==null&&(e.__e=r.__e,e.__k=r.__k),o.__c(t,e)}yr(t,e,r,n)};var st=$.unmount;function Ht(t,e,r){return t&&(t.__c&&t.__c.__H&&(t.__c.__H.__.forEach(function(n){typeof n.__c=="function"&&n.__c()}),t.__c.__H=null),(t=$t({},t)).__c!=null&&(t.__c.__P===r&&(t.__c.__P=e),t.__c.__e=!0,t.__c=null),t.__k=t.__k&&t.__k.map(function(n){return Ht(n,e,r)})),t}function It(t,e,r){return t&&r&&(t.__v=null,t.__k=t.__k&&t.__k.map(function(n){return It(n,e,r)}),t.__c&&t.__c.__P===e&&(t.__e&&r.appendChild(t.__e),t.__c.__e=!0,t.__c.__P=r)),t}function ve(){this.__u=0,this.o=null,this.__b=null}function Ot(t){var e=t.__.__c;return e&&e.__a&&e.__a(t)}function vr(t){var e,r,n;function o(a){if(e||(e=t()).then(function(i){r=i.default||i},function(i){n=i}),n)throw n;if(!r)throw e;return X(r,a)}return o.displayName="Lazy",o.__f=!0,o}function oe(){this.i=null,this.l=null}$.unmount=function(t){var e=t.__c;e&&e.__R&&e.__R(),e&&32&t.__u&&(t.type=null),st&&st(t)},(ve.prototype=new Q).__c=function(t,e){var r=e.__c,n=this;n.o==null&&(n.o=[]),n.o.push(r);var o=Ot(n.__v),a=!1,i=function(){a||(a=!0,r.__R=null,o?o(d):d())};r.__R=i;var d=function(){if(!--n.__u){if(n.state.__a){var m=n.state.__a;n.__v.__k[0]=It(m,m.__c.__P,m.__c.__O)}var u;for(n.setState({__a:n.__b=null});u=n.o.pop();)u.forceUpdate()}};n.__u++||32&e.__u||n.setState({__a:n.__b=n.__v.__k[0]}),t.then(i,i)},ve.prototype.componentWillUnmount=function(){this.o=[]},ve.prototype.render=function(t,e){if(this.__b){if(this.__v.__k){var r=document.createElement("div"),n=this.__v.__k[0].__c;this.__v.__k[0]=Ht(this.__b,r,n.__O=n.__P)}this.__b=null}var o=e.__a&&X(J,null,t.fallback);return o&&(o.__u&=-33),[X(J,null,e.__a?null:t.children),o]};var nt=function(t,e,r){if(++r[1]===r[0]&&t.l.delete(e),t.props.revealOrder&&(t.props.revealOrder[0]!=="t"||!t.l.size))for(r=t.i;r;){for(;r.length>3;)r.pop()();if(r[1]<r[0])break;t.i=r=r[2]}};function br(t){return this.getChildContext=function(){return t.context},t.children}function xr(t){var e=this,r=t.h;if(e.componentWillUnmount=function(){re(null,e.v),e.v=null,e.h=null},e.h&&e.h!==r&&e.componentWillUnmount(),!e.v){for(var n=e.__v;n!==null&&!n.__m&&n.__!==null;)n=n.__;e.h=r,e.v={nodeType:1,parentNode:r,childNodes:[],__k:{__m:n.__m},contains:function(){return!0},insertBefore:function(o,a){this.childNodes.push(o),e.h.insertBefore(o,a)},removeChild:function(o){this.childNodes.splice(this.childNodes.indexOf(o)>>>1,1),e.h.removeChild(o)}}}re(X(br,{context:e.context},t.__v),e.v)}function wr(t,e){var r=X(xr,{__v:t,h:e});return r.containerInfo=e,r}(oe.prototype=new Q).__a=function(t){var e=this,r=Ot(e.__v),n=e.l.get(t);return n[0]++,function(o){var a=function(){e.props.revealOrder?(n.push(o),nt(e,t,n)):o()};r?r(a):a()}},oe.prototype.render=function(t){this.i=null,this.l=new Map;var e=Y(t.children);t.revealOrder&&t.revealOrder[0]==="b"&&e.reverse();for(var r=e.length;r--;)this.l.set(e[r],this.i=[1,0,this.i]);return t.children},oe.prototype.componentDidUpdate=oe.prototype.componentDidMount=function(){var t=this;this.l.forEach(function(e,r){nt(t,r,e)})};var jt=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,kr=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,Nr=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,Sr=/[A-Z0-9]/g,Cr=typeof document<"u",Tr=function(t){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(t)};function Er(t,e,r){return e.__k==null&&(e.textContent=""),re(t,e),typeof r=="function"&&r(),t?t.__c:null}function Ur(t,e,r){return kt(t,e),typeof r=="function"&&r(),t?t.__c:null}Q.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(t){Object.defineProperty(Q.prototype,t,{configurable:!0,get:function(){return this["UNSAFE_"+t]},set:function(e){Object.defineProperty(this,t,{configurable:!0,writable:!0,value:e})}})});var at=$.event;function Rr(){}function $r(){return this.cancelBubble}function Lr(){return this.defaultPrevented}$.event=function(t){return at&&(t=at(t)),t.persist=Rr,t.isPropagationStopped=$r,t.isDefaultPrevented=Lr,t.nativeEvent=t};var De,Pr={enumerable:!1,configurable:!0,get:function(){return this.class}},ot=$.vnode;$.vnode=function(t){typeof t.type=="string"&&(function(e){var r=e.props,n=e.type,o={},a=n.indexOf("-")===-1;for(var i in r){var d=r[i];if(!(i==="value"&&"defaultValue"in r&&d==null||Cr&&i==="children"&&n==="noscript"||i==="class"||i==="className")){var m=i.toLowerCase();i==="defaultValue"&&"value"in r&&r.value==null?i="value":i==="download"&&d===!0?d="":m==="translate"&&d==="no"?d=!1:m[0]==="o"&&m[1]==="n"?m==="ondoubleclick"?i="ondblclick":m!=="onchange"||n!=="input"&&n!=="textarea"||Tr(r.type)?m==="onfocus"?i="onfocusin":m==="onblur"?i="onfocusout":Nr.test(i)&&(i=m):m=i="oninput":a&&kr.test(i)?i=i.replace(Sr,"-$&").toLowerCase():d===null&&(d=void 0),m==="oninput"&&o[i=m]&&(i="oninputCapture"),o[i]=d}}n=="select"&&o.multiple&&Array.isArray(o.value)&&(o.value=Y(r.children).forEach(function(u){u.props.selected=o.value.indexOf(u.props.value)!=-1})),n=="select"&&o.defaultValue!=null&&(o.value=Y(r.children).forEach(function(u){u.props.selected=o.multiple?o.defaultValue.indexOf(u.props.value)!=-1:o.defaultValue==u.props.value})),r.class&&!r.className?(o.class=r.class,Object.defineProperty(o,"className",Pr)):(r.className&&!r.class||r.class&&r.className)&&(o.class=o.className=r.className),e.props=o})(t),t.$$typeof=jt,ot&&ot(t)};var it=$.__r;$.__r=function(t){it&&it(t),De=t.__c};var lt=$.diffed;$.diffed=function(t){lt&&lt(t);var e=t.props,r=t.__e;r!=null&&t.type==="textarea"&&"value"in e&&e.value!==r.value&&(r.value=e.value==null?"":e.value),De=null};var Ar={ReactCurrentDispatcher:{current:{readContext:function(t){return De.__n[t.__c].props.value},useCallback:Ct,useContext:Tt,useDebugValue:Et,useDeferredValue:At,useEffect:z,useId:Ut,useImperativeHandle:St,useInsertionEffect:Wt,useLayoutEffect:ue,useMemo:he,useReducer:Ie,useRef:Oe,useState:E,useSyncExternalStore:Lt,useTransition:Mt}}};function Mr(t){return X.bind(null,t)}function we(t){return!!t&&t.$$typeof===jt}function Wr(t){return we(t)&&t.type===J}function Hr(t){return!!t&&!!t.displayName&&(typeof t.displayName=="string"||t.displayName instanceof String)&&t.displayName.startsWith("Memo(")}function Ir(t){return we(t)?ar.apply(null,arguments):t}function Or(t){return!!t.__k&&(re(null,t),!0)}function jr(t){return t&&(t.base||t.nodeType===1&&t)||null}var Dr=function(t,e){return t(e)},Fr=function(t,e){return t(e)},zr=J,Gr=we,ge={useState:E,useId:Ut,useReducer:Ie,useEffect:z,useLayoutEffect:ue,useInsertionEffect:Wt,useTransition:Mt,useDeferredValue:At,useSyncExternalStore:Lt,startTransition:Pt,useRef:Oe,useImperativeHandle:St,useMemo:he,useCallback:Ct,useContext:Tt,useDebugValue:Et,version:"18.3.1",Children:_r,render:Er,hydrate:Ur,unmountComponentAtNode:Or,createPortal:wr,createElement:X,createContext:or,createFactory:Mr,cloneElement:Ir,createRef:er,Fragment:J,isValidElement:we,isElement:Gr,isFragment:Wr,isMemo:Hr,findDOMNode:jr,Component:Q,PureComponent:Pe,memo:pr,forwardRef:gr,flushSync:Fr,unstable_batchedUpdates:Dr,StrictMode:zr,Suspense:ve,SuspenseList:oe,lazy:vr,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:Ar};const Vr=t=>t;function qr(t,e=Vr){const r=ge.useSyncExternalStore(t.subscribe,ge.useCallback(()=>e(t.getState()),[t,e]),ge.useCallback(()=>e(t.getInitialState()),[t,e]));return ge.useDebugValue(r),r}const ct=t=>{const e=mr(t),r=n=>qr(e,n);return Object.assign(r,e),r},me=(t=>t?ct(t):ct),Dt=me(t=>({ruleGroups:[],loading:!1,error:null,setRuleGroups:e=>t({ruleGroups:e,error:null}),addRuleGroup:e=>t(r=>({ruleGroups:[...r.ruleGroups.filter(n=>n.name!==e.name),e]})),updateRuleGroup:(e,r)=>t(n=>({ruleGroups:n.ruleGroups.map(o=>o.name===e?r:o)})),removeRuleGroup:e=>t(r=>({ruleGroups:r.ruleGroups.filter(n=>n.name!==e)})),setLoading:e=>t({loading:e}),setError:e=>t({error:e})})),Ft=me(t=>({upstreams:[],loading:!1,error:null,setUpstreams:e=>t({upstreams:e,error:null}),addUpstream:e=>t(r=>({upstreams:[...r.upstreams,e]})),removeUpstream:e=>t(r=>({upstreams:r.upstreams.filter(n=>n.address!==e)})),setLoading:e=>t({loading:e}),setError:e=>t({error:e})})),zt=me(t=>({stats:null,loading:!1,error:null,setStats:e=>t({stats:e,error:null}),setLoading:e=>t({loading:e}),setError:e=>t({error:e})})),Gt=me(t=>({info:null,loading:!1,error:null,setInfo:e=>t({info:e,error:null}),setLoading:e=>t({loading:e}),setError:e=>t({error:e})})),Vt=me(t=>({events:[],loading:!1,error:null,setEvents:e=>t({events:e,error:null}),addEvent:e=>t(r=>({events:[e,...r.events].slice(0,2e3)})),setLoading:e=>t({loading:e}),setError:e=>t({error:e})})),qt=()=>Dt(t=>t.ruleGroups),Bt=()=>Dt(t=>({setRuleGroups:t.setRuleGroups,addRuleGroup:t.addRuleGroup,updateRuleGroup:t.updateRuleGroup,removeRuleGroup:t.removeRuleGroup,setLoading:t.setLoading,setError:t.setError})),Jt=()=>Ft(t=>t.upstreams),Zt=()=>Ft(t=>({setUpstreams:t.setUpstreams,addUpstream:t.addUpstream,removeUpstream:t.removeUpstream,setLoading:t.setLoading,setError:t.setError})),Br=()=>zt(t=>t.stats),Jr=()=>zt(t=>({setStats:t.setStats,setLoading:t.setLoading,setError:t.setError})),Zr=()=>Vt(t=>t.events),Qr=()=>Vt(t=>({setEvents:t.setEvents,addEvent:t.addEvent,setLoading:t.setLoading,setError:t.setError})),Yr=()=>Gt(t=>t.info),Xr=()=>Gt(t=>({setInfo:t.setInfo,setLoading:t.setLoading,setError:t.setError})),Ce=[{label:"1m",seconds:60},{label:"5m",seconds:300},{label:"15m",seconds:900}],Kr={1:"A",28:"AAAA",2:"NS",5:"CNAME",6:"SOA",12:"PTR",15:"MX",16:"TXT",33:"SRV"};function es({provider:t}){const e=Br(),{setStats:r,setError:n}=Jr(),o=qt(),a=Jt(),i=Yr(),{setRuleGroups:d,setError:m}=Bt(),{setUpstreams:u,setError:h}=Zt(),{setInfo:l,setError:p}=Xr(),[c,v]=E(Ce[1]),[g,k]=E([]),[x,N]=E([]),A=y=>{window.location.hash=y,window.scrollTo(0,0)};z(()=>{const y=t.onStats(r),O=t.onRuleGroups(d),B=t.onUpstreams(u),q=t.onOverview?t.onOverview(R=>{R?.stats&&r(R.stats);try{window.__ov=R}catch{}S(R)}):()=>{};return t.fetchStats().then(r).catch(R=>n(R.message)),t.fetchRuleGroups().then(d).catch(R=>m(R.message)),t.fetchUpstreams().then(u).catch(R=>h(R.message)),t.fetchServerInfo().then(l).catch(R=>p(R.message)),t.fetchOverview&&t.fetchOverview().then(R=>{R?.stats&&r(R.stats),S(R);try{window.__ov=R}catch{}}).catch(()=>{}),()=>{y(),O(),B(),q()}},[t,r,d,u,n,m,h,l,p]);const[U,S]=E(null);z(()=>{if(!e)return;const y=30,O=e.effective_rps??(e.dns_queries_total?e.dns_queries_total/60:0);k(q=>{const R=[...q,Math.max(0,Number(O||0))];return R.length>y&&R.shift(),R});const B=(e.dns_request_avg_seconds??0)*1e3;N(q=>{const R=[...q,Math.max(0,Number(B||0))];return R.length>y&&R.shift(),R})},[e]);const C=e?.effective_rps??(e?e.dns_queries_total/60:0),P=e?.dns_request_avg_seconds?e.dns_request_avg_seconds*1e3:0,W=a?a.length:0,F=o?o.reduce((y,O)=>y+O.patterns.length,0):0,j=(()=>{if(!e)return null;const y=e.cache_hit_rate;return y==null||(e.dns_queries_total||0)===0?null:y})(),T=y=>Array.from({length:y},()=>""),f={labels:T(g.length),datasets:[{label:"RPS",data:g,borderColor:"#3b82f6",backgroundColor:"#3b82f6",fill:!1}]},b={labels:T(x.length),datasets:[{label:"Avg RT (ms)",data:x,borderColor:"#10b981",backgroundColor:"#10b981",fill:!1}]};return s("div",{className:"space-y-6",children:[s("div",{className:"flex items-center justify-between",children:[s("div",{children:[s("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Dashboard"}),s("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Monitor your DNS proxy performance and configuration"})]}),s("div",{className:"flex items-center space-x-4",children:s("select",{value:c.ms,onChange:y=>{const O=Ce.find(B=>B.ms===parseInt(y.currentTarget.value));O&&v(O)},className:"px-3 py-2 text-sm border border-gray-300 rounded-md bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:text-gray-100 dark:border-gray-600 dark:focus:border-blue-400 dark:focus:ring-blue-400",children:Ce.map(y=>s("option",{value:y.ms,children:y.label},y.ms))})})]}),s("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[s(fe,{title:"DNS RPS",value:C.toFixed(1),icon:s("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),color:"blue",loading:!e}),s(fe,{title:"Response Time",value:`${P.toFixed(0)}ms`,icon:s("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),color:"green",loading:!e}),s(fe,{title:"Active Upstreams",value:W,icon:s("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),color:"purple",loading:!a}),s(fe,{title:"Total Rules",value:F,icon:s("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),color:"indigo",loading:!o})]}),s("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s(G,{title:"DNS Queries Over Time",subtitle:`Last ${c.label}`,children:s(Ke,{data:f,type:"line",height:256,xLabel:"time",yLabel:"RPS",loading:!e})}),s(G,{title:"Response Time Over Time",subtitle:`Last ${c.label}`,children:s(Ke,{data:b,type:"line",height:256,xLabel:"time",yLabel:"ms",loading:!e})})]}),s("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[s(G,{title:"Service Status",className:"lg:col-span-2",children:s("div",{className:"space-y-4",children:[s("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[s("div",{className:"flex items-center",children:[s("div",{className:`w-3 h-3 rounded-full mr-3 ${e?.service_ready===1?"bg-green-500":"bg-red-500"}`}),s("div",{children:[s("p",{className:"font-medium text-gray-900 dark:text-white",children:"DNS Proxy"}),s("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e?.service_ready===1?"Running":"Stopped"})]})]}),s("div",{className:"text-right",children:[s("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Uptime"}),s("p",{className:"font-medium text-gray-900 dark:text-white",children:U?.uptime??(i?i.uptime:"Unknown")})]})]}),s("div",{className:"grid grid-cols-2 gap-4",children:[s("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[s("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Cache hit rate"}),s("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:j==null?"N/A":`${(j*100).toFixed(2)}%`})]}),s("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[s("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Queries (1m)"}),s("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[U?.queries_last_min??"N/A",U?.errors_last_min?` (${U?.errors_last_min} errors)`:""]})]})]})]})}),s(G,{title:"Quick Actions",children:s("div",{className:"space-y-3",children:[s(M,{variant:"outline",fullWidth:!0,className:"justify-start hover:scale-[1.01] transition-transform",onClick:()=>A("rules"),children:[s("svg",{className:"w-5 h-5 mr-3 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Add New Rule"]}),s(M,{variant:"outline",fullWidth:!0,className:"justify-start hover:scale-[1.01] transition-transform",onClick:()=>A("upstreams"),children:[s("svg",{className:"w-5 h-5 mr-3 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),"Add Upstream"]})]})})]})]})}function D({label:t,error:e,hint:r,required:n=!1,className:o="",id:a,...i}){const d=a||`input-${Math.random().toString(36).substr(2,9)}`,p=`input-field block w-full px-3 py-2.5 text-sm rounded-md border transition-all duration-200 ease-out focus:outline-none focus:ring-2 disabled:opacity-50 disabled:cursor-not-allowed bg-white text-gray-900 placeholder-gray-500 border-gray-300 hover:border-gray-400 focus:border-blue-500 focus:ring-blue-500 disabled:bg-gray-50 disabled:border-gray-300 dark:bg-gray-800 dark:text-gray-100 dark:placeholder-gray-400 dark:border-gray-600 dark:hover:border-gray-500 dark:focus:border-blue-400 dark:focus:ring-blue-400 dark:disabled:bg-gray-700 dark:disabled:border-gray-600 ${e?"border-red-500 focus:border-red-500 focus:ring-red-500 dark:border-red-400 dark:focus:border-red-400 dark:focus:ring-red-400":""} ${o}`.trim();return s("div",{className:"input-container space-y-1",children:[t&&s("label",{htmlFor:d,className:"input-label block text-sm font-medium text-gray-700 dark:text-gray-300",children:[t,n&&s("span",{className:"text-red-500 ml-1",children:"*"})]}),s("input",{id:d,className:p,...i}),r&&!e&&s("p",{className:"input-hint text-xs text-gray-500 dark:text-gray-400",children:r}),e&&s("p",{className:"input-error text-xs text-red-600 dark:text-red-400",children:e})]})}function ts({provider:t}){const[e,r]=E(""),[n,o]=E("A"),[a,i]=E(""),[d,m]=E(!1);return s("div",{className:"space-y-6",children:[s("div",{children:[s("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Resolve"}),s("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Run a test DNS resolve via the active pipeline"})]}),s(G,{children:s("form",{onSubmit:async h=>{if(h.preventDefault(),!!e.trim()){m(!0),i("");try{const l=await t.testResolve(e.trim(),n),p=`Upstream: ${l.upstream} | RCODE: ${l.rcode} | Answers: ${l.answers}`,c=(l.records||[]).join(`
`);i(`${p}
${c}`)}catch(l){i(l.message)}finally{m(!1)}}},className:"space-y-4",children:[s("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[s(D,{label:"Domain",value:e,onInput:h=>r(h.target.value),placeholder:"example.com",required:!0}),s("div",{children:[s("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Type"}),s("select",{className:"w-full px-3 py-2 h-[42px] border border-gray-300 rounded-md bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:text-gray-100 dark:border-gray-600 dark:focus:border-blue-400 dark:focus:ring-blue-400",value:n,onChange:h=>o(h.currentTarget.value),children:[s("option",{value:"A",children:"A"}),s("option",{value:"AAAA",children:"AAAA"}),s("option",{value:"CNAME",children:"CNAME"}),s("option",{value:"MX",children:"MX"}),s("option",{value:"NS",children:"NS"}),s("option",{value:"TXT",children:"TXT"}),s("option",{value:"SRV",children:"SRV"}),s("option",{value:"PTR",children:"PTR"})]})]}),s("div",{className:"flex items-end",children:s(M,{type:"submit",variant:"primary",fullWidth:!0,loading:d,disabled:d,children:d?"Resolving…":"Resolve"})})]}),a&&s("div",{children:[s("div",{className:"flex items-center justify-between mb-2",children:[s("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Result"}),s("div",{className:"flex gap-2",children:[s(M,{type:"button",variant:"outline",size:"sm",onClick:()=>navigator.clipboard.writeText(a),children:"Copy"}),s(M,{type:"button",variant:"secondary",size:"sm",onClick:()=>i(""),children:"Clear"})]})]}),s("pre",{className:"mt-1 p-3 rounded-md bg-gray-50 text-gray-800 dark:bg-gray-900 dark:text-gray-200 whitespace-pre-wrap text-sm border border-gray-200 dark:border-gray-700 font-mono leading-6 max-h-96 overflow-auto",children:a})]})]})})]})}function be({children:t,variant:e="default",size:r="md",className:n="",...o}){const a="badge inline-flex items-center rounded-md font-medium",i={default:"bg-gray-100 text-gray-900 dark:bg-gray-800 dark:text-gray-100",primary:"bg-blue-600 text-white dark:bg-blue-600 dark:text-white",secondary:"bg-gray-200 text-gray-900 dark:bg-gray-700 dark:text-gray-100"},d={sm:"px-2 py-0.5 text-xs",md:"px-2.5 py-1 text-sm"},m=`${a} ${i[e]} ${d[r]} ${n}`.trim();return s("span",{className:m,...o,children:t})}const rs=[{id:"overview",label:"Overview",icon:s("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[s("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"}),s("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 5a2 2 0 012-2h4a2 2 0 012 2v6H8V5z"})]})},{id:"rules",label:"Rules",icon:s("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})},{id:"upstreams",label:"Upstreams",icon:s("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})})},{id:"history",label:"History",icon:s("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})},{id:"hosts",label:"Hosts",icon:s("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7h18M3 12h18M3 17h18"})})},{id:"resolve",label:"Resolve",icon:s("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3M3 11h18M5 19h14a2 2 0 002-2v-6H3v6a2 2 0 002 2z"})})},{id:"update",label:"Updates",icon:s("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}];function ss({activeTab:t,onTabChange:e,collapsed:r=!1}){return s("aside",{className:`fixed left-0 top-0 z-40 h-screen bg-white/95 dark:bg-gray-800/95 backdrop-blur-sm border-r border-gray-100 dark:border-gray-700 transition-all duration-300 ${r?"w-16":"w-64"}`,children:[s("div",{className:"flex items-center justify-between h-16 px-3 border-b border-gray-100 dark:border-gray-700",children:[!r&&s("div",{className:"flex items-center space-x-2",children:[s("div",{className:"w-7 h-7 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center shadow-sm",children:s("span",{className:"text-white font-bold text-sm",children:"O"})}),s("span",{className:"text-lg font-semibold text-gray-900 dark:text-white tracking-tight",children:"Outway"})]}),r&&s("div",{className:"w-7 h-7 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center mx-auto shadow-sm",children:s("span",{className:"text-white font-bold text-sm",children:"O"})})]}),s("nav",{className:"flex-1 px-3 py-4 space-y-1",children:rs.map(n=>{const o=t===n.id;return s("button",{onClick:()=>e(n.id),className:`w-full flex items-center px-3 py-2.5 text-sm font-medium rounded-xl transition-all duration-200 ${o?"bg-blue-600 text-white shadow-lg shadow-blue-600/25":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white"}`,children:[s("span",{className:`flex-shrink-0 ${r?"mx-auto":"mr-3"}`,children:n.icon}),!r&&s("span",{className:"truncate font-medium",children:n.label})]},n.id)})}),s("div",{className:"p-3 border-t border-gray-100 dark:border-gray-700",children:[!r&&s("div",{className:"flex items-center space-x-3",children:[s("div",{className:"w-8 h-8 bg-gradient-to-br from-gray-300 to-gray-400 dark:from-gray-600 dark:to-gray-700 rounded-full flex items-center justify-center shadow-sm",children:s("span",{className:"text-xs font-semibold text-gray-700 dark:text-gray-200",children:"A"})}),s("div",{className:"flex-1 min-w-0",children:[s("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:"Admin"}),s("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:"outway@example.com"})]})]}),r&&s("div",{className:"flex justify-center",children:s("div",{className:"w-8 h-8 bg-gradient-to-br from-gray-300 to-gray-400 dark:from-gray-600 dark:to-gray-700 rounded-full flex items-center justify-center shadow-sm",children:s("span",{className:"text-xs font-semibold text-gray-700 dark:text-gray-200",children:"A"})})})]})]})}const dt="outway-theme";function Qt(){const[t,e]=E(()=>typeof window>"u"?"auto":localStorage.getItem(dt)||"auto"),[r,n]=E("light");return z(()=>{const a=()=>{if(t==="auto"){const i=window.matchMedia("(prefers-color-scheme: dark)").matches;n(i?"dark":"light")}else n(t)};if(a(),t==="auto"){const i=window.matchMedia("(prefers-color-scheme: dark)"),d=()=>a();return i.addEventListener("change",d),()=>i.removeEventListener("change",d)}},[t]),z(()=>{const a=document.documentElement;r==="dark"?a.classList.add("dark"):a.classList.remove("dark")},[r]),z(()=>{typeof window<"u"&&localStorage.setItem(dt,t)},[t]),{theme:t,resolvedTheme:r,setTheme:a=>{e(a)}}}function ns({className:t="",showLabel:e=!1,variant:r="select",...n}){const{theme:o,resolvedTheme:a,setTheme:i}=Qt(),d=p=>{i(p)},m=()=>{const p=["light","dark","auto"],v=(p.indexOf(o)+1)%p.length;i(p[v])},u=()=>{switch(o){case"light":return s("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})});case"dark":return s("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})});case"auto":return s("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}},h=()=>{switch(o){case"light":return"Light theme";case"dark":return"Dark theme";case"auto":return`Auto theme (${a})`}},l=[{value:"light",label:"Light",icon:"☀️"},{value:"dark",label:"Dark",icon:"🌙"},{value:"auto",label:"Auto",icon:"🔄"}];return r==="button"?s("div",{className:`flex items-center gap-2 ${t}`,...n,children:[s("button",{onClick:m,className:"p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-500 dark:text-gray-400 transition-colors duration-200","aria-label":h(),title:h(),children:u()}),e&&s("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:o==="auto"?`Auto (${a})`:o})]}):s("div",{className:`theme-toggle ${t}`,...n,children:s("select",{value:o,onChange:p=>d(p.currentTarget.value),className:"theme-select",children:l.map(p=>s("option",{value:p.value,children:[p.icon," ",p.label]},p.value))})})}function as({onSidebarToggle:t,provider:e}){const[r,n]=E("ws");return z(()=>{if(!e||!e.onStatus)return;const o=e.onStatus(a=>n(a.channel));return()=>{o&&o()}},[e]),s("header",{className:"bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-b border-gray-100 dark:border-gray-700",children:s("div",{className:"flex items-center justify-between h-14 px-4",children:[s("div",{className:"flex items-center gap-3",children:t&&s("button",{onClick:t,className:"p-1.5 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-300 transition-all duration-200","aria-label":"Toggle sidebar",children:s("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 6h16M4 12h16M4 18h16"})})})}),s("div",{className:"flex items-center gap-2",children:[s("span",{className:`px-2 py-0.5 text-xs rounded-full ${r==="ws"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300":"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-300"}`,title:r==="ws"?"WebSocket live":"REST fallback",children:r.toUpperCase()}),e?.reconnect&&r==="rest"&&s("button",{className:"inline-flex items-center gap-1 text-xs px-2 py-1 rounded-md border border-gray-300 dark:border-gray-600/50 text-gray-700 dark:text-gray-200 bg-transparent hover:bg-gray-50 dark:hover:bg-gray-700/50",title:"Try reconnect WebSocket",onClick:()=>e.reconnect&&e.reconnect(),children:[s("svg",{className:"w-3.5 h-3.5",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:s("path",{fillRule:"evenodd",d:"M4.083 9.75A6.75 6.75 0 0117.5 10a.75.75 0 001.5 0A8.25 8.25 0 103.5 15.398V13a.75.75 0 00-1.5 0v4a.75.75 0 00.75.75H7a.75.75 0 000-1.5H4.84A6.73 6.73 0 014.083 9.75z",clipRule:"evenodd"})}),"Reconnect"]}),s("div",{className:"mx-1",children:s(ns,{variant:"button"})})]})]})})}function Yt({message:t,type:e="info",duration:r=5e3,onClose:n,position:o="top-right"}){const[a,i]=E(!1);z(()=>{const h=setTimeout(()=>i(!0),100),l=setTimeout(()=>{i(!1),setTimeout(n,300)},r);return()=>{clearTimeout(h),clearTimeout(l)}},[r,n]);const d={success:{bg:"bg-green-50 dark:bg-green-900",border:"border-green-200 dark:border-green-700",text:"text-green-800 dark:text-green-200",icon:s("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})},error:{bg:"bg-red-50 dark:bg-red-900",border:"border-red-200 dark:border-red-700",text:"text-red-800 dark:text-red-200",icon:s("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 16.5c-.77.833.192 2.5 1.732 2.5z"})})},warning:{bg:"bg-yellow-50 dark:bg-yellow-900",border:"border-yellow-200 dark:border-yellow-700",text:"text-yellow-800 dark:text-yellow-200",icon:s("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 16.5c-.77.833.192 2.5 1.732 2.5z"})})},info:{bg:"bg-blue-50 dark:bg-blue-900",border:"border-blue-200 dark:border-blue-700",text:"text-blue-800 dark:text-blue-200",icon:s("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}},m={"top-right":"top-4 right-4","top-left":"top-4 left-4","bottom-right":"bottom-4 right-4","bottom-left":"bottom-4 left-4"},u=d[e];return s("div",{className:`fixed ${m[o]} z-50 max-w-sm w-full`,children:s("div",{className:`${u.bg} ${u.border} border rounded-lg shadow-lg p-4 transition-all duration-300 ${a?"transform translate-x-0 opacity-100":"transform translate-x-full opacity-0"}`,children:s("div",{className:"flex items-start",children:[s("div",{className:`flex-shrink-0 ${u.text}`,children:u.icon}),s("div",{className:"ml-3 flex-1",children:s("p",{className:`text-sm font-medium ${u.text}`,children:t})}),s("div",{className:"ml-4 flex-shrink-0",children:s("button",{onClick:()=>{i(!1),setTimeout(n,300)},className:`${u.text} hover:opacity-75 transition-opacity`,children:s("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})})]})})})}function os({toasts:t,onRemove:e}){return s("div",{className:"fixed inset-0 pointer-events-none z-50",children:t.map(r=>s(Yt,{message:r.message,type:r.type,duration:r.duration,onClose:()=>e(r.id)},r.id))})}function _e({size:t="md",color:e="primary",text:r,className:n=""}){const o={sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8"},a={primary:"text-blue-600",secondary:"text-gray-600",white:"text-white"};return s("div",{className:`flex items-center justify-center ${n}`,children:s("div",{className:"flex flex-col items-center space-y-2",children:[s("div",{className:`${o[t]} ${a[e]} animate-spin`,children:s("svg",{className:"w-full h-full",fill:"none",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:[s("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),r&&s("p",{className:`text-sm ${a[e]} dark:text-gray-400`,children:r})]})})}function is({provider:t}){const e=qt(),{setRuleGroups:r,setError:n}=Bt(),[o,a]=E(""),[i,d]=E(""),[m,u]=E(""),[h,l]=E([""]),[p,c]=E(!0),[v,g]=E(""),[k,x]=E(!1),[N,A]=E(null),[U,S]=E({});z(()=>{const _=t.onRuleGroups(w=>{r(w)});return t.fetchRuleGroups().then(r).catch(w=>{console.error("Failed to fetch rule groups:",w),n(w.message)}),_},[t,r,n]);const C=e.filter(_=>_.name.toLowerCase().includes(v.toLowerCase())||_.description?.toLowerCase().includes(v.toLowerCase())||_.patterns.some(w=>w.toLowerCase().includes(v.toLowerCase()))),P=()=>{l([...h,""])},W=_=>{l(h.filter((w,L)=>L!==_))},F=(_,w)=>{const L=[...h];L[_]=w,l(L)},j=async _=>{if(_.preventDefault(),!o.trim()||!m.trim()||h.some(w=>!w.trim())){n("Please fill in all required fields");return}x(!0);try{const w={name:o.trim(),description:i.trim()||"",via:m.trim(),patterns:h.filter(L=>L.trim()),pin_ttl:p};await t.createRuleGroup(w),a(""),d(""),u(""),l([""]),c(!0)}catch(w){console.error("Failed to create rule group:",w),n(w instanceof Error?w.message:"Failed to create rule group")}finally{x(!1)}},T=_=>{S(w=>({...w,[_.name]:{..._}}))},f=_=>{S(w=>{const L={...w};return delete L[_],L})},b=(_,w,L)=>{S(V=>({...V,[_]:{...V[_],[w]:L}}))},y=(_,w,L)=>{S(V=>{const ae=V[_];if(!ae)return V;const ke=ae.patterns.slice();return ke[w]=L,{...V,[_]:{...ae,patterns:ke}}})},O=_=>{S(w=>{const L=w[_];return L?{...w,[_]:{...L,patterns:[...L.patterns,""]}}:w})},B=(_,w)=>{S(L=>{const V=L[_];if(!V)return L;const ae=V.patterns.filter((ke,Xt)=>Xt!==w);return{...L,[_]:{...V,patterns:ae}}})},q=async _=>{const w=U[_];if(w)try{await t.updateRuleGroup(_,{name:w.name,description:w.description||"",via:w.via,patterns:w.patterns.filter(V=>V.trim()),pin_ttl:!!w.pin_ttl}),f(_);const L=await t.fetchRuleGroups();r(L)}catch(L){console.error("Failed to update rule group:",L),n(L instanceof Error?L.message:"Failed to update rule group")}},R=async _=>{try{await t.deleteRuleGroup(_),A(null)}catch(w){console.error("Failed to delete rule group:",w),n(w instanceof Error?w.message:"Failed to delete rule group")}};return s("div",{className:"space-y-6",children:[s("div",{className:"flex items-center justify-between",children:s("div",{children:[s("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Rule Groups"}),s("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Manage DNS routing rules and patterns"})]})}),s(G,{title:"Add New Rule Group",subtitle:"Create a new routing rule group",children:s("form",{onSubmit:j,className:"space-y-6",children:[s("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s(D,{label:"Group Name",value:o,onInput:_=>a(_.target.value),placeholder:"e.g., YouTube",required:!0}),s(D,{label:"Via Interface",value:m,onInput:_=>u(_.target.value),placeholder:"e.g., utun4",required:!0})]}),s(D,{label:"Description",value:i,onInput:_=>d(_.target.value),placeholder:"Optional description"}),s("div",{children:[s("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"DNS Patterns *"}),h.map((_,w)=>s("div",{className:"flex gap-3 mb-3",children:[s("div",{className:"flex-1",children:s(D,{value:_,onInput:L=>F(w,L.target.value),placeholder:"e.g., *.youtube.com",required:!0})}),h.length>1&&s(M,{type:"button",variant:"outline",size:"sm",onClick:()=>W(w),children:"Remove"})]},w)),s(M,{type:"button",variant:"secondary",size:"sm",onClick:P,children:"Add Pattern"})]}),s("div",{className:"flex items-center gap-3",children:[s("input",{type:"checkbox",id:"pin-ttl",checked:p,onChange:_=>c(_.target.checked),className:"rounded border-gray-300 dark:border-gray-600 text-black dark:text-white focus:ring-black dark:focus:ring-white"}),s("label",{htmlFor:"pin-ttl",className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:s("span",{className:"input-label",children:"Pin TTL (keep IP/route until TTL expires)"})})]}),s("div",{className:"flex gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:s(M,{type:"submit",variant:"primary",loading:k,disabled:k,children:k?"Creating...":"Create Rule Group"})})]})}),s("div",{children:s(D,{label:"Search Rule Groups",value:v,onInput:_=>g(_.target.value),placeholder:"Search by name, description, or pattern...",hint:"Filter rule groups by name, description, or DNS patterns"})}),s("div",{className:"grid gap-4",children:C.map(_=>s(G,{title:_.name,subtitle:_.description,children:[s("div",{className:"flex justify-between items-start mb-4",children:[s("div",{className:"flex items-center gap-3",children:[s(be,{variant:"primary",children:_.patterns.length}),s("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:_.patterns.length===1?"pattern":"patterns"})]}),s("div",{className:"flex gap-2",children:[U[_.name]?s(J,{children:[s(M,{variant:"secondary",size:"sm",onClick:()=>f(_.name),children:"Cancel"}),s(M,{variant:"primary",size:"sm",onClick:()=>q(_.name),children:"Save"})]}):s(M,{variant:"secondary",size:"sm",onClick:()=>T(_),children:"Edit"}),s(M,{variant:"outline",size:"sm",onClick:()=>A(_.name),children:"Delete"})]})]}),U[_.name]?s("div",{className:"space-y-4",children:[s("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[s("div",{className:"flex items-center gap-2",children:[s("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Via Interface:"}),s(D,{value:U[_.name].via,onInput:w=>b(_.name,"via",w.target.value)})]}),s("div",{className:"flex items-center gap-2",children:[s("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Pin TTL:"}),s("input",{type:"checkbox",checked:!!U[_.name].pin_ttl,onChange:w=>b(_.name,"pin_ttl",w.target.checked)})]})]}),s("div",{children:[s("span",{className:"font-medium text-sm text-gray-700 dark:text-gray-300",children:"Description:"}),s(D,{value:U[_.name].description||"",onInput:w=>b(_.name,"description",w.target.value),placeholder:"Optional description"})]}),s("div",{className:"mt-2 pt-2 border-t border-gray-200 dark:border-gray-700",children:[s("span",{className:"font-medium text-sm text-gray-700 dark:text-gray-300",children:"DNS Patterns:"}),U[_.name].patterns.map((w,L)=>s("div",{className:"flex gap-2 mt-2",children:[s(D,{value:w,onInput:V=>y(_.name,L,V.target.value)}),s(M,{variant:"outline",size:"sm",onClick:()=>B(_.name,L),children:"Remove"})]},L)),s(M,{className:"mt-2",variant:"secondary",size:"sm",onClick:()=>O(_.name),children:"Add Pattern"})]})]}):s(J,{children:[s("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[s("div",{className:"flex items-center gap-2",children:[s("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Via Interface:"}),s(be,{variant:"secondary",children:_.via})]}),s("div",{className:"flex items-center gap-2",children:[s("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Pin TTL:"}),s(be,{variant:_.pin_ttl?"primary":"secondary",children:_.pin_ttl?"Yes":"No"})]})]}),s("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[s("span",{className:"font-medium text-sm text-gray-700 dark:text-gray-300",children:"DNS Patterns:"}),s("div",{className:"flex flex-wrap gap-2 mt-2",children:_.patterns.map((w,L)=>s("span",{className:"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 px-2 py-1 rounded text-xs font-mono",children:w},L))})]})]})]},_.name))}),C.length===0&&s(G,{className:"text-center py-8",children:s("p",{className:"text-secondary",children:v?"No rule groups match your search.":"No rule groups configured."})}),N&&s("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s(G,{className:"max-w-md w-full mx-4",children:[s("h3",{className:"text-lg font-semibold mb-4",children:"Confirm Delete"}),s("p",{className:"text-secondary mb-6",children:['Are you sure you want to delete the rule group "',N,'"? This action cannot be undone.']}),s("div",{className:"flex gap-3 justify-end",children:[s(M,{variant:"secondary",onClick:()=>A(null),children:"Cancel"}),s(M,{variant:"danger",onClick:()=>R(N),children:"Delete"})]})]})})]})}function ls(t){return Kr[t]||`TYPE${t}`}function cs(t){return t.length>50?t.substring(0,47)+"...":t}function ds(t){return new Date(typeof t=="string"?t:t*1e3).toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})}function us(t){return t.trim()?[/^udp:[a-zA-Z0-9.-]+:\d+$/,/^tcp:[a-zA-Z0-9.-]+:\d+$/,/^https?:\/\/[a-zA-Z0-9.-]+(\/.*)?$/,/^[a-zA-Z0-9.-]+:\d+$/,/^[a-zA-Z0-9.-]+$/].some(n=>n.test(t))?{valid:!0}:{valid:!1,error:"Invalid upstream format. Use: udp:host:port, tcp:host:port, https://host/path, or host:port"}:{valid:!1,error:"Upstream is required"}}function hs({provider:t}){const e=Jt(),{setUpstreams:r,addUpstream:n,removeUpstream:o,setError:a}=Zt(),[i,d]=E(""),[m,u]=E(""),[h,l]=E(""),[p,c]=E(!1),[v,g]=E(null),[k,x]=E("asc"),[N,A]=E({});z(()=>t.onUpstreams(b=>{r(b)}),[t,r,a]);const U=[...e||[]].sort((f,b)=>{const y=(f.name||f.address).localeCompare(b.name||b.address);return k==="asc"?y:-y}),S=async f=>{f.preventDefault();const b=us(i);if(!b.valid){a(b.error);return}c(!0),a(null);try{let y=i.trim();try{const q=new URL(y),R=q.protocol.replace(":","").toLowerCase();R!=="https"&&(y=`${R==="tls"?"dot":R==="quic"?"doq":R}://${q.host}`)}catch{y=`udp://${y.replace(/^(udp|tcp|tls|dot|quic|doq):\/\//i,"")}`}const O={name:(m||new URL(y).hostname).trim(),address:y};h!==""&&(O.weight=Number(h)),n(O);const B=[...e,O];await t.saveUpstreams(B),d(""),u(""),l("")}catch(y){console.error("Failed to save upstream:",y),a(y instanceof Error?y.message:"Failed to save upstream")}finally{c(!1)}},C=async f=>{try{o(f);const b=e.filter(y=>y.address!==f);await t.saveUpstreams(b),g(null)}catch(b){console.error("Failed to delete upstream:",b),a(b instanceof Error?b.message:"Failed to delete upstream")}},P=f=>{const b=e.find(y=>y.address===f);b&&A(y=>({...y,[f]:{...b}}))},W=f=>{A(b=>{const y={...b};return delete y[f],y})},F=async f=>{const b=N[f];if(!b)return;const y=e.find(R=>R.address===f);if(!y)return;const O={name:(b.name??y.name??"").trim(),address:(b.address??y.address).trim()},B=b.weight===void 0?y.weight:Number(b.weight);B!==void 0&&(O.weight=B);const q=e.map(R=>R.address===f?O:R);try{r(q),await t.saveUpstreams(q),W(f)}catch(R){console.error("Failed to save edit:",R),a(R instanceof Error?R.message:"Failed to save")}},j=(f,b,y)=>{A(O=>({...O,[f]:{...O[f],[b]:b==="weight"?y===""?void 0:Number(y):y}}))},T=()=>{x(f=>f==="asc"?"desc":"asc")};return s("div",{className:"space-y-6",children:[s("div",{className:"flex items-center justify-between",children:s("div",{children:[s("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Upstreams"}),s("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Manage DNS upstream servers and their configuration"})]})}),s(G,{title:"Add New Upstream",subtitle:"Add a new DNS upstream server",children:s("form",{onSubmit:S,className:"space-y-6",children:[s("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s(D,{label:"Name",value:m,onInput:f=>u(f.target.value),placeholder:"Human-friendly name"}),s(D,{label:"Address",value:i,onInput:f=>d(f.target.value),placeholder:"udp://8.8.8.8:53 or https://dns.google/dns-query",hint:"Use URL form",required:!0}),s(D,{label:"Weight",type:"number",value:h,onInput:f=>l(f.target.value===""?"":Number(f.target.value)),placeholder:"1"})]}),s("div",{className:"flex gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:s(M,{type:"submit",variant:"primary",loading:p,disabled:p,children:p?"Adding...":"Add Upstream"})})]})}),s(G,{title:"Configured Upstreams",subtitle:`${e.length} upstream server${e.length===1?"":"s"} configured`,children:[s("div",{className:"flex justify-between items-center mb-6",children:[s("div",{className:"flex items-center gap-3",children:[s(be,{variant:"primary",children:e.length}),s("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.length===1?"upstream server":"upstream servers"})]}),s(M,{variant:"secondary",size:"sm",onClick:T,title:`Sort ${k==="asc"?"Z-A":"A-Z"}`,children:k==="asc"?"A-Z":"Z-A"})]}),U.length===0?s("div",{className:"text-center py-8",children:s("p",{className:"text-gray-600 dark:text-gray-400",children:"No upstream servers configured yet."})}):s("div",{className:"space-y-3",children:U.map(f=>s("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:N[f.address]?s("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3 items-end",children:[s(D,{label:"Name",value:N[f.address]?.name??f.name,onInput:b=>j(f.address,"name",b.target.value)}),s(D,{label:"Address",value:N[f.address]?.address??f.address,onInput:b=>j(f.address,"address",b.target.value)}),s(D,{label:"Weight",type:"number",value:N[f.address]?.weight??f.weight??"",onInput:b=>j(f.address,"weight",b.target.value)}),s("div",{className:"flex gap-2 justify-end",children:[s(M,{variant:"outline",size:"sm",onClick:()=>W(f.address),children:"Cancel"}),s(M,{variant:"primary",size:"sm",onClick:()=>F(f.address),children:"Save"})]})]}):s("div",{className:"flex items-center justify-between gap-4",children:[s("div",{className:"flex flex-col min-w-0",children:[s("span",{className:"text-sm text-gray-500 dark:text-gray-400 truncate max-w-[420px]",title:f.name||"Unnamed",children:f.name||"Unnamed"}),s("span",{className:"mt-1 px-2 py-1 rounded bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-gray-100 text-xs font-mono truncate max-w-[520px]",title:f.address,children:f.address})]}),s("div",{className:"flex items-center gap-3",children:[s("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["weight: ",f.weight??1]}),s(M,{variant:"secondary",size:"sm",onClick:()=>P(f.address),children:"Edit"}),s(M,{variant:"outline",size:"sm",onClick:()=>g(f.address),children:"Delete"})]})]})},f.address))})]}),v&&s("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50",children:s("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 p-6 max-w-md w-full",children:[s("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Delete Upstream"}),s("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:["Are you sure you want to delete upstream ",s("strong",{children:['"',v,'"']}),"? This action cannot be undone."]}),s("div",{className:"flex gap-3 justify-end",children:[s(M,{variant:"outline",onClick:()=>g(null),children:"Cancel"}),s(M,{variant:"primary",onClick:()=>C(v),children:"Delete"})]})]})})]})}function ms(t){if(t<1e3)return`${t.toFixed(1)}ms`;const e=t/1e3;return e<60?`${e.toFixed(2)}s`:`${(e/60).toFixed(1)}m`}function ps({provider:t}){const e=Zr(),{setEvents:r,setError:n}=Qr(),[o,a]=E(""),[i,d]=E(200);z(()=>{const h=t.onHistory(l=>{r(l)});return t.fetchHistory().then(r).catch(l=>{console.error("Failed to fetch history:",l),n(l.message)}),h},[t,r,n]);const m=he(()=>{let h=e;if(o.trim()){const l=o.toLowerCase();h=e.filter(p=>p.name.toLowerCase().includes(l))}return h.slice(0,i)},[e,o,i]),u=()=>e.length<=i?s(J,{}):s("div",{style:{marginTop:"12px",textAlign:"center"},children:[s("span",{className:"muted",children:["Showing ",i," of ",e.length," events."]}),i<1e3&&s("button",{className:"ow-btn ow-btn--secondary ow-btn--sm",style:{marginLeft:"8px"},onClick:()=>d(Math.min(i*2,2e3)),children:"Show More"})]});return s("div",{className:"space-y-6",children:[s("div",{className:"flex items-center justify-between",children:s("div",{children:[s("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Query History"}),s("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"View DNS query history and performance metrics"})]})}),s(G,{title:"Search and Filters",subtitle:"Filter DNS query history",children:s("div",{className:"space-y-4",children:[s(D,{label:"Filter by Domain",value:o,onInput:h=>a(h.target.value),placeholder:"Filter by domain name...",hint:"Enter a domain name to filter the results"}),s("div",{className:"flex items-center justify-between",children:[s("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Showing ",m.length," of ",e.length," events"]}),e.length>i&&s("button",{className:"text-sm text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300",onClick:()=>d(Math.min(i*2,2e3)),children:"Show More"})]})]})}),s(G,{title:"Query History",subtitle:`${m.length} DNS queries`,children:m.length===0?s("div",{className:"text-center py-8",children:s("p",{className:"text-gray-600 dark:text-gray-400",children:e.length===0?"No query history available":"No queries match filter"})}):s("div",{className:"overflow-x-auto",children:[s("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[s("thead",{className:"bg-gray-50 dark:bg-gray-800",children:s("tr",{children:[s("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Time"}),s("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Domain"}),s("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Type"}),s("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Upstream"}),s("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Duration"}),s("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Status"})]})}),s("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700",children:m.map((h,l)=>s("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[s("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:ds(h.time)}),s("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-gray-100",children:h.name}),s("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:ls(h.qtype)}),s("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",title:h.upstream,children:cs(h.upstream)}),s("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:ms(h.duration_ms)}),s("td",{className:"px-6 py-4 whitespace-nowrap",children:s("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${h.status==="ok"?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400":"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400"}`,children:h.status==="ok"?"OK":"Error"})})]},`${h.time}-${h.name}-${l}`))})]}),u()]})})]})}function fs({provider:t}){const[e,r]=E([]),[n,o]=E(!0),[a,i]=E(null);z(()=>{let p=t.onHosts(c=>{r(c),o(!1)});return t.fetchHosts().then(r).catch(c=>i(String(c))).finally(()=>o(!1)),()=>{p()}},[t]);const d=()=>r(p=>[...p,{pattern:"",a:[],aaaa:[],ttl:60}]),m=p=>r(c=>c.filter((v,g)=>g!==p)),u=(p,c)=>r(v=>v.map((g,k)=>k===p?{...g,...c}:g)),h=p=>p?p.split(",").map(c=>c.trim()).filter(Boolean):[];return s("div",{className:"space-y-6",children:[s("div",{className:"flex items-center justify-between",children:[s("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Hosts"}),s("div",{className:"space-x-2",children:[s(M,{variant:"secondary",onClick:d,children:"Add"}),s(M,{onClick:async()=>{i(null);try{await t.saveHosts(e)}catch(p){i(String(p))}},children:"Save"})]})]}),a&&s("div",{className:"text-red-600 text-sm",children:a}),s(G,{title:"Overrides",subtitle:"Static DNS responses with wildcard support",children:n?s("div",{className:"text-gray-500",children:"Loading..."}):s("div",{className:"overflow-x-auto",children:s("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[s("thead",{className:"bg-gray-50 dark:bg-gray-800",children:s("tr",{children:[s("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Pattern"}),s("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"A (comma separated)"}),s("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"AAAA (comma separated)"}),s("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"TTL"}),s("th",{className:"px-3 py-2 text-right text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),s("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700",children:[e.map((p,c)=>s("tr",{children:[s("td",{className:"px-3 py-2 w-[28%]",children:s(D,{value:p.pattern||"",onInput:v=>u(c,{pattern:v.currentTarget.value}),placeholder:"e.g. *.example.com"})}),s("td",{className:"px-3 py-2 w-[28%]",children:s(D,{value:(p.a||[]).join(", "),onInput:v=>u(c,{a:h(v.currentTarget.value)}),placeholder:"127.0.0.1, 10.0.0.1"})}),s("td",{className:"px-3 py-2 w-[28%]",children:s(D,{value:(p.aaaa||[]).join(", "),onInput:v=>u(c,{aaaa:h(v.currentTarget.value)}),placeholder:"::1, 2001:db8::1"})}),s("td",{className:"px-3 py-2 w-[8%]",children:s(D,{type:"number",value:String(p.ttl??60),onInput:v=>u(c,{ttl:Number(v.currentTarget.value)}),placeholder:"60"})}),s("td",{className:"px-3 py-2 text-right w-[8%]",children:s(M,{variant:"danger",onClick:()=>m(c),children:"Del"})})]},c)),e.length===0&&s("tr",{children:s("td",{colSpan:5,className:"px-3 py-6 text-sm text-gray-500 text-center",children:"No hosts configured. Click Add to create one."})})]})]})})})]})}const gs=(t,e)=>{const r=e.split("/"),n=r[0],o=r[1];if(!n||!o)return null;for(const a of t){const i=a.name.toLowerCase();if(i.includes(n.toLowerCase())&&i.includes(o.toLowerCase()))return a}for(const a of t)if(a.name.toLowerCase().includes(n.toLowerCase()))return a;for(const a of t){const i=a.name.toLowerCase();if(i.includes(".tar.gz")||i.includes(".zip")||i.includes(".bin"))return a}return null},_s=({provider:t})=>{const[e,r]=E(null),[n,o]=E(null),[a,i]=E(!1),[d,m]=E(!1),[u,h]=E(!1),[l,p]=E(null),[c,v]=E(null),g=(S,C)=>{p({message:S,type:C}),setTimeout(()=>p(null),5e3)};z(()=>t?t.onUpdateAvailable(C=>{console.log("WebSocket update notification received:",C),r(C),g(`Update available: ${C.latest_version}`,"success")}):void 0,[t]);const k=async()=>{i(!0);try{const S=await fetch("/api/v1/update/check");if(!S.ok)throw new Error("Failed to check for updates");const C=await S.json();r(C)}catch(S){g(`Failed to check for updates: ${S}`,"error")}finally{i(!1)}},x=async()=>{if(!e?.release?.assets)return;const S=n?.platform||"",C=gs(e.release.assets,S);if(!C){g("No suitable update found for your platform","error");return}m(!0);try{const P=await fetch("/api/v1/update/download",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({download_url:C.browser_download_url})});if(!P.ok)throw new Error("Failed to download update");const W=await P.json();v(W.path),g("Update downloaded successfully","success")}catch(P){g(`Failed to download update: ${P}`,"error")}finally{m(!1)}},N=async()=>{if(c){h(!0);try{const S=await fetch("/api/v1/update/install",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({update_path:c})});if(!S.ok)throw new Error("Failed to install update");const C=await S.json();g(C.message||"Update installed successfully. Please restart the application.","success"),v(null)}catch(S){g(`Failed to install update: ${S}`,"error")}finally{h(!1)}}},A=S=>new Date(S).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),U=S=>{const C=S.match(/(?:(\d+)h)?(?:(\d+)m)?(?:(\d+(?:\.\d+)?)s)?/);if(!C)return S;const P=parseInt(C[1]||"0"),W=parseInt(C[2]||"0"),F=parseFloat(C[3]||"0"),j=[];return P>0&&j.push(`${P}h`),W>0&&j.push(`${W}m`),F>0&&j.push(`${Math.floor(F)}s`),j.join(" ")||"0s"};return z(()=>{(async()=>{try{const C=await fetch("/api/v1/update/status");if(C.ok){const P=await C.json();o(P)}}catch(C){console.error("Failed to load update status:",C)}})(),k()},[]),s("div",{className:"space-y-6",children:[s("div",{className:"flex items-center justify-between",children:s("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Updates"})}),l&&s(Yt,{message:l.message,type:l.type,onClose:()=>p(null)}),s(G,{children:s("div",{className:"p-6",children:[s("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-6",children:"Current Version"}),n?s("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[s("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[s("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Version"}),s("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:n.current_version})]}),s("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[s("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Build Time"}),s("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:A(n.build_time)})]}),s("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[s("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Uptime"}),s("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:U(n.uptime)})]}),s("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[s("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Platform"}),s("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:n.platform})]})]}):s("div",{className:"flex items-center justify-center py-12",children:s(_e,{})})]})}),s(G,{children:s("div",{className:"p-6",children:[s("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[s("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Check for Updates"}),s(M,{onClick:k,disabled:a,className:"flex items-center gap-2 w-full sm:w-auto",children:[a?s(_e,{size:"sm"}):null,"Check for Updates"]})]}),e&&s("div",{className:"space-y-4",children:[e.has_update?s("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-xl p-6",children:[s("div",{className:"flex items-center gap-3 mb-3",children:[s("div",{className:"w-3 h-3 bg-blue-500 rounded-full animate-pulse"}),s("p",{className:"text-blue-800 dark:text-blue-200 font-semibold text-lg",children:"Update Available"})]}),s("p",{className:"text-blue-700 dark:text-blue-300 text-base mb-2",children:["New version ",s("span",{className:"font-bold",children:e.latest_version})," is available"]}),s("p",{className:"text-blue-600 dark:text-blue-400 text-sm",children:["Current version: ",e.current_version]}),e.release&&s("div",{className:"mt-3 space-y-2",children:[s("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:["Released: ",A(e.release.published_at)]}),e.release.body&&s("details",{className:"mt-2",children:[s("summary",{className:"text-sm text-blue-600 dark:text-blue-400 cursor-pointer hover:underline",children:"Release Notes"}),s("div",{className:"mt-2 p-3 bg-white dark:bg-gray-800 rounded border text-sm text-gray-700 dark:text-gray-300 whitespace-pre-wrap",children:e.release.body})]})]})]}):s("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-xl p-6",children:[s("div",{className:"flex items-center gap-3 mb-3",children:[s("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),s("p",{className:"text-green-800 dark:text-green-200 font-semibold text-lg",children:"You are up to date"})]}),s("p",{className:"text-green-700 dark:text-green-300 text-base",children:["Running latest version ",s("span",{className:"font-bold",children:e.current_version})]})]}),e.has_update&&s("div",{className:"flex flex-col sm:flex-row gap-3 mt-6",children:c?s(M,{onClick:N,disabled:u,className:"flex items-center justify-center gap-2 px-6 py-3 bg-red-600 hover:bg-red-700 text-white font-medium",children:[u?s(_e,{size:"sm"}):null,"Install Update"]}):s(M,{onClick:x,disabled:d,className:"flex items-center justify-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium",children:[d?s(_e,{size:"sm"}):null,"Download Update"]})})]})]})})]})};function ys(){const[t,e]=E("overview"),[r,n]=E(!1),[o,a]=E(null),[i,d]=E([]);Qt(),z(()=>{const h=new hr("/ws");let l=null;h.connect().then(()=>{a(h),console.log("Provider connected")}).catch(g=>{console.error("Failed to connect provider:",g)});const p=()=>{const g=window.location.hash.slice(1);["overview","rules","upstreams","history","hosts","resolve","update"].includes(g)&&e(g)};p(),window.addEventListener("hashchange",p);const c=()=>{window.innerWidth<1024&&n(!0)};c(),window.addEventListener("resize",c);const v=h.onStatus?.(g=>{if(g.channel==="rest"){l&&clearTimeout(l),l=window.setTimeout(()=>{d(k=>[{id:`${Date.now()}`,message:"WebSocket unavailable — using polling",type:"warning",duration:2500},...k].slice(0,4)),l=null},1200);return}l&&(clearTimeout(l),l=null),d(k=>[{id:`${Date.now()}`,message:"Realtime updates via WebSocket",type:"success",duration:2500},...k].slice(0,4))});return()=>{window.removeEventListener("hashchange",p),window.removeEventListener("resize",c),l&&clearTimeout(l),v&&v(),h.close()}},[]);const m=h=>{window.location.hash.slice(1)!==h?window.location.hash=h:e(h),window.scrollTo(0,0)},u=()=>{n(!r)};return o?s("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-700",children:[s(os,{toasts:i,onRemove:h=>d(l=>l.filter(p=>p.id!==h))}),s(ss,{activeTab:t,onTabChange:m,collapsed:r}),s("div",{className:`transition-all duration-300 ${r?"lg:ml-16":"lg:ml-64"}`,children:[s(as,{onSidebarToggle:u,sidebarCollapsed:r,provider:o}),s("main",{className:"p-6",children:s("div",{className:"max-w-7xl mx-auto",children:[t==="overview"&&s(es,{provider:o}),t==="rules"&&s(is,{provider:o}),t==="upstreams"&&s(hs,{provider:o}),t==="history"&&s(ps,{provider:o}),t==="hosts"&&s(fs,{provider:o}),t==="resolve"&&s(ts,{provider:o}),t==="update"&&s(_s,{provider:o})]})})]}),!r&&s("div",{className:"fixed inset-0 z-30 bg-black bg-opacity-50 lg:hidden",onClick:u})]}):s("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:s("div",{className:"text-center",children:[s("div",{className:"w-16 h-16 bg-gray-200 dark:bg-gray-700 rounded-full animate-pulse mx-auto mb-4"}),s("p",{className:"text-gray-600 dark:text-gray-400",children:"Connecting to server..."})]})})}re(s(ys,{}),document.getElementById("app"));
