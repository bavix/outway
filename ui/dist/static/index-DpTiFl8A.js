var Mr=Object.defineProperty;var Dr=(t,e,s)=>e in t?Mr(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var q=(t,e,s)=>Dr(t,typeof e!="symbol"?e+"":e,s);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function s(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(o){if(o.ep)return;o.ep=!0;const n=s(o);fetch(o.href,n)}})();var pe,U,Lt,re,st,Pt,$t,Ut,je,Me,De,At,fe={},Mt=[],Or=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,ge=Array.isArray;function X(t,e){for(var s in e)t[s]=e[s];return t}function Fe(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function Y(t,e,s){var a,o,n,i={};for(n in e)n=="key"?a=e[n]:n=="ref"?o=e[n]:i[n]=e[n];if(arguments.length>2&&(i.children=arguments.length>3?pe.call(arguments,2):s),typeof t=="function"&&t.defaultProps!=null)for(n in t.defaultProps)i[n]===void 0&&(i[n]=t.defaultProps[n]);return he(t,i,a,o,null)}function he(t,e,s,a,o){var n={type:t,props:e,key:s,ref:a,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:o??++Lt,__i:-1,__u:0};return o==null&&U.vnode!=null&&U.vnode(n),n}function Dt(){return{current:null}}function Z(t){return t.children}function Q(t,e){this.props=t,this.context=e}function oe(t,e){if(e==null)return t.__?oe(t.__,t.__i+1):null;for(var s;e<t.__k.length;e++)if((s=t.__k[e])!=null&&s.__e!=null)return s.__e;return typeof t.type=="function"?oe(t):null}function Ot(t){var e,s;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((s=t.__k[e])!=null&&s.__e!=null){t.__e=t.__c.base=s.__e;break}return Ot(t)}}function Oe(t){(!t.__d&&(t.__d=!0)&&re.push(t)&&!Ne.__r++||st!=U.debounceRendering)&&((st=U.debounceRendering)||Pt)(Ne)}function Ne(){for(var t,e,s,a,o,n,i,d=1;re.length;)re.length>d&&re.sort($t),t=re.shift(),d=re.length,t.__d&&(s=void 0,a=void 0,o=(a=(e=t).__v).__e,n=[],i=[],e.__P&&((s=X({},a)).__v=a.__v+1,U.vnode&&U.vnode(s),ze(e.__P,s,a,e.__n,e.__P.namespaceURI,32&a.__u?[o]:null,n,o??oe(a),!!(32&a.__u),i),s.__v=a.__v,s.__.__k[s.__i]=s,Ht(n,s,i),a.__e=a.__=null,s.__e!=o&&Ot(s)));Ne.__r=0}function Wt(t,e,s,a,o,n,i,d,f,u,m){var l,h,c,_,x,E,b,S=a&&a.__k||Mt,w=e.length;for(f=Wr(s,e,S,f,w),l=0;l<w;l++)(c=s.__k[l])!=null&&(h=c.__i==-1?fe:S[c.__i]||fe,c.__i=l,E=ze(t,c,h,o,n,i,d,f,u,m),_=c.__e,c.ref&&h.ref!=c.ref&&(h.ref&&Ge(h.ref,null,c),m.push(c.ref,c.__c||_,c)),x==null&&_!=null&&(x=_),(b=!!(4&c.__u))||h.__k===c.__k?f=It(c,f,t,b):typeof c.type=="function"&&E!==void 0?f=E:_&&(f=_.nextSibling),c.__u&=-7);return s.__e=x,f}function Wr(t,e,s,a,o){var n,i,d,f,u,m=s.length,l=m,h=0;for(t.__k=new Array(o),n=0;n<o;n++)(i=e[n])!=null&&typeof i!="boolean"&&typeof i!="function"?(f=n+h,(i=t.__k[n]=typeof i=="string"||typeof i=="number"||typeof i=="bigint"||i.constructor==String?he(null,i,null,null,null):ge(i)?he(Z,{children:i},null,null,null):i.constructor==null&&i.__b>0?he(i.type,i.props,i.key,i.ref?i.ref:null,i.__v):i).__=t,i.__b=t.__b+1,d=null,(u=i.__i=Ir(i,s,f,l))!=-1&&(l--,(d=s[u])&&(d.__u|=2)),d==null||d.__v==null?(u==-1&&(o>m?h--:o<m&&h++),typeof i.type!="function"&&(i.__u|=4)):u!=f&&(u==f-1?h--:u==f+1?h++:(u>f?h--:h++,i.__u|=4))):t.__k[n]=null;if(l)for(n=0;n<m;n++)(d=s[n])!=null&&!(2&d.__u)&&(d.__e==a&&(a=oe(d)),Ft(d,d));return a}function It(t,e,s,a){var o,n;if(typeof t.type=="function"){for(o=t.__k,n=0;o&&n<o.length;n++)o[n]&&(o[n].__=t,e=It(o[n],e,s,a));return e}t.__e!=e&&(a&&(e&&t.type&&!e.parentNode&&(e=oe(t)),s.insertBefore(t.__e,e||null)),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function K(t,e){return e=e||[],t==null||typeof t=="boolean"||(ge(t)?t.some(function(s){K(s,e)}):e.push(t)),e}function Ir(t,e,s,a){var o,n,i,d=t.key,f=t.type,u=e[s],m=u!=null&&(2&u.__u)==0;if(u===null&&t.key==null||m&&d==u.key&&f==u.type)return s;if(a>(m?1:0)){for(o=s-1,n=s+1;o>=0||n<e.length;)if((u=e[i=o>=0?o--:n++])!=null&&!(2&u.__u)&&d==u.key&&f==u.type)return i}return-1}function at(t,e,s){e[0]=="-"?t.setProperty(e,s??""):t[e]=s==null?"":typeof s!="number"||Or.test(e)?s:s+"px"}function ve(t,e,s,a,o){var n,i;e:if(e=="style")if(typeof s=="string")t.style.cssText=s;else{if(typeof a=="string"&&(t.style.cssText=a=""),a)for(e in a)s&&e in s||at(t.style,e,"");if(s)for(e in s)a&&s[e]==a[e]||at(t.style,e,s[e])}else if(e[0]=="o"&&e[1]=="n")n=e!=(e=e.replace(Ut,"$1")),i=e.toLowerCase(),e=i in t||e=="onFocusOut"||e=="onFocusIn"?i.slice(2):e.slice(2),t.l||(t.l={}),t.l[e+n]=s,s?a?s.u=a.u:(s.u=je,t.addEventListener(e,n?De:Me,n)):t.removeEventListener(e,n?De:Me,n);else{if(o=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=s??"";break e}catch{}typeof s=="function"||(s==null||s===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&s==1?"":s))}}function nt(t){return function(e){if(this.l){var s=this.l[e.type+t];if(e.t==null)e.t=je++;else if(e.t<s.u)return;return s(U.event?U.event(e):e)}}}function ze(t,e,s,a,o,n,i,d,f,u){var m,l,h,c,_,x,E,b,S,w,N,L,M,O,T,P,I,W=e.type;if(e.constructor!=null)return null;128&s.__u&&(f=!!(32&s.__u),n=[d=e.__e=s.__e]),(m=U.__b)&&m(e);e:if(typeof W=="function")try{if(b=e.props,S="prototype"in W&&W.prototype.render,w=(m=W.contextType)&&a[m.__c],N=m?w?w.props.value:m.__:a,s.__c?E=(l=e.__c=s.__c).__=l.__E:(S?e.__c=l=new W(b,N):(e.__c=l=new Q(b,N),l.constructor=W,l.render=jr),w&&w.sub(l),l.props=b,l.state||(l.state={}),l.context=N,l.__n=a,h=l.__d=!0,l.__h=[],l._sb=[]),S&&l.__s==null&&(l.__s=l.state),S&&W.getDerivedStateFromProps!=null&&(l.__s==l.state&&(l.__s=X({},l.__s)),X(l.__s,W.getDerivedStateFromProps(b,l.__s))),c=l.props,_=l.state,l.__v=e,h)S&&W.getDerivedStateFromProps==null&&l.componentWillMount!=null&&l.componentWillMount(),S&&l.componentDidMount!=null&&l.__h.push(l.componentDidMount);else{if(S&&W.getDerivedStateFromProps==null&&b!==c&&l.componentWillReceiveProps!=null&&l.componentWillReceiveProps(b,N),!l.__e&&l.shouldComponentUpdate!=null&&l.shouldComponentUpdate(b,l.__s,N)===!1||e.__v==s.__v){for(e.__v!=s.__v&&(l.props=b,l.state=l.__s,l.__d=!1),e.__e=s.__e,e.__k=s.__k,e.__k.some(function(p){p&&(p.__=e)}),L=0;L<l._sb.length;L++)l.__h.push(l._sb[L]);l._sb=[],l.__h.length&&i.push(l);break e}l.componentWillUpdate!=null&&l.componentWillUpdate(b,l.__s,N),S&&l.componentDidUpdate!=null&&l.__h.push(function(){l.componentDidUpdate(c,_,x)})}if(l.context=N,l.props=b,l.__P=t,l.__e=!1,M=U.__r,O=0,S){for(l.state=l.__s,l.__d=!1,M&&M(e),m=l.render(l.props,l.state,l.context),T=0;T<l._sb.length;T++)l.__h.push(l._sb[T]);l._sb=[]}else do l.__d=!1,M&&M(e),m=l.render(l.props,l.state,l.context),l.state=l.__s;while(l.__d&&++O<25);l.state=l.__s,l.getChildContext!=null&&(a=X(X({},a),l.getChildContext())),S&&!h&&l.getSnapshotBeforeUpdate!=null&&(x=l.getSnapshotBeforeUpdate(c,_)),P=m,m!=null&&m.type===Z&&m.key==null&&(P=jt(m.props.children)),d=Wt(t,ge(P)?P:[P],e,s,a,o,n,i,d,f,u),l.base=e.__e,e.__u&=-161,l.__h.length&&i.push(l),E&&(l.__E=l.__=null)}catch(p){if(e.__v=null,f||n!=null)if(p.then){for(e.__u|=f?160:128;d&&d.nodeType==8&&d.nextSibling;)d=d.nextSibling;n[n.indexOf(d)]=null,e.__e=d}else{for(I=n.length;I--;)Fe(n[I]);We(e)}else e.__e=s.__e,e.__k=s.__k,p.then||We(e);U.__e(p,e,s)}else n==null&&e.__v==s.__v?(e.__k=s.__k,e.__e=s.__e):d=e.__e=Hr(s.__e,e,s,a,o,n,i,f,u);return(m=U.diffed)&&m(e),128&e.__u?void 0:d}function We(t){t&&t.__c&&(t.__c.__e=!0),t&&t.__k&&t.__k.forEach(We)}function Ht(t,e,s){for(var a=0;a<s.length;a++)Ge(s[a],s[++a],s[++a]);U.__c&&U.__c(e,t),t.some(function(o){try{t=o.__h,o.__h=[],t.some(function(n){n.call(o)})}catch(n){U.__e(n,o.__v)}})}function jt(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:ge(t)?t.map(jt):X({},t)}function Hr(t,e,s,a,o,n,i,d,f){var u,m,l,h,c,_,x,E=s.props,b=e.props,S=e.type;if(S=="svg"?o="http://www.w3.org/2000/svg":S=="math"?o="http://www.w3.org/1998/Math/MathML":o||(o="http://www.w3.org/1999/xhtml"),n!=null){for(u=0;u<n.length;u++)if((c=n[u])&&"setAttribute"in c==!!S&&(S?c.localName==S:c.nodeType==3)){t=c,n[u]=null;break}}if(t==null){if(S==null)return document.createTextNode(b);t=document.createElementNS(o,S,b.is&&b),d&&(U.__m&&U.__m(e,n),d=!1),n=null}if(S==null)E===b||d&&t.data==b||(t.data=b);else{if(n=n&&pe.call(t.childNodes),E=s.props||fe,!d&&n!=null)for(E={},u=0;u<t.attributes.length;u++)E[(c=t.attributes[u]).name]=c.value;for(u in E)if(c=E[u],u!="children"){if(u=="dangerouslySetInnerHTML")l=c;else if(!(u in b)){if(u=="value"&&"defaultValue"in b||u=="checked"&&"defaultChecked"in b)continue;ve(t,u,null,c,o)}}for(u in b)c=b[u],u=="children"?h=c:u=="dangerouslySetInnerHTML"?m=c:u=="value"?_=c:u=="checked"?x=c:d&&typeof c!="function"||E[u]===c||ve(t,u,c,E[u],o);if(m)d||l&&(m.__html==l.__html||m.__html==t.innerHTML)||(t.innerHTML=m.__html),e.__k=[];else if(l&&(t.innerHTML=""),Wt(e.type=="template"?t.content:t,ge(h)?h:[h],e,s,a,S=="foreignObject"?"http://www.w3.org/1999/xhtml":o,n,i,n?n[0]:s.__k&&oe(s,0),d,f),n!=null)for(u=n.length;u--;)Fe(n[u]);d||(u="value",S=="progress"&&_==null?t.removeAttribute("value"):_!=null&&(_!==t[u]||S=="progress"&&!_||S=="option"&&_!=E[u])&&ve(t,u,_,E[u],o),u="checked",x!=null&&x!=t[u]&&ve(t,u,x,E[u],o))}return t}function Ge(t,e,s){try{if(typeof t=="function"){var a=typeof t.__u=="function";a&&t.__u(),a&&e==null||(t.__u=t(e))}else t.current=e}catch(o){U.__e(o,s)}}function Ft(t,e,s){var a,o;if(U.unmount&&U.unmount(t),(a=t.ref)&&(a.current&&a.current!=t.__e||Ge(a,null,e)),(a=t.__c)!=null){if(a.componentWillUnmount)try{a.componentWillUnmount()}catch(n){U.__e(n,e)}a.base=a.__P=null}if(a=t.__k)for(o=0;o<a.length;o++)a[o]&&Ft(a[o],e,s||typeof t.type!="function");s||Fe(t.__e),t.__c=t.__=t.__e=void 0}function jr(t,e,s){return this.constructor(t,s)}function ie(t,e,s){var a,o,n,i;e==document&&(e=document.documentElement),U.__&&U.__(t,e),o=(a=typeof s=="function")?null:s&&s.__k||e.__k,n=[],i=[],ze(e,t=(!a&&s||e).__k=Y(Z,null,[t]),o||fe,fe,e.namespaceURI,!a&&s?[s]:o?null:e.firstChild?pe.call(e.childNodes):null,n,!a&&s?s:o?o.__e:e.firstChild,a,i),Ht(n,t,i)}function zt(t,e){ie(t,e,zt)}function Fr(t,e,s){var a,o,n,i,d=X({},t.props);for(n in t.type&&t.type.defaultProps&&(i=t.type.defaultProps),e)n=="key"?a=e[n]:n=="ref"?o=e[n]:d[n]=e[n]===void 0&&i!=null?i[n]:e[n];return arguments.length>2&&(d.children=arguments.length>3?pe.call(arguments,2):s),he(t.type,d,a||t.key,o||t.ref,null)}function Gt(t){function e(s){var a,o;return this.getChildContext||(a=new Set,(o={})[e.__c]=this,this.getChildContext=function(){return o},this.componentWillUnmount=function(){a=null},this.shouldComponentUpdate=function(n){this.props.value!=n.value&&a.forEach(function(i){i.__e=!0,Oe(i)})},this.sub=function(n){a.add(n);var i=n.componentWillUnmount;n.componentWillUnmount=function(){a&&a.delete(n),i&&i.call(n)}}),s.children}return e.__c="__cC"+At++,e.__=t,e.Provider=e.__l=(e.Consumer=function(s,a){return s.children(a)}).contextType=e,e}pe=Mt.slice,U={__e:function(t,e,s,a){for(var o,n,i;e=e.__;)if((o=e.__c)&&!o.__)try{if((n=o.constructor)&&n.getDerivedStateFromError!=null&&(o.setState(n.getDerivedStateFromError(t)),i=o.__d),o.componentDidCatch!=null&&(o.componentDidCatch(t,a||{}),i=o.__d),i)return o.__E=o}catch(d){t=d}throw t}},Lt=0,Q.prototype.setState=function(t,e){var s;s=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=X({},this.state),typeof t=="function"&&(t=t(X({},s),this.props)),t&&X(s,t),t!=null&&this.__v&&(e&&this._sb.push(e),Oe(this))},Q.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),Oe(this))},Q.prototype.render=Z,re=[],Pt=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,$t=function(t,e){return t.__v.__b-e.__v.__b},Ne.__r=0,Ut=/(PointerCapture)$|Capture$/i,je=0,Me=nt(!1),De=nt(!0),At=0;var zr=0;function r(t,e,s,a,o,n){e||(e={});var i,d,f=e;if("ref"in f)for(d in f={},e)d=="ref"?i=e[d]:f[d]=e[d];var u={type:t,props:f,key:s,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--zr,__i:-1,__u:0,__source:o,__self:n};if(typeof t=="function"&&(i=t.defaultProps))for(d in i)f[d]===void 0&&(f[d]=i[d]);return U.vnode&&U.vnode(u),u}var ee,H,Le,ot,le=0,qt=[],z=U,it=z.__b,lt=z.__r,ct=z.diffed,dt=z.__c,ut=z.unmount,ht=z.__;function se(t,e){z.__h&&z.__h(H,t,le||e),le=0;var s=H.__H||(H.__H={__:[],__h:[]});return t>=s.__.length&&s.__.push({}),s.__[t]}function k(t){return le=1,Ce(Vt,t)}function Ce(t,e,s){var a=se(ee++,2);if(a.t=t,!a.__c&&(a.__=[s?s(e):Vt(void 0,e),function(d){var f=a.__N?a.__N[0]:a.__[0],u=a.t(f,d);f!==u&&(a.__N=[u,a.__[1]],a.__c.setState({}))}],a.__c=H,!H.__f)){var o=function(d,f,u){if(!a.__c.__H)return!0;var m=a.__c.__H.__.filter(function(h){return!!h.__c});if(m.every(function(h){return!h.__N}))return!n||n.call(this,d,f,u);var l=a.__c.props!==d;return m.forEach(function(h){if(h.__N){var c=h.__[0];h.__=h.__N,h.__N=void 0,c!==h.__[0]&&(l=!0)}}),n&&n.call(this,d,f,u)||l};H.__f=!0;var n=H.shouldComponentUpdate,i=H.componentWillUpdate;H.componentWillUpdate=function(d,f,u){if(this.__e){var m=n;n=void 0,o(d,f,u),n=m}i&&i.call(this,d,f,u)},H.shouldComponentUpdate=o}return a.__N||a.__}function j(t,e){var s=se(ee++,3);!z.__s&&Qe(s.__H,e)&&(s.__=t,s.u=e,H.__H.__h.push(s))}function de(t,e){var s=se(ee++,4);!z.__s&&Qe(s.__H,e)&&(s.__=t,s.u=e,H.__h.push(s))}function Ee(t){return le=5,te(function(){return{current:t}},[])}function qe(t,e,s){le=6,de(function(){if(typeof t=="function"){var a=t(e());return function(){t(null),a&&typeof a=="function"&&a()}}if(t)return t.current=e(),function(){return t.current=null}},s==null?s:s.concat(t))}function te(t,e){var s=se(ee++,7);return Qe(s.__H,e)&&(s.__=t(),s.__H=e,s.__h=t),s.__}function Ve(t,e){return le=8,te(function(){return t},e)}function Be(t){var e=H.context[t.__c],s=se(ee++,9);return s.c=t,e?(s.__==null&&(s.__=!0,e.sub(H)),e.props.value):t.__}function Je(t,e){z.useDebugValue&&z.useDebugValue(e?e(t):t)}function Gr(t){var e=se(ee++,10),s=k();return e.__=t,H.componentDidCatch||(H.componentDidCatch=function(a,o){e.__&&e.__(a,o),s[1](a)}),[s[0],function(){s[1](void 0)}]}function Ze(){var t=se(ee++,11);if(!t.__){for(var e=H.__v;e!==null&&!e.__m&&e.__!==null;)e=e.__;var s=e.__m||(e.__m=[0,0]);t.__="P"+s[0]+"-"+s[1]++}return t.__}function qr(){for(var t;t=qt.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(we),t.__H.__h.forEach(Ie),t.__H.__h=[]}catch(e){t.__H.__h=[],z.__e(e,t.__v)}}z.__b=function(t){H=null,it&&it(t)},z.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),ht&&ht(t,e)},z.__r=function(t){lt&&lt(t),ee=0;var e=(H=t.__c).__H;e&&(Le===H?(e.__h=[],H.__h=[],e.__.forEach(function(s){s.__N&&(s.__=s.__N),s.u=s.__N=void 0})):(e.__h.forEach(we),e.__h.forEach(Ie),e.__h=[],ee=0)),Le=H},z.diffed=function(t){ct&&ct(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(qt.push(e)!==1&&ot===z.requestAnimationFrame||((ot=z.requestAnimationFrame)||Vr)(qr)),e.__H.__.forEach(function(s){s.u&&(s.__H=s.u),s.u=void 0})),Le=H=null},z.__c=function(t,e){e.some(function(s){try{s.__h.forEach(we),s.__h=s.__h.filter(function(a){return!a.__||Ie(a)})}catch(a){e.some(function(o){o.__h&&(o.__h=[])}),e=[],z.__e(a,s.__v)}}),dt&&dt(t,e)},z.unmount=function(t){ut&&ut(t);var e,s=t.__c;s&&s.__H&&(s.__H.__.forEach(function(a){try{we(a)}catch(o){e=o}}),s.__H=void 0,e&&z.__e(e,s.__v))};var mt=typeof requestAnimationFrame=="function";function Vr(t){var e,s=function(){clearTimeout(a),mt&&cancelAnimationFrame(e),setTimeout(t)},a=setTimeout(s,35);mt&&(e=requestAnimationFrame(s))}function we(t){var e=H,s=t.__c;typeof s=="function"&&(t.__c=void 0,s()),H=e}function Ie(t){var e=H;t.__c=t.__(),H=e}function Qe(t,e){return!t||t.length!==e.length||e.some(function(s,a){return s!==t[a]})}function Vt(t,e){return typeof e=="function"?e(t):e}class Br{constructor(e){q(this,"ws",null);q(this,"reconnectTimeout",null);q(this,"reconnectAttempts",0);q(this,"maxReconnectAttempts",10);q(this,"baseDelay",500);q(this,"maxDelay",1e4);q(this,"callbacks",new Map);q(this,"lastSnapshot",{});this.url=e}async connect(){return new Promise((e,s)=>{try{const a=this.url.replace(/^http/,"ws");this.ws=new WebSocket(a),this.ws.onopen=()=>{console.log("WebSocket connected"),this.reconnectAttempts=0,this.clearReconnectTimeout(),e()},this.ws.onmessage=o=>{try{const n=JSON.parse(o.data);this.handleMessage(n)}catch(n){console.warn("Invalid WebSocket message:",n)}},this.ws.onclose=()=>{console.log("WebSocket disconnected"),this.scheduleReconnect()},this.ws.onerror=o=>{console.error("WebSocket error:",o),s(o)},this.ws.addEventListener("ping",()=>{var o;((o=this.ws)==null?void 0:o.readyState)===WebSocket.OPEN&&this.ws.send("pong")})}catch(a){s(a)}})}close(){this.clearReconnectTimeout(),this.ws&&(this.ws.close(),this.ws=null)}handleMessage(e){let s=e.data;if(e.type==="upstreams"&&Array.isArray(s)){const o=this.lastSnapshot.upstreams||[];s=s.map((n,i)=>{var h;const d=(n.name||n.Name||"").toString(),f=n.weight??n.Weight,u=(n.type||n.Type||"").toString().toLowerCase(),m=(n.address||n.Address||"").toString();let l=m;if(/^(https?|udp|tcp|tls|dot|quic|doq):\/\//i.test(m)||(u&&u!=="doh"?l=`${u}://${m}`:l=`udp://${m}`),!l||l==="udp://"){const c=o.find(_=>_.name===d);l=(c==null?void 0:c.address)||((h=o[i])==null?void 0:h.address)||l}return{name:d,address:l,weight:f}})}if(e.type==="history"){const o=Array.isArray(s)?s:s&&Array.isArray(s.events)?s.events:[];s=o;try{console.debug("[WS] history",Array.isArray(o)?o.length:0)}catch{}}if(e.type==="stats"&&s)if(typeof s=="object"&&s!==null){s={dns_queries_total:s.dns_queries_total||0,dns_marks_total:s.dns_marks_total||0,marks_dropped_total:s.marks_dropped_total||0,dns_upstream_rtt_avg_seconds:s.dns_upstream_rtt_avg_seconds||0,dns_request_avg_seconds:s.dns_request_avg_seconds||0,service_ready:s.service_ready||0,effective_rps:s.effective_rps||0,origin_rps:s.origin_rps||0,cache_hit_rate:s.cache_hit_rate||0,...s};try{console.debug("[WS] stats received:",s)}catch{}}else try{console.warn("[WS] Invalid stats payload:",s)}catch{}if(e.type==="overview"&&s)try{window.__ov=s}catch{}if(e.type==="cache_updated"){const o=this.callbacks.get("cache");o&&o.forEach(n=>{var i,d,f,u;try{n({items:((i=this.lastSnapshot.cache)==null?void 0:i.items)||[],total:((d=this.lastSnapshot.cache)==null?void 0:d.total)||0,offset:((f=this.lastSnapshot.cache)==null?void 0:f.offset)||0,limit:((u=this.lastSnapshot.cache)==null?void 0:u.limit)||0})}catch{}})}this.lastSnapshot[e.type]=s;const a=this.callbacks.get(e.type);a&&a.forEach(o=>{try{o(s)}catch(n){console.error("Callback error:",n)}})}scheduleReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.error("Max reconnection attempts reached");return}this.clearReconnectTimeout();const e=Math.min(this.baseDelay*Math.pow(1.8,this.reconnectAttempts),this.maxDelay),s=e*.25,a=e+(Math.random()-.5)*s;this.reconnectTimeout=window.setTimeout(()=>{this.reconnectAttempts++,console.log(`Attempting to reconnect (${this.reconnectAttempts}/${this.maxReconnectAttempts})`),this.connect().catch(console.error)},a)}clearReconnectTimeout(){this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null)}onRuleGroups(e){return this.subscribe("rule_groups",e)}onUpstreams(e){return this.subscribe("upstreams",e)}onStats(e){return this.subscribe("stats",e)}onHistory(e){return this.subscribe("history",e)}onHosts(e){return this.subscribe("hosts",e)}onOverview(e){return this.subscribe("overview",e)}onCache(e){return this.subscribe("cache",e)}onCacheUpdated(e){return this.subscribe("cache_updated",e)}onUpdateAvailable(e){return this.subscribe("update_available",e)}subscribe(e,s){if(this.callbacks.has(e)||this.callbacks.set(e,new Set),this.callbacks.get(e).add(s),this.lastSnapshot[e])try{s(this.lastSnapshot[e])}catch(a){console.error("Snapshot callback error:",a)}return()=>{const a=this.callbacks.get(e);a&&(a.delete(s),a.size===0&&this.callbacks.delete(e))}}async fetchRuleGroups(){throw new Error("Use REST provider for fetch operations")}async createRuleGroup(e){throw new Error("Use REST provider for mutation operations")}async updateRuleGroup(e,s){throw new Error("Use REST provider for mutation operations")}async deleteRuleGroup(e){throw new Error("Use REST provider for mutation operations")}async fetchUpstreams(){throw new Error("Use REST provider for fetch operations")}async saveUpstreams(e){throw new Error("Use REST provider for mutation operations")}async fetchStats(){throw new Error("Use REST provider for fetch operations")}async fetchHistory(){throw new Error("Use REST provider for fetch operations")}async fetchServerInfo(){throw new Error("Use REST provider for fetch operations")}async fetchConfig(){throw new Error("Use REST provider for fetch operations")}async updateConfig(e){throw new Error("Use REST provider for mutation operations")}async fetchHosts(){throw new Error("Use REST provider for fetch operations")}async saveHosts(e){throw new Error("Use REST provider for mutation operations")}async testResolve(e,s){throw new Error("Use REST provider for fetch operations")}on(e,s){this.callbacks.has(e)||this.callbacks.set(e,new Set),this.callbacks.get(e).add(s)}off(e,s){const a=this.callbacks.get(e);a&&a.delete(s)}async request(e,s,a){throw new Error("Use REST provider for HTTP requests")}async fetchLocalZones(){throw new Error("Use REST provider for Local DNS operations")}async fetchLocalLeases(){throw new Error("Use REST provider for Local DNS operations")}async testLocalResolve(e){throw new Error("Use REST provider for Local DNS operations")}}class Jr{constructor(e=""){q(this,"pollingTimers",new Map);q(this,"callbacks",new Map);q(this,"pollingConfig",{stats:3e4,history:6e4,rule_groups:3e5,upstreams:3e5,hosts:3e5,cache:3e4,local_zones:3e4,local_leases:3e4});this.baseUrl=e}async connect(){this.startPolling("stats",()=>this.fetchStats()),this.startPolling("history",()=>this.fetchHistory()),this.startPolling("rule_groups",()=>this.fetchRuleGroups()),this.startPolling("upstreams",()=>this.fetchUpstreams()),this.startPolling("hosts",()=>this.fetchHosts()),this.startPolling("cache",()=>this.fetchCache())}close(){this.pollingTimers.forEach(e=>clearInterval(e)),this.pollingTimers.clear(),this.callbacks.clear()}async fetchJSON(e,s={}){const a=await fetch(`${this.baseUrl}${e}`,{headers:{"Content-Type":"application/json",...s.headers},...s});if(!a.ok)throw new Error(`HTTP ${a.status}: ${await a.text()}`);const o=a.headers.get("content-type");return o!=null&&o.includes("application/json")?a.json():a.text()}startPolling(e,s){const a=this.pollingConfig[e];s().then(n=>{this.notifyCallbacks(e,n)}).catch(console.error);const o=window.setInterval(()=>{s().then(n=>{this.notifyCallbacks(e,n)}).catch(console.error)},a);this.pollingTimers.set(e,o)}notifyCallbacks(e,s){const a=this.callbacks.get(e);a&&a.forEach(o=>{try{o(s)}catch(n){console.error("Polling callback error:",n)}})}onRuleGroups(e){return this.subscribe("rule_groups",e)}onUpstreams(e){return this.subscribe("upstreams",e)}onStats(e){return this.subscribe("stats",e)}onHistory(e){return this.subscribe("history",e)}onHosts(e){return this.subscribe("hosts",e)}onCache(e){return this.subscribe("cache",e)}onUpdateAvailable(e){return()=>{}}subscribe(e,s){return this.callbacks.has(e)||this.callbacks.set(e,new Set),this.callbacks.get(e).add(s),()=>{const a=this.callbacks.get(e);a&&(a.delete(s),a.size===0&&this.callbacks.delete(e))}}async fetchRuleGroups(){return(await this.fetchJSON("/api/v1/rule-groups")).rule_groups}async createRuleGroup(e){await this.fetchJSON("/api/v1/rule-groups",{method:"POST",body:JSON.stringify(e)})}async updateRuleGroup(e,s){await this.fetchJSON(`/api/v1/rule-groups/${encodeURIComponent(e)}`,{method:"PUT",body:JSON.stringify(s)})}async deleteRuleGroup(e){await this.fetchJSON(`/api/v1/rule-groups/${encodeURIComponent(e)}`,{method:"DELETE"})}async fetchUpstreams(){return(await this.fetchJSON("/api/v1/upstreams")).upstreams.map(s=>{var f,u;const a=s.name||s.Name||"",o=s.weight??s.Weight,n=(f=s.type)==null?void 0:f.toString().toLowerCase(),i=((u=s.address)==null?void 0:u.toString())||"";let d=i;return/^(https?|udp|tcp|tls|dot|quic|doq):\/\//i.test(i)?d=i:n&&n!=="doh"&&(d=`${n}://${i.replace(/^(udp|tcp|tls|dot|quic|doq):\/\//i,"")}`),{name:a,address:d,weight:o}})}async saveUpstreams(e){const s=e.map(a=>{const o=String(a.address||"").trim();let n=(a.name||"").trim();const i=typeof a.weight=="number"?a.weight:void 0;try{const u=new URL(o),m=u.protocol.replace(":","").toLowerCase();let l=o;return m!=="https"&&(l=`${m==="tls"?"dot":m==="quic"?"doq":m}://${u.host}`),n||(n=u.hostname),{name:n,address:l,...i!==void 0?{weight:i}:{}}}catch{}const d=o.replace(/^(udp|tcp|tls|dot|quic|doq):\/\//i,"");n||(n=d.split(":")[0]||d);const f=`udp://${d}`;return{name:n,address:f,...i!==void 0?{weight:i}:{}}});await this.fetchJSON("/api/v1/upstreams",{method:"POST",body:JSON.stringify({upstreams:s})})}async fetchStats(){return this.fetchJSON("/api/v1/stats")}async fetchHistory(){return(await this.fetchJSON("/api/v1/history")).events}async fetchHosts(){return(await this.fetchJSON("/api/v1/hosts")).hosts}async saveHosts(e){await this.fetchJSON("/api/v1/hosts",{method:"PUT",body:JSON.stringify({hosts:e})})}async fetchServerInfo(){return this.fetchJSON("/api/v1/info")}async testResolve(e,s){const a=new URLSearchParams({name:e,type:s});return this.fetchJSON(`/api/v1/resolve?${a.toString()}`)}async cacheFlush(){return this.fetchJSON("/api/v1/cache/flush",{method:"POST"})}async cacheDelete(e){return this.fetchJSON("/api/v1/cache/delete",{method:"POST",body:JSON.stringify(e)})}onOverview(e){return this.subscribe("overview",e)}async fetchOverview(){return this.fetchJSON("/api/v1/overview")}async fetchCache(e){const s=new URLSearchParams;e!=null&&e.offset&&s.set("offset",String(e.offset)),e!=null&&e.limit&&s.set("limit",String(e.limit)),e!=null&&e.q&&s.set("q",e.q);const a=s.toString();return this.fetchJSON(`/api/v1/cache${a?`?${a}`:""}`)}async fetchCacheKey(e){const s=new URLSearchParams({key:e});return this.fetchJSON(`/api/v1/cache/key?${s.toString()}`)}on(e,s){this.callbacks.has(e)||this.callbacks.set(e,new Set),this.callbacks.get(e).add(s)}off(e,s){const a=this.callbacks.get(e);a&&a.delete(s)}async request(e,s,a){const o=`${this.baseUrl}${s}`,n={method:e,headers:{"Content-Type":"application/json"}};return a&&(n.body=JSON.stringify(a)),fetch(o,n)}async fetchLocalZones(){return(await this.fetchJSON("/api/v1/local/zones")).zones||[]}async fetchLocalLeases(){return(await this.fetchJSON("/api/v1/local/leases")).leases||[]}async testLocalResolve(e){const s=new URLSearchParams({name:e});return this.fetchJSON(`/api/v1/local/resolve?${s.toString()}`)}}class Zr{constructor(e="/ws",s=""){q(this,"wsProvider");q(this,"restProvider");q(this,"isWSConnected",!1);q(this,"listeners",new Map);q(this,"wsUnsubs",new Map);q(this,"restUnsubs",new Map);q(this,"statusListeners",new Set);this.wsProvider=new Br(e),this.restProvider=new Jr(s)}async connect(){try{await this.wsProvider.connect(),this.isWSConnected=!0,console.log("Using WebSocket provider")}catch(e){console.warn("WebSocket connection failed, falling back to REST:",e),this.isWSConnected=!1}try{await this.restProvider.connect(),console.log("REST provider ready")}catch(e){throw console.error("REST provider failed:",e),e}this.resubscribeAll(),this.monitorWSConnection(),this.emitStatus()}close(){this.wsProvider.close(),this.restProvider.close(),this.wsUnsubs.forEach(e=>e()),this.restUnsubs.forEach(e=>e()),this.wsUnsubs.clear(),this.restUnsubs.clear(),this.listeners.clear(),this.statusListeners.clear()}monitorWSConnection(){const e=setInterval(()=>{var o;const s=this.isWSConnected;if(!(((o=this.wsProvider.ws)==null?void 0:o.readyState)===WebSocket.OPEN)){setTimeout(()=>{var d;const n=((d=this.wsProvider.ws)==null?void 0:d.readyState)!==WebSocket.OPEN,i=this.isWSConnected;this.isWSConnected=!n,i!==this.isWSConnected&&(this.resubscribeAll(),console.log(this.isWSConnected?"WebSocket active":"Using REST fallback"),this.emitStatus())},1500);return}this.isWSConnected=!0,s!==!0&&(this.resubscribeAll(),console.log(this.isWSConnected?"WebSocket active":"Using REST fallback"),this.emitStatus())},1e4);this.wsUnsubs.set("_monitor",()=>clearInterval(e))}addListener(e,s){return this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(s),this.resubscribe(e),()=>{const a=this.listeners.get(e);a&&(a.delete(s),a.size===0&&this.listeners.delete(e));const o=this.wsUnsubs.get(e);o&&o();const n=this.restUnsubs.get(e);n&&n(),this.wsUnsubs.delete(e),this.restUnsubs.delete(e)}}resubscribe(e){const s=this.wsUnsubs.get(e);s&&s();const a=this.restUnsubs.get(e);a&&a(),this.wsUnsubs.delete(e),this.restUnsubs.delete(e);const o=this.listeners.get(e);if(!o||o.size===0)return;const n=i=>o.forEach(d=>{try{d(i)}catch{}});if(this.isWSConnected)switch(e){case"rule_groups":this.wsUnsubs.set(e,this.wsProvider.onRuleGroups(n));break;case"upstreams":this.wsUnsubs.set(e,this.wsProvider.onUpstreams(n));break;case"stats":this.wsUnsubs.set(e,this.wsProvider.onStats(n));break;case"history":this.wsUnsubs.set(e,this.wsProvider.onHistory(n));break;case"hosts":this.wsUnsubs.set(e,this.wsProvider.onHosts(n));break;case"overview":this.wsUnsubs.set(e,this.wsProvider.onOverview(n));break;case"update_available":this.wsUnsubs.set(e,this.wsProvider.onUpdateAvailable(n));break;case"cache":this.wsUnsubs.set(e,this.wsProvider.onCache(n));break}else switch(e){case"rule_groups":this.restUnsubs.set(e,this.restProvider.onRuleGroups(n)),this.restProvider.fetchRuleGroups().then(n).catch(console.error);break;case"upstreams":this.restUnsubs.set(e,this.restProvider.onUpstreams(n)),this.restProvider.fetchUpstreams().then(n).catch(console.error);break;case"stats":this.restUnsubs.set(e,this.restProvider.onStats(n)),this.restProvider.fetchStats().then(i=>{console.debug("[FailoverProvider] Stats loaded via REST:",i),n(i)}).catch(i=>{console.error("[FailoverProvider] Failed to load stats via REST:",i)});break;case"history":this.restUnsubs.set(e,this.restProvider.onHistory(n)),this.restProvider.fetchHistory().then(n).catch(console.error);break;case"hosts":this.restUnsubs.set(e,this.restProvider.onHosts(n)),this.restProvider.fetchHosts().then(n).catch(console.error);break;case"overview":this.restUnsubs.set(e,this.restProvider.onOverview(n)),this.restProvider.fetchOverview().then(n).catch(console.error);break;case"update_available":this.restUnsubs.set(e,this.restProvider.onUpdateAvailable(n));break;case"cache":this.restUnsubs.set(e,this.restProvider.onCache(n));break}}resubscribeAll(){Array.from(this.listeners.keys()).forEach(e=>this.resubscribe(e))}emitStatus(){const e={channel:this.isWSConnected?"ws":"rest",connected:!0};this.statusListeners.forEach(s=>{try{s(e)}catch{}})}onStatus(e){return this.statusListeners.add(e),e({channel:this.isWSConnected?"ws":"rest",connected:!0}),()=>{this.statusListeners.delete(e)}}async reconnect(){try{await this.wsProvider.connect(),this.isWSConnected=!0,this.resubscribeAll(),this.emitStatus()}catch{}}onRuleGroups(e){return this.addListener("rule_groups",e)}onUpstreams(e){return this.addListener("upstreams",e)}onStats(e){return this.addListener("stats",e)}onHistory(e){return this.addListener("history",e)}onHosts(e){return this.addListener("hosts",e)}onOverview(e){return this.addListener("overview",e)}onUpdateAvailable(e){return this.addListener("update_available",e)}onCache(e){return this.addListener("cache",e)}onCacheUpdated(e){return this.addListener("cache_updated",e)}async fetchCache(e){return this.restProvider.fetchCache(e)}async fetchRuleGroups(){try{return await this.restProvider.fetchRuleGroups()}catch(e){throw console.error("Failed to fetch rule groups:",e),e}}async createRuleGroup(e){try{await this.restProvider.createRuleGroup(e)}catch(s){throw console.error("Failed to create rule group:",s),s}}async updateRuleGroup(e,s){try{await this.restProvider.updateRuleGroup(e,s)}catch(a){throw console.error("Failed to update rule group:",a),a}}async deleteRuleGroup(e){try{await this.restProvider.deleteRuleGroup(e)}catch(s){throw console.error("Failed to delete rule group:",s),s}}async fetchUpstreams(){var e;try{return this.isWSConnected&&this.wsProvider&&((e=this.wsProvider.lastSnapshot)!=null&&e.upstreams)?this.wsProvider.lastSnapshot.upstreams:await this.restProvider.fetchUpstreams()}catch(s){throw console.error("Failed to fetch upstreams:",s),s}}async saveUpstreams(e){try{await this.restProvider.saveUpstreams(e)}catch(s){throw console.error("Failed to save upstreams:",s),s}}async fetchStats(){try{return await this.restProvider.fetchStats()}catch(e){throw console.error("Failed to fetch stats:",e),e}}async fetchHistory(){try{return await this.restProvider.fetchHistory()}catch(e){throw console.error("Failed to fetch history:",e),e}}async fetchHosts(){try{return await this.restProvider.fetchHosts()}catch(e){throw console.error("Failed to fetch hosts:",e),e}}async saveHosts(e){try{await this.restProvider.saveHosts(e)}catch(s){throw console.error("Failed to save hosts:",s),s}}async fetchServerInfo(){try{return await this.restProvider.fetchServerInfo()}catch(e){throw console.error("Failed to fetch server info:",e),e}}async fetchOverview(){try{return await this.restProvider.fetchOverview()}catch(e){throw console.error("Failed to fetch overview:",e),e}}async testResolve(e,s){try{return await this.restProvider.testResolve(e,s)}catch(a){throw console.error("Failed to run resolve test:",a),a}}async cacheFlush(){return this.restProvider.cacheFlush()}async cacheDelete(e){return this.restProvider.cacheDelete(e)}on(e,s){this.isWSConnected?this.wsProvider.on(e,s):this.restProvider.on(e,s)}off(e,s){this.isWSConnected?this.wsProvider.off(e,s):this.restProvider.off(e,s)}async request(e,s,a){return this.isWSConnected?this.wsProvider.request(e,s,a):this.restProvider.request(e,s,a)}async fetchLocalZones(){return this.restProvider.fetchLocalZones()}async fetchLocalLeases(){return this.restProvider.fetchLocalLeases()}async testLocalResolve(e){return this.restProvider.testLocalResolve(e)}}function V({children:t,className:e="",title:s,subtitle:a,...o}){const n=`card bg-white/80 dark:bg-gray-800/70 backdrop-blur-sm rounded-xl p-6 border border-gray-200/50 dark:border-gray-700/50 shadow-lg hover:shadow-xl transition-all duration-300 ${e}`.trim();return r("div",{className:n,...o,children:[(s||a)&&r("div",{className:"card-header pb-4 mb-6 border-b border-gray-200 dark:border-gray-700",children:[s&&r("h3",{className:"card-title text-xl font-semibold text-gray-900 dark:text-gray-100 leading-tight",children:s}),a&&r("p",{className:"card-subtitle text-sm text-gray-600 dark:text-gray-400 mt-2 leading-relaxed",children:a})]}),r("div",{className:"card-content text-gray-700 dark:text-gray-300 leading-relaxed",children:t})]})}function be({title:t,value:e,change:s,icon:a,color:o="blue",className:n=""}){const i={blue:"text-blue-600 dark:text-blue-400",green:"text-green-600 dark:text-green-400",red:"text-red-600 dark:text-red-400",yellow:"text-yellow-600 dark:text-yellow-400",purple:"text-purple-600 dark:text-purple-400",indigo:"text-indigo-600 dark:text-indigo-400"},d=`stats-card bg-white rounded-md p-6 shadow-sm dark:bg-black dark:shadow-none ${n}`.trim();return r("div",{className:d,children:r("div",{className:"flex items-center justify-between",children:[r("div",{children:[r("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t}),r("p",{className:"text-2xl font-bold text-black dark:text-white mt-1",children:e}),s&&r("p",{className:`text-xs font-medium mt-2 ${s.type==="increase"?"text-green-600":"text-red-600"}`,children:[s.type==="increase"?"↗":"↘"," ",Math.abs(s.value),"%"]})]}),a&&r("div",{className:`flex-shrink-0 w-6 h-6 flex items-center justify-center rounded-full ${i[o]}`,children:a})]})})}function D({variant:t="primary",size:e="md",children:s,disabled:a=!1,loading:o=!1,fullWidth:n=!1,className:i="",...d}){const f="btn inline-flex items-center justify-center font-medium rounded-md disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 ease-out",u={primary:"btn-primary bg-blue-600 text-white hover:bg-blue-700 shadow-lg hover:shadow-xl shadow-blue-600/25 hover:shadow-blue-600/40 dark:bg-blue-600 dark:text-white dark:hover:bg-blue-700",secondary:"btn-secondary bg-gray-100 text-gray-900 hover:bg-gray-200 shadow-md hover:shadow-lg dark:bg-gray-700 dark:text-gray-100 dark:hover:bg-gray-600",outline:"btn-outline bg-white/80 dark:bg-gray-800/80 text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700 backdrop-blur-sm",danger:"btn-danger bg-red-600 text-white hover:bg-red-700 shadow-lg hover:shadow-xl shadow-red-600/25 hover:shadow-red-600/40 dark:bg-red-600 dark:text-white dark:hover:bg-red-700"},m={sm:"btn-sm px-3 py-2 text-sm rounded-lg",md:"btn-md px-4 py-2.5 text-sm rounded-lg",lg:"btn-lg px-6 py-3 text-base rounded-lg"},l=n?"w-full":"",h=o?"btn-loading":"",c=`${f} ${u[t]} ${m[e]} ${l} ${h} ${i}`.trim();return r("button",{className:c,disabled:a||o,...d,children:[o&&r("svg",{className:"btn-spinner animate-spin -ml-1 mr-2 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[r("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),r("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),s]})}function ft({title:t,data:e,type:s="line",height:a=300,loading:o=!1,error:n,className:i="",xLabel:d,yLabel:f}){const u=Ee(null);j(()=>{if(!u.current||!e)return;const c=u.current,_=c.getContext("2d");if(!_)return;const x=56,E=c.width-x*2,b=c.height-x*2;_.clearRect(0,0,c.width,c.height),s==="line"?m(_,e,x,E,b,d,f):s==="bar"?l(_,e,x,E,b,d,f):s==="doughnut"&&h(_,e,c.width/2,c.height/2,Math.min(c.width,c.height)/3)},[e,s]);const m=(c,_,x,E,b,S,w)=>{var W;const N=_.datasets[0];if(!N)return;const L=Math.max(...N.data),M=Math.min(...N.data),O=L-M||1;c.strokeStyle="#e5e7eb",c.lineWidth=1;for(let p=0;p<=5;p++){const g=x+b/5*p;c.beginPath(),c.moveTo(x,g),c.lineTo(x+E,g),c.stroke()}c.fillStyle="#6b7280",c.font="12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial",c.textAlign="right";for(let p=0;p<=5;p++){const g=x+b/5*p,y=L-O/5*p,A=Number.isFinite(y)?y>=100?y.toFixed(0):y.toFixed(1):"0";c.fillText(A,x-8,g+4)}w&&(c.save(),c.translate(16,x+b/2),c.rotate(-Math.PI/2),c.textAlign="center",c.fillText(w,0,0),c.restore()),c.textAlign="center";const T=N.data.length,P=Math.min(6,Math.max(2,T)),I=Math.max(1,Math.floor((T-1)/(P-1)));for(let p=0;p<T;p+=I){const g=x+E/(T-1)*p,y=((W=_.labels)==null?void 0:W[p])||"";y&&c.fillText(y,g,x+b+18)}S&&c.fillText(S,x+E/2,x+b+34),c.strokeStyle="#3b82f6",c.lineWidth=2,c.beginPath(),N.data.forEach((p,g)=>{const y=x+E/(N.data.length-1)*g,A=x+b-(p-M)/O*b;g===0?c.moveTo(y,A):c.lineTo(y,A)}),c.stroke(),c.fillStyle="#3b82f6",N.data.forEach((p,g)=>{const y=x+E/(N.data.length-1)*g,A=x+b-(p-M)/O*b;c.beginPath(),c.arc(y,A,4,0,2*Math.PI),c.fill()})},l=(c,_,x,E,b,S,w)=>{var W;const N=_.datasets[0];if(!N)return;const L=Math.max(...N.data),M=E/N.data.length*.8,O=E/N.data.length*.2;c.fillStyle="#3b82f6",N.data.forEach((p,g)=>{const y=p/L*b,A=x+g*(M+O)+O/2,F=x+b-y;c.fillRect(A,F,M,y)}),c.fillStyle="#6b7280",c.font="12px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial",c.textAlign="right";for(let p=0;p<=5;p++){const g=x+b/5*p,y=L-L/5*p,A=Number.isFinite(y)?y>=100?y.toFixed(0):y.toFixed(1):"0";c.fillText(A,x-8,g+4)}w&&(c.save(),c.translate(16,x+b/2),c.rotate(-Math.PI/2),c.textAlign="center",c.fillText(w,0,0),c.restore()),c.textAlign="center";const T=N.data.length,P=Math.min(6,Math.max(2,T)),I=Math.max(1,Math.floor((T-1)/(P-1)));for(let p=0;p<T;p+=I){const g=x+p*(M+O)+O/2+M/2,y=((W=_.labels)==null?void 0:W[p])||"";y&&c.fillText(y,g,x+b+18)}S&&c.fillText(S,x+E/2,x+b+34)},h=(c,_,x,E,b)=>{const S=_.datasets[0];if(!S)return;const w=S.data.reduce((M,O)=>M+O,0),N=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6"];let L=0;S.data.forEach((M,O)=>{const T=M/w*2*Math.PI;c.beginPath(),c.arc(x,E,b,L,L+T),c.arc(x,E,b*.6,L+T,L,!0),c.closePath(),c.fillStyle=N[O%N.length],c.fill(),L+=T})};return o?r("div",{className:`flex items-center justify-center ${i}`,style:{height:a},children:r("div",{className:"text-center",children:[r("div",{className:"w-8 h-8 border-2 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),r("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Loading chart..."})]})}):n?r("div",{className:`flex items-center justify-center ${i}`,style:{height:a},children:r("div",{className:"text-center",children:[r("svg",{className:"w-12 h-12 mx-auto mb-4 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 16.5c-.77.833.192 2.5 1.732 2.5z"})}),r("p",{className:"text-sm text-red-600 dark:text-red-400",children:n})]})}):r("div",{className:`chart-container ${i}`,children:[t&&r("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:t}),r("div",{className:"relative",children:r("canvas",{ref:u,width:800,height:a,className:"w-full h-auto"})})]})}const Qr={},pt=t=>{let e;const s=new Set,a=(m,l)=>{const h=typeof m=="function"?m(e):m;if(!Object.is(h,e)){const c=e;e=l??(typeof h!="object"||h===null)?h:Object.assign({},e,h),s.forEach(_=>_(e,c))}},o=()=>e,f={setState:a,getState:o,getInitialState:()=>u,subscribe:m=>(s.add(m),()=>s.delete(m)),destroy:()=>{(Qr?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),s.clear()}},u=e=t(a,o,f);return f},Xr=t=>t?pt(t):pt;function Bt(t,e){for(var s in e)t[s]=e[s];return t}function He(t,e){for(var s in t)if(s!=="__source"&&!(s in e))return!0;for(var a in e)if(a!=="__source"&&t[a]!==e[a])return!0;return!1}function Xe(t,e){var s=e(),a=k({t:{__:s,u:e}}),o=a[0].t,n=a[1];return de(function(){o.__=s,o.u=e,Pe(o)&&n({t:o})},[t,s,e]),j(function(){return Pe(o)&&n({t:o}),t(function(){Pe(o)&&n({t:o})})},[t]),s}function Pe(t){var e,s,a=t.u,o=t.__;try{var n=a();return!((e=o)===(s=n)&&(e!==0||1/e==1/s)||e!=e&&s!=s)}catch{return!0}}function Ye(t){t()}function Ke(t){return t}function et(){return[!1,Ye]}var tt=de;function Se(t,e){this.props=t,this.context=e}function Jt(t,e){function s(o){var n=this.props.ref,i=n==o.ref;return!i&&n&&(n.call?n(null):n.current=null),e?!e(this.props,o)||!i:He(this.props,o)}function a(o){return this.shouldComponentUpdate=s,Y(t,o)}return a.displayName="Memo("+(t.displayName||t.name)+")",a.prototype.isReactComponent=!0,a.__f=!0,a.type=t,a}(Se.prototype=new Q).isPureReactComponent=!0,Se.prototype.shouldComponentUpdate=function(t,e){return He(this.props,t)||He(this.state,e)};var gt=U.__b;U.__b=function(t){t.type&&t.type.__f&&t.ref&&(t.props.ref=t.ref,t.ref=null),gt&&gt(t)};var Yr=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function Zt(t){function e(s){var a=Bt({},s);return delete a.ref,t(a,s.ref||null)}return e.$$typeof=Yr,e.render=t,e.prototype.isReactComponent=e.__f=!0,e.displayName="ForwardRef("+(t.displayName||t.name)+")",e}var yt=function(t,e){return t==null?null:K(K(t).map(e))},Qt={map:yt,forEach:yt,count:function(t){return t?K(t).length:0},only:function(t){var e=K(t);if(e.length!==1)throw"Children.only";return e[0]},toArray:K},Kr=U.__e;U.__e=function(t,e,s,a){if(t.then){for(var o,n=e;n=n.__;)if((o=n.__c)&&o.__c)return e.__e==null&&(e.__e=s.__e,e.__k=s.__k),o.__c(t,e)}Kr(t,e,s,a)};var _t=U.unmount;function Xt(t,e,s){return t&&(t.__c&&t.__c.__H&&(t.__c.__H.__.forEach(function(a){typeof a.__c=="function"&&a.__c()}),t.__c.__H=null),(t=Bt({},t)).__c!=null&&(t.__c.__P===s&&(t.__c.__P=e),t.__c.__e=!0,t.__c=null),t.__k=t.__k&&t.__k.map(function(a){return Xt(a,e,s)})),t}function Yt(t,e,s){return t&&s&&(t.__v=null,t.__k=t.__k&&t.__k.map(function(a){return Yt(a,e,s)}),t.__c&&t.__c.__P===e&&(t.__e&&s.appendChild(t.__e),t.__c.__e=!0,t.__c.__P=s)),t}function me(){this.__u=0,this.o=null,this.__b=null}function Kt(t){var e=t.__.__c;return e&&e.__a&&e.__a(t)}function er(t){var e,s,a;function o(n){if(e||(e=t()).then(function(i){s=i.default||i},function(i){a=i}),a)throw a;if(!s)throw e;return Y(s,n)}return o.displayName="Lazy",o.__f=!0,o}function ne(){this.i=null,this.l=null}U.unmount=function(t){var e=t.__c;e&&e.__R&&e.__R(),e&&32&t.__u&&(t.type=null),_t&&_t(t)},(me.prototype=new Q).__c=function(t,e){var s=e.__c,a=this;a.o==null&&(a.o=[]),a.o.push(s);var o=Kt(a.__v),n=!1,i=function(){n||(n=!0,s.__R=null,o?o(d):d())};s.__R=i;var d=function(){if(!--a.__u){if(a.state.__a){var f=a.state.__a;a.__v.__k[0]=Yt(f,f.__c.__P,f.__c.__O)}var u;for(a.setState({__a:a.__b=null});u=a.o.pop();)u.forceUpdate()}};a.__u++||32&e.__u||a.setState({__a:a.__b=a.__v.__k[0]}),t.then(i,i)},me.prototype.componentWillUnmount=function(){this.o=[]},me.prototype.render=function(t,e){if(this.__b){if(this.__v.__k){var s=document.createElement("div"),a=this.__v.__k[0].__c;this.__v.__k[0]=Xt(this.__b,s,a.__O=a.__P)}this.__b=null}var o=e.__a&&Y(Z,null,t.fallback);return o&&(o.__u&=-33),[Y(Z,null,e.__a?null:t.children),o]};var vt=function(t,e,s){if(++s[1]===s[0]&&t.l.delete(e),t.props.revealOrder&&(t.props.revealOrder[0]!=="t"||!t.l.size))for(s=t.i;s;){for(;s.length>3;)s.pop()();if(s[1]<s[0])break;t.i=s=s[2]}};function es(t){return this.getChildContext=function(){return t.context},t.children}function ts(t){var e=this,s=t.h;if(e.componentWillUnmount=function(){ie(null,e.v),e.v=null,e.h=null},e.h&&e.h!==s&&e.componentWillUnmount(),!e.v){for(var a=e.__v;a!==null&&!a.__m&&a.__!==null;)a=a.__;e.h=s,e.v={nodeType:1,parentNode:s,childNodes:[],__k:{__m:a.__m},contains:function(){return!0},insertBefore:function(o,n){this.childNodes.push(o),e.h.insertBefore(o,n)},removeChild:function(o){this.childNodes.splice(this.childNodes.indexOf(o)>>>1,1),e.h.removeChild(o)}}}ie(Y(es,{context:e.context},t.__v),e.v)}function tr(t,e){var s=Y(ts,{__v:t,h:e});return s.containerInfo=e,s}(ne.prototype=new Q).__a=function(t){var e=this,s=Kt(e.__v),a=e.l.get(t);return a[0]++,function(o){var n=function(){e.props.revealOrder?(a.push(o),vt(e,t,a)):o()};s?s(n):n()}},ne.prototype.render=function(t){this.i=null,this.l=new Map;var e=K(t.children);t.revealOrder&&t.revealOrder[0]==="b"&&e.reverse();for(var s=e.length;s--;)this.l.set(e[s],this.i=[1,0,this.i]);return t.children},ne.prototype.componentDidUpdate=ne.prototype.componentDidMount=function(){var t=this;this.l.forEach(function(e,s){vt(t,s,e)})};var rr=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,rs=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,ss=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,as=/[A-Z0-9]/g,ns=typeof document<"u",os=function(t){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(t)};function sr(t,e,s){return e.__k==null&&(e.textContent=""),ie(t,e),typeof s=="function"&&s(),t?t.__c:null}function ar(t,e,s){return zt(t,e),typeof s=="function"&&s(),t?t.__c:null}Q.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(t){Object.defineProperty(Q.prototype,t,{configurable:!0,get:function(){return this["UNSAFE_"+t]},set:function(e){Object.defineProperty(this,t,{configurable:!0,writable:!0,value:e})}})});var bt=U.event;function is(){}function ls(){return this.cancelBubble}function cs(){return this.defaultPrevented}U.event=function(t){return bt&&(t=bt(t)),t.persist=is,t.isPropagationStopped=ls,t.isDefaultPrevented=cs,t.nativeEvent=t};var rt,ds={enumerable:!1,configurable:!0,get:function(){return this.class}},xt=U.vnode;U.vnode=function(t){typeof t.type=="string"&&function(e){var s=e.props,a=e.type,o={},n=a.indexOf("-")===-1;for(var i in s){var d=s[i];if(!(i==="value"&&"defaultValue"in s&&d==null||ns&&i==="children"&&a==="noscript"||i==="class"||i==="className")){var f=i.toLowerCase();i==="defaultValue"&&"value"in s&&s.value==null?i="value":i==="download"&&d===!0?d="":f==="translate"&&d==="no"?d=!1:f[0]==="o"&&f[1]==="n"?f==="ondoubleclick"?i="ondblclick":f!=="onchange"||a!=="input"&&a!=="textarea"||os(s.type)?f==="onfocus"?i="onfocusin":f==="onblur"?i="onfocusout":ss.test(i)&&(i=f):f=i="oninput":n&&rs.test(i)?i=i.replace(as,"-$&").toLowerCase():d===null&&(d=void 0),f==="oninput"&&o[i=f]&&(i="oninputCapture"),o[i]=d}}a=="select"&&o.multiple&&Array.isArray(o.value)&&(o.value=K(s.children).forEach(function(u){u.props.selected=o.value.indexOf(u.props.value)!=-1})),a=="select"&&o.defaultValue!=null&&(o.value=K(s.children).forEach(function(u){u.props.selected=o.multiple?o.defaultValue.indexOf(u.props.value)!=-1:o.defaultValue==u.props.value})),s.class&&!s.className?(o.class=s.class,Object.defineProperty(o,"className",ds)):(s.className&&!s.class||s.class&&s.className)&&(o.class=o.className=s.className),e.props=o}(t),t.$$typeof=rr,xt&&xt(t)};var wt=U.__r;U.__r=function(t){wt&&wt(t),rt=t.__c};var kt=U.diffed;U.diffed=function(t){kt&&kt(t);var e=t.props,s=t.__e;s!=null&&t.type==="textarea"&&"value"in e&&e.value!==s.value&&(s.value=e.value==null?"":e.value),rt=null};var nr={ReactCurrentDispatcher:{current:{readContext:function(t){return rt.__n[t.__c].props.value},useCallback:Ve,useContext:Be,useDebugValue:Je,useDeferredValue:Ke,useEffect:j,useId:Ze,useImperativeHandle:qe,useInsertionEffect:tt,useLayoutEffect:de,useMemo:te,useReducer:Ce,useRef:Ee,useState:k,useSyncExternalStore:Xe,useTransition:et}}},us="18.3.1";function or(t){return Y.bind(null,t)}function ye(t){return!!t&&t.$$typeof===rr}function ir(t){return ye(t)&&t.type===Z}function lr(t){return!!t&&!!t.displayName&&(typeof t.displayName=="string"||t.displayName instanceof String)&&t.displayName.startsWith("Memo(")}function cr(t){return ye(t)?Fr.apply(null,arguments):t}function dr(t){return!!t.__k&&(ie(null,t),!0)}function ur(t){return t&&(t.base||t.nodeType===1&&t)||null}var hr=function(t,e){return t(e)},mr=function(t,e){return t(e)},fr=Z,pr=ye,gr={useState:k,useId:Ze,useReducer:Ce,useEffect:j,useLayoutEffect:de,useInsertionEffect:tt,useTransition:et,useDeferredValue:Ke,useSyncExternalStore:Xe,startTransition:Ye,useRef:Ee,useImperativeHandle:qe,useMemo:te,useCallback:Ve,useContext:Be,useDebugValue:Je,version:"18.3.1",Children:Qt,render:sr,hydrate:ar,unmountComponentAtNode:dr,createPortal:tr,createElement:Y,createContext:Gt,createFactory:or,cloneElement:cr,createRef:Dt,Fragment:Z,isValidElement:ye,isElement:pr,isFragment:ir,isMemo:lr,findDOMNode:ur,Component:Q,PureComponent:Se,memo:Jt,forwardRef:Zt,flushSync:mr,unstable_batchedUpdates:hr,StrictMode:fr,Suspense:me,SuspenseList:ne,lazy:er,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:nr};const hs=Object.freeze(Object.defineProperty({__proto__:null,Children:Qt,Component:Q,Fragment:Z,PureComponent:Se,StrictMode:fr,Suspense:me,SuspenseList:ne,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:nr,cloneElement:cr,createContext:Gt,createElement:Y,createFactory:or,createPortal:tr,createRef:Dt,default:gr,findDOMNode:ur,flushSync:mr,forwardRef:Zt,hydrate:ar,isElement:pr,isFragment:ir,isMemo:lr,isValidElement:ye,lazy:er,memo:Jt,render:sr,startTransition:Ye,unmountComponentAtNode:dr,unstable_batchedUpdates:hr,useCallback:Ve,useContext:Be,useDebugValue:Je,useDeferredValue:Ke,useEffect:j,useErrorBoundary:Gr,useId:Ze,useImperativeHandle:qe,useInsertionEffect:tt,useLayoutEffect:de,useMemo:te,useReducer:Ce,useRef:Ee,useState:k,useSyncExternalStore:Xe,useTransition:et,version:us},Symbol.toStringTag,{value:"Module"}));function ms(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function fs(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var s=function a(){return this instanceof a?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};s.prototype=e.prototype}else s={};return Object.defineProperty(s,"__esModule",{value:!0}),Object.keys(t).forEach(function(a){var o=Object.getOwnPropertyDescriptor(t,a);Object.defineProperty(s,a,o.get?o:{enumerable:!0,get:function(){return t[a]}})}),s}var yr={exports:{}},_r={};const vr=fs(hs);var br={exports:{}},xr={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ce=vr;function ps(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var gs=typeof Object.is=="function"?Object.is:ps,ys=ce.useState,_s=ce.useEffect,vs=ce.useLayoutEffect,bs=ce.useDebugValue;function xs(t,e){var s=e(),a=ys({inst:{value:s,getSnapshot:e}}),o=a[0].inst,n=a[1];return vs(function(){o.value=s,o.getSnapshot=e,$e(o)&&n({inst:o})},[t,s,e]),_s(function(){return $e(o)&&n({inst:o}),t(function(){$e(o)&&n({inst:o})})},[t]),bs(s),s}function $e(t){var e=t.getSnapshot;t=t.value;try{var s=e();return!gs(t,s)}catch{return!0}}function ws(t,e){return e()}var ks=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?ws:xs;xr.useSyncExternalStore=ce.useSyncExternalStore!==void 0?ce.useSyncExternalStore:ks;br.exports=xr;var Ns=br.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Te=vr,Ss=Ns;function Cs(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Es=typeof Object.is=="function"?Object.is:Cs,Ts=Ss.useSyncExternalStore,Rs=Te.useRef,Ls=Te.useEffect,Ps=Te.useMemo,$s=Te.useDebugValue;_r.useSyncExternalStoreWithSelector=function(t,e,s,a,o){var n=Rs(null);if(n.current===null){var i={hasValue:!1,value:null};n.current=i}else i=n.current;n=Ps(function(){function f(c){if(!u){if(u=!0,m=c,c=a(c),o!==void 0&&i.hasValue){var _=i.value;if(o(_,c))return l=_}return l=c}if(_=l,Es(m,c))return _;var x=a(c);return o!==void 0&&o(_,x)?(m=c,_):(m=c,l=x)}var u=!1,m,l,h=s===void 0?null:s;return[function(){return f(e())},h===null?void 0:function(){return f(h())}]},[e,s,a,o]);var d=Ts(t,n[0],n[1]);return Ls(function(){i.hasValue=!0,i.value=d},[d]),$s(d),d};yr.exports=_r;var Us=yr.exports;const As=ms(Us),wr={},{useDebugValue:Ms}=gr,{useSyncExternalStoreWithSelector:Ds}=As;let Nt=!1;const Os=t=>t;function Ws(t,e=Os,s){(wr?"production":void 0)!=="production"&&s&&!Nt&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),Nt=!0);const a=Ds(t.subscribe,t.getState,t.getServerState||t.getInitialState,e,s);return Ms(a),a}const St=t=>{(wr?"production":void 0)!=="production"&&typeof t!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const e=typeof t=="function"?Xr(t):t,s=(a,o)=>Ws(e,a,o);return Object.assign(s,e),s},_e=t=>t?St(t):St,kr=_e(t=>({ruleGroups:[],loading:!1,error:null,setRuleGroups:e=>t({ruleGroups:e,error:null}),addRuleGroup:e=>t(s=>({ruleGroups:[...s.ruleGroups.filter(a=>a.name!==e.name),e]})),updateRuleGroup:(e,s)=>t(a=>({ruleGroups:a.ruleGroups.map(o=>o.name===e?s:o)})),removeRuleGroup:e=>t(s=>({ruleGroups:s.ruleGroups.filter(a=>a.name!==e)})),setLoading:e=>t({loading:e}),setError:e=>t({error:e})})),Nr=_e(t=>({upstreams:[],loading:!1,error:null,setUpstreams:e=>t({upstreams:e,error:null}),addUpstream:e=>t(s=>({upstreams:[...s.upstreams,e]})),removeUpstream:e=>t(s=>({upstreams:s.upstreams.filter(a=>a.address!==e)})),setLoading:e=>t({loading:e}),setError:e=>t({error:e})})),Sr=_e(t=>({stats:null,loading:!1,error:null,setStats:e=>t({stats:e,error:null}),setLoading:e=>t({loading:e}),setError:e=>t({error:e})})),Cr=_e(t=>({info:null,loading:!1,error:null,setInfo:e=>t({info:e,error:null}),setLoading:e=>t({loading:e}),setError:e=>t({error:e})})),Er=_e(t=>({events:[],loading:!1,error:null,setEvents:e=>t({events:e,error:null}),addEvent:e=>t(s=>({events:[e,...s.events].slice(0,2e3)})),setLoading:e=>t({loading:e}),setError:e=>t({error:e})})),Tr=()=>kr(t=>t.ruleGroups),Rr=()=>kr(t=>({setRuleGroups:t.setRuleGroups,addRuleGroup:t.addRuleGroup,updateRuleGroup:t.updateRuleGroup,removeRuleGroup:t.removeRuleGroup,setLoading:t.setLoading,setError:t.setError})),Lr=()=>Nr(t=>t.upstreams),Pr=()=>Nr(t=>({setUpstreams:t.setUpstreams,addUpstream:t.addUpstream,removeUpstream:t.removeUpstream,setLoading:t.setLoading,setError:t.setError})),Is=()=>Sr(t=>t.stats),Hs=()=>Sr(t=>({setStats:t.setStats,setLoading:t.setLoading,setError:t.setError})),js=()=>Er(t=>t.events),Fs=()=>Er(t=>({setEvents:t.setEvents,addEvent:t.addEvent,setLoading:t.setLoading,setError:t.setError})),zs=()=>Cr(t=>t.info),Gs=()=>Cr(t=>({setInfo:t.setInfo,setLoading:t.setLoading,setError:t.setError})),Ue=[{label:"1m",seconds:60},{label:"5m",seconds:300},{label:"15m",seconds:900}],qs={1:"A",28:"AAAA",2:"NS",5:"CNAME",6:"SOA",12:"PTR",15:"MX",16:"TXT",33:"SRV"};function Vs({provider:t}){const e=Is(),{setStats:s,setError:a}=Hs(),o=Tr(),n=Lr(),i=zs(),{setRuleGroups:d,setError:f}=Rr(),{setUpstreams:u,setError:m}=Pr(),{setInfo:l,setError:h}=Gs(),[c,_]=k(Ue[1]),[x,E]=k([]),[b,S]=k([]),w=y=>{window.location.hash=y,window.scrollTo(0,0)};j(()=>{const y=t.onStats(s),A=t.onRuleGroups(d),F=t.onUpstreams(u),B=t.onOverview?t.onOverview(R=>{R!=null&&R.stats&&s(R.stats);try{window.__ov=R}catch{}L(R)}):()=>{};return t.fetchStats().then(s).catch(R=>a(R.message)),t.fetchRuleGroups().then(d).catch(R=>f(R.message)),t.fetchUpstreams().then(u).catch(R=>m(R.message)),t.fetchServerInfo().then(l).catch(R=>h(R.message)),t.fetchOverview&&t.fetchOverview().then(R=>{R!=null&&R.stats&&s(R.stats),L(R);try{window.__ov=R}catch{}}).catch(()=>{}),()=>{y(),A(),F(),B()}},[t,s,d,u,a,f,m,l,h]);const[N,L]=k(null);j(()=>{if(!e)return;const y=30,A=e.effective_rps??(e.dns_queries_total?e.dns_queries_total/60:0);E(B=>{const R=[...B,Math.max(0,Number(A||0))];return R.length>y&&R.shift(),R});const F=(e.dns_request_avg_seconds??0)*1e3;S(B=>{const R=[...B,Math.max(0,Number(F||0))];return R.length>y&&R.shift(),R})},[e]);const M=(e==null?void 0:e.effective_rps)??(e?e.dns_queries_total/60:0),O=e!=null&&e.dns_request_avg_seconds?e.dns_request_avg_seconds*1e3:0,T=n?n.length:0,P=o?o.reduce((y,A)=>y+A.patterns.length,0):0,I=(()=>{if(!e)return null;const y=e.cache_hit_rate;return y==null||(e.dns_queries_total||0)===0?null:y})(),W=y=>Array.from({length:y},()=>""),p={labels:W(x.length),datasets:[{label:"RPS",data:x,borderColor:"#3b82f6",backgroundColor:"#3b82f6",fill:!1}]},g={labels:W(b.length),datasets:[{label:"Avg RT (ms)",data:b,borderColor:"#10b981",backgroundColor:"#10b981",fill:!1}]};return r("div",{className:"space-y-6",children:[r("div",{className:"flex items-center justify-between",children:[r("div",{children:[r("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Dashboard"}),r("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Monitor your DNS proxy performance and configuration"})]}),r("div",{className:"flex items-center space-x-4",children:r("select",{value:c.ms,onChange:y=>{const A=Ue.find(F=>F.ms===parseInt(y.currentTarget.value));A&&_(A)},className:"px-3 py-2 text-sm border border-gray-300 rounded-md bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:text-gray-100 dark:border-gray-600 dark:focus:border-blue-400 dark:focus:ring-blue-400",children:Ue.map(y=>r("option",{value:y.ms,children:y.label},y.ms))})})]}),r("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[r(be,{title:"DNS RPS",value:M.toFixed(1),icon:r("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),color:"blue",loading:!e}),r(be,{title:"Response Time",value:`${O.toFixed(0)}ms`,icon:r("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),color:"green",loading:!e}),r(be,{title:"Active Upstreams",value:T,icon:r("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),color:"purple",loading:!n}),r(be,{title:"Total Rules",value:P,icon:r("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),color:"indigo",loading:!o})]}),r("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[r(V,{title:"DNS Queries Over Time",subtitle:`Last ${c.label}`,children:r(ft,{data:p,type:"line",height:256,xLabel:"time",yLabel:"RPS",loading:!e})}),r(V,{title:"Response Time Over Time",subtitle:`Last ${c.label}`,children:r(ft,{data:g,type:"line",height:256,xLabel:"time",yLabel:"ms",loading:!e})})]}),r("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[r(V,{title:"Service Status",className:"lg:col-span-2",children:r("div",{className:"space-y-4",children:[r("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[r("div",{className:"flex items-center",children:[r("div",{className:`w-3 h-3 rounded-full mr-3 ${(e==null?void 0:e.service_ready)===1?"bg-green-500":"bg-red-500"}`}),r("div",{children:[r("p",{className:"font-medium text-gray-900 dark:text-white",children:"DNS Proxy"}),r("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:(e==null?void 0:e.service_ready)===1?"Running":"Stopped"})]})]}),r("div",{className:"text-right",children:[r("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Uptime"}),r("p",{className:"font-medium text-gray-900 dark:text-white",children:(N==null?void 0:N.uptime)??(i?i.uptime:"Unknown")})]})]}),r("div",{className:"grid grid-cols-2 gap-4",children:[r("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[r("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Cache hit rate"}),r("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:I==null?"N/A":`${(I*100).toFixed(2)}%`})]}),r("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[r("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Queries (1m)"}),r("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[(N==null?void 0:N.queries_last_min)??"N/A",N!=null&&N.errors_last_min?` (${N==null?void 0:N.errors_last_min} errors)`:""]})]})]})]})}),r(V,{title:"Quick Actions",children:r("div",{className:"space-y-3",children:[r(D,{variant:"outline",fullWidth:!0,className:"justify-start hover:scale-[1.01] transition-transform",onClick:()=>w("rules"),children:[r("svg",{className:"w-5 h-5 mr-3 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Add New Rule"]}),r(D,{variant:"outline",fullWidth:!0,className:"justify-start hover:scale-[1.01] transition-transform",onClick:()=>w("upstreams"),children:[r("svg",{className:"w-5 h-5 mr-3 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),"Add Upstream"]})]})})]})]})}function G({label:t,error:e,hint:s,required:a=!1,className:o="",id:n,...i}){const d=n||`input-${Math.random().toString(36).substr(2,9)}`,h=`input-field block w-full px-3 py-2 h-[42px] text-sm rounded-md border transition-all duration-200 ease-out focus:outline-none focus:ring-2 disabled:opacity-50 disabled:cursor-not-allowed bg-white text-gray-900 placeholder-gray-500 border-gray-300 hover:border-gray-400 focus:border-blue-500 focus:ring-blue-500 disabled:bg-gray-50 disabled:border-gray-300 dark:bg-gray-800 dark:text-gray-100 dark:placeholder-gray-400 dark:border-gray-600 dark:hover:border-gray-500 dark:focus:border-blue-400 dark:focus:ring-blue-400 dark:disabled:bg-gray-700 dark:disabled:border-gray-600 ${e?"border-red-500 focus:border-red-500 focus:ring-red-500 dark:border-red-400 dark:focus:border-red-400 dark:focus:ring-red-400":""} ${o}`.trim();return r("div",{className:"input-container space-y-1",children:[t&&r("label",{htmlFor:d,className:"input-label block text-sm font-medium text-gray-700 dark:text-gray-300",children:[t,a&&r("span",{className:"text-red-500 ml-1",children:"*"})]}),r("input",{id:d,className:h,...i}),s&&!e&&r("p",{className:"input-hint text-xs text-gray-500 dark:text-gray-400",children:s}),e&&r("p",{className:"input-error text-xs text-red-600 dark:text-red-400",children:e})]})}function Bs({provider:t}){const[e,s]=k(""),[a,o]=k("A"),[n,i]=k(""),[d,f]=k(!1),u=l=>{let h=(l||"").trim();if(!h)return h;h.startsWith("@")&&(h=h.slice(1));try{return new URL(h).hostname||h}catch{}try{return new URL(/^https?:\/\//i.test(h)?h:`http://${h}`).hostname||h}catch{}return h=h.replace(/^\w+:\/\//,""),h=h.replace(/\/.*$/,""),h};return r("div",{className:"space-y-6",children:[r("div",{children:[r("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Resolve"}),r("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Run a test DNS resolve via the active pipeline"})]}),r(V,{children:r("form",{onSubmit:async l=>{if(l.preventDefault(),!!e.trim()){f(!0),i("");try{const h=u(e),c=await t.testResolve(h,a),_=[`Upstream: ${c.upstream}`,`RCODE: ${c.rcode}`,`Answers: ${c.answers}`];c.response_time_ms!==void 0&&_.push(`Time: ${c.response_time_ms}ms`),c.ttl!==void 0&&_.push(`TTL: ${c.ttl}s`);const x=_.join(" | "),E=(c.records||[]).join(`
`);i(`${x}
${E}`)}catch(h){i(h.message)}finally{f(!1)}}},className:"space-y-4",children:[r("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[r(G,{label:"Domain",value:e,onInput:l=>s(l.target.value),placeholder:"example.com or https://www.example.com",required:!0}),r("div",{children:[r("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Type"}),r("select",{className:"w-full px-3 py-2 h-[42px] border border-gray-300 rounded-md bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:text-gray-100 dark:border-gray-600 dark:focus:border-blue-400 dark:focus:ring-blue-400",value:a,onChange:l=>o(l.currentTarget.value),children:[r("option",{value:"A",children:"A"}),r("option",{value:"AAAA",children:"AAAA"}),r("option",{value:"CNAME",children:"CNAME"}),r("option",{value:"MX",children:"MX"}),r("option",{value:"NS",children:"NS"}),r("option",{value:"TXT",children:"TXT"}),r("option",{value:"SRV",children:"SRV"}),r("option",{value:"PTR",children:"PTR"})]})]}),r("div",{className:"flex items-end",children:r(D,{type:"submit",variant:"primary",fullWidth:!0,loading:d,disabled:d,children:d?"Resolving…":"Resolve"})})]}),n&&r("div",{children:[r("div",{className:"flex items-center justify-between mb-2",children:[r("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Result"}),r("div",{className:"flex gap-2",children:[r(D,{type:"button",variant:"outline",size:"sm",onClick:()=>navigator.clipboard.writeText(n),children:"Copy"}),r(D,{type:"button",variant:"secondary",size:"sm",onClick:()=>i(""),children:"Clear"})]})]}),r("pre",{className:"mt-1 p-3 rounded-md bg-gray-50 text-gray-800 dark:bg-gray-900 dark:text-gray-200 whitespace-pre-wrap text-sm border border-gray-200 dark:border-gray-700 font-mono leading-6 max-h-96 overflow-auto",children:n})]})]})})]})}function ke({children:t,variant:e="default",size:s="md",className:a="",...o}){const n="badge inline-flex items-center rounded-md font-medium",i={default:"bg-gray-100 text-gray-900 dark:bg-gray-800 dark:text-gray-100",primary:"bg-blue-600 text-white dark:bg-blue-600 dark:text-white",secondary:"bg-gray-200 text-gray-900 dark:bg-gray-700 dark:text-gray-100"},d={sm:"px-2 py-0.5 text-xs",md:"px-2.5 py-1 text-sm"},f=`${n} ${i[e]} ${d[s]} ${a}`.trim();return r("span",{className:f,...o,children:t})}const Js=[{id:"overview",label:"Overview",icon:r("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"}),r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 5a2 2 0 012-2h4a2 2 0 012 2v6H8V5z"})]})},{id:"rules",label:"Rules",icon:r("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})},{id:"upstreams",label:"Upstreams",icon:r("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})})},{id:"history",label:"History",icon:r("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})},{id:"hosts",label:"Hosts",icon:r("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7h18M3 12h18M3 17h18"})})},{id:"localdns",label:"Local DNS",icon:r("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})},{id:"resolve",label:"Resolve",icon:r("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3M3 11h18M5 19h14a2 2 0 002-2v-6H3v6a2 2 0 002 2z"})})},{id:"cache",label:"Cache",icon:r("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 10h16M4 14h16M4 18h16"})})},{id:"update",label:"Updates",icon:r("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}];function Zs({activeTab:t,onTabChange:e,collapsed:s=!1}){return r("aside",{className:`fixed left-0 top-0 z-40 h-screen bg-white/95 dark:bg-gray-800/95 backdrop-blur-sm border-r border-gray-100 dark:border-gray-700 transition-all duration-300 ${s?"w-16":"w-64"} ${s?"-translate-x-full lg:translate-x-0":"translate-x-0"} lg:translate-x-0`,children:[r("div",{className:"flex items-center justify-between h-16 px-3 border-b border-gray-100 dark:border-gray-700",children:[!s&&r("div",{className:"flex items-center space-x-2",children:[r("div",{className:"w-7 h-7 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center shadow-sm",children:r("span",{className:"text-white font-bold text-sm",children:"O"})}),r("span",{className:"text-lg font-semibold text-gray-900 dark:text-white tracking-tight",children:"Outway"})]}),s&&r("div",{className:"w-7 h-7 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center mx-auto shadow-sm",children:r("span",{className:"text-white font-bold text-sm",children:"O"})})]}),r("nav",{className:"flex-1 px-3 py-4 space-y-1 overflow-y-auto",children:Js.map(a=>{const o=t===a.id;return r("button",{onClick:()=>e(a.id),className:`w-full flex items-center px-3 py-2.5 text-sm font-medium rounded-xl transition-all duration-200 ${o?"bg-blue-600 text-white shadow-lg shadow-blue-600/25":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white"}`,children:[r("span",{className:`flex-shrink-0 ${s?"mx-auto":"mr-3"}`,children:a.icon}),!s&&r("span",{className:"truncate font-medium",children:a.label})]},a.id)})}),r("div",{className:"p-3 border-t border-gray-100 dark:border-gray-700",children:[!s&&r("div",{className:"flex items-center space-x-3",children:[r("div",{className:"w-8 h-8 bg-gradient-to-br from-gray-300 to-gray-400 dark:from-gray-600 dark:to-gray-700 rounded-full flex items-center justify-center shadow-sm",children:r("span",{className:"text-xs font-semibold text-gray-700 dark:text-gray-200",children:"A"})}),r("div",{className:"flex-1 min-w-0",children:[r("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:"Admin"}),r("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:"outway@example.com"})]})]}),s&&r("div",{className:"flex justify-center",children:r("div",{className:"w-8 h-8 bg-gradient-to-br from-gray-300 to-gray-400 dark:from-gray-600 dark:to-gray-700 rounded-full flex items-center justify-center shadow-sm",children:r("span",{className:"text-xs font-semibold text-gray-700 dark:text-gray-200",children:"A"})})})]})]})}const Ct="outway-theme";function $r(){const[t,e]=k(()=>typeof window>"u"?"auto":localStorage.getItem(Ct)||"auto"),[s,a]=k("light");return j(()=>{const n=()=>{if(t==="auto"){const i=window.matchMedia("(prefers-color-scheme: dark)").matches;a(i?"dark":"light")}else a(t)};if(n(),t==="auto"){const i=window.matchMedia("(prefers-color-scheme: dark)"),d=()=>n();return i.addEventListener("change",d),()=>i.removeEventListener("change",d)}},[t]),j(()=>{const n=document.documentElement;s==="dark"?n.classList.add("dark"):n.classList.remove("dark")},[s]),j(()=>{typeof window<"u"&&localStorage.setItem(Ct,t)},[t]),{theme:t,resolvedTheme:s,setTheme:n=>{e(n)}}}function Qs({className:t="",showLabel:e=!1,variant:s="select",...a}){const{theme:o,resolvedTheme:n,setTheme:i}=$r(),d=h=>{i(h)},f=()=>{const h=["light","dark","auto"],_=(h.indexOf(o)+1)%h.length;i(h[_])},u=()=>{switch(o){case"light":return r("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})});case"dark":return r("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})});case"auto":return r("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}},m=()=>{switch(o){case"light":return"Light theme";case"dark":return"Dark theme";case"auto":return`Auto theme (${n})`}},l=[{value:"light",label:"Light",icon:"☀️"},{value:"dark",label:"Dark",icon:"🌙"},{value:"auto",label:"Auto",icon:"🔄"}];return s==="button"?r("div",{className:`flex items-center gap-2 ${t}`,...a,children:[r("button",{onClick:f,className:"p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-500 dark:text-gray-400 transition-colors duration-200","aria-label":m(),title:m(),children:u()}),e&&r("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:o==="auto"?`Auto (${n})`:o})]}):r("div",{className:`theme-toggle ${t}`,...a,children:r("select",{value:o,onChange:h=>d(h.currentTarget.value),className:"theme-select",children:l.map(h=>r("option",{value:h.value,children:[h.icon," ",h.label]},h.value))})})}function Xs({onSidebarToggle:t,provider:e}){const[s,a]=k("ws");return j(()=>{if(!e||!e.onStatus)return;const o=e.onStatus(n=>a(n.channel));return()=>{o&&o()}},[e]),r("header",{className:"sticky top-0 z-30 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-b border-gray-100 dark:border-gray-700",children:r("div",{className:"flex items-center justify-between h-14 px-4",children:[r("div",{className:"flex items-center gap-3",children:[t&&r("button",{onClick:t,className:"p-1.5 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-300 transition-all duration-200","aria-label":"Toggle sidebar",children:r("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 6h16M4 12h16M4 18h16"})})}),r("div",{className:"flex items-center lg:hidden select-none",children:[r("div",{className:"w-6 h-6 bg-gradient-to-br from-blue-500 to-blue-600 rounded flex items-center justify-center shadow-sm mr-2",children:r("span",{className:"text-white font-bold text-xs",children:"O"})}),r("span",{className:"text-sm font-semibold text-gray-900 dark:text-white tracking-tight",children:"Outway"})]})]}),r("div",{className:"flex items-center gap-2",children:[r("span",{className:`px-2 py-0.5 text-xs rounded-full ${s==="ws"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300":"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-300"}`,title:s==="ws"?"WebSocket live":"REST fallback",children:s.toUpperCase()}),(e==null?void 0:e.reconnect)&&s==="rest"&&r("button",{className:"inline-flex items-center gap-1 text-xs px-2 py-1 rounded-md border border-gray-300 dark:border-gray-600/50 text-gray-700 dark:text-gray-200 bg-transparent hover:bg-gray-50 dark:hover:bg-gray-700/50",title:"Try reconnect WebSocket",onClick:()=>e.reconnect&&e.reconnect(),children:[r("svg",{className:"w-3.5 h-3.5",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:r("path",{fillRule:"evenodd",d:"M4.083 9.75A6.75 6.75 0 0117.5 10a.75.75 0 001.5 0A8.25 8.25 0 103.5 15.398V13a.75.75 0 00-1.5 0v4a.75.75 0 00.75.75H7a.75.75 0 000-1.5H4.84A6.73 6.73 0 014.083 9.75z",clipRule:"evenodd"})}),"Reconnect"]}),r("div",{className:"mx-1",children:r(Qs,{variant:"button"})})]})]})})}function Ys({children:t,className:e=""}){return r("div",{className:`overflow-auto border border-gray-200 dark:border-gray-700 rounded-lg ${e}`,children:r("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:t})})}function Ks({children:t}){return r("thead",{className:"bg-gray-50 dark:bg-gray-900",children:t})}function Ae({children:t}){return r("tr",{children:t})}function Et({children:t,sortable:e=!1,active:s=!1,order:a="asc",onClick:o}){return r("th",{onClick:o,className:`px-4 py-2 text-left text-xs font-medium uppercase tracking-wider ${e?"cursor-pointer select-none":""} text-gray-500 dark:text-gray-400`,children:r("span",{className:"inline-flex items-center gap-1",children:[t,e&&s&&r("svg",{className:"w-3 h-3",viewBox:"0 0 20 20",fill:"currentColor",children:r("path",{d:a==="asc"?"M5 12l5-5 5 5H5z":"M5 8l5 5 5-5H5z"})})]})})}function ea({children:t}){return r("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:t})}function ae({children:t,align:e="left",colSpan:s,title:a}){return r("td",{className:`px-4 py-2 text-sm ${e==="right"?"text-right":""}`,colSpan:s,title:a,children:t})}function Tt({isOpen:t,title:e,children:s,onClose:a,primaryAction:o,secondaryAction:n,size:i="md",className:d=""}){return j(()=>{const u=m=>{m.key==="Escape"&&t&&a()};return t&&(document.addEventListener("keydown",u),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",u),document.body.style.overflow="unset"}},[t,a]),t?r("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[r("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:a}),r("div",{className:"flex min-h-full items-center justify-center p-4",children:r("div",{className:`relative w-full ${{sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"}[i]} transform overflow-hidden rounded-lg bg-white dark:bg-gray-800 shadow-xl transition-all ${d}`,children:[e&&r("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:r("div",{className:"flex items-center justify-between",children:[r("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:e}),r("button",{onClick:a,className:"p-1 rounded-md text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",children:r("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),r("div",{className:"px-6 py-4",children:s}),(o||n)&&r("div",{className:"px-6 py-4 border-t border-gray-200 dark:border-gray-700",children:r("div",{className:"flex justify-end space-x-3",children:[n&&r(D,{variant:n.variant||"outline",onClick:n.onClick,disabled:n.disabled,children:n.label}),o&&r(D,{variant:o.variant||"primary",onClick:o.onClick,loading:o.loading,disabled:o.disabled,children:o.label})]})})]})})]}):null}function Ur({message:t,type:e="info",duration:s=5e3,onClose:a,position:o="top-right"}){const[n,i]=k(!1);j(()=>{const m=setTimeout(()=>i(!0),100),l=setTimeout(()=>{i(!1),setTimeout(a,300)},s);return()=>{clearTimeout(m),clearTimeout(l)}},[s,a]);const d={success:{bg:"bg-green-50 dark:bg-green-900",border:"border-green-200 dark:border-green-700",text:"text-green-800 dark:text-green-200",icon:r("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})},error:{bg:"bg-red-50 dark:bg-red-900",border:"border-red-200 dark:border-red-700",text:"text-red-800 dark:text-red-200",icon:r("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 16.5c-.77.833.192 2.5 1.732 2.5z"})})},warning:{bg:"bg-yellow-50 dark:bg-yellow-900",border:"border-yellow-200 dark:border-yellow-700",text:"text-yellow-800 dark:text-yellow-200",icon:r("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 16.5c-.77.833.192 2.5 1.732 2.5z"})})},info:{bg:"bg-blue-50 dark:bg-blue-900",border:"border-blue-200 dark:border-blue-700",text:"text-blue-800 dark:text-blue-200",icon:r("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}},f={"top-right":"top-4 right-4","top-left":"top-4 left-4","bottom-right":"bottom-4 right-4","bottom-left":"bottom-4 left-4"},u=d[e];return r("div",{className:`fixed ${f[o]} z-50 max-w-sm w-full`,children:r("div",{className:`${u.bg} ${u.border} border rounded-lg shadow-lg p-4 transition-all duration-300 ${n?"transform translate-x-0 opacity-100":"transform translate-x-full opacity-0"}`,children:r("div",{className:"flex items-start",children:[r("div",{className:`flex-shrink-0 ${u.text}`,children:u.icon}),r("div",{className:"ml-3 flex-1",children:r("p",{className:`text-sm font-medium ${u.text}`,children:t})}),r("div",{className:"ml-4 flex-shrink-0",children:r("button",{onClick:()=>{i(!1),setTimeout(a,300)},className:`${u.text} hover:opacity-75 transition-opacity`,children:r("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})})]})})})}function ta({toasts:t,onRemove:e}){return r("div",{className:"fixed inset-0 pointer-events-none z-50",children:t.map(s=>r(Ur,{message:s.message,type:s.type,duration:s.duration,onClose:()=>e(s.id)},s.id))})}function xe({size:t="md",color:e="primary",text:s,className:a=""}){const o={sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8"},n={primary:"text-blue-600",secondary:"text-gray-600",white:"text-white"};return r("div",{className:`flex items-center justify-center ${a}`,children:r("div",{className:"flex flex-col items-center space-y-2",children:[r("div",{className:`${o[t]} ${n[e]} animate-spin`,children:r("svg",{className:"w-full h-full",fill:"none",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:[r("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),r("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),s&&r("p",{className:`text-sm ${n[e]} dark:text-gray-400`,children:s})]})})}function ra({provider:t}){const e=Tr(),{setRuleGroups:s,setError:a}=Rr(),[o,n]=k(""),[i,d]=k(""),[f,u]=k(""),[m,l]=k([""]),[h,c]=k(!0),[_,x]=k(""),[E,b]=k(!1),[S,w]=k(null),[N,L]=k({});j(()=>{const v=t.onRuleGroups(C=>{s(C)});return t.fetchRuleGroups().then(s).catch(C=>{console.error("Failed to fetch rule groups:",C),a(C.message)}),v},[t,s,a]);const M=e.filter(v=>{var C;return v.name.toLowerCase().includes(_.toLowerCase())||((C=v.description)==null?void 0:C.toLowerCase().includes(_.toLowerCase()))||v.patterns.some($=>$.toLowerCase().includes(_.toLowerCase()))}),O=()=>{l([...m,""])},T=v=>{l(m.filter((C,$)=>$!==v))},P=(v,C)=>{const $=[...m];$[v]=C,l($)},I=async v=>{if(v.preventDefault(),!o.trim()||!f.trim()||m.some(C=>!C.trim())){a("Please fill in all required fields");return}b(!0);try{const C={name:o.trim(),description:i.trim()||"",via:f.trim(),patterns:m.filter($=>$.trim()),pin_ttl:h};await t.createRuleGroup(C),n(""),d(""),u(""),l([""]),c(!0)}catch(C){console.error("Failed to create rule group:",C),a(C instanceof Error?C.message:"Failed to create rule group")}finally{b(!1)}},W=v=>{L(C=>({...C,[v.name]:{...v}}))},p=v=>{L(C=>{const $={...C};return delete $[v],$})},g=(v,C,$)=>{L(J=>({...J,[v]:{...J[v],[C]:$}}))},y=(v,C,$)=>{L(J=>{const ue=J[v];if(!ue)return J;const Re=ue.patterns.slice();return Re[C]=$,{...J,[v]:{...ue,patterns:Re}}})},A=v=>{L(C=>{const $=C[v];return $?{...C,[v]:{...$,patterns:[...$.patterns,""]}}:C})},F=(v,C)=>{L($=>{const J=$[v];if(!J)return $;const ue=J.patterns.filter((Re,Ar)=>Ar!==C);return{...$,[v]:{...J,patterns:ue}}})},B=async v=>{const C=N[v];if(C)try{await t.updateRuleGroup(v,{name:C.name,description:C.description||"",via:C.via,patterns:C.patterns.filter(J=>J.trim()),pin_ttl:!!C.pin_ttl}),p(v);const $=await t.fetchRuleGroups();s($)}catch($){console.error("Failed to update rule group:",$),a($ instanceof Error?$.message:"Failed to update rule group")}},R=async v=>{try{await t.deleteRuleGroup(v),w(null)}catch(C){console.error("Failed to delete rule group:",C),a(C instanceof Error?C.message:"Failed to delete rule group")}};return r("div",{className:"space-y-6",children:[r("div",{className:"flex items-center justify-between",children:r("div",{children:[r("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Rule Groups"}),r("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Manage DNS routing rules and patterns"})]})}),r(V,{title:"Add New Rule Group",subtitle:"Create a new routing rule group",children:r("form",{onSubmit:I,className:"space-y-6",children:[r("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[r(G,{label:"Group Name",value:o,onInput:v=>n(v.target.value),placeholder:"e.g., YouTube",required:!0}),r(G,{label:"Via Interface",value:f,onInput:v=>u(v.target.value),placeholder:"e.g., utun4",required:!0})]}),r(G,{label:"Description",value:i,onInput:v=>d(v.target.value),placeholder:"Optional description"}),r("div",{children:[r("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"DNS Patterns *"}),m.map((v,C)=>r("div",{className:"flex gap-3 mb-3",children:[r("div",{className:"flex-1",children:r(G,{value:v,onInput:$=>P(C,$.target.value),placeholder:"e.g., *.youtube.com",required:!0})}),m.length>1&&r(D,{type:"button",variant:"outline",size:"sm",onClick:()=>T(C),children:"Remove"})]},C)),r(D,{type:"button",variant:"secondary",size:"sm",onClick:O,children:"Add Pattern"})]}),r("div",{className:"flex items-center gap-3",children:[r("input",{type:"checkbox",id:"pin-ttl",checked:h,onChange:v=>c(v.target.checked),className:"rounded border-gray-300 dark:border-gray-600 text-black dark:text-white focus:ring-black dark:focus:ring-white"}),r("label",{htmlFor:"pin-ttl",className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:r("span",{className:"input-label",children:"Pin TTL (keep IP/route until TTL expires)"})})]}),r("div",{className:"flex gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:r(D,{type:"submit",variant:"primary",loading:E,disabled:E,children:E?"Creating...":"Create Rule Group"})})]})}),r("div",{children:r(G,{label:"Search Rule Groups",value:_,onInput:v=>x(v.target.value),placeholder:"Search by name, description, or pattern...",hint:"Filter rule groups by name, description, or DNS patterns"})}),r("div",{className:"grid gap-4",children:M.map(v=>r(V,{title:v.name,subtitle:v.description,children:[r("div",{className:"flex justify-between items-start mb-4",children:[r("div",{className:"flex items-center gap-3",children:[r(ke,{variant:"primary",children:v.patterns.length}),r("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:v.patterns.length===1?"pattern":"patterns"})]}),r("div",{className:"flex gap-2",children:[N[v.name]?r(Z,{children:[r(D,{variant:"secondary",size:"sm",onClick:()=>p(v.name),children:"Cancel"}),r(D,{variant:"primary",size:"sm",onClick:()=>B(v.name),children:"Save"})]}):r(D,{variant:"secondary",size:"sm",onClick:()=>W(v),children:"Edit"}),r(D,{variant:"outline",size:"sm",onClick:()=>w(v.name),children:"Delete"})]})]}),N[v.name]?r("div",{className:"space-y-4",children:[r("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[r("div",{className:"flex items-center gap-2",children:[r("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Via Interface:"}),r(G,{value:N[v.name].via,onInput:C=>g(v.name,"via",C.target.value)})]}),r("div",{className:"flex items-center gap-2",children:[r("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Pin TTL:"}),r("input",{type:"checkbox",checked:!!N[v.name].pin_ttl,onChange:C=>g(v.name,"pin_ttl",C.target.checked)})]})]}),r("div",{children:[r("span",{className:"font-medium text-sm text-gray-700 dark:text-gray-300",children:"Description:"}),r(G,{value:N[v.name].description||"",onInput:C=>g(v.name,"description",C.target.value),placeholder:"Optional description"})]}),r("div",{className:"mt-2 pt-2 border-t border-gray-200 dark:border-gray-700",children:[r("span",{className:"font-medium text-sm text-gray-700 dark:text-gray-300",children:"DNS Patterns:"}),N[v.name].patterns.map((C,$)=>r("div",{className:"flex gap-2 mt-2",children:[r(G,{value:C,onInput:J=>y(v.name,$,J.target.value)}),r(D,{variant:"outline",size:"sm",onClick:()=>F(v.name,$),children:"Remove"})]},$)),r(D,{className:"mt-2",variant:"secondary",size:"sm",onClick:()=>A(v.name),children:"Add Pattern"})]})]}):r(Z,{children:[r("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[r("div",{className:"flex items-center gap-2",children:[r("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Via Interface:"}),r(ke,{variant:"secondary",children:v.via})]}),r("div",{className:"flex items-center gap-2",children:[r("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Pin TTL:"}),r(ke,{variant:v.pin_ttl?"primary":"secondary",children:v.pin_ttl?"Yes":"No"})]})]}),r("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[r("span",{className:"font-medium text-sm text-gray-700 dark:text-gray-300",children:"DNS Patterns:"}),r("div",{className:"flex flex-wrap gap-2 mt-2",children:v.patterns.map((C,$)=>r("span",{className:"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 px-2 py-1 rounded text-xs font-mono",children:C},$))})]})]})]},v.name))}),M.length===0&&r(V,{className:"text-center py-8",children:r("p",{className:"text-secondary",children:_?"No rule groups match your search.":"No rule groups configured."})}),S&&r("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:r(V,{className:"max-w-md w-full mx-4",children:[r("h3",{className:"text-lg font-semibold mb-4",children:"Confirm Delete"}),r("p",{className:"text-secondary mb-6",children:['Are you sure you want to delete the rule group "',S,'"? This action cannot be undone.']}),r("div",{className:"flex gap-3 justify-end",children:[r(D,{variant:"secondary",onClick:()=>w(null),children:"Cancel"}),r(D,{variant:"danger",onClick:()=>R(S),children:"Delete"})]})]})})]})}function sa(t){return qs[t]||`TYPE${t}`}function aa(t){return t.length>50?t.substring(0,47)+"...":t}function na(t){return new Date(typeof t=="string"?t:t*1e3).toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})}function oa(t){return t.trim()?[/^udp:[a-zA-Z0-9.-]+:\d+$/,/^tcp:[a-zA-Z0-9.-]+:\d+$/,/^https?:\/\/[a-zA-Z0-9.-]+(\/.*)?$/,/^[a-zA-Z0-9.-]+:\d+$/,/^[a-zA-Z0-9.-]+$/].some(a=>a.test(t))?{valid:!0}:{valid:!1,error:"Invalid upstream format. Use: udp:host:port, tcp:host:port, https://host/path, or host:port"}:{valid:!1,error:"Upstream is required"}}function ia({provider:t}){const e=Lr(),{setUpstreams:s,addUpstream:a,removeUpstream:o,setError:n}=Pr(),[i,d]=k(""),[f,u]=k(""),[m,l]=k(""),[h,c]=k(!1),[_,x]=k(null),[E,b]=k("asc"),[S,w]=k({});j(()=>t.onUpstreams(g=>{s(g)}),[t,s,n]);const N=[...e||[]].sort((p,g)=>{const y=(p.name||p.address).localeCompare(g.name||g.address);return E==="asc"?y:-y}),L=async p=>{p.preventDefault();const g=oa(i);if(!g.valid){n(g.error);return}c(!0),n(null);try{let y=i.trim();try{const B=new URL(y),R=B.protocol.replace(":","").toLowerCase();R!=="https"&&(y=`${R==="tls"?"dot":R==="quic"?"doq":R}://${B.host}`)}catch{y=`udp://${y.replace(/^(udp|tcp|tls|dot|quic|doq):\/\//i,"")}`}const A={name:(f||new URL(y).hostname).trim(),address:y};m!==""&&(A.weight=Number(m)),a(A);const F=[...e,A];await t.saveUpstreams(F),d(""),u(""),l("")}catch(y){console.error("Failed to save upstream:",y),n(y instanceof Error?y.message:"Failed to save upstream")}finally{c(!1)}},M=async p=>{try{o(p);const g=e.filter(y=>y.address!==p);await t.saveUpstreams(g),x(null)}catch(g){console.error("Failed to delete upstream:",g),n(g instanceof Error?g.message:"Failed to delete upstream")}},O=p=>{const g=e.find(y=>y.address===p);g&&w(y=>({...y,[p]:{...g}}))},T=p=>{w(g=>{const y={...g};return delete y[p],y})},P=async p=>{const g=S[p];if(!g)return;const y=e.find(R=>R.address===p);if(!y)return;const A={name:(g.name??y.name??"").trim(),address:(g.address??y.address).trim()},F=g.weight===void 0?y.weight:Number(g.weight);F!==void 0&&(A.weight=F);const B=e.map(R=>R.address===p?A:R);try{s(B),await t.saveUpstreams(B),T(p)}catch(R){console.error("Failed to save edit:",R),n(R instanceof Error?R.message:"Failed to save")}},I=(p,g,y)=>{w(A=>({...A,[p]:{...A[p],[g]:g==="weight"?y===""?void 0:Number(y):y}}))},W=()=>{b(p=>p==="asc"?"desc":"asc")};return r("div",{className:"space-y-6",children:[r("div",{className:"flex items-center justify-between",children:r("div",{children:[r("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Upstreams"}),r("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Manage DNS upstream servers and their configuration"})]})}),r(V,{title:"Add New Upstream",subtitle:"Add a new DNS upstream server",children:r("form",{onSubmit:L,className:"space-y-6",children:[r("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[r(G,{label:"Name",value:f,onInput:p=>u(p.target.value),placeholder:"Human-friendly name"}),r(G,{label:"Address",value:i,onInput:p=>d(p.target.value),placeholder:"udp://8.8.8.8:53 or https://dns.google/dns-query",hint:"Use URL form",required:!0}),r(G,{label:"Weight",type:"number",value:m,onInput:p=>l(p.target.value===""?"":Number(p.target.value)),placeholder:"1"})]}),r("div",{className:"flex gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:r(D,{type:"submit",variant:"primary",loading:h,disabled:h,children:h?"Adding...":"Add Upstream"})})]})}),r(V,{title:"Configured Upstreams",subtitle:`${e.length} upstream server${e.length===1?"":"s"} configured`,children:[r("div",{className:"flex justify-between items-center mb-6",children:[r("div",{className:"flex items-center gap-3",children:[r(ke,{variant:"primary",children:e.length}),r("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.length===1?"upstream server":"upstream servers"})]}),r(D,{variant:"secondary",size:"sm",onClick:W,title:`Sort ${E==="asc"?"Z-A":"A-Z"}`,children:E==="asc"?"A-Z":"Z-A"})]}),N.length===0?r("div",{className:"text-center py-8",children:r("p",{className:"text-gray-600 dark:text-gray-400",children:"No upstream servers configured yet."})}):r("div",{className:"space-y-3",children:N.map(p=>{var g,y,A;return r("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:S[p.address]?r("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3 items-end",children:[r(G,{label:"Name",value:((g=S[p.address])==null?void 0:g.name)??p.name,onInput:F=>I(p.address,"name",F.target.value)}),r(G,{label:"Address",value:((y=S[p.address])==null?void 0:y.address)??p.address,onInput:F=>I(p.address,"address",F.target.value)}),r(G,{label:"Weight",type:"number",value:((A=S[p.address])==null?void 0:A.weight)??p.weight??"",onInput:F=>I(p.address,"weight",F.target.value)}),r("div",{className:"flex gap-2 justify-end",children:[r(D,{variant:"outline",size:"sm",onClick:()=>T(p.address),children:"Cancel"}),r(D,{variant:"primary",size:"sm",onClick:()=>P(p.address),children:"Save"})]})]}):r("div",{className:"flex items-center justify-between gap-4",children:[r("div",{className:"flex flex-col min-w-0",children:[r("span",{className:"text-sm text-gray-500 dark:text-gray-400 truncate max-w-[420px]",title:p.name||"Unnamed",children:p.name||"Unnamed"}),r("span",{className:"mt-1 px-2 py-1 rounded bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-gray-100 text-xs font-mono truncate max-w-[520px]",title:p.address,children:p.address})]}),r("div",{className:"flex items-center gap-3",children:[r("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["weight: ",p.weight??1]}),r(D,{variant:"secondary",size:"sm",onClick:()=>O(p.address),children:"Edit"}),r(D,{variant:"outline",size:"sm",onClick:()=>x(p.address),children:"Delete"})]})]})},p.address)})})]}),_&&r("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50",children:r("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 p-6 max-w-md w-full",children:[r("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Delete Upstream"}),r("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:["Are you sure you want to delete upstream ",r("strong",{children:['"',_,'"']}),"? This action cannot be undone."]}),r("div",{className:"flex gap-3 justify-end",children:[r(D,{variant:"outline",onClick:()=>x(null),children:"Cancel"}),r(D,{variant:"primary",onClick:()=>M(_),children:"Delete"})]})]})})]})}function la({provider:t}){const e=js(),{setEvents:s,setError:a}=Fs(),[o,n]=k(""),[i,d]=k(200);j(()=>{const m=t.onHistory(l=>{s(l)});return t.fetchHistory().then(s).catch(l=>{console.error("Failed to fetch history:",l),a(l.message)}),m},[t,s,a]);const f=te(()=>{let m=e;if(o.trim()){const l=o.toLowerCase();m=e.filter(h=>h.name.toLowerCase().includes(l))}return m.slice(0,i)},[e,o,i]),u=()=>e.length<=i?r(Z,{}):r("div",{style:{marginTop:"12px",textAlign:"center"},children:[r("span",{className:"muted",children:["Showing ",i," of ",e.length," events."]}),i<1e3&&r("button",{className:"ow-btn ow-btn--secondary ow-btn--sm",style:{marginLeft:"8px"},onClick:()=>d(Math.min(i*2,2e3)),children:"Show More"})]});return r("div",{className:"space-y-6",children:[r("div",{className:"flex items-center justify-between",children:r("div",{children:[r("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Query History"}),r("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"View DNS query history and performance metrics"})]})}),r(V,{title:"Search and Filters",subtitle:"Filter DNS query history",children:r("div",{className:"space-y-4",children:[r(G,{label:"Filter by Domain",value:o,onInput:m=>n(m.target.value),placeholder:"Filter by domain name...",hint:"Enter a domain name to filter the results"}),r("div",{className:"flex items-center justify-between",children:[r("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Showing ",f.length," of ",e.length," events"]}),e.length>i&&r("button",{className:"text-sm text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300",onClick:()=>d(Math.min(i*2,2e3)),children:"Show More"})]})]})}),r(V,{title:"Query History",subtitle:`${f.length} DNS queries`,children:f.length===0?r("div",{className:"text-center py-8",children:r("p",{className:"text-gray-600 dark:text-gray-400",children:e.length===0?"No query history available":"No queries match filter"})}):r("div",{className:"overflow-x-auto",children:[r("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700 table-auto",children:[r("thead",{className:"bg-gray-50 dark:bg-gray-800",children:r("tr",{children:[r("th",{className:"px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Time"}),r("th",{className:"px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Domain"}),r("th",{className:"px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Type"}),r("th",{className:"px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Client IP"}),r("th",{className:"px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Upstream"}),r("th",{className:"px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Duration"}),r("th",{className:"px-4 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Status"})]})}),r("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700",children:f.map((m,l)=>r("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[r("td",{className:"px-4 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:na(m.time)}),r("td",{className:"px-4 sm:px-6 py-3 sm:py-4 whitespace-normal sm:whitespace-nowrap break-words text-sm font-medium text-gray-900 dark:text-gray-100",children:m.name}),r("td",{className:"px-4 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:sa(m.qtype)}),r("td",{className:"px-4 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400 font-mono",children:m.client_ip||"unknown"}),r("td",{className:"px-4 sm:px-6 py-3 sm:py-4 whitespace-normal sm:whitespace-nowrap break-words text-sm text-gray-500 dark:text-gray-400",title:m.upstream,children:aa(m.upstream)}),r("td",{className:"px-4 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:m.duration}),r("td",{className:"px-4 sm:px-6 py-3 sm:py-4 whitespace-nowrap",children:r("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${m.status==="ok"?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400":"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400"}`,children:m.status==="ok"?"OK":"Error"})})]},`${m.time}-${m.name}-${l}`))})]}),u()]})})]})}function ca({provider:t}){const[e,s]=k([]),[a,o]=k(!0),[n,i]=k(null);j(()=>{let h=t.onHosts(c=>{s(c),o(!1)});return t.fetchHosts().then(s).catch(c=>i(String(c))).finally(()=>o(!1)),()=>{h()}},[t]);const d=()=>s(h=>[...h,{pattern:"",a:[],aaaa:[],ttl:60}]),f=h=>s(c=>c.filter((_,x)=>x!==h)),u=(h,c)=>s(_=>_.map((x,E)=>E===h?{...x,...c}:x)),m=h=>h?h.split(",").map(c=>c.trim()).filter(Boolean):[];return r("div",{className:"space-y-6",children:[r("div",{className:"flex items-center justify-between",children:[r("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Hosts"}),r("div",{className:"space-x-2",children:[r(D,{variant:"secondary",onClick:d,children:"Add"}),r(D,{onClick:async()=>{i(null);try{await t.saveHosts(e)}catch(h){i(String(h))}},children:"Save"})]})]}),n&&r("div",{className:"text-red-600 text-sm",children:n}),r(V,{title:"Overrides",subtitle:"Static DNS responses with wildcard support",children:a?r("div",{className:"text-gray-500",children:"Loading..."}):r("div",{className:"overflow-x-auto",children:r("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[r("thead",{className:"bg-gray-50 dark:bg-gray-800",children:r("tr",{children:[r("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Pattern"}),r("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"A (comma separated)"}),r("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"AAAA (comma separated)"}),r("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"TTL"}),r("th",{className:"px-3 py-2 text-right text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),r("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700",children:[e.map((h,c)=>r("tr",{children:[r("td",{className:"px-3 py-2 w-[28%]",children:r(G,{value:h.pattern||"",onInput:_=>u(c,{pattern:_.currentTarget.value}),placeholder:"e.g. *.example.com"})}),r("td",{className:"px-3 py-2 w-[28%]",children:r(G,{value:(h.a||[]).join(", "),onInput:_=>u(c,{a:m(_.currentTarget.value)}),placeholder:"127.0.0.1, 10.0.0.1"})}),r("td",{className:"px-3 py-2 w-[28%]",children:r(G,{value:(h.aaaa||[]).join(", "),onInput:_=>u(c,{aaaa:m(_.currentTarget.value)}),placeholder:"::1, 2001:db8::1"})}),r("td",{className:"px-3 py-2 w-[8%]",children:r(G,{type:"number",value:String(h.ttl??60),onInput:_=>u(c,{ttl:Number(_.currentTarget.value)}),placeholder:"60"})}),r("td",{className:"px-3 py-2 text-right w-[8%]",children:r(D,{variant:"danger",onClick:()=>f(c),children:"Del"})})]},c)),e.length===0&&r("tr",{children:r("td",{colSpan:5,className:"px-3 py-6 text-sm text-gray-500 text-center",children:"No hosts configured. Click Add to create one."})})]})]})})})]})}function da({provider:t}){const[e,s]=k([]),[a,o]=k([]),[n,i]=k(""),[d,f]=k(null),[u,m]=k(!0),[l,h]=k(!1),[c,_]=k(null);j(()=>{const w=async()=>{var L,M;try{m(!0),_(null);const[O,T]=await Promise.all([((L=t.fetchLocalZones)==null?void 0:L.call(t))||Promise.resolve([]),((M=t.fetchLocalLeases)==null?void 0:M.call(t))||Promise.resolve([])]);s(O.map(P=>({name:P,detected:!0}))),o(T)}catch(O){_(O instanceof Error?O.message:"Failed to load data")}finally{m(!1)}};w();const N=setInterval(w,3e4);return()=>{clearInterval(N)}},[t]);const x=async()=>{if(n.trim())try{h(!0),_(null),f(null);const w=await t.testLocalResolve(n);f(w)}catch(w){_(w instanceof Error?w.message:"Failed to resolve hostname")}finally{h(!1)}},E=w=>{try{const N=new Date(w),L=new Date,M=N.getTime()-L.getTime();if(M<0)return"Expired";const O=Math.floor(M/(1e3*60*60)),T=Math.floor(M%(1e3*60*60)/(1e3*60));return O>0?`${O}h ${T}m`:`${T}m`}catch{return"Unknown"}},b=w=>{switch(w){case 0:return"NOERROR";case 1:return"FORMERR";case 2:return"SERVFAIL";case 3:return"NXDOMAIN";case 4:return"NOTIMP";case 5:return"REFUSED";default:return`RCODE_${w}`}},S=w=>{switch(w){case 1:return"A";case 28:return"AAAA";case 5:return"CNAME";case 15:return"MX";case 2:return"NS";case 16:return"TXT";case 33:return"SRV";case 12:return"PTR";default:return`TYPE_${w}`}};return u?r("div",{className:"flex items-center justify-center h-64",children:[r("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),r("span",{className:"ml-2 text-gray-600",children:"Loading local DNS data..."})]}):r("div",{className:"space-y-6",children:[r("div",{className:"flex items-center justify-between",children:r("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Local DNS"})}),c&&r("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:r("div",{className:"flex",children:[r("div",{className:"flex-shrink-0",children:r("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:r("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),r("div",{className:"ml-3",children:[r("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),r("div",{className:"mt-2 text-sm text-red-700",children:c})]})]})}),r("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[r("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Detected Local Zones"}),r("div",{className:"flex flex-wrap gap-2",children:[e.map(w=>r("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:[w.name,w.detected&&r("span",{className:"ml-1 text-xs",children:"(auto)"})]},w.name)),e.length===0&&r("p",{className:"text-gray-500 dark:text-gray-400",children:"No local zones detected"})]})]}),r("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[r("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:["DHCP Leases (",a.length,")"]}),r("div",{className:"overflow-x-auto",children:r("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[r("thead",{className:"bg-gray-50 dark:bg-gray-700",children:r("tr",{children:[r("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Hostname"}),r("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"IP Address"}),r("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"MAC Address"}),r("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Expires"})]})}),r("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:[a.map((w,N)=>r("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[r("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:w.hostname}),r("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:w.ip}),r("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300 font-mono",children:w.mac}),r("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:E(w.expire)})]},N)),a.length===0&&r("tr",{children:r("td",{colSpan:4,className:"px-6 py-4 text-center text-gray-500 dark:text-gray-400",children:"No DHCP leases found"})})]})]})})]}),r("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[r("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Test Resolution"}),r("div",{className:"flex gap-4 mb-4",children:[r("input",{type:"text",value:n,onChange:w=>i(w.target.value),onKeyDown:w=>{w.key==="Enter"&&n.trim()&&!l&&x()},placeholder:"Enter hostname (e.g., myhost.lan)",className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"}),r("button",{onClick:x,disabled:!n.trim()||l,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:[l&&r("svg",{className:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[r("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),r("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),l?"Resolving...":"Resolve"]})]}),d&&r("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[r("h3",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Resolution Result"}),r("div",{className:"space-y-2 text-sm",children:[r("div",{className:"flex",children:[r("span",{className:"font-medium text-gray-600 dark:text-gray-400 w-24",children:"Hostname:"}),r("span",{className:"text-gray-900 dark:text-white",children:d.hostname})]}),r("div",{className:"flex",children:[r("span",{className:"font-medium text-gray-600 dark:text-gray-400 w-24",children:"Local Zone:"}),r("span",{className:`px-2 py-1 rounded text-xs ${d.is_local?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:d.is_local?"Yes":"No"})]}),d.is_local&&r("div",{className:"flex",children:[r("span",{className:"font-medium text-gray-600 dark:text-gray-400 w-24",children:"Zone:"}),r("span",{className:"text-gray-900 dark:text-white",children:d.zone})]}),r("div",{className:"flex",children:[r("span",{className:"font-medium text-gray-600 dark:text-gray-400 w-24",children:"RCode:"}),r("span",{className:`px-2 py-1 rounded text-xs ${d.rcode===0?"bg-green-100 text-green-800":d.rcode===3?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:b(d.rcode)})]}),r("div",{className:"flex",children:[r("span",{className:"font-medium text-gray-600 dark:text-gray-400 w-24",children:"Answers:"}),r("span",{className:"text-gray-900 dark:text-white",children:d.answers})]}),r("div",{className:"flex",children:[r("span",{className:"font-medium text-gray-600 dark:text-gray-400 w-24",children:"Authoritative:"}),r("span",{className:"text-gray-900 dark:text-white",children:d.authoritative?"Yes":"No"})]}),d.answers===0?r("div",{className:"mt-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:[r("div",{className:"flex items-center gap-2",children:[r("svg",{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),r("span",{className:"text-yellow-800 dark:text-yellow-200 font-medium",children:"No DNS records found"})]}),r("p",{className:"text-yellow-700 dark:text-yellow-300 text-sm mt-1",children:d.rcode===3?"Hostname does not exist (NXDOMAIN)":"No answers returned"})]}):d.answer_details.length>0?r("div",{className:"mt-4",children:[r("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Answer Details"}),r("div",{className:"space-y-1",children:d.answer_details.map((w,N)=>r("div",{className:"flex items-center gap-2 text-xs",children:[r("span",{className:"font-mono bg-gray-200 dark:bg-gray-600 px-2 py-1 rounded",children:S(w.type)}),r("span",{className:"text-gray-900 dark:text-white",children:w.name}),r("span",{className:"text-gray-500 dark:text-gray-400",children:"→"}),r("span",{className:"text-gray-900 dark:text-white",children:w.data}),r("span",{className:"text-gray-500 dark:text-gray-400",children:["TTL: ",w.ttl]})]},N))})]}):null]})]})]})]})}const ua=(t,e)=>{const s=e.split("/"),a=s[0],o=s[1];if(!a||!o)return null;for(const n of t){const i=n.name.toLowerCase();if(i.includes(a.toLowerCase())&&i.includes(o.toLowerCase()))return n}for(const n of t)if(n.name.toLowerCase().includes(a.toLowerCase()))return n;for(const n of t){const i=n.name.toLowerCase();if(i.includes(".tar.gz")||i.includes(".zip")||i.includes(".bin"))return n}return null},ha=({provider:t})=>{const[e,s]=k(null),[a,o]=k(null),[n,i]=k(!1),[d,f]=k(!1),[u,m]=k(!1),[l,h]=k(!1),[c,_]=k(null),[x,E]=k(null),b=(T,P)=>{_({message:T,type:P}),setTimeout(()=>_(null),5e3)};j(()=>t?t.onUpdateAvailable(P=>{console.log("WebSocket update notification received:",P),s(P),b(`Update available: ${P.latest_version}`,"success")}):void 0,[t]);const S=async()=>{i(!0);try{const T=await fetch("/api/v1/update/check");if(!T.ok)throw new Error("Failed to check for updates");const P=await T.json();s(P)}catch(T){b(`Failed to check for updates: ${T}`,"error")}finally{i(!1)}},w=async()=>{var I;if(!((I=e==null?void 0:e.release)!=null&&I.assets))return;const T=(a==null?void 0:a.platform)||"",P=ua(e.release.assets,T);if(!P){b("No suitable update found for your platform","error");return}f(!0);try{const W=await fetch("/api/v1/update/download",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({download_url:P.browser_download_url})});if(!W.ok)throw new Error("Failed to download update");const p=await W.json();E(p.path),b("Update downloaded successfully","success")}catch(W){b(`Failed to download update: ${W}`,"error")}finally{f(!1)}},N=async(T=30,P=2e3)=>{h(!0);let I=0;const W=async()=>{try{return(await fetch("/api/v1/update/status",{method:"HEAD",signal:AbortSignal.timeout(5e3)})).ok}catch{return!1}},p=async()=>{if(I++,I>T){h(!1),b("Server did not come back online after installation. Please check manually.","error");return}if(await W()){h(!1),b("Server is back online! Reloading page...","success"),setTimeout(()=>{window.location.reload()},1e3);return}setTimeout(p,P)};b("Installation complete. Waiting for server to restart...","success"),p()},L=async()=>{if(x){m(!0);try{const T=await fetch("/api/v1/update/install",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({update_path:x})});if(!T.ok)throw new Error("Failed to install update");const P=await T.json();b(P.message||"Update installed successfully. Server will restart...","success"),E(null),await N()}catch(T){b(`Failed to install update: ${T}`,"error")}finally{m(!1)}}},M=T=>new Date(T).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),O=T=>{const P=T.match(/(?:(\d+)h)?(?:(\d+)m)?(?:(\d+(?:\.\d+)?)s)?/);if(!P)return T;const I=parseInt(P[1]||"0"),W=parseInt(P[2]||"0"),p=parseFloat(P[3]||"0"),g=[];return I>0&&g.push(`${I}h`),W>0&&g.push(`${W}m`),p>0&&g.push(`${Math.floor(p)}s`),g.join(" ")||"0s"};return j(()=>{(async()=>{try{const P=await fetch("/api/v1/update/status");if(P.ok){const I=await P.json();o(I)}}catch(P){console.error("Failed to load update status:",P)}})(),S()},[]),r("div",{className:"space-y-6",children:[r("div",{className:"flex items-center justify-between",children:r("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Updates"})}),c&&r(Ur,{message:c.message,type:c.type,onClose:()=>_(null)}),r(V,{children:r("div",{className:"p-6",children:[r("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-6",children:"Current Version"}),a?r("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[r("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[r("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Version"}),r("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:a.current_version})]}),r("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[r("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Build Time"}),r("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:M(a.build_time)})]}),r("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[r("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Uptime"}),r("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:O(a.uptime)})]}),r("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[r("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Platform"}),r("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:a.platform})]})]}):r("div",{className:"flex items-center justify-center py-12",children:r(xe,{})})]})}),r(V,{children:r("div",{className:"p-6",children:[r("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[r("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Check for Updates"}),r(D,{onClick:S,disabled:n,className:"flex items-center gap-2 w-full sm:w-auto",children:[n?r(xe,{size:"sm"}):null,"Check for Updates"]})]}),e&&r("div",{className:"space-y-4",children:[e.has_update?r("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-xl p-6",children:[r("div",{className:"flex items-center gap-3 mb-3",children:[r("div",{className:"w-3 h-3 bg-blue-500 rounded-full animate-pulse"}),r("p",{className:"text-blue-800 dark:text-blue-200 font-semibold text-lg",children:"Update Available"})]}),r("p",{className:"text-blue-700 dark:text-blue-300 text-base mb-2",children:["New version ",r("span",{className:"font-bold",children:e.latest_version})," is available"]}),r("p",{className:"text-blue-600 dark:text-blue-400 text-sm",children:["Current version: ",e.current_version]}),e.release&&r("div",{className:"mt-3 space-y-2",children:[r("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:["Released: ",M(e.release.published_at)]}),e.release.body&&r("details",{className:"mt-2",children:[r("summary",{className:"text-sm text-blue-600 dark:text-blue-400 cursor-pointer hover:underline",children:"Release Notes"}),r("div",{className:"mt-2 p-3 bg-white dark:bg-gray-800 rounded border text-sm text-gray-700 dark:text-gray-300 whitespace-pre-wrap",children:e.release.body})]})]})]}):r("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-xl p-6",children:[r("div",{className:"flex items-center gap-3 mb-3",children:[r("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),r("p",{className:"text-green-800 dark:text-green-200 font-semibold text-lg",children:"You are up to date"})]}),r("p",{className:"text-green-700 dark:text-green-300 text-base",children:["Running latest version ",r("span",{className:"font-bold",children:e.current_version})]})]}),e.has_update&&r("div",{className:"flex flex-col sm:flex-row gap-3 mt-6",children:x?r(D,{onClick:L,disabled:u||l,className:"flex items-center justify-center gap-2 px-6 py-3 bg-red-600 hover:bg-red-700 text-white font-medium",children:[u?r(xe,{size:"sm"}):null,l?"Waiting for server...":"Install Update"]}):r(D,{onClick:w,disabled:d,className:"flex items-center justify-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium",children:[d?r(xe,{size:"sm"}):null,"Download Update"]})})]})]})})]})};function ma(t){let e=(t||"").trim();if(!e)return e;e.startsWith("@")&&(e=e.slice(1));try{return new URL(e).hostname||e}catch{}try{return new URL(/^https?:\/\//i.test(e)?e:`http://${e}`).hostname||e}catch{}return e=e.replace(/^\w+:\/\//,""),e=e.replace(/\/.*$/,""),e}function Rt({label:t,value:e,onChange:s,children:a,className:o="",...n}){return r("div",{children:[t&&r("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:t}),r("select",{value:e,onChange:s,className:`w-full px-3 py-2 h-[42px] border border-gray-300 rounded-md bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:text-gray-100 dark:border-gray-600 dark:focus:border-blue-400 dark:focus:ring-blue-400 ${o}`,...n,children:a})]})}function fa({provider:t}){const[e,s]=k(""),[a,o]=k(""),[n,i]=k(!1),[d,f]=k([]),[u,m]=k(0),[l,h]=k(0),[c,_]=k(20),[x,E]=k(""),[b,S]=k(""),[w,N]=k("expires"),[L,M]=k("desc"),[O,T]=k({open:!1}),[P,I]=k(!1);j(()=>{try{const g=JSON.parse(localStorage.getItem("cache.ui")||"{}");typeof g.limit=="number"&&_(g.limit),g.sort&&N(g.sort),g.order&&M(g.order)}catch{}},[]),j(()=>{try{localStorage.setItem("cache.ui",JSON.stringify({limit:c,sort:w,order:L}))}catch{}},[c,w,L]),j(()=>{const g=window.setTimeout(()=>S(x),300);return()=>window.clearTimeout(g)},[x]),j(()=>{var F,B,R;const g=(F=t.onCache)==null?void 0:F.call(t,v=>{!v||!Array.isArray(v.items)||(f(v.items),m(v.total||0))});let y=0;const A=(B=t.onCacheUpdated)==null?void 0:B.call(t,()=>{var C;const v=Date.now();v-y<800||(y=v,(C=t.fetchCache)==null||C.call(t,{offset:l,limit:c,q:b,sort:w,order:L}).then($=>{$&&(f($.items||[]),m($.total||0))}).catch(()=>{}))});return(R=t.fetchCache)==null||R.call(t,{offset:l,limit:c,q:b,sort:w,order:L}).then(v=>{v&&(f(v.items||[]),m(v.total||0))}).catch(()=>{}),()=>{g&&g(),A&&A()}},[t,l,c,b,w,L]);const W=te(()=>Math.max(1,Math.ceil(u/c)),[u,c]),p=te(()=>Math.floor(l/c)+1,[l,c]);return r("div",{className:"space-y-6",children:[r("div",{children:[r("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Cache"}),r("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Manage local DNS cache"})]}),r(V,{children:r("div",{className:"space-y-4",children:[r("div",{className:"flex flex-wrap items-end gap-3",children:[r("div",{className:"flex-1 min-w-[260px]",children:r(G,{label:"Domain",value:e,onInput:g=>s(g.target.value),placeholder:"example.com"})}),r("div",{className:"w-64",children:r(Rt,{label:"Type (optional)",value:a,onChange:g=>o(g.target.value),children:[r("option",{value:"",children:"All"}),r("option",{value:"1",children:"A"}),r("option",{value:"28",children:"AAAA"}),r("option",{value:"5",children:"CNAME"}),r("option",{value:"15",children:"MX"}),r("option",{value:"2",children:"NS"}),r("option",{value:"16",children:"TXT"}),r("option",{value:"33",children:"SRV"}),r("option",{value:"12",children:"PTR"})]})}),r("div",{className:"ml-auto flex items-end gap-3",children:[r(D,{type:"button",variant:"secondary",size:"md",className:"h-[42px]",disabled:n,onClick:async()=>{const g=ma(e);if(g){i(!0);try{await t.cacheDelete({name:g,qtype:a?parseInt(a,10):void 0})}finally{i(!1)}}},children:"Delete domain cache"}),r(D,{type:"button",variant:"outline",size:"md",className:"h-[42px]",disabled:n,onClick:()=>I(!0),children:"Flush all"}),r("div",{className:"flex items-center gap-2",children:[r("label",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Per page"}),r(Rt,{value:String(c),onChange:g=>_(parseInt(g.target.value,10)),children:[r("option",{value:"10",children:"10"}),r("option",{value:"20",children:"20"}),r("option",{value:"50",children:"50"})]})]})]})]}),r("div",{children:r(G,{label:"Search",value:x,onInput:g=>E(g.target.value),placeholder:"Filter by domain"})}),r(Ys,{children:[r(Ks,{children:r(Ae,{children:[[{key:"name",label:"Domain"},{key:"qtype",label:"Type"},{key:"answers",label:"Answers"},{key:"expires",label:"Expires"}].map(g=>r(Et,{sortable:!0,active:w===g.key,order:L,onClick:()=>{w===g.key?M(L==="asc"?"desc":"asc"):(N(g.key),M("asc")),h(0)},children:g.label},g.key)),r(Et,{})]})}),r(ea,{children:[d.map(g=>r(Ae,{children:[r(ae,{children:g.name}),r(ae,{children:{1:"A",28:"AAAA",5:"CNAME",15:"MX",2:"NS",16:"TXT",33:"SRV",12:"PTR"}[g.qtype]||g.qtype}),r(ae,{children:g.answers}),r(ae,{children:[Math.max(0,Math.floor((new Date(g.expires_at).getTime()-Date.now())/1e3)),"s"]}),r(ae,{align:"right",children:[r(D,{type:"button",size:"sm",variant:"outline",onClick:async()=>{var y,A;i(!0);try{await((y=t.cacheDelete)==null?void 0:y.call(t,{name:g.name,qtype:g.qtype})),await((A=t.fetchCache)==null?void 0:A.call(t,{offset:l,limit:c,q:b,sort:w,order:L}))}finally{i(!1)}},children:"Delete"}),r(D,{type:"button",size:"sm",className:"ml-2",variant:"secondary",onClick:async()=>{try{const y=await t.restProvider.fetchCacheKey(g.key);T({open:!0,key:g.key,data:y})}catch{}},children:"View"})]})]},g.key)),d.length===0&&r(Ae,{children:r(ae,{align:"left",colSpan:5,children:[" ",r("span",{className:"px-4 py-6 block text-sm text-gray-500 dark:text-gray-400",children:"No cache entries"})," "]})})]})]}),r("div",{className:"flex items-center justify-between",children:[r("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Total: ",u]}),r("div",{className:"flex items-center gap-2",children:[r(D,{type:"button",variant:"outline",size:"sm",disabled:p<=1,onClick:()=>h(Math.max(0,l-c)),children:"Prev"}),r("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:[p," / ",W]}),r(D,{type:"button",variant:"outline",size:"sm",disabled:p>=W,onClick:()=>h(l+c),children:"Next"})]})]})]})}),r(Tt,{isOpen:O.open,title:`Cache entry: ${O.key}`,onClose:()=>T({open:!1}),children:O.data?r("div",{className:"space-y-2",children:[r("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:["RCODE: ",O.data.rcode]}),r("pre",{className:"p-3 rounded-md bg-gray-50 text-gray-800 dark:bg-gray-900 dark:text-gray-200 whitespace-pre-wrap text-sm border border-gray-200 dark:border-gray-700 max-h-80 overflow-auto",children:(O.data.answers||[]).join(`
`)})]}):r("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Loading…"})}),r(Tt,{isOpen:P,title:"Confirm flush",onClose:()=>I(!1),primaryAction:{label:"Flush all",onClick:async()=>{var g,y;i(!0);try{await((g=t.cacheFlush)==null?void 0:g.call(t)),await((y=t.fetchCache)==null?void 0:y.call(t,{offset:0,limit:c,q:b,sort:w,order:L})),h(0)}finally{i(!1),I(!1)}},variant:"primary"},secondaryAction:{label:"Cancel",onClick:()=>I(!1)},children:r("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:"This will clear the entire cache. Continue?"})})]})}function pa(){const t=()=>{const l=window.location.hash.slice(1);return["overview","rules","upstreams","history","hosts","localdns","resolve","cache","update"].includes(l)?l:"overview"},[e,s]=k(t()),[a,o]=k(!1),[n,i]=k(null),[d,f]=k([]);$r(),j(()=>{var E;const l=new Zr("/ws");let h=null;l.connect().then(()=>{i(l),console.log("Provider connected")}).catch(b=>{console.error("Failed to connect provider:",b)});const c=()=>{const b=window.location.hash.slice(1);["overview","rules","upstreams","history","hosts","localdns","resolve","cache","update"].includes(b)&&s(b)};c(),window.addEventListener("hashchange",c);const _=()=>{window.innerWidth<1024&&o(!0)};_(),window.addEventListener("resize",_);const x=(E=l.onStatus)==null?void 0:E.call(l,b=>{if(b.channel==="rest"){h&&clearTimeout(h),h=window.setTimeout(()=>{f(S=>[{id:`${Date.now()}`,message:"WebSocket unavailable — using polling",type:"warning",duration:2500},...S].slice(0,4)),h=null},1200);return}h&&(clearTimeout(h),h=null),f(S=>[{id:`${Date.now()}`,message:"Realtime updates via WebSocket",type:"success",duration:2500},...S].slice(0,4))});return()=>{window.removeEventListener("hashchange",c),window.removeEventListener("resize",_),h&&clearTimeout(h),x&&x(),l.close()}},[]);const u=l=>{window.location.hash.slice(1)!==l?window.location.hash=l:s(l),window.innerWidth<1024&&o(!0),window.scrollTo(0,0)},m=()=>{o(!a)};return n?r("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-700",children:[r(ta,{toasts:d,onRemove:l=>f(h=>h.filter(c=>c.id!==l))}),r(Zs,{activeTab:e,onTabChange:u,collapsed:a}),r("div",{className:`transition-all duration-300 ${a?"lg:ml-16":"lg:ml-64"}`,children:[r(Xs,{onSidebarToggle:m,sidebarCollapsed:a,provider:n}),r("main",{className:"p-6",children:r("div",{className:"max-w-7xl mx-auto",children:[e==="overview"&&r(Vs,{provider:n}),e==="rules"&&r(ra,{provider:n}),e==="upstreams"&&r(ia,{provider:n}),e==="history"&&r(la,{provider:n}),e==="hosts"&&r(ca,{provider:n}),e==="localdns"&&r(da,{provider:n}),e==="resolve"&&r(Bs,{provider:n}),e==="cache"&&r(fa,{provider:n}),e==="update"&&r(ha,{provider:n})]})})]}),!a&&r("div",{className:"fixed inset-0 z-30 bg-black/50 lg:hidden",onClick:m})]}):r("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:r("div",{className:"text-center",children:[r("div",{className:"w-16 h-16 bg-gray-200 dark:bg-gray-700 rounded-full animate-pulse mx-auto mb-4"}),r("p",{className:"text-gray-600 dark:text-gray-400",children:"Connecting to server..."})]})})}ie(r(pa,{}),document.getElementById("app"));
